!function(t,c,s){class a{constructor(e){"function"==typeof e&&(e={initSuccessCallback:e});var t=JSON.parse(localStorage.getItem("FicoTTSOptions"));u=Object.assign({},u,a.defaults,t,e),this.init()}}const l={"en-au-x-afh-network":"Narelle","en-au-x-aua-network":"Abigail","en-au-x-aub-network":"Braith","en-au-x-auc-network":"Kayla","en-au-x-aud-network":"Lachlan","en-gb-x-fis-network":"Keira","en-gb-x-gba-network":"Grace","en-gb-x-gbb-network":"Taylor","en-gb-x-gbc-network":"Lauren","en-gb-x-gbd-network":"Nicholas","en-gb-x-gbg-network":"Libby","en-gb-x-rjs-network":"Peter","en-in-x-ahp-network":"Sayyar","en-in-x-cxx-network":"Bahiya","en-in-x-ena-network":"Farah","en-in-x-enc-network":"Atika","en-in-x-end-network":"Husam","en-in-x-ene-network":"Salah","en-ng-x-tfn-network":"Jenete","en-us-x-iob-network":"Josephine","en-us-x-iog-network":"Gloria","en-us-x-iol-network":"Joe","en-us-x-iom-network":"Paul","en-us-x-sfg-network":"Mary","en-us-x-tpc-network":"Michelle","en-us-x-tpd-network":"James","en-us-x-tpf-network":"Cathy",Alex:"Alex",Daniel:"Daniel",Fiona:"Fiona",Fred:"Fred",Karen:"Karen",Moira:"Moira",Rishi:"Rishi",Samantha:"Samantha",Tessa:"Tessa",Veena:"Veena",Victoria:"Victoria","Google US English":"Cathy","Google UK English Female":"Abbie","Google UK English Male":"Alexander","Microsoft Abeo Online (Natural) - English (Nigeria)":"Abeo","Microsoft Aria Online (Natural) - English (United States)":"Aria","Microsoft Clara Online (Natural) - English (Canada)":"Clara","Microsoft Emily Online (Natural) - English (Ireland)":"Emily","Microsoft Guy Online (Natural) - English (United States)":"Guy","Microsoft Jenny Online (Natural) - English (United States)":"Jenny","Microsoft Leah Online (Natural) - English (South Africa)":"Leah","Microsoft Natasha Online (Natural) - English (Australia)":"Natasha","Microsoft Neerja Online (Natural) - English (India)":"Neerja","Microsoft Rosa Online (Natural) - English (Philippines)":"Rosa","Microsoft Sonia Online (Natural) - English (United Kingdom)":"Sonia","Microsoft Zira Desktop - English (United States)":"Zira"},h="Hi. I'm fico advisor.";let d,p,g,u={initSuccessCallback:function(){},initFailCallback:function(){}};a.defaults={autoplay:!0,lang:"en",pitch:1,rate:.8,voiceIndex:0},function(){if("undefined"!=typeof ANI&&void 0!==ANI.ttsSpeak){const i=e=>{const t=Math.random().toString().substring(2);return c["TTSCallback"+t]=()=>{delete c["TTSCallback"+t],(e||(()=>{})).call(this)},`window.TTSCallback${t}();`};let e=i(()=>{console.info("initialize success"),d=JSON.parse(ANI.getVoices()).filter(e=>e.lang.startsWith("en-")),p=Array.from(d).sort((e,t)=>e.name.localeCompare(t.name)),this.changeOptions(),c.addEventListener("pagehide",()=>this.stop()),"function"==typeof u.initSuccessCallback&&u.initSuccessCallback()});this.init=()=>{ANI.textToSpeechInit(u.lang,e,i(()=>{console.info("initialize failed"),"function"==typeof u.initFailCallback&&u.initFailCallback()})),n()},this.changeOptions=()=>{ANI.changeTTSOptions(JSON.stringify(Object.assign({},u,{voiceIndex:d.indexOf(p[u.voiceIndex])})))},this.speak=(e,...t)=>{0<t.length&&(t=[i(t[0])]),ANI.ttsSpeak(e,t)},this.speakRepeat=(e,t,a,...n)=>{0<n.length&&(n=[i(n[0])]),ANI.ttsSpeakRepeat(e,t,a,n)},this.speakSample=(e,t,a)=>{ANI.ttsSpeakSample(h,d.indexOf(p[e]),t,a,[i(()=>{ANI.changeTTSOptions(JSON.stringify(Object.assign({},u,{voiceIndex:d.indexOf(p[e])})))})])},this.stop=(...e)=>{0<e.length&&(e=[i(e[0])]),ANI.ttsStop(e)},this.autoEnabled=()=>u.autoplay;let t,a=0;this.openSettings=()=>{if(null==d||0==d.length)return null==t?(a=0,d=JSON.parse(ANI.getVoices()).filter(e=>e.lang.startsWith("en-")),p=Array.from(d).sort((e,t)=>e.name.localeCompare(t.name)),t=setInterval(this.openSettings,250)):e in c&&a<20?a++:20<=a&&(a=0,clearInterval(t),t=null,alert("목소리 목록을 가져올 수 없습니다."),r()),!1;a=0,clearInterval(t),t=null,r()}}else{if(!("speechSynthesis"in c))return void alert('브라우저에서 지원하는 목소리가 없어서\n "읽어주는 서비스"가 제공되지 않습니다.');{let i=1,s=200,l,o;this.init=()=>{n(),(g=new SpeechSynthesisUtterance).onend=function(){1<i?(i--,l=setTimeout(()=>speechSynthesis.speak(g),s)):(clearTimeout(l),null!=o&&o(),o=null)},"onvoiceschanged"in speechSynthesis?speechSynthesis.onvoiceschanged=a:a()},this.speak=(e,t=()=>{})=>{null==this.initialized?setTimeout(()=>this.speak(e,t),250):(speechSynthesis.cancel(),clearTimeout(l),g.text=e,o=t,speechSynthesis.speak(g))},this.speakRepeat=(e,t,a,n=()=>{})=>{clearTimeout(l),speechSynthesis.speaking&&speechSynthesis.cancel(),g.text=e,i=t,s=a,o=n,speechSynthesis.speak(g)},this.speakSample=(e,t,a)=>{g.text=h,g.voice=p[e],g.rate=t,g.pitch=a,speechSynthesis.speaking&&speechSynthesis.cancel(),speechSynthesis.speak(g)},this.stop=(e=()=>{})=>{i=1,clearTimeout(l),speechSynthesis.cancel(),e()},this.autoEnabled=()=>u.autoplay,this.changeOptions=()=>{g.lang=u.lang,g.pitch=u.pitch,g.rate=u.rate,g.voice=p[u.voiceIndex]};let e,t=0;this.openSettings=()=>{if(null==d||0==d.length)return null==e?(t=0,d=speechSynthesis.getVoices().filter(e=>e.lang.startsWith("en-")&&"Google UK English Female"!=e.name),p=Array.from(d).sort((e,t)=>e.name.localeCompare(t.name)),e=setInterval(this.openSettings,250)):t<20?t++:(t=0,clearInterval(e),e=null,alert("목소리 목록을 가져올 수 없습니다."),r()),!1;t=0,clearInterval(e),e=null,r()};const a=()=>{d=speechSynthesis.getVoices().filter(e=>e.lang.startsWith("en-")&&"Google UK English Female"!=e.name),p=Array.from(d).sort((e,t)=>e.name.localeCompare(t.name)),g.voice=p[u.voiceIndex],this.initialized=!0,c.addEventListener("pagehide",()=>{this.stop()}),0<d.length&&null!=u.initSuccessCallback?u.initSuccessCallback.call(this):0==d.length&&null!=u.initFailCallback&&u.initFailCallback.call(this)}}}const n=()=>{null==s.querySelector("#ttsSettings")&&s.body.appendChild(createElement({el:"div",class:"modal fade",id:"ttsSettings",tabIndex:"-1","aria-modal":"true",role:"dialog",children:[{el:"div",class:"modal-dialog modal-dialog-centered",children:[{el:"div",class:"modal-content rounded-8",children:[{el:"style",textContent:"#ttsSettings input[type=range]::-webkit-slider-thumb {background:var(--fc-purple);}#ttsSettings .form-check-input:checked {background-color:var(--fc-purple);border-color:var(--fc-purple);}#ttsSettings .btn-check:checked+.btn {-webkit-animation: pulsate-bck 1s linear infinite both;animation: pulsate-bck 1s linear infinite both;}@-webkit-keyframes pulsate-bck {0% {-webkit-transform: scale(1);transform: scale(1);}50% {-webkit-transform: scale(0.9);transform: scale(0.9);}100% {-webkit-transform: scale(1);transform: scale(1);}}@keyframes pulsate-bck {0% {-webkit-transform: scale(1);transform: scale(1);}50% {-webkit-transform: scale(0.9);transform: scale(0.9);}100% {-webkit-transform: scale(1);transform: scale(1);}}#ttsSettings .form-check-input:focus {border-color:var(--fc-purple);box-shadow:0 0 0 0.25rem #58517440;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23847aaf'/%3e%3c/svg%3e\")}#ttsSettings input[type=range]::after {content:attr(data-range);margin-left:10px}"},{el:"div",class:"modal-header",children:[{el:"h5",class:"modal-title fw-bold text-fc-purple",textContent:"음성 환경설정"},{el:"div",class:"ms-auto text-align-end form-check form-switch",children:[{el:"input",type:"checkbox",id:"ttsToggle",class:"form-check-input",checked:u.autoplay},{el:"label",class:"form-check-label text-dark",htmlFor:"ttsToggle",textContent:"자동 재생"}]},{el:"button",type:"button",class:"btn-close ms-2","data-bs-dismiss":"modal","aria-label":"Close",title:"닫기"}]},{el:"div",class:"modal-body",children:[{el:"label",for:"ttsList",class:"form-label sub-title fs-6 text-dark",textContent:"목소리 선택"},{el:"div",class:"col-12 mb-3 row g-0",id:"ttsList"},{el:"label",for:"ttsRateRange",class:"form-label sub-title fs-6 text-dark",children:["목소리 빠르기 ",{el:"span",class:"text-secondary",textContent:"(기본: 0.8)"}]},{el:"input",type:"range",class:"form-range",id:"ttsRateRange",min:"0.1",max:"2",step:"0.1","data-range":u.rate.toFixed(1),value:u.rate.toFixed(1),oninput:function(){this.dataset.range=parseFloat(this.value).toFixed(1)}},{el:"label",for:"ttsPitchRange",class:"form-label sub-title fs-6 text-dark",children:["목소리 높이 ",{el:"span",class:"text-secondary",textContent:"(기본: 1.0)"}]},{el:"input",type:"range",class:"form-range",id:"ttsPitchRange",min:"0",max:"2",step:"0.1","data-range":u.pitch.toFixed(1),value:u.pitch.toFixed(1),oninput:function(){this.dataset.range=parseFloat(this.value).toFixed(1)}}]}]}]}]}))},r=()=>{var e=s.getElementById("ttsList");e.replaceChildren(createElement(Array.from(d,(e,t)=>({el:"div",class:"col-3 p-1 p-sm-3",children:[{el:"input",value:t,id:"ttsVoice"+t,name:"ttsVoice",type:"radio",class:"btn-check d-none","data-v-name":e.name},{el:"label",htmlFor:"ttsVoice"+t,class:"btn btn-outline-fico position-relative border-0 mx-auto p-1",children:[{el:"img",class:"rounded-circle w-100",src:`https://static.findsvoc.com/images/app/tts/profile/${l[e.name]||"default"}.jpg`},{el:"img",class:"rounded-3 position-absolute bottom-0 end-0 border",src:`https://flagcdn.com/w40/${e.lang.replace("scotland","GB-SCT").toLowerCase().substring(3)}.png`,style:"width:33%"}]},{el:"span",class:"d-block ps-2 text-fico",textContent:l[e.name]||e.name}]})).sort((e,t)=>e.children[0]["data-v-name"].localeCompare(t.children[0]["data-v-name"])))),t(e).find(`[name="ttsVoice"]:eq(${u.voiceIndex})`).prop("checked",!0),t("#ttsSettings").modal("show")};t(s).on("change","#ttsToggle",e=>{u.autoplay=e.target.checked}).on("click change","[name=ttsVoice], #ttsRateRange, #ttsPitchRange",()=>{this.speakSample(parseInt(t('#ttsSettings [name="ttsVoice"]:checked').index('[name="ttsVoice"]')),parseFloat(t("#ttsRateRange").val()),parseFloat(t("#ttsPitchRange").val()))}).on("hide.bs.modal","#ttsSettings",()=>{var e={voiceIndex:t('#ttsSettings [name="ttsVoice"]:checked').index('[name="ttsVoice"]'),pitch:parseFloat(t("#ttsPitchRange").val()),rate:parseFloat(t("#ttsRateRange").val())};u=Object.assign(u,e),this.changeOptions(),this.stop(),localStorage.setItem("FicoTTSOptions",JSON.stringify(Object.assign({},u)))})}.call(a.prototype),globalThis.FicoTTS=a}(jQuery,this,document);