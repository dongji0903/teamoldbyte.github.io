!function(){const l="savedWordList",c=".one-word-unit-section",s={el:"span",role:"button",class:"js-save-word keep-word-btn fas fa-download fa-sm",dataset:{bsToggle:"tooltip",bsTitle:"보관하기"}},p={el:"span",role:"button",class:"js-unsave-word unkeep-word-btn fas fa-bookmark",dataset:{bsToggle:"tooltip",bsHtml:!0,bsTitle:"보관된 단어입니다.<br>보관을 해제하려면 다시 클릭"}},n={el:"div",class:"js-unsaved-toast toast align-items-center text-white p-0",role:"alert",style:{width:"150px",background:"#1b1f40",zIndex:9999},dataset:{bsDelay:1e3},ariaLive:"assertive",ariaAtomic:"true",children:[{el:"div",class:"toast-body p-1",textContent:"보관 해제되었습니다."}]};let m,h;new Promise((e,a)=>{sessionStorage.getItem(l)?(h=JSON.parse(sessionStorage.getItem(l)),e()):$.getJSON("/memento/keepword/init",s=>{h=s;let o=0;!function t(){try{sessionStorage.setItem(l,JSON.stringify(h.slice(o))),0<o&&alertModal("브라우저 저장 공간이 부족하여 가장 오래 전 저장한 단어 "+o+"개는 제외되었습니다."),e()}catch(e){e instanceof QuotaExceededError&&(o>=s.length&&(alertModal("브라우저의 저장 공간이 부족합니다."),a()),o++,t())}}()}).fail(()=>alertModal("저장된 단어 목록을 읽어오지 못했습니다.",a))}).then(()=>$.getScript("https://static.findsvoc.com/js/util/datetime-util.min.js")).then(()=>{$.getScript("https://static.findsvoc.com/js/public/peel.min.js",()=>{document.head.appendChild(createElement([{el:"link",rel:"stylesheet",href:"https://static.findsvoc.com/css/public/peel.min.css"},{el:"link",rel:"stylesheet",href:"https://static.findsvoc.com/css/app/keepword.min.css"}])),$(function(){m=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){m.unobserve(e.target);{e=e.target;const t=$(e).data().wordId,n=h.find(e=>e.wordId==t);n?($(e).addClass("saved").data("keepWordId",n.keepWordId).find(".title").before($(createElement(p)).show()),$(e).find(".meaning").each((e,t)=>{t.style.verticalAlign="middle";var s=Array.from(t.getClientRects(),e=>e.width).reduce((e,t)=>e+t),o=t.getClientRects()[0].height,t=($(t).wrapInner('<div class="d-inline-block peel"><div class="peel-bottom"></div></div>').find(".peel").prepend(`<div class="peel-top text-center fw-bold text-primary"><div class="position-relative top-50 translate-middle-y">${new Date(n.saveDate).format(s<54?"MM-dd":"yyyy-MM-dd")}</div></div><div class="peel-back"></div>`),$(t).find(".peel")[0]);t.style.width=s+10+"px",t.style.height=o+10+"px";const a=new Peel(t,{path:{"stroke-width":0,d:`M0,0 C0,5 ${s+10},5 ${s+10},0 ${s+10},0 ${s+10},${o+5} ${s+10},${o+5} ${s+10},${o+10} 0,${o+10} 0,${o+5} 0,${o+5} 0,0 0,0`},bottomShadowOffset:2,corner:Peel.Corners.TOP_LEFT});a.setFadeThreshold(.7),a.setPeelPosition(25,10),a.setPeelPath(25,10,a.width/2,2*a.height,a.width,2*a.height,2*a.width,a.height/2);let i;a.handleDrag(function(e,t,s){.85<a.getAmountClipped()&&(a.removeEvents(),$(a.el).closest(".meaning").text($(a.bottomLayer).text()));t=(t-(i=i||t))/a.width;this.setTimeAlongPath(t)}),$(t).data("peel",a)})):$(e).is(".saved")&&($(e).removeClass("saved").find(".js-unsave-word").remove(),$(e).find(".peel")?.data("peel")?.removeEvents(),$(e).find(".meaning").each((e,t)=>{$(t).text($(t).find(".peel-bottom").text())}))}}})}),$(c).each((e,t)=>m.observe(t)),$(document).on("DOMNodeInsertedIntoDocument",c,function(){m.observe(this)})})})}),$(document).on("mouseover",c,function(){var e,t;$(this).is(".saved,.processing")||0<$(this).find(".js-save-word").length||(e=createElement(s),t=$(this).find(".title"),$(e).css("--offset",Math.max(t[0].offsetWidth/2,22)+"px"),$(e).insertAfter(t))}).on("mouseleave",c,function(){$(this).is(".processing")||$(this).find(".js-save-word").remove()}).on("click",".js-save-word",function(){var e=$(this).closest(c);if(!e.is(".processing")){e.addClass("processing");const{wordId:r,sentenceId:t,workbookId:s}=e.data();new Promise((e,t)=>{setTimeout(()=>e(),1e3)}).then(()=>{new Promise((e,t)=>{Date.prototype.format?e((new Date).format("yyyy-MM-dd")):$.getScript("https://static.findsvoc.com/js/util/datetime-util.min.js",()=>e((new Date).format("yyyy-MM-dd")))}).then(d=>{$.ajax({url:"/memento/word/save",type:"POST",contentType:"application/json",data:JSON.stringify({wordId:r,sentenceId:t,workbookId:s,saveDate:d}),success:e=>{var{wordId:t,keepWordId:s,saveDate:o}=t={wordId:r,keepWordId:e,saveDate:d},t={wordId:t,keepWordId:s,saveDate:o};h?h.push(t):h=[t],sessionStorage.setItem(l,JSON.stringify(h));{var a=this,i=e;const n=$(createElement(p));anime({targets:a,translateY:-20,opacity:0,easing:"linear",complete:e=>{const s=$(a).closest(c);$(c).filter((e,t)=>$(t).data("wordId")==s.data("wordId")&&!$(t).is(".saved,.processing")).each((e,t)=>{m.unobserve(t),m.observe(t)}),s.data("keepWordId",i).removeClass("processing").addClass("saved").find(".title").before(n),$(a).remove(),n.fadeIn()}})}},error:()=>alertModal("단어 보관에 실패했습니다.")})})})}}).on("hidden.bs.toast",".js-saved-toast",function(){}).on("click",".js-unsave-word",function(e){e.stopPropagation(),e.stopImmediatePropagation();e=$(this).closest(c);if(!e.is(".processing")){e.addClass("processing"),$(this).tooltip("hide");const i=e.data()["keepWordId"];$.ajax({url:"/memento/word/change-status",type:"POST",contentType:"application/json",data:JSON.stringify({keepWordId:i,del:!0}),success:()=>{var t;t=i,h&&(h=h.filter(e=>e.keepWordId!=t),sessionStorage.setItem(l,JSON.stringify(h)));{var e=this;const s=createElement(n),o=createElement({el:"div",class:"position-absolute start-0 bottom-100"}),a=(o.appendChild(s),$(e).closest(c).removeData("keepWordId"));a.prepend(o),e.style.transformOrigin="200% 0",anime({targets:e,rotateX:"-90deg",rotateZ:"-150deg",scale:2,opacity:0,easing:"linear",duration:500,complete:()=>{$(e).remove(),a.removeClass("saved processing").find(".meaning").each(function(){$(this).find(".peel").each((e,t)=>{const s={t:0},o=$(t).data("peel");anime({targets:s,duration:2e3,t:1,change:e=>{o.setTimeAlongPath(s.t)},complete:e=>{o.removeEvents(),$(this).text($(this).find(".peel-bottom").text())}})})})}}),$(s).toast("show")}},error:()=>alertModal("단어 보관 해제에 실패했습니다.")})}}).on("hidden.bs.toast",".js-unsaved-toast",function(){$(this).parent().remove()})}();