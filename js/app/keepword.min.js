!function(){const r="savedWordList",t="one-word-unit-section",n="."+t,s={el:"span",role:"button",class:"js-save-word keep-word-btn fas fa-download",dataset:{bsToggle:"tooltip",bsTitle:"보관하기"},children:[{el:"span",class:"keep-word-tail"}]},i={el:"span",role:"button",class:"js-unsave-word unkeep-word-btn fas fa-bookmark",dataset:{bsToggle:"tooltip",bsHtml:!0,bsTitle:"보관된 단어입니다.<br>보관을 해제하려면 다시 클릭"}},d={el:"div",class:"js-unsaved-toast toast align-items-center text-white p-0",role:"alert",style:{width:"150px",background:"#1b1f40",zIndex:9999},dataset:{bsDelay:1e3},ariaLive:"assertive",ariaAtomic:"true",children:[{el:"div",class:"toast-body p-1",textContent:"보관 해제되었습니다."}]};let l,c;function a(d,o,a){return new Promise((n,e)=>{const t=c.findIndex(e=>e.wordId==d);if(-1<t){const s=c[t].keepWordId;$.ajax({url:"/memento/word/change-status",type:"POST",contentType:"application/json",data:JSON.stringify({keepWordId:s,del:!1}),success:()=>{c[t].del=!1,sessionStorage.setItem(r,JSON.stringify(c)),n(s)},error:e})}else new Promise((e,t)=>{Date.prototype.format?e((new Date).format("yyyy-MM-dd")):$.getScript("https://static.findsvoc.com/js/util/datetime-util.min.js",()=>e((new Date).format("yyyy-MM-dd")))}).then(i=>{$.ajax({url:"/memento/word/save",type:"POST",contentType:"application/json",data:JSON.stringify({wordId:d,sentenceId:o,workbookId:a,saveDate:i}),success:e=>{var{wordId:t,keepWordId:s,saveDate:o,del:a}=t={wordId:d,keepWordId:e,saveDate:i,del:!1},t={wordId:t,keepWordId:s,saveDate:o,del:a};c?c.push(t):c=[t],sessionStorage.setItem(r,JSON.stringify(c)),n(e)},error:e})})})}new Promise((e,a)=>{sessionStorage.getItem(r)?(c=JSON.parse(sessionStorage.getItem(r)),e()):$.getJSON("/memento/keepword/init",o=>{if(Array.isArray(o)){c=o;let s=0;!function t(){try{sessionStorage.setItem(r,JSON.stringify(c.slice(s))),0<s&&alertModal("브라우저 저장 공간이 부족하여 가장 오래 전 저장한 단어 "+s+"개는 제외되었습니다."),e()}catch(e){e instanceof QuotaExceededError&&(s>=o.length&&(alertModal("브라우저의 저장 공간이 부족합니다."),a()),s++,t())}}()}else alertModal("저장된 단어 목록을 읽어오지 못했습니다.",a)}).fail(()=>alertModal("저장된 단어 목록을 읽어오지 못했습니다.",a))}).then(()=>$.getScript("https://static.findsvoc.com/js/util/datetime-util.min.js")).then(()=>{$.getScript("https://static.findsvoc.com/js/public/peel.min.js",()=>{document.head.appendChild(createElement([{el:"link",rel:"stylesheet",href:"https://static.findsvoc.com/css/public/peel.min.css"},{el:"link",rel:"stylesheet",href:"https://static.findsvoc.com/css/app/keepword.min.css"}])),$(function(){l=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){l.unobserve(e.target);{e=e.target;const t=$(e).data().wordId,n=c.find(e=>e.wordId==t&&!e.del);n?($(e).addClass("saved").data("keepWordId",n.keepWordId).find(".title").before($(createElement(i)).show()),$(e).find(".meaning").each((e,t)=>{var s=Array.from(t.getClientRects(),e=>e.width).reduce((e,t)=>e+t),o=t.getClientRects()[0].height,t=($(t).wrapInner('<div class="d-inline-block peel"><div class="peel-bottom"></div></div>').find(".peel").prepend(`<div class="peel-top text-center fw-bold text-primary"><div class="position-relative top-50 translate-middle-y">${new Date(n.saveDate).format(s<54?"MM-dd":"yyyy-MM-dd")}</div></div><div class="peel-back"></div>`),$(t).find(".peel")[0]);t.style.width=s+10+"px",t.style.height=o+10+"px";const a=new Peel(t,{path:{"stroke-width":0,d:`M0,0 C0,5 ${s+10},5 ${s+10},0 ${s+10},0 ${s+10},${o+5} ${s+10},${o+5} ${s+10},${o+10} 0,${o+10} 0,${o+5} 0,${o+5} 0,0 0,0`},bottomShadowOffset:2,corner:Peel.Corners.TOP_LEFT});a.setFadeThreshold(.7),a.setPeelPosition(25,10),a.setPeelPath(25,10,a.width/2,2*a.height,a.width,2*a.height,2*a.width,a.height/2);let i;a.handleDrag(function(e,t,s){.85<a.getAmountClipped()&&(a.removeEvents(),$(a.el).closest(".meaning").text($(a.bottomLayer).text()));t=(t-(i=i||t))/a.width;this.setTimeAlongPath(t)}),$(t).data("peel",a)})):$(e).is(".saved")&&($(e).removeClass("saved").find(".js-unsave-word").remove(),$(e).find(".peel")?.data("peel")?.removeEvents(),$(e).find(".meaning").each((e,t)=>{$(t).text($(t).find(".peel-bottom").text())}))}}})}),$(n).each((e,t)=>{l.observe(t)}),new MutationObserver(e=>{e?.forEach(e=>{"childList"==e.type&&e.addedNodes?.forEach(e=>{e.nodeType==Node.ELEMENT_NODE&&e.classList?.contains(t)&&l.observe(e)})})}).observe(document,{childList:!0,subtree:!0})})})}),$(document).on("mouseover",n,function(){var e,t;$(this).is(".saved,.processing")||0<$(this).find(".js-save-word").length||(e=createElement(s),t=$(this).find(".title"),$(e).css("--offset",Math.max(t[0].offsetWidth/2,22)+"px"),$(e).insertAfter(t))}).on("mouseleave",n,function(){$(this).is(".processing")||$(this).find(".js-save-word").remove()}).on("click",".js-save-word",function(e){e.stopPropagation();e=$(this).closest(n);if(!e.is(".processing")){e.addClass("processing");const{wordId:t,sentenceId:s,workbookId:o}=e.data();setTimeout(()=>{a(t,s,o).then(e=>{{var t=this,o=e;const a=$(createElement(i));anime({targets:t,translateY:-20,opacity:0,easing:"linear",complete:e=>{const s=$(t).closest(n);$(n).filter((e,t)=>$(t).data("wordId")==s.data("wordId")&&!$(t).is(".saved,.processing")).each((e,t)=>{l.unobserve(t),l.observe(t)}),s.data("keepWordId",o).removeClass("processing").addClass("saved").find(".title").before(a),$(t).remove(),a.fadeIn()}})}}).catch(()=>alertModal("단어 보관에 실패했습니다."))},1e3)}}).on("click",".js-unsave-word",function(e){e.stopPropagation(),e.stopImmediatePropagation();e=$(this).closest(n);if(!e.is(".processing")){e.addClass("processing"),$(this).tooltip("hide");const i=e.data()["keepWordId"];$.ajax({url:"/memento/word/change-status",type:"POST",contentType:"application/json",data:JSON.stringify({keepWordId:i,del:!0}),success:()=>{var t;t=i,c&&(c.find(e=>e.keepWordId==t).del=!0,sessionStorage.setItem(r,JSON.stringify(c)));{var e=this;const s=createElement(d),o=createElement({el:"div",class:"position-absolute start-0 bottom-100"}),a=(o.appendChild(s),$(e).closest(n).removeData("keepWordId"));a.prepend(o),e.style.transformOrigin="200% 0",anime({targets:e,rotateX:"-90deg",rotateZ:"-150deg",scale:2,opacity:0,easing:"linear",duration:500,complete:()=>{$(e).remove(),a.removeClass("saved processing").find(".meaning").each(function(){$(this).find(".peel").each((e,t)=>{const s={t:0},o=$(t).data("peel");anime({targets:s,duration:2e3,t:1,change:e=>{o.setTimeAlongPath(s.t)},complete:e=>{o.removeEvents(),$(this).text($(this).find(".peel-bottom").text())}})})})}}),$(s).toast("show")}},error:()=>alertModal("단어 보관 해제에 실패했습니다.")})}}).on("hidden.bs.toast",".js-unsaved-toast",function(){$(this).parent().remove()}),Object.assign(window,{keepWord:a})}();