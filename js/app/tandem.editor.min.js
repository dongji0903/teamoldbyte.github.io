!function(b,y,C){let a=[],s=[],g,x;const l={49:'[value="s"]',50:'[value="v"]',51:'[value="o"]',52:'[value="c"]',53:'[value="oc"]',54:'[value="a"]',81:'[value="tor"]',87:'[value="ptc"]',69:'[value="ger"]',82:'[value="conj"]',65:'[value="phr"]',83:'[value="adjphr"]',68:'[value="advphr"]',70:'[value="ptcphr"]',84:'[value="ccls"]',89:'[value="ncls"]',71:'[value="acls"]',72:'[value="advcls"]',90:'[value="mod"]',88:'[value="erasing"]',67:'[value="comment"]',ctrlS:'[value="save"]',ctrlZ:'[value="undo"]:not([disabled])',ctrlY:'[value="redo"]:not([disabled])'};let c,d=0,m=0,u={};function w(t){var e=t.dataset.seq;a.push([e,t.innerHTML]),s=[],b('.svoc-toolbar [value="undo"]').prop("disabled",!1)}function k(t){b(t).find(".sem").filter((t,e)=>0==e.textContent.length).remove(),C.checkPOSDepth(t),C.wrapWithBracket(t),C.splitInners(t),C.trimTextContent(t),C.correctMarkLine(t),b(".edit-svoc").focus()}b.fn.svoceditor=async function(t,e,o){return u={forNew:t,saveCallback:e,cancelCallback:o},"close"==t?(void 0!==g&&g.detach(),void 0!==x&&x.detach()):(void 0===g&&(await b.get("https://static.findsvoc.com/css/app/tandem.editor.min.css",t=>{var e=y.createElement("style");e.innerHTML=t,y.head.append(e)}),await b.getJSON("https://static.findsvoc.com/data/tandem/edit-toolbar.json",o=>{g=b('<div id="js-edit-toolbar" class="svoc-toolbar row g-2 btn-toolbar" role="toolbar"></div>');for(let t=0,e=o.length;t<e;t++)!function o(a,t){let s,e;switch(a.type){case"group":e="btn-group col-auto";case"div":e=a.class||e,s=y.createElement("div");break;default:e=a.class||"btn btn-outline-dark col-auto btn-sm",(s=y.createElement("button")).dataset.toggle="tooltip",s.dataset.placement="bottom",s.dataset.mode=a.mode,s.title=a.title,s.value=a.value,s.innerHTML=a.html}s.className=e;t.append(s);if(a.children)for(let t=0,e=a.children.length;t<e;t++)o(a.children[t],b(s))}(o[t],g);g.find('[data-toggle="tooltip"]').click(function(){b(this).tooltip("hide")}).tooltip({trigger:"hover"});const n=parseFloat(getComputedStyle(y.body).fontSize);b(y).on("keydown",function(t){b(t.target).is("input")&&0<b(t.target).closest(".edit-comment").length&&27==t.keyCode?b(t.target.form).find("button:eq(1)").trigger("click"):b(".edit-svoc")?.is(":focus")&&((t.ctrlKey||t.metaKey)&&65<=t.keyCode&&t.keyCode<=90?l["ctrl"+t.key.toUpperCase()]&&(t.preventDefault(),g.find(l["ctrl"+t.key.toUpperCase()]).trigger("click")):b(t.target).is("input")||null==l[t.keyCode]||g.find(l[t.keyCode]).trigger("click"))}),g.on("click",'[value="save"]',function(){var e,t=this.closest(".edit-svoc").querySelector(".semantics-result");for(b(t).closest(".edit-svoc").addClass("pe-none").find(".svoc-editor-badge").html('<i class="fas fa-spinner fa-spin"></i> 저장중').animate({width:"100%"});null!=t.querySelector(".brkt,.line-end,canvas.curved_arrow");)t.querySelector(".brkt,.line-end,canvas.curved_arrow").remove();e=t,requestAnimationFrame(async function(){var t=await C.getSvocBytes(e);C.wrapWithBracket(e),C.correctMarkLine(e),a=[],s=[],g.find('[value="undo"], [value="redo"]').prop("disabled",!0),u.saveCallback(t),b(".svoc-editor-badge").html('<i class="fas fa-check"></i> 저장됨'),setTimeout(()=>{x.text(""),b(e).unwrap(),g.find('[value="undo"], [value="redo"]').prop("disabled",!0),g.find("button").removeClass("active").tooltip("hide"),b(".js-edit-svoc,.js-del-svoc,.js-add-svoc").prop("disabled",!1),b(".svoc-editor-badge,.svoc-editor-emblem").remove(),g.detach(),x.detach()},2e3)})}).on("click",'[value="close"]',function(){var t,e;confirm("수정내역은 저장되지 않습니다.\n편집모드를 종료하시겠습니까?")&&(t=b(this).closest(".edit-svoc").find(".semantics-result"),0<a.length&&(e=a.shift(),t.html(e[1]),b(".erasing-target").toggleClass("erasing-target"),b(".mod-start,.mod-indicator").remove(),C.drawConnections(t[0]),t.animate({opacity:.5},100).animate({opacity:1},100)),e=t,g.find('[value="undo"], [value="redo"]').prop("disabled",!0),g.find("button").removeClass("active").tooltip("hide"),e.unwrap(),a=[],s=[],b(".svoc-editor-badge,.svoc-editor-emblem").remove(),g.detach(),x.detach(),u.cancelCallback())}).on("click","[data-mode]:not([disabled])",function(){if("undo"==this.dataset.mode)return!0;let t=getSelection(),e;if(b(".svoc-toolbar .active").add(this).toggleClass("active"),b(".erasing-target, .comment-target").removeClass("erasing-target comment-target"),b(".mod-start,.mod-indicator").remove(),b(this).is(".active")){var o=this.dataset.mode;switch(b(".edit-svoc").attr("data-mode",o),o){case"role":case"wrap":t.isCollapsed?x.text("적용 텍스트를 드래그 하세요."):(b(".edit-svoc").trigger("mouseup",this.value).attr("data-mode",null),b(this).removeClass("active"));break;case"erasing":x.html("지우려는 태그를 클릭 하세요.<br><h6>하위태그 모두 선택 : shift+클릭</h6>"),t.removeAllRanges();break;case"mod":x.text("수식어 위치를 클릭 하세요."),t.removeAllRanges();break;case"comment":x.text("문법 코멘트를 추가할 요소를 선택하세요."),t.removeAllRanges()}if(t.isCollapsed){if(y.caretPositionFromPoint)e=y.caretPositionFromPoint(d,m);else{if(!y.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;e=y.caretRangeFromPoint(d,m)}let t=e.startContainer;for(;1!=t.nodeType;)t=t.parentNode;b(t).trigger("mouseover")}}else b(".edit-svoc").attr("data-mode",null),x.empty()}).on("click",'[value="undo"], [value="redo"]',function(t){var e;t.preventDefault(),("undo"==this.value||"redo"==this.value&&0<s.length)&&(this.classList.add("active"),t=("undo"==this.value?a:s).pop(),e=b(`.edit-svoc .semantics-result[data-seq="${t[0]}"]`),("undo"==this.value?s:a).push([e.attr("data-seq"),e.html()]),e.html(t[1]),b(".erasing-target").toggleClass("erasing-target"),b(".mod-start,.mod-indicator").remove(),C.drawConnections(e[0]),e.animate({opacity:.5},100).animate({opacity:1},100),b('.svoc-toolbar [value="undo"]').prop("disabled",0==a.length),b('.svoc-toolbar [value="redo"]').prop("disabled",0==s.length),setTimeout(()=>{this.classList.remove("active")},50))});let i=[],r=null,e=!1;function f(){b(y).on("mouseover",'[data-mode="comment"] .semantics-result .sem',function(t){null!=this.dataset.gc&&0!=this.dataset.gc.length||(t.stopPropagation(),this.classList.add("comment-target"))}).on("mouseout",'[data-mode="comment"] .semantics-result *',function(){b(".comment-target").removeClass("comment-target")})}b(y).on("mouseover",'[data-mode="erasing"] .semantics-result *',function(e,o){e.stopPropagation();var a=e.target;if(r=a,s(),b(a).is(".curved_arrow"))for(var t of a.classList)-1<t.indexOf("mfd")&&(b(this).siblings(".curved_arrow."+t).each(function(){i.push(this)}),i.push(b(".rcm.mfd-"+t.substring(3))[0]));function s(){if(null!=a){if(i.push(a),o||e.shiftKey)for(var t of a.getElementsByTagName("span"))i.push(t);a.textContent==a.parentElement.textContent?(a=a.parentElement,i.push(a)):0<a.children.length&&a.children[0].textContent==a.textContent&&i.push(a.children[0])}}null!=a.previousElementSibling&&b(a.previousElementSibling).is('[class*="-start"]:not([class*="cmnt-align-start"])')&&null!=a.nextElementSibling&&b(a.nextElementSibling).is('[class*="-end"]')&&(i.push(a.previousElementSibling),i.push(a.nextElementSibling)),-1<a.className.indexOf("-start")?(a=a.nextElementSibling,s(),null!=a&&null!=a.nextElementSibling&&(a=a.nextElementSibling,i.push(a))):-1<a.className.indexOf("-end")&&(a=a.previousElementSibling,s(),null!=a)&&null!=a.previousElementSibling&&(a=a.previousElementSibling,i.push(a)),i.forEach(function(t){t.classList.add("erasing-target")})}).on("mouseout",'[data-mode="erasing"] .semantics-result *',function(t){i.forEach(function(t){b(t).removeClass("erasing-target")}),i=[],r=null,t.stopPropagation()}).on("keydown keyup",function(t){("keydown"==t.type&&!e&&t.shiftKey||"keyup"==t.type&&e&&!t.shiftKey)&&(e=!e,b(y.body).toggleClass("shift",e),null!=r)&&b(r).trigger("mouseout").trigger("mouseover",[e])}).on("click",".erasing-target",function(t){var e=t.target.closest(".semantics-result")||t.target;e.closest('[data-mode="erasing"]')&&(w(e),i.forEach(function(t){0==t.textContent.length||t.matches(".brkt")?b(t).remove():b(t).contents().unwrap()})),b(e).find(".rcm").each(function(){for(var t of this.classList)-1<t.indexOf("mfd")&&0==b(`[data-mfd="${t.substring(4)}"]`).length&&b(this).contents().unwrap()}),b(e).find("[data-mfd]").each(function(){0==b(".rcm.mfd-"+this.dataset.mfd).length&&delete this.dataset.mfd}),t.shiftKey&&getSelection().removeAllRanges(),k(e)}).on("mouseup",'.edit-svoc[data-mode="role"], .edit-svoc[data-mode="wrap"]',function(t,e){t.stopPropagation();var t=g.find(".active").val(),o=getSelection(),a=o?.anchorNode?.parentElement?.closest(".semantics-result");if(!o.isCollapsed){if(w(a),"role"==this.dataset.mode){var a=o,s=e||t,n={s:"S",v:"V",o:"O",c:"C",oc:"o.c.",m:"M",a:"A"},i={a:"부사적 보충어",tor:"to부정사",ger:"동명사",ptc:"분사"},r=a.getRangeAt(0),l=y.createElement("span");l.className="sem "+s,null!=n[s]&&(l.dataset.rc=n[s],l.dataset.rcMin=n[s].substring(0,"oc"==s?4:1)),null!=i[s]&&(l.dataset.gc=i[s]);try{r.surroundContents(l)}catch(t){l.appendChild(r.extractContents()),r.insertNode(l)}r.detach(),a.removeAllRanges(),k(n=b(l).closest(".semantics-result")[0])}else if("wrap"==this.dataset.mode){var c=o;var d=e||t;const u={s:"S",o:"O",c:"C",oc:"o.c.",m:"M",a:"A"},p={ncls:{s:"주어절",o:"목적어절",c:"보어절",oc:"목적보어절",m:"관계절"},acls:"형용사절",advcls:"부사절",phr:"전치사구",adjphr:"형용사구",advphr:"부사구",ptcphr:"부사구(분사구문)",ccls:"등위절"},v=c.getRangeAt(0),f=b(v.startContainer).closest(".semantics-result")[0];switch(d){case"ncls":const h=y.createElement("div");h.className="cls-role-menu",h.style.position="absolute",h.style.top=scrollY+v.getClientRects()[0].top+v.getClientRects()[0].height+"px",h.style.left=scrollX+v.getClientRects()[0].left+"px",h.insertAdjacentHTML("afterbegin",'<button class="cls-role-btn" value="s">s</button><button class="cls-role-btn" value="o">o</button><button class="cls-role-btn" value="c">c</button><button class="cls-role-btn" value="oc">oc</button>'),y.body.appendChild(h);let a=!1;b(y).on("click",function t(e){if(a){if(16==(16&h.compareDocumentPosition(e.target))){var o=y.createElement("span");o.className="sem "+e.target.value,null!=u[e.target.value]&&(o.dataset.rc=u[e.target.value]);try{v.surroundContents(o)}catch(t){o.appendChild(v.extractContents()),v.insertNode(o)}o=y.createElement("span");o.className="sem "+d,o.dataset.gc=p[d][e.target.value];try{v.surroundContents(o)}catch(t){o.appendChild(v.extractContents()),v.insertNode(o)}v.detach(),c.removeAllRanges(),k(f)}b(y).off("click",t),b(h).remove()}else a=!0});break;case"acls":case"advcls":var m=y.createElement("span");m.className="sem m",m.dataset.rc=u.m;try{v.surroundContents(m)}catch(t){m.appendChild(v.extractContents()),v.insertNode(m)}C.trimTextContent(f),v.selectNode(m);default:m=y.createElement("span");m.className="sem "+d,p[d]&&(m.dataset.gc=p[d]);try{v.surroundContents(m)}catch(t){m.appendChild(v.extractContents()),v.insertNode(m)}v.detach(),c.removeAllRanges(),k(f)}}b(".edit-svoc").attr("data-mode",null),g.find(".active").removeClass("active"),x.empty()}}).on("click",'.edit-svoc:not([data-mode="erasing"]):not([data-mode="mod"]):not([data-mode="comment"]) .sem',function(t){b(".edit-comment").remove();var o=this,a=("touchstart"==t.type?t.touches[0]:t).clientX,s=("touchstart"==t.type?t.touches[0]:t).clientY,n=this.getClientRects(),i=b(this).is(".odd")?1:0,r=b(this).is(".rcm")?1:0,l=i?-1:1,c=r?-1:1,d=["top","bottom"][i],m=["left","right"][r];for(let e of[{data:"rc",pseudo:"::before"},{data:"gc",pseudo:"::after"}]){var u=getComputedStyle(o,e.pseudo),p=parseFloat(u[d]),v=parseFloat(u[m]),f=parseFloat(u.width),u=parseFloat(u.height);if(null!=o.dataset[e.data]&&!isNaN(f)&&!isNaN(u)){p=n[i][d]+l*p,u=p+l*u,v=n[r?n.length-1:0][m]+c*v,f=v+c*f;if(Math.min(p,u,s)!=s&&Math.max(p,u,s)!=s&&Math.min(v,f,a)!=a&&Math.max(v,f,a)!=a){t.stopPropagation();var h=y.createElement("div");function g(t){16!=(16&h.compareDocumentPosition(t.target))&&(b(y).off("mousedown",g),b(h).remove(),b(".edit-svoc").focus())}h.className="edit-comment text-end",h.style.position="absolute",h.insertAdjacentHTML("afterbegin",'<form class="btn-group"><input class="form-control" type="text"'+`placeholder="↵" value="${o.dataset[e.data]}"/>`+'<div class="btn-group ms-1"><button class="btn btn-sm btn-fico" type="submit">확인</button><button class="btn btn-sm btn-outline-fico" type="button">취소</button></div></form>'),y.body.appendChild(h),h.style.top=scrollY+Math.max(p,u)+"px",h.style.left=scrollX+Math.min(v,f)+"px","gc"==e.data&&(h.style.top=scrollY+Math.min(p,u)-h.offsetHeight-10+"px"),h.firstChild.firstChild.focus(),b(y).on("mousedown",g),b(h).find("form").on("submit",function(t){t.preventDefault(),w(o.closest(".semantics-result"));t=b(this).find("input").val().trim();0==t.length?delete o.dataset[e.data]:o.dataset[e.data]=t,b(y).off("mousedown",g),b(h).remove(),C.checkGCDepth(o.closest(".semantics-result")),b(".edit-svoc").focus()}),b(h).find("button:eq(1)").on("click",function(){b(y).off("mousedown",g),b(h).remove(),b(".edit-svoc").focus()});break}}}}).on("mouseover",'[data-mode="mod"] .semantics-result *',function(t){b(".mod-indicator").remove();var e=".cls,.acls,.ncls,.advcls,.phr,.tor,.ger,.adjphr,.ptc",e=b(this).is(e)?this:0==b(this).closest(e).length?null!=this.dataset.lv?this:null:b(this).closest(e)[0];if(null==e||e.textContent.trim().length<2||null!=e.dataset.mfd)return c=null,!1;t.stopPropagation(),c=e;t=y.createElement("div");t.className="mod-indicator",t.style.position="absolute",t.style.top=scrollY+e.getClientRects()[0].top-3*n+"px",t.style.left=scrollX+e.getClientRects()[0].left-.8*n+"px",t.textContent="↑",y.body.appendChild(t)}).on("mousemove",".edit-svoc .semantics-result",function(t){d=("touchstart"==t.type?t.touches[0]:t).clientX,m=("touchstart"==t.type?t.touches[0]:t).clientY;let e,o,a;if(0<b(t.target).closest('[data-mode="mod-end"] .semantics-result').length){b(".mod-indicator").remove();var s=y.createElement("div");if(s.className="mod-indicator",s.style.position="absolute",y.caretPositionFromPoint)o=y.caretPositionFromPoint(d,m);else{if(!y.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;o=y.caretRangeFromPoint(d,m)}if("function"==typeof Selection.prototype.modify){if((e=getSelection()).removeAllRanges(),e.addRange(o),e.modify("move","backward","word"),e.modify("extend","forward","word"),0==e.rangeCount||null==e.toString().trim().match(/\w/))return e.removeAllRanges(),!1;if(a=e.getRangeAt(0).getClientRects()[0],e.removeAllRanges(),a.y>m||m>a.y+a.height)return!1}else if("function"==typeof Range.prototype.expand){if(o.expand("word"),null==o.toString().trim().match(/\w/))return!1;if(a=o.getClientRects()[0],o.detach(),a.y>m||m>a.y+a.height)return!1}else console.error("[This browser supports neither Selection.modify nor Range.expand.]");t.stopPropagation(),s.style.top=scrollY+a.top-3*n+"px",s.style.left=scrollX+a.right-n+"px",s.textContent="↓",y.body.appendChild(s)}}).on("click",'[data-mode="mod"] .semantics-result *',function(t){if(null==c)return!1;t.stopPropagation(),b(".mod-indicator").toggleClass("mod-indicator mod-start"),this.closest(".edit-svoc").dataset.mode="mod-end",b(".semantic-edit-guide-msg").text("피수식어 위치를 클릭 하세요.")}).on("click",'[data-mode="mod-end"] .semantics-result',function(t){if(0==b(".mod-indicator").length)return!1;t.stopPropagation(),b(".mod-start").remove(),w(this);var e,o=this.dataset.seq,a=0,s=(b(this).find(".rcm").each(function(){for(var t of this.classList)-1<t.indexOf("mfd")&&(a=Math.max(a,parseFloat(t.split("-")[2])))}),c.dataset.mfd=o+"-"+(a+1),y.createElement("span")),o=(s.className=`sem rcm mfd-${o}-`+(a+1),s.dataset.gc="수식",("touchstart"==t.type?t.touches[0]:t).clientX),t=("touchstart"==t.type?t.touches[0]:t).clientY;if(y.caretPositionFromPoint)e=y.caretPositionFromPoint(o,t);else{if(!y.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;e=y.caretRangeFromPoint(o,t)}for((o=getSelection()).removeAllRanges(),o.addRange(e),o.modify("move","backward","word"),o.modify("extend","forward","word"),e=o.getRangeAt(0);e.toString().endsWith(" ");)e.setEnd(e.endContainer,e.endOffset-1);0==e.endOffset&&e.setEnd(e.startContainer,e.startContainer.data.length);try{e.surroundContents(s)}catch(t){s.appendChild(e.extractContents()),e.insertNode(s)}o.removeAllRanges(),c=null,b(".mod-indicator").remove(),b(".edit-svoc").attr("data-mode",null),g.find('[data-mode="mod"].active').removeClass("active"),x.empty(),C.checkGCDepth(this)}).on("click",".comment-target",function(t){const e=t.target.closest(".semantics-result")||t.target,o=this;b(y).off("mouseover",'[data-mode="comment"] .semantics-result .sem').off("mouseout",'[data-mode="comment"] .semantics-result *'),b(".edit-comment").remove();var t=o.getClientRects(),a=o.matches(".odd")?1:0,s=o.matches(".rcm")?1:0,n=a?-1:1,i=s?-1:1,r=["top","bottom"][a],l=["left","right"][s],c=getComputedStyle(o,"::after"),d=parseFloat(c[r]),m=parseFloat(c[l]),u=parseFloat(c.width),c=parseFloat(c.height),a=t[a][r]+n*d,r=a+n*c,d=t[s?t.length-1:0][l]+i*m,n=d+i*u;const p=y.createElement("div");function v(t){16!=(16&p.compareDocumentPosition(t.target))&&(b(y).off("mousedown",v),b(p).remove(),b(".edit-svoc").focus(),f())}p.className="edit-comment text-end",p.style.position="absolute",p.style.top=scrollY+Math.max(a,r)+"px",p.style.left=scrollX+Math.min(d,n)+"px",p.insertAdjacentHTML("afterbegin",'<form class="btn-group"><input class="form-control" type="text" placeholder="↵"/><div class="btn-group ms-1"><button class="btn btn-sm btn-fico" type="submit">확인</button><button class="btn btn-sm btn-outline-fico" type="button">취소</button></div></form>'),y.body.appendChild(p),p.style.top=scrollY+Math.min(a,r)-p.offsetHeight-10+"px",p.firstChild.firstChild.focus(),b(y).on("mousedown",v),b(p).find("form").on("submit",function(t){t.preventDefault(),o.classList.remove("comment-target"),e.closest('[data-mode="comment"]')&&w(e),f();t=b(this).find("input").val().trim();0==t.length?delete o.dataset.gc:o.dataset.gc=t,b(y).off("mousedown",v),b(p).remove(),C.checkGCDepth(o.closest(".semantics-result")),b(".edit-svoc").focus(),e.closest(".edit-svoc").removeAttribute("data-mode"),g.find('[data-mode="comment"].active').removeClass("active"),x.empty()}),b(p).find("button:eq(1)").on("click",function(){b(y).off("mousedown",v),b(p).remove(),f(),b(".edit-svoc").focus()})}),f()})),void 0===x&&(x=b('<div class="semantic-edit-guide-msg mx-auto"></div>')),this.wrap(b('<div class="edit-svoc" tabindex="0"></div>')).before(b(`<span class="svoc-editor-badge badge fs-6 rounded-pill">${t?"New":"Edit"}</span>`)).before(b('<span class="svoc-editor-emblem position-absolute end-0 me-2 p-1 pb-0 bg-white rounded-pill pe-none">『 <b class="app-name-text">fico </b><b class="text-fc-red" style="font-size:.9rem;">SVOC Editor</b>™』</span>')).before(g).after(x),b(".edit-svoc").focus()),this}}(jQuery,document,tandem);