!function(b,C,y){let u=[],a=[],f,v,s,l,c,d,m,p,h,w;const x={49:'[value="s"]',50:'[value="rs"]',51:'[value="ss"]',52:'[value="v"]',53:'[value="o"]',54:'[value="io"]',55:'[value="do"]',56:'[value="ro"]',57:'[value="po"]',48:'[value="c"]',189:'[value="oc"]',187:'[value="a"]',81:'[value="tor"]',87:'[value="to"]',69:'[value="ger"]',82:'[value="go"]',84:'[value="ptc"]',89:'[value="ptco"]',85:'[value="ptcphr"]',65:'[value="phr"]',83:'[value="advphr"]',68:'[value="adjphr"]',70:'[value="conj"]',71:'[value="ccls"]',72:'[value="pcls"]',74:'[value="ncls"]',75:'[value="acls"]',76:'[value="advcls"]',186:'[value="pcl"]',90:'[value="mod"]',88:'[value="erasing"]',67:'[value="comment"]',ctrlS:'[value="save"]',ctrlZ:'[value="undo"]:not([disabled])',ctrlY:'[value="redo"]:not([disabled])'};let k,E=0,P=0,S={};const R={rs:"s",io:"o",do:"o",ro:"o"},N={s:"S",rs:"(진)s",v:"V",o:"O",io:"i.o.",do:"d.o.",po:"(전)o",ro:"(진)o",to:"(부)o",go:"(동)o",ptco:"(분)o",appo:"동격",c:"C",oc:"o.c.",m:"M",a:"A"},A={a:"부사적 보충어",ss:"의미상 주어",tor:"to부정사",ger:"동명사",ptc:"분사",to:"to부정사 목적어",go:"동명사 목적어",ptco:"분사 목적어",appo:"동격 =>",ncls:{s:"주어절",o:"목적어절",c:"보어절",oc:"목적보어절",m:"관계절",po:"전치사 목적어절",to:"to부정사 목적어절",go:"동명사 목적어절",ptco:"분사 목적어절",appo:"동격 =>",interr:"의문사절 접속사",nrp:"명사적 관계사",nclc:""},acls:"형용사절",advcls:"부사절",phr:"전치사구",adjphr:"형용사구",advphr:"부사구",ptcphr:"부사구(분사구문)",ccls:"등위절",pcls:"병렬절",pcl:"삽입절"};function F(e){f.find('[value="undo"], [value="redo"]').prop("disabled",!0),f.find("button").removeClass("active").each((e,t)=>{bootstrap?.Tooltip?.getInstance(t)?.hide()}),e.unwrap(),u=[],a=[],b(".svoc-editor-badge,.svoc-editor-emblem").remove(),f.detach(),v.detach(),S.cancelCallback()}function T(e){var t=e.dataset.seq;u.push([t,e.innerHTML]),a=[],b('.svoc-toolbar [value="undo"]').prop("disabled",!1)}function M(e,t,o){var a=e.getClientRects()[0];b(C.body).append({ncls:c,tor:m,ger:p,ptc:h}[t].css("top",scrollY+a.top+a.height+"px").css("left",scrollX+a.left+"px").data("range",e).data("wrapperEl",o))}function O(e){b(e).find(".sem").filter((e,t)=>0==t.textContent.length).remove(),y.checkPOSDepth(e),y.wrapWithBracket(e),y.splitInners(e),y.trimTextContent(e),y.correctMarkLine(e),b(".edit-svoc").focus()}b.fn.svoceditor=async function(e,t,o){return S={forNew:e,saveCallback:t,cancelCallback:o},"close"==e?(void 0!==f&&f.detach(),void 0!==v&&v.detach()):(void 0===f&&(await b.get("https://static.findsvoc.com/css/app/tandem.editor.min.css",e=>{var t=C.createElement("style");t.innerHTML=e,C.head.append(t)}),await b.get("https://static.findsvoc.com/fragment/tandem/editor_template.min.html",e=>{f=b(e).find("#js-edit-toolbar"),c=b(e).find(".cls-role-menu"),d=b(e).find(".cls-conj-menu"),m=b(e).find(".tor-role-menu"),p=b(e).find(".ger-role-menu"),h=b(e).find(".ptc-role-menu"),w=b(e).find(".edit-comment"),f.find('[data-bs-toggle="tooltip"]').click(function(){bootstrap?.Tooltip?.getInstance(this)?.hide()}).tooltip({trigger:"hover"});const n=parseFloat(getComputedStyle(C.body).fontSize);b(C).on("keydown",function(e){b(e.target).is("input")&&0<b(e.target).closest(".edit-comment").length&&27==e.keyCode?b(e.target.form).find("button:eq(1)").trigger("click"):b(".edit-svoc")?.is(":focus")&&((e.ctrlKey||e.metaKey)&&65<=e.keyCode&&e.keyCode<=90?x["ctrl"+e.key.toUpperCase()]&&(e.preventDefault(),f.find(x["ctrl"+e.key.toUpperCase()]).trigger("click")):b(e.target).is("input")||null==x[e.keyCode]||f.find(x[e.keyCode]).trigger("click"))}),f.on("click",'[value="save"]',function(){var o,e=this.closest(".edit-svoc").querySelector(".semantics-result");for(b(e).closest(".edit-svoc").addClass("pe-none").find(".svoc-editor-badge").html('<i class="fas fa-spinner fa-spin"></i> 저장중').animate({width:"100%"});null!=e.querySelector(".brkt,.line-end,canvas.curved_arrow");)e.querySelector(".brkt,.line-end,canvas.curved_arrow").remove();o=e,requestAnimationFrame(async function(){var e=await y.getSvocBytes(o),e=(y.wrapWithBracket(o),y.correctMarkLine(o),u=[],a=[],f.find('[value="undo"], [value="redo"]').prop("disabled",!0),S.saveCallback(e));function t(e){setTimeout(()=>{v.text(""),b(o).unwrap(),f.find('[value="undo"], [value="redo"]').prop("disabled",!0),f.find("button").removeClass("active").each((e,t)=>{bootstrap?.Tooltip?.getInstance(t)?.hide()}),b(".svoc-editor-badge,.svoc-editor-emblem").remove(),f.detach(),v.detach(),e?.call()},2e3)}e&&e.then&&e.fail?e.then(function(){b(".svoc-editor-badge").html('<i class="fas fa-check"></i> 저장됨'),t()}).fail(function(){b(".svoc-editor-badge").html('<i class="fas fa-ban"></i> 저장실패'),F(b(o))}):(b(".svoc-editor-badge").html('<i class="fas fa-check"></i> 저장됨'),t())})}).on("click",'[value="close"]',function(){var e,t;confirm("수정내역은 저장되지 않습니다.\n편집모드를 종료하시겠습니까?")&&(e=b(this).closest(".edit-svoc").find(".semantics-result"),0<u.length&&(t=u.shift(),e.html(t[1]),b(".erasing-target").toggleClass("erasing-target"),b(".mod-start,.mod-indicator").remove(),y.drawConnections(e[0]),e.animate({opacity:.5},100).animate({opacity:1},100)),F(e))}).on("click","[data-mode]:not([disabled])",function(){if("undo"==this.dataset.mode)return!0;let e=getSelection(),t;if(b(".svoc-toolbar .active").add(this).toggleClass("active"),b(".erasing-target, .comment-target").removeClass("erasing-target comment-target"),b(".mod-start,.mod-indicator").remove(),b(this).is(".active")){var o=this.dataset.mode;switch(b(".edit-svoc").attr("data-mode",o),o){case"role":case"wrap":e.isCollapsed?v.text("적용 텍스트를 드래그 하세요."):(b(".edit-svoc").trigger("mouseup",this.value).attr("data-mode",null),b(this).removeClass("active"));break;case"erasing":v.html("지우려는 태그를 클릭 하세요.<br><h6>하위태그 모두 선택 : shift+클릭</h6>"),e.removeAllRanges();break;case"mod":v.text("수식어 위치를 클릭 하세요."),e.removeAllRanges();break;case"comment":v.text("문법 코멘트를 추가할 요소를 선택하세요."),e.removeAllRanges();break;case"cleft":e.isCollapsed?v.text("적용 텍스트를 드래그 하세요.(It is[was]부터 that까지 한 번에)\nthat 대신 who,where 등 가능"):(b(".edit-svoc").trigger("mouseup",this.value).attr("data-mode",null),b(this).removeClass("active"))}if(e.isCollapsed){if(C.caretPositionFromPoint)t=C.caretPositionFromPoint(E,P);else{if(!C.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;t=C.caretRangeFromPoint(E,P)}let e=t.startContainer;for(;1!=e.nodeType;)e=e.parentNode;b(e).trigger("mouseover")}}else b(".edit-svoc").attr("data-mode",null),v.empty()}).on("click",'[value="undo"], [value="redo"]',function(e){var t;e.preventDefault(),("undo"==this.value||"redo"==this.value&&0<a.length)&&(this.classList.add("active"),e=("undo"==this.value?u:a).pop(),t=b(`.edit-svoc .semantics-result[data-seq="${e[0]}"]`),("undo"==this.value?a:u).push([t.attr("data-seq"),t.html()]),t.html(e[1]),b(".erasing-target").toggleClass("erasing-target"),b(".mod-start,.mod-indicator").remove(),y.drawConnections(t[0]),t.animate({opacity:.5},100).animate({opacity:1},100),b('.svoc-toolbar [value="undo"]').prop("disabled",0==u.length),b('.svoc-toolbar [value="redo"]').prop("disabled",0==a.length),setTimeout(()=>{this.classList.remove("active")},50))});let r=[],i=null,t=!1;function g(){b(C).on("mouseover",'[data-mode="comment"] .semantics-result .sem',function(e){null!=this.dataset.gc&&0!=this.dataset.gc.length||(e.stopPropagation(),this.classList.add("comment-target"))}).on("mouseout",'[data-mode="comment"] .semantics-result *',function(){b(".comment-target").removeClass("comment-target")})}b(C).on("mouseover",'[data-mode="erasing"] .semantics-result *',function(t,o){t.stopPropagation();var a=t.target;if(i=a,s(),b(a).is(".curved_arrow"))for(var e of a.classList)-1<e.indexOf("mfd")&&(b(this).siblings(".curved_arrow."+e).each(function(){r.push(this)}),r.push(b(".rcm.mfd-"+e.substring(3))[0]));function s(){if(null!=a){if(r.push(a),o||t.shiftKey)for(var e of a.getElementsByTagName("span"))r.push(e);a.textContent==a.parentElement.textContent?(a=a.parentElement,r.push(a)):0<a.children.length&&a.children[0].textContent==a.textContent&&r.push(a.children[0])}}null!=a.previousElementSibling&&b(a.previousElementSibling).is('[class*="-start"]:not([class*="cmnt-align-start"])')&&null!=a.nextElementSibling&&b(a.nextElementSibling).is('[class*="-end"]')&&(r.push(a.previousElementSibling),r.push(a.nextElementSibling)),-1<a.className.indexOf("-start")?(a=a.nextElementSibling,s(),null!=a&&null!=a.nextElementSibling&&(a=a.nextElementSibling,r.push(a))):-1<a.className.indexOf("-end")&&(a=a.previousElementSibling,s(),null!=a)&&null!=a.previousElementSibling&&(a=a.previousElementSibling,r.push(a)),r.forEach(function(e){e.classList.add("erasing-target")})}).on("mouseout",'[data-mode="erasing"] .semantics-result *',function(e){r.forEach(function(e){b(e).removeClass("erasing-target")}),r=[],i=null,e.stopPropagation()}).on("keydown keyup",function(e){("keydown"==e.type&&!t&&e.shiftKey||"keyup"==e.type&&t&&!e.shiftKey)&&(t=!t,b(C.body).toggleClass("shift",t),null!=i)&&b(i).trigger("mouseout").trigger("mouseover",[t])}).on("click",".erasing-target",function(e){var t=e.target.closest(".semantics-result")||e.target;t.closest('[data-mode="erasing"]')&&(T(t),r.forEach(function(e){0==e.textContent.length||e.matches(".brkt")?b(e).remove():b(e).contents().unwrap()})),b(t).find(".rcm").each(function(){for(var e of this.classList)-1<e.indexOf("mfd")&&0==b(`[data-mfd="${e.substring(4)}"]`).length&&b(this).contents().unwrap()}),b(t).find("[data-mfd]").each(function(){0==b(".rcm.mfd-"+this.dataset.mfd).length&&delete this.dataset.mfd}),e.shiftKey&&getSelection().removeAllRanges(),O(t)}).on("mouseup",'.edit-svoc[data-mode="role"], .edit-svoc[data-mode="wrap"]',function(e,t){e.stopPropagation();var e=f.find(".active").val(),o=getSelection(),a=o?.anchorNode?.parentElement?.closest(".semantics-result");if(!o.isCollapsed){if(T(a),"role"==this.dataset.mode){a=o;var s=t||e;const p=a.getRangeAt(0),h=C.createElement("span");h.className="sem "+(R[s]??s),null!=N[s]&&(h.dataset.rc=N[s],h.dataset.rcMin=N[s]);"string"==typeof A[s]&&(h.dataset.gc=A[s]);try{p.surroundContents(h)}catch(e){h.appendChild(p.extractContents()),p.insertNode(h)}p.detach(),a.removeAllRanges(),["tor","ptc"].includes(s)&&1==h.childElementCount&&[".adjphr",".advphr"].find(e=>h.firstElementChild.matches(e))&&y.swapParentAndChild(h,h.firstElementChild);a=b(h).closest(".semantics-result")[0];O(a)}else if("wrap"==this.dataset.mode){var n,r=o,i=t||e,l=r.getRangeAt(0),s=l.startContainer.nodeType===Node.TEXT_NODE?l.startContainer.parentNode:l.startContainer,c=s.closest(".sem"),d=s.closest(".semantics-result"),m=c?.matches(".sem."+("pcl"==i?"advcls":i));switch(i){case"tor":case"ger":case"ptc":case"ncls":if(l.toString().length==c?.textContent?.length){var u=createElement({el:"span",class:"sem "+i,dataset:{gc:A[i]}});c.matches(".s,.o,.po,.to,.go,.ptco,.c,.oc,.appo,.adjphr,.advphr")?"ncls"==i?(c?.dataset?.gc&&delete c.dataset.gc,u.dataset.gc=A.ncls[Array.from(c.classList).filter(e=>["s","o","po","to","go","ptco","c","oc","appo"].includes(e))[0]],b(c).wrap(u)):b(c).wrapInner(u):m?(n=b(c).wrapInner(u).children().eq(0).unwrap(),l.selectNode(n[0]),M(l,i,n[0])):b(c).wrap(u),O(d)}else{let t;if(["tor","ger","ptc"].includes(i)){t=createElement({el:"span",class:"sem "+i,dataset:{gc:A[i]}});try{l.surroundContents(t)}catch(e){t.appendChild(l.extractContents()),l.insertNode(t)}}"ptc"==i&&(n=createElement({el:"span",class:"sem adjphr",dataset:{gc:A.adjphr}}),b(t).wrap(n)),O(d),"ptc"!=i&&M(l,i,t)}break;case"acls":case"advcls":case"pcl":u=C.createElement("span");u.className="sem m",u.dataset.rc=N.m;try{l.surroundContents(u)}catch(e){u.appendChild(l.extractContents()),l.insertNode(u)}y.trimTextContent(d),l.selectNode(u);default:const g=C.createElement("span");g.classList.add("sem","pcl"==i?"advcls":i),A[i]&&(g.dataset.gc=A[i]);try{l.surroundContents(g)}catch(e){g.appendChild(l.extractContents()),l.insertNode(g)}l.detach(),r.removeAllRanges(),["adjphr","advphr"].includes(i)&&[".tor",".ptc"].some(e=>g.parentElement.matches(e))&&1===Array.from(g.parentElement.childNodes).filter(e=>0<e.textContent.length).length&&y.swapParentAndChild(g.parentElement,g),O(d)}}b(".edit-svoc").attr("data-mode",null),f.find(".active").removeClass("active"),v.empty()}}).on("mouseup",'.edit-svoc[data-mode="cleft"]',function(n){n.stopPropagation();var r=this.querySelector(".semantics-result"),i=(r.normalize(),getSelection());if(!i.isCollapsed){var l=i.anchorNode.compareDocumentPosition(i.focusNode);let e=!1,{anchorNode:t,anchorOffset:o,focusNode:a,focusOffset:s}=((e=!l&&i.anchorOffset>i.focusOffset||l===Node.DOCUMENT_POSITION_PRECEDING?!0:e)&&i.setBaseAndExtent(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset),i);for(;/^(\s|[.,?!'"])/.test(t.textContent.substring(o));)o++;for(;/(\s|'s|[.,?!'"])$/.test(a.textContent.substring(0,s));)s--;for(;0<o&&/\w/.test(t.textContent[o-1]);)o--;for(;s<a.textContent.length&&/\w/.test(a.textContent[s]);)s++;i.setBaseAndExtent(a,s,t,o);l=i.toString().trim().match(/^[iI]t( is| was|'s| had been| has been|'s been|'ll be|'ll have been| will be| will have been| can be| could be| could have been| would be| would have been) .+\S$/);if(l){T(r);var c,d="It"+l[1],l=l[0].match(/(that|wh(o(se|m)?|e(n|re)|y|at|ich)|how)$/i);l&&((c=new Range).setStart(a,s-l[0].length),c.setEnd(a,s),c.surroundContents(createElement({el:"span",class:"sem cleft"})));try{var m=new Range;m.setStart(t,o),m.setEnd(t,o+d.length),m.surroundContents(createElement({el:"span",class:"sem cleft",dataset:{gc:"강조구문"}}))}catch(n){return alertModal("선택 범위 내의 다른 마킹을 지워주세요."),void b(r).html(u.pop())}i.removeAllRanges()}else alertModal('"It + be동사 + 강조대상 + that(생략 가능. that 대신 who,where 등 가능)"까지 선택하세요.')}}).on("click",".cls-role-menu button",function(){var e=this.value,t=createElement({el:"span",class:"sem "+(R[e]??e)}),o=(N[e]&&(t.dataset.rc=N[e]),c.data("range"));try{o.surroundContents(t)}catch(e){t.appendChild(o.extractContents()),o.insertNode(t)}var a=createElement({el:"span",class:"sem ncls"});A.ncls[e]&&(a.dataset.gc=A.ncls[e]),b(t).wrap(a),c.data("range",null).detach(),O(t.closest(".semantics-result")),"appo"==e?(o.detach(),getSelection().removeAllRanges(),b(t).parent().addClass("comment-target").trigger("click"),b(".edit-comment :text").val("동격 => ")):(a=o.getClientRects()[0],b(C.body).append(d.css("top",scrollY+a.top+a.height+"px").css("left",scrollX+a.left+"px").data("range",b(t).parent(".ncls"))),d.find('button[value="nclc"]').prop("checked",!0))}).on("click",".cls-conj-menu button",function(){var e=this.value,t=d.data("range");t.attr("data-gc",A.ncls[e]||t.attr("data-gc")),getSelection().removeAllRanges(),d.data("range",null).detach(),O(t.closest(".semantics-result")[0])}).on("click",".tor-role-menu button,.ger-role-menu button,.ptc-role-menu button",function(){var e=this.value,t=this.closest(".tor-role-menu,.ger-role-menu,.ptc-role-menu").className.match(/(\w+)-role-menu/)[1],t={tor:m,ger:p,ptc:h}[t],o=createElement({el:"span",class:"sem "+(R[e]??e)}),a=(N[e]&&(o.dataset.rc=N[e]),["adjphr","advphr"].includes(e)&&A[e]&&(o.dataset.gc=A[e]),t.data("wrapperEl"));["adjphr","advphr"].includes(e)?b(a).wrap(o):b(a).wrapInner(o),t.data("range").detach(),getSelection().removeAllRanges(),t.data("range",null).data("wrapperEl",null).detach(),O(a.closest(".semantics-result"))}).on("mouseup",function(e){(c.is(":visible")&&!e.target.closest(".cls-role-menu")||d.is(":visible")&&!e.target.closest(".cls-conj-menu")||m.is(":visible")&&!e.target.closest(".tor-role-menu")||p.is(":visible")&&!e.target.closest(".ger-role-menu")||h.is(":visible")&&!e.target.closest(".ptc-role-menu"))&&(getSelection().removeAllRanges(),c.data("range",null).detach(),d.data("range",null).detach(),m.data("range",null).detach(),p.data("range",null).detach(),h.data("range",null).detach())}).on("click",'.edit-svoc:not([data-mode="erasing"]):not([data-mode="mod"]):not([data-mode="comment"]) .sem',function(e){b(".edit-comment").remove();var o=this,a=("touchstart"==e.type?e.touches[0]:e).clientX,s=("touchstart"==e.type?e.touches[0]:e).clientY,n=this.getClientRects(),r=b(this).is(".odd")?1:0,i=b(this).is(".rcm")?1:0,l=r?-1:1,c=i?-1:1,d=["top","bottom"][r],m=["left","right"][i];for(let t of[{data:"rc",pseudo:"::before"},{data:"gc",pseudo:"::after"}]){var u=getComputedStyle(o,t.pseudo),p=parseFloat(u[d]),h=parseFloat(u[m]),g=parseFloat(u.width),u=parseFloat(u.height);if(null!=o.dataset[t.data]&&!isNaN(g)&&!isNaN(u)){p=n[r][d]+l*p,u=p+l*u,h=n[i?n.length-1:0][m]+c*h,g=h+c*g;if(Math.min(p,u,s)!=s&&Math.max(p,u,s)!=s&&Math.min(h,g,a)!=a&&Math.max(h,g,a)!=a){e.stopPropagation();const v=w.clone(!1);function f(e){16!=(16&v[0].compareDocumentPosition(e.target))&&(b(C).off("mousedown",f),v.remove(),b(".edit-svoc").focus())}v.find("input:text").val(o.dataset[t.data]),C.body.appendChild(v[0]),v.css("top","gc"==t.data?scrollY+Math.max(p,u)+"px":scrollY+Math.min(p,u)-v.height()-10+"px").css("left",scrollX+Math.min(h,g)+"px").find("input:text")[0].focus(),b(C).on("mousedown",f),v.find("form").on("submit",function(e){e.preventDefault(),T(o.closest(".semantics-result"));e=b(this).find("input").val().trim();0==e.length?delete o.dataset[t.data]:o.dataset[t.data]=e,b(C).off("mousedown",f),v.remove(),y.checkGCDepth(o.closest(".semantics-result")),b(".edit-svoc").focus()}),v.find("button:eq(1)").on("click",function(){b(C).off("mousedown",f),v.remove(),b(".edit-svoc").focus()});break}}}}).on("mouseover",'[data-mode="mod"] .semantics-result *',function(e){b(".mod-indicator").remove();var t=".cls,.acls,.ncls,.advcls,.phr,.tor,.ger,.adjphr,.ptc",t=b(this).is(t)?this:0==b(this).closest(t).length?null!=this.dataset.lv?this:null:b(this).closest(t)[0];if(null==t||t.textContent.trim().length<2||null!=t.dataset.mfd)return k=null,!1;e.stopPropagation(),k=t;e=C.createElement("div");e.className="mod-indicator",e.style.position="absolute",e.style.top=scrollY+t.getClientRects()[0].top-3*n+"px",e.style.left=scrollX+t.getClientRects()[0].left-.8*n+"px",e.textContent="↑",C.body.appendChild(e)}).on("mousemove",".edit-svoc .semantics-result",function(e){E=("touchstart"==e.type?e.touches[0]:e).clientX,P=("touchstart"==e.type?e.touches[0]:e).clientY;let t,o,a;if(0<b(e.target).closest('[data-mode="mod-end"] .semantics-result').length){b(".mod-indicator").remove();var s=C.createElement("div");if(s.className="mod-indicator",s.style.position="absolute",C.caretPositionFromPoint)o=C.caretPositionFromPoint(E,P);else{if(!C.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;o=C.caretRangeFromPoint(E,P)}if("function"==typeof Selection.prototype.modify){if((t=getSelection()).removeAllRanges(),t.addRange(o),t.modify("move","backward","word"),t.modify("extend","forward","word"),0==t.rangeCount||null==t.toString().trim().match(/\w/))return t.removeAllRanges(),!1;if(a=t.getRangeAt(0).getClientRects()[0],t.removeAllRanges(),a.y>P||P>a.y+a.height)return!1}else if("function"==typeof Range.prototype.expand){if(o.expand("word"),null==o.toString().trim().match(/\w/))return!1;if(a=o.getClientRects()[0],o.detach(),a.y>P||P>a.y+a.height)return!1}else console.error("[This browser supports neither Selection.modify nor Range.expand.]");e.stopPropagation(),s.style.top=scrollY+a.top-3*n+"px",s.style.left=scrollX+a.right-n+"px",s.textContent="↓",C.body.appendChild(s)}}).on("click",'[data-mode="mod"] .semantics-result *',function(e){if(null==k)return!1;e.stopPropagation(),b(".mod-indicator").toggleClass("mod-indicator mod-start"),this.closest(".edit-svoc").dataset.mode="mod-end",b(".semantic-edit-guide-msg").text("피수식어 위치를 클릭 하세요.")}).on("click",'[data-mode="mod-end"] .semantics-result',function(e){if(0==b(".mod-indicator").length)return!1;e.stopPropagation(),b(".mod-start").remove(),T(this);var t,o=this.dataset.seq,a=0,s=(b(this).find(".rcm").each(function(){for(var e of this.classList)-1<e.indexOf("mfd")&&(a=Math.max(a,parseFloat(e.split("-")[2])))}),k.dataset.mfd=o+"-"+(a+1),C.createElement("span")),o=(s.className=`sem rcm mfd-${o}-`+(a+1),s.dataset.gc="수식",("touchstart"==e.type?e.touches[0]:e).clientX),e=("touchstart"==e.type?e.touches[0]:e).clientY;if(C.caretPositionFromPoint)t=C.caretPositionFromPoint(o,e);else{if(!C.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;t=C.caretRangeFromPoint(o,e)}for((o=getSelection()).removeAllRanges(),o.addRange(t),o.modify("move","backward","word"),o.modify("extend","forward","word"),t=o.getRangeAt(0);t.toString().endsWith(" ");)t.setEnd(t.endContainer,t.endOffset-1);0==t.endOffset&&t.setEnd(t.startContainer,t.startContainer.data.length);try{t.surroundContents(s)}catch(e){s.appendChild(t.extractContents()),t.insertNode(s)}o.removeAllRanges(),k=null,b(".mod-indicator").remove(),b(".edit-svoc").attr("data-mode",null),f.find('[data-mode="mod"].active').removeClass("active"),v.empty(),y.checkGCDepth(this)}).on("click",".comment-target",function(e){const t=e.target.closest(".semantics-result")||e.target,o=this;b(C).off("mouseover",'[data-mode="comment"] .semantics-result .sem').off("mouseout",'[data-mode="comment"] .semantics-result *'),b(".edit-comment").remove();var e=o.getClientRects(),a=o.matches(".odd")?1:0,s=o.matches(".rcm")?1:0,n=a?-1:1,r=s?-1:1,i=["top","bottom"][a],l=["left","right"][s],c=getComputedStyle(o,"::after"),d=parseFloat(c[i]),m=parseFloat(c[l]),u=parseFloat(c.width),c=parseFloat(c.height),a=e[a][i]+n*d,i=a+n*c,d=e[s?e.length-1:0][l]+r*m,n=d+r*u;const p=w.clone(!1);function h(e){16!=(16&p[0].compareDocumentPosition(e.target))&&(b(C).off("mousedown",h),p.remove(),b(".edit-svoc").focus(),g())}C.body.appendChild(p[0]),p.find("input:text").val(o.dataset.gc??""),p.css("top",scrollY+Math.max(a,i)+"px").css("left",scrollX+Math.min(d,n)+"px").find("input:text")[0].focus(),b(C).on("mousedown",h),p.find("form").on("submit",function(e){e.preventDefault(),o.classList.remove("comment-target"),t.closest('[data-mode="comment"]')&&T(t),g();e=b(this).find("input").val().trim();0==e.length?delete o.dataset.gc:o.dataset.gc=e,b(C).off("mousedown",h),p.remove(),y.checkGCDepth(o.closest(".semantics-result")),b(".edit-svoc").focus(),t.closest(".edit-svoc").removeAttribute("data-mode"),f.find('[data-mode="comment"].active').removeClass("active"),v.empty()}),p.find("button:eq(1)").on("click",function(){b(C).off("mousedown",h),p.remove(),g(),b(".edit-svoc").focus()})}),g(),v=b(e).find(".semantic-edit-guide-msg"),s=b(e).find(".svoc-editor-badge"),l=b(e).find(".svoc-editor-emblem")},"html")),(t=s.clone()).text(e?"New":"Edit"),this.wrap(b('<div class="edit-svoc" tabindex="0"></div>')).before(t).before(l).before(f).after(v),b(".edit-svoc").focus()),this}}(jQuery,document,tandem);