!function(v,b,C){let u=[],o=[],f,y,s,l,c,d,m,p,h,w,x={49:'[value="s"]',50:'[value="rs"]',51:'[value="ss"]',52:'[value="v"]',53:'[value="o"]',54:'[value="io"]',55:'[value="do"]',56:'[value="ro"]',57:'[value="po"]',48:'[value="c"]',189:'[value="oc"]',187:'[value="a"]',81:'[value="tor"]',87:'[value="to"]',69:'[value="ger"]',82:'[value="go"]',84:'[value="ptc"]',89:'[value="ptco"]',85:'[value="ptcphr"]',65:'[value="phr"]',83:'[value="advphr"]',68:'[value="adjphr"]',70:'[value="conj"]',71:'[value="ccls"]',72:'[value="pcls"]',74:'[value="ncls"]',75:'[value="acls"]',76:'[value="advcls"]',186:'[value="pcl"]',90:'[value="mod"]',88:'[value="erasing"]',67:'[value="comment"]',ctrlS:'[value="save"]',ctrlZ:'[value="undo"]:not([disabled])',ctrlY:'[value="redo"]:not([disabled])'},k,E=0,P=0,S={},R={rs:"s",io:"o",do:"o",ro:"o"},N={s:"S",rs:"(진)s",v:"V",o:"O",io:"i.o.",do:"d.o.",po:"(전)o",ro:"(진)o",to:"(부)o",go:"(동)o",ptco:"(분)o",appo:"동격",c:"C",oc:"o.c.",m:"M",a:"A"},A={a:"부사적 보충어",ss:"의미상 주어",tor:"to부정사",ger:"동명사",ptc:"분사",to:"to부정사 목적어",go:"동명사 목적어",ptco:"분사 목적어",appo:"동격 =>",ncls:{s:"주어절",o:"목적어절",c:"보어절",oc:"목적보어절",m:"관계절",po:"전치사 목적어절",to:"to부정사 목적어절",go:"동명사 목적어절",ptco:"분사 목적어절",appo:"동격 =>",interr:"의문사절 접속사",nrp:"명사적 관계사",nclc:""},acls:"형용사절",advcls:"부사절",phr:"전치사구",adjphr:"형용사구",advphr:"부사구",ptcphr:"부사구(분사구문)",ccls:"등위절",pcls:"병렬절",pcl:"삽입절"};function F(e){f.find('[value="undo"], [value="redo"]').prop("disabled",!0),f.find("button").removeClass("active").each((e,t)=>{bootstrap?.Tooltip?.getInstance(t)?.hide()}),e.unwrap(),u=[],o=[],v(".svoc-editor-badge,.svoc-editor-emblem").remove(),f.detach(),y.detach(),S.cancelCallback()}function T(e){var t=e.dataset.seq;u.push([t,e.innerHTML]),o=[],v('.svoc-toolbar [value="undo"]').prop("disabled",!1)}function M(e,t,a){var o=e.getClientRects()[0];v(b.body).append({ncls:c,tor:m,ger:p,ptc:h}[t].css("top",scrollY+o.top+o.height+"px").css("left",scrollX+o.left+"px").data("range",e).data("wrapperEl",a))}function O(e){v(e).find(".sem").filter((e,t)=>0==t.textContent.length).remove(),C.checkPOSDepth(e),C.wrapWithBracket(e),C.splitInners(e),C.trimTextContent(e),C.correctMarkLine(e),v(".edit-svoc").focus()}v.fn.svoceditor=async function(e,t,a){return S={forNew:e,saveCallback:t,cancelCallback:a},"close"==e?(void 0!==f&&f.detach(),void 0!==y&&y.detach()):(void 0===f&&(await v.get("https://static.findsvoc.com/css/app/tandem.editor.min.css",e=>{var t=b.createElement("style");t.innerHTML=e,b.head.append(t)}),await v.get("https://static.findsvoc.com/fragment/tandem/editor_template.min.html",e=>{f=v(e).find("#js-edit-toolbar"),c=v(e).find(".cls-role-menu"),d=v(e).find(".cls-conj-menu"),m=v(e).find(".tor-role-menu"),p=v(e).find(".ger-role-menu"),h=v(e).find(".ptc-role-menu"),w=v(e).find(".edit-comment"),f.find('[data-bs-toggle="tooltip"]').click(function(){bootstrap?.Tooltip?.getInstance(this)?.hide()}).tooltip({trigger:"hover"});let n=parseFloat(getComputedStyle(b.body).fontSize),r=(v(b).on("keydown",function(e){v(e.target).is("input")&&0<v(e.target).closest(".edit-comment").length&&27==e.keyCode?v(e.target.form).find("button:eq(1)").trigger("click"):v(".edit-svoc")?.is(":focus")&&((e.ctrlKey||e.metaKey)&&65<=e.keyCode&&e.keyCode<=90?x["ctrl"+e.key.toUpperCase()]&&(e.preventDefault(),f.find(x["ctrl"+e.key.toUpperCase()]).trigger("click")):v(e.target).is("input")||null==x[e.keyCode]||f.find(x[e.keyCode]).trigger("click"))}),f.on("click",'[value="save"]',function(){var a,e=this.closest(".edit-svoc").querySelector(".semantics-result");for(v(e).closest(".edit-svoc").addClass("pe-none").find(".svoc-editor-badge").html('<i class="fas fa-spinner fa-spin"></i> 저장중').animate({width:"100%"});null!=e.querySelector(".brkt,.line-end,canvas.curved_arrow");)e.querySelector(".brkt,.line-end,canvas.curved_arrow").remove();a=e,requestAnimationFrame(async function(){var e=await C.getSvocBytes(a),e=(C.wrapWithBracket(a),C.correctMarkLine(a),u=[],o=[],f.find('[value="undo"], [value="redo"]').prop("disabled",!0),S.saveCallback(e));function t(e){setTimeout(()=>{y.text(""),v(a).unwrap(),f.find('[value="undo"], [value="redo"]').prop("disabled",!0),f.find("button").removeClass("active").each((e,t)=>{bootstrap?.Tooltip?.getInstance(t)?.hide()}),v(".svoc-editor-badge,.svoc-editor-emblem").remove(),f.detach(),y.detach(),e?.call()},2e3)}e&&e.then&&e.fail?e.then(function(){v(".svoc-editor-badge").html('<i class="fas fa-check"></i> 저장됨'),t()}).fail(function(){v(".svoc-editor-badge").html('<i class="fas fa-ban"></i> 저장실패'),F(v(a))}):(v(".svoc-editor-badge").html('<i class="fas fa-check"></i> 저장됨'),t())})}).on("click",'[value="close"]',function(){var e,t;confirm("수정내역은 저장되지 않습니다.\n편집모드를 종료하시겠습니까?")&&(e=v(this).closest(".edit-svoc").find(".semantics-result"),0<u.length&&(t=u.shift(),e.html(t[1]),v(".erasing-target").toggleClass("erasing-target"),v(".mod-start,.mod-indicator").remove(),C.drawConnections(e[0]),e.animate({opacity:.5},100).animate({opacity:1},100)),F(e))}).on("click","[data-mode]:not([disabled])",function(){if("undo"==this.dataset.mode)return!0;let e=getSelection(),t;if(v(".svoc-toolbar .active").add(this).toggleClass("active"),v(".erasing-target, .comment-target").removeClass("erasing-target comment-target"),v(".mod-start,.mod-indicator").remove(),v(this).is(".active")){var a=this.dataset.mode;switch(v(".edit-svoc").attr("data-mode",a),a){case"role":case"wrap":e.isCollapsed?y.text("적용 텍스트를 드래그 하세요."):(v(".edit-svoc").trigger("mouseup",this.value).attr("data-mode",null),v(this).removeClass("active"));break;case"erasing":y.html("지우려는 태그를 클릭 하세요.<br><h6>하위태그 모두 선택 : shift+클릭</h6>"),e.removeAllRanges();break;case"mod":y.text("수식어 위치를 클릭 하세요."),e.removeAllRanges();break;case"comment":y.text("문법 코멘트를 추가할 요소를 선택하세요."),e.removeAllRanges();break;case"cleft":e.isCollapsed?y.text("적용 텍스트를 드래그 하세요.(It is[was]부터 that까지 한 번에)\nthat 대신 who,where 등 가능"):(v(".edit-svoc").trigger("mouseup",this.value).attr("data-mode",null),v(this).removeClass("active"))}if(e.isCollapsed){if(b.caretPositionFromPoint)t=b.caretPositionFromPoint(E,P);else{if(!b.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;t=b.caretRangeFromPoint(E,P)}let e=t.startContainer;for(;1!=e.nodeType;)e=e.parentNode;v(e).trigger("mouseover")}}else v(".edit-svoc").attr("data-mode",null),y.empty()}).on("click",'[value="undo"], [value="redo"]',function(e){var t;e.preventDefault(),("undo"==this.value||"redo"==this.value&&0<o.length)&&(this.classList.add("active"),e=("undo"==this.value?u:o).pop(),t=v(`.edit-svoc .semantics-result[data-seq="${e[0]}"]`),("undo"==this.value?o:u).push([t.attr("data-seq"),t.html()]),t.html(e[1]),v(".erasing-target").toggleClass("erasing-target"),v(".mod-start,.mod-indicator").remove(),C.drawConnections(t[0]),t.animate({opacity:.5},100).animate({opacity:1},100),v('.svoc-toolbar [value="undo"]').prop("disabled",0==u.length),v('.svoc-toolbar [value="redo"]').prop("disabled",0==o.length),setTimeout(()=>{this.classList.remove("active")},50))}),[]),i=null,t=!1;function g(){v(b).on("mouseover",'[data-mode="comment"] .semantics-result .sem',function(e){null!=this.dataset.gc&&0!=this.dataset.gc.length||(e.stopPropagation(),this.classList.add("comment-target"))}).on("mouseout",'[data-mode="comment"] .semantics-result *',function(){v(".comment-target").removeClass("comment-target")})}v(b).on("mouseover",'[data-mode="erasing"] .semantics-result *',function(t,a){t.stopPropagation();var o=t.target;if(i=o,s(),v(o).is(".curved_arrow"))for(var e of o.classList)-1<e.indexOf("mfd")&&(v(this).siblings(".curved_arrow."+e).each(function(){r.push(this)}),r.push(v(".rcm.mfd-"+e.substring(3))[0]));function s(){if(null!=o){if(r.push(o),a||t.shiftKey)for(var e of o.getElementsByTagName("span"))r.push(e);o.textContent==o.parentElement.textContent?(o=o.parentElement,r.push(o)):0<o.children.length&&o.children[0].textContent==o.textContent&&r.push(o.children[0])}}null!=o.previousElementSibling&&v(o.previousElementSibling).is('[class*="-start"]:not([class*="cmnt-align-start"])')&&null!=o.nextElementSibling&&v(o.nextElementSibling).is('[class*="-end"]')&&(r.push(o.previousElementSibling),r.push(o.nextElementSibling)),-1<o.className.indexOf("-start")?(o=o.nextElementSibling,s(),null!=o&&null!=o.nextElementSibling&&(o=o.nextElementSibling,r.push(o))):-1<o.className.indexOf("-end")&&(o=o.previousElementSibling,s(),null!=o)&&null!=o.previousElementSibling&&(o=o.previousElementSibling,r.push(o)),r.forEach(function(e){e.classList.add("erasing-target")})}).on("mouseout",'[data-mode="erasing"] .semantics-result *',function(e){r.forEach(function(e){v(e).removeClass("erasing-target")}),r=[],i=null,e.stopPropagation()}).on("keydown keyup",function(e){("keydown"==e.type&&!t&&e.shiftKey||"keyup"==e.type&&t&&!e.shiftKey)&&(t=!t,v(b.body).toggleClass("shift",t),null!=i)&&v(i).trigger("mouseout").trigger("mouseover",[t])}).on("click",".erasing-target",function(e){var t=e.target.closest(".semantics-result")||e.target;t.closest('[data-mode="erasing"]')&&(T(t),r.forEach(function(e){0==e.textContent.length||e.matches(".brkt")?v(e).remove():v(e).contents().unwrap()})),v(t).find(".rcm").each(function(){for(var e of this.classList)-1<e.indexOf("mfd")&&0==v(`[data-mfd="${e.substring(4)}"]`).length&&v(this).contents().unwrap()}),v(t).find("[data-mfd]").each(function(){0==v(".rcm.mfd-"+this.dataset.mfd).length&&delete this.dataset.mfd}),e.shiftKey&&getSelection().removeAllRanges(),O(t)}).on("mouseup",'.edit-svoc[data-mode="role"], .edit-svoc[data-mode="wrap"]',function(e,o){e.stopPropagation();var e=f.find(".active").val(),s=getSelection(),n=s?.anchorNode?.parentElement?.closest(".semantics-result");if(!s.isCollapsed){if(T(n),"role"==this.dataset.mode){n=s;var r=o||e;let t=n.getRangeAt(0),a=b.createElement("span");a.className="sem "+(R[r]??r),null!=N[r]&&(a.dataset.rc=N[r],a.dataset.rcMin=N[r]);"string"==typeof A[r]&&(a.dataset.gc=A[r]);try{t.surroundContents(a)}catch(e){a.appendChild(t.extractContents()),t.insertNode(a)}t.detach(),n.removeAllRanges(),["tor","ptc"].includes(r)&&1==a.childElementCount&&[".adjphr",".advphr"].find(e=>a.firstElementChild.matches(e))&&C.swapParentAndChild(a,a.firstElementChild);n=v(a).closest(".semantics-result")[0];O(n)}else if("wrap"==this.dataset.mode){var a=s,i=o||e,l=a.getRangeAt(0),r=l.startContainer.nodeType===Node.TEXT_NODE?l.startContainer.parentNode:l.startContainer,c=r.closest(".sem"),d=r.closest(".semantics-result"),m=c?.matches(".sem."+("pcl"==i?"advcls":i));switch(i){case"tor":case"ger":case"ptc":case"ncls":if(l.toString().length==c?.textContent?.length){var u=createElement({el:"span",class:"sem "+i,dataset:{gc:A[i]}});c.matches(".s,.o,.po,.to,.go,.ptco,.c,.oc,.appo,.adjphr,.advphr")?"ncls"==i?(c?.dataset?.gc&&delete c.dataset.gc,u.dataset.gc=A.ncls[Array.from(c.classList).filter(e=>["s","o","po","to","go","ptco","c","oc","appo"].includes(e))[0]],v(c).wrap(u)):v(c).wrapInner(u):m?(p=v(c).wrapInner(u).children().eq(0).unwrap(),l.selectNode(p[0]),M(l,i,p[0])):v(c).wrap(u),O(d)}else{let t;if(["tor","ger","ptc"].includes(i)){t=createElement({el:"span",class:"sem "+i,dataset:{gc:A[i]}});try{l.surroundContents(t)}catch(e){t.appendChild(l.extractContents()),l.insertNode(t)}}O(d),M(l,i,t)}break;case"acls":case"advcls":case"pcl":var p=b.createElement("span");p.className="sem m",p.dataset.rc=N.m;try{l.surroundContents(p)}catch(e){p.appendChild(l.extractContents()),l.insertNode(p)}C.trimTextContent(d),l.selectNode(p);default:let t=b.createElement("span");t.classList.add("sem","pcl"==i?"advcls":i),A[i]&&(t.dataset.gc=A[i]);try{l.surroundContents(t)}catch(e){t.appendChild(l.extractContents()),l.insertNode(t)}l.detach(),a.removeAllRanges(),["adjphr","advphr"].includes(i)&&[".tor",".ptc"].some(e=>t.parentElement.matches(e))&&1===Array.from(t.parentElement.childNodes).filter(e=>0<e.textContent.length).length&&C.swapParentAndChild(t.parentElement,t),O(d)}}v(".edit-svoc").attr("data-mode",null),f.find(".active").removeClass("active"),y.empty()}}).on("mouseup",'.edit-svoc[data-mode="cleft"]',function(n){n.stopPropagation();var r=this.querySelector(".semantics-result"),i=(r.normalize(),getSelection());if(!i.isCollapsed){var l=i.anchorNode.compareDocumentPosition(i.focusNode);let e=!1,{anchorNode:t,anchorOffset:a,focusNode:o,focusOffset:s}=((e=!l&&i.anchorOffset>i.focusOffset||l===Node.DOCUMENT_POSITION_PRECEDING?!0:e)&&i.setBaseAndExtent(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset),i);for(;/^(\s|[.,?!'"])/.test(t.textContent.substring(a));)a++;for(;/(\s|'s|[.,?!'"])$/.test(o.textContent.substring(0,s));)s--;for(;0<a&&/\w/.test(t.textContent[a-1]);)a--;for(;s<o.textContent.length&&/\w/.test(o.textContent[s]);)s++;i.setBaseAndExtent(o,s,t,a);l=i.toString().trim().match(/^[iI]t( is| was|'s| had been| has been|'s been|'ll be|'ll have been| will be| will have been| can be| could be| could have been| would be| would have been)[ ,].+\S$/);if(l){T(r);var c,d="It"+l[1],l=l[0].match(/(that|wh(o(se|m)?|e(n|re)|y|at|ich)|how)$/i);l&&((c=new Range).setStart(o,s-l[0].length),c.setEnd(o,s),c.surroundContents(createElement({el:"span",class:"sem cleft"})));try{var m=new Range;m.setStart(t,a),m.setEnd(t,a+d.length),m.surroundContents(createElement({el:"span",class:"sem cleft",dataset:{gc:"강조구문"}}))}catch(n){return alertModal("선택 범위 내의 다른 마킹을 지워주세요."),void v(r).html(u.pop())}i.removeAllRanges()}else alertModal('"It + be동사 + 강조대상 + that(생략 가능. that 대신 who,where 등 가능)"까지 선택하세요.')}}).on("click",".cls-role-menu button",function(){var e=this.value,t=createElement({el:"span",class:"sem "+(R[e]??e)}),a=(N[e]&&(t.dataset.rc=N[e]),c.data("range"));try{a.surroundContents(t)}catch(e){t.appendChild(a.extractContents()),a.insertNode(t)}var o=createElement({el:"span",class:"sem ncls"});A.ncls[e]&&(o.dataset.gc=A.ncls[e]),v(t).wrap(o),c.data("range",null).detach(),O(t.closest(".semantics-result")),"appo"==e?(a.detach(),getSelection().removeAllRanges(),v(t).parent().addClass("comment-target").trigger("click"),v(".edit-comment :text").val("동격 => ")):(o=a.getClientRects()[0],v(b.body).append(d.css("top",scrollY+o.top+o.height+"px").css("left",scrollX+o.left+"px").data("range",v(t).parent(".ncls"))),d.find('button[value="nclc"]').prop("checked",!0))}).on("click",".cls-conj-menu button",function(){var e=this.value,t=d.data("range");t.attr("data-gc",A.ncls[e]||t.attr("data-gc")),getSelection().removeAllRanges(),d.data("range",null).detach(),O(t.closest(".semantics-result")[0])}).on("click",".tor-role-menu button,.ger-role-menu button,.ptc-role-menu button",function(){var e=this.value,t=this.closest(".tor-role-menu,.ger-role-menu,.ptc-role-menu").className.match(/(\w+)-role-menu/)[1],t={tor:m,ger:p,ptc:h}[t],a=createElement({el:"span",class:"sem "+(R[e]??e)}),o=(N[e]&&(a.dataset.rc=N[e]),["adjphr","advphr"].includes(e)&&A[e]&&(a.dataset.gc=A[e]),t.data("wrapperEl"));["adjphr","advphr"].includes(e)?v(o).wrap(a):v(o).wrapInner(a),t.data("range").detach(),getSelection().removeAllRanges(),t.data("range",null).data("wrapperEl",null).detach(),O(o.closest(".semantics-result"))}).on("mouseup",function(e){(c.is(":visible")&&!e.target.closest(".cls-role-menu")||d.is(":visible")&&!e.target.closest(".cls-conj-menu")||m.is(":visible")&&!e.target.closest(".tor-role-menu")||p.is(":visible")&&!e.target.closest(".ger-role-menu")||h.is(":visible")&&!e.target.closest(".ptc-role-menu"))&&(getSelection().removeAllRanges(),c.data("range",null).detach(),d.data("range",null).detach(),m.data("range",null).detach(),p.data("range",null).detach(),h.data("range",null).detach())}).on("click",'.edit-svoc:not([data-mode="erasing"]):not([data-mode="mod"]):not([data-mode="comment"]) .sem',function(e){v(".edit-comment").remove();var o=this,t=("touchstart"==e.type?e.touches[0]:e).clientX,s=("touchstart"==e.type?e.touches[0]:e).clientY,n=this.getClientRects(),r=v(this).is(".odd")?1:0,i=v(this).is(".rcm")?1:0,l=r?-1:1,c=i?-1:1,d=["top","bottom"][r],m=["left","right"][i];for(let a of[{data:"rc",pseudo:"::before"},{data:"gc",pseudo:"::after"}]){var u=getComputedStyle(o,a.pseudo),p=parseFloat(u[d]),h=parseFloat(u[m]),g=parseFloat(u.width),u=parseFloat(u.height);if(null!=o.dataset[a.data]&&!isNaN(g)&&!isNaN(u)){p=n[r][d]+l*p,u=p+l*u,h=n[i?n.length-1:0][m]+c*h,g=h+c*g;if(Math.min(p,u,s)!=s&&Math.max(p,u,s)!=s&&Math.min(h,g,t)!=t&&Math.max(h,g,t)!=t){e.stopPropagation();let t=w.clone(!1);function f(e){16!=(16&t[0].compareDocumentPosition(e.target))&&(v(b).off("mousedown",f),t.remove(),v(".edit-svoc").focus())}t.find("input:text").val(o.dataset[a.data]),b.body.appendChild(t[0]),t.css("top","gc"==a.data?scrollY+Math.max(p,u)+"px":scrollY+Math.min(p,u)-t.height()-10+"px").css("left",scrollX+Math.min(h,g)+"px").find("input:text")[0].focus(),v(b).on("mousedown",f),t.find("form").on("submit",function(e){e.preventDefault(),T(o.closest(".semantics-result"));e=v(this).find("input").val().trim();0==e.length?delete o.dataset[a.data]:o.dataset[a.data]=e,v(b).off("mousedown",f),t.remove(),C.checkGCDepth(o.closest(".semantics-result")),v(".edit-svoc").focus()}),t.find("button:eq(1)").on("click",function(){v(b).off("mousedown",f),t.remove(),v(".edit-svoc").focus()});break}}}}).on("mouseover",'[data-mode="mod"] .semantics-result *',function(e){v(".mod-indicator").remove();var t=".cls,.acls,.ncls,.advcls,.phr,.tor,.ger,.adjphr,.ptc",t=v(this).is(t)?this:0==v(this).closest(t).length?null!=this.dataset.lv?this:null:v(this).closest(t)[0];if(null==t||t.textContent.trim().length<2||null!=t.dataset.mfd)return k=null,!1;e.stopPropagation(),k=t;e=b.createElement("div");e.className="mod-indicator",e.style.position="absolute",e.style.top=scrollY+t.getClientRects()[0].top-3*n+"px",e.style.left=scrollX+t.getClientRects()[0].left-.8*n+"px",e.textContent="↑",b.body.appendChild(e)}).on("mousemove",".edit-svoc .semantics-result",function(e){E=("touchstart"==e.type?e.touches[0]:e).clientX,P=("touchstart"==e.type?e.touches[0]:e).clientY;let t,a,o;if(0<v(e.target).closest('[data-mode="mod-end"] .semantics-result').length){v(".mod-indicator").remove();var s=b.createElement("div");if(s.className="mod-indicator",s.style.position="absolute",b.caretPositionFromPoint)a=b.caretPositionFromPoint(E,P);else{if(!b.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;a=b.caretRangeFromPoint(E,P)}if("function"==typeof Selection.prototype.modify){if((t=getSelection()).removeAllRanges(),t.addRange(a),t.modify("move","backward","word"),t.modify("extend","forward","word"),0==t.rangeCount||null==t.toString().trim().match(/\w/))return t.removeAllRanges(),!1;if(o=t.getRangeAt(0).getClientRects()[0],t.removeAllRanges(),o.y>P||P>o.y+o.height)return!1}else if("function"==typeof Range.prototype.expand){if(a.expand("word"),null==a.toString().trim().match(/\w/))return!1;if(o=a.getClientRects()[0],a.detach(),o.y>P||P>o.y+o.height)return!1}else console.error("[This browser supports neither Selection.modify nor Range.expand.]");e.stopPropagation(),s.style.top=scrollY+o.top-3*n+"px",s.style.left=scrollX+o.right-n+"px",s.textContent="↓",b.body.appendChild(s)}}).on("click",'[data-mode="mod"] .semantics-result *',function(e){if(null==k)return!1;e.stopPropagation(),v(".mod-indicator").toggleClass("mod-indicator mod-start"),this.closest(".edit-svoc").dataset.mode="mod-end",v(".semantic-edit-guide-msg").text("피수식어 위치를 클릭 하세요.")}).on("click",'[data-mode="mod-end"] .semantics-result',function(e){if(0==v(".mod-indicator").length)return!1;e.stopPropagation(),v(".mod-start").remove(),T(this);var t,a=this.dataset.seq,o=0,s=(v(this).find(".rcm").each(function(){for(var e of this.classList)-1<e.indexOf("mfd")&&(o=Math.max(o,parseFloat(e.split("-")[2])))}),k.dataset.mfd=a+"-"+(o+1),b.createElement("span")),a=(s.className=`sem rcm mfd-${a}-`+(o+1),s.dataset.gc="수식",("touchstart"==e.type?e.touches[0]:e).clientX),e=("touchstart"==e.type?e.touches[0]:e).clientY;if(b.caretPositionFromPoint)t=b.caretPositionFromPoint(a,e);else{if(!b.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;t=b.caretRangeFromPoint(a,e)}for((a=getSelection()).removeAllRanges(),a.addRange(t),a.modify("move","backward","word"),a.modify("extend","forward","word"),t=a.getRangeAt(0);t.toString().endsWith(" ");)t.setEnd(t.endContainer,t.endOffset-1);0==t.endOffset&&t.setEnd(t.startContainer,t.startContainer.data.length);try{t.surroundContents(s)}catch(e){s.appendChild(t.extractContents()),t.insertNode(s)}a.removeAllRanges(),k=null,v(".mod-indicator").remove(),v(".edit-svoc").attr("data-mode",null),f.find('[data-mode="mod"].active').removeClass("active"),y.empty(),C.checkGCDepth(this)}).on("click",".comment-target",function(e){let t=e.target.closest(".semantics-result")||e.target,a=this;v(b).off("mouseover",'[data-mode="comment"] .semantics-result .sem').off("mouseout",'[data-mode="comment"] .semantics-result *'),v(".edit-comment").remove();var e=a.getClientRects(),o=a.matches(".odd")?1:0,s=a.matches(".rcm")?1:0,n=o?-1:1,r=s?-1:1,i=["top","bottom"][o],l=["left","right"][s],c=getComputedStyle(a,"::after"),d=parseFloat(c[i]),m=parseFloat(c[l]),u=parseFloat(c.width),c=parseFloat(c.height),o=e[o][i]+n*d,i=o+n*c,d=e[s?e.length-1:0][l]+r*m,n=d+r*u;let p=w.clone(!1);function h(e){16!=(16&p[0].compareDocumentPosition(e.target))&&(v(b).off("mousedown",h),p.remove(),v(".edit-svoc").focus(),g())}b.body.appendChild(p[0]),p.find("input:text").val(a.dataset.gc??""),p.css("top",scrollY+Math.max(o,i)+"px").css("left",scrollX+Math.min(d,n)+"px").find("input:text")[0].focus(),v(b).on("mousedown",h),p.find("form").on("submit",function(e){e.preventDefault(),a.classList.remove("comment-target"),t.closest('[data-mode="comment"]')&&T(t),g();e=v(this).find("input").val().trim();0==e.length?delete a.dataset.gc:a.dataset.gc=e,v(b).off("mousedown",h),p.remove(),C.checkGCDepth(a.closest(".semantics-result")),v(".edit-svoc").focus(),t.closest(".edit-svoc").removeAttribute("data-mode"),f.find('[data-mode="comment"].active').removeClass("active"),y.empty()}),p.find("button:eq(1)").on("click",function(){v(b).off("mousedown",h),p.remove(),g(),v(".edit-svoc").focus()})}),g(),y=v(e).find(".semantic-edit-guide-msg"),s=v(e).find(".svoc-editor-badge"),l=v(e).find(".svoc-editor-emblem")},"html")),(t=s.clone()).text(e?"New":"Edit"),this.wrap(v('<div class="edit-svoc" tabindex="0"></div>')).before(t).before(l).before(f).after(y),v(".edit-svoc").focus()),this}}(jQuery,document,tandem);