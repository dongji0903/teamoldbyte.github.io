!function(b,y,C){let s=[],a=[],x,w;const l={49:'[value="s"]',50:'[value="v"]',51:'[value="o"]',52:'[value="c"]',53:'[value="oc"]',54:'[value="a"]',81:'[value="tor"]',87:'[value="ptc"]',69:'[value="ger"]',82:'[value="conj"]',65:'[value="phr"]',83:'[value="adjphr"]',68:'[value="advphr"]',70:'[value="ptcphr"]',84:'[value="ccls"]',89:'[value="ncls"]',71:'[value="acls"]',72:'[value="advcls"]',90:'[value="mod"]',88:'[value="erasing"]',67:'[value="comment"]',ctrlS:'[value="save"]',ctrlZ:'[value="undo"]:not([disabled])',ctrlY:'[value="redo"]:not([disabled])'};let c,d=0,m=0,u={};function k(t){var e=t.dataset.seq;s.push([e,t.innerHTML]),a=[],b('.svoc-toolbar [value="undo"]').prop("disabled",!1)}function P(t){b(t).find(".sem").filter((t,e)=>0==e.textContent.length).remove(),C.checkPOSDepth(t),C.wrapWithBracket(t),C.splitInners(t),C.trimTextContent(t),C.correctMarkLine(t),b(".edit-svoc").focus()}b.fn.svoceditor=async function(t,e,o){return u={forNew:t,saveCallback:e,cancelCallback:o},"close"==t?(void 0!==x&&x.detach(),void 0!==w&&w.detach()):(void 0===x&&(await b.get("https://static.findsvoc.com/css/app/tandem.editor.min.css",t=>{const e=y.createElement("style");e.innerHTML=t,y.head.append(e)}),await b.getJSON("https://static.findsvoc.com/data/tandem/edit-toolbar.json",o=>{x=b('<div id="js-edit-toolbar" class="svoc-toolbar row g-2 btn-toolbar" role="toolbar"></div>');for(let t=0,e=o.length;t<e;t++)!function o(s,t){let a,e;switch(s.type){case"group":e="btn-group col-auto";case"div":e=s.class||e,a=y.createElement("div");break;default:e=s.class||"btn btn-outline-dark col-auto btn-sm",(a=y.createElement("button")).dataset.toggle="tooltip",a.dataset.placement="bottom",a.dataset.mode=s.mode,a.title=s.title,a.value=s.value,a.innerHTML=s.html}a.className=e;t.append(a);if(s.children)for(let t=0,e=s.children.length;t<e;t++)o(s.children[t],b(a))}(o[t],x);x.find('[data-toggle="tooltip"]').click(function(){b(this).tooltip("hide")}).tooltip({trigger:"hover"});const n=parseFloat(getComputedStyle(y.body).fontSize);b(y).on("keydown",function(t){b(t.target).is("input")&&0<b(t.target).closest(".edit-comment").length&&27==t.keyCode?b(t.target.form).find("button:eq(1)").trigger("click"):b(".edit-svoc")?.is(":focus")&&((t.ctrlKey||t.metaKey)&&65<=t.keyCode&&t.keyCode<=90?l["ctrl"+t.key.toUpperCase()]&&(t.preventDefault(),x.find(l["ctrl"+t.key.toUpperCase()]).trigger("click")):b(t.target).is("input")||null==l[t.keyCode]||x.find(l[t.keyCode]).trigger("click"))}),x.on("click",'[value="save"]',function(){var e,t=this.closest(".edit-svoc").querySelector(".semantics-result");for(b(t).closest(".edit-svoc").addClass("pe-none").find(".svoc-editor-badge").html('<i class="fas fa-spinner fa-spin"></i> 저장중').animate({width:"100%"});null!=t.querySelector(".brkt,.line-end,canvas.curved_arrow");)t.querySelector(".brkt,.line-end,canvas.curved_arrow").remove();e=t,requestAnimationFrame(async function(){var t=await C.getSvocBytes(e);C.wrapWithBracket(e),C.correctMarkLine(e),s=[],a=[],x.find('[value="undo"], [value="redo"]').prop("disabled",!0),u.saveCallback(t),b(".svoc-editor-badge").html('<i class="fas fa-check"></i> 저장됨'),setTimeout(()=>{w.text(""),b(e).unwrap(),x.find('[value="undo"], [value="redo"]').prop("disabled",!0),x.find("button").removeClass("active").tooltip("hide"),b(".js-edit-svoc,.js-del-svoc,.js-add-svoc").prop("disabled",!1),b(".svoc-editor-badge,.svoc-editor-emblem").remove(),x.detach(),w.detach()},2e3)})}).on("click",'[value="close"]',function(){if(confirm("수정내역은 저장되지 않습니다.\n편집모드를 종료하시겠습니까?")){const e=b(this).closest(".edit-svoc"),o=e.find(".semantics-result");0<s.length&&(t=s.shift(),o.html(t[1]),b(".erasing-target").toggleClass("erasing-target"),b(".mod-start,.mod-indicator").remove(),C.drawConnections(o[0]),o.animate({opacity:.5},100).animate({opacity:1},100)),t=o,x.find('[value="undo"], [value="redo"]').prop("disabled",!0),x.find("button").removeClass("active").tooltip("hide"),t.unwrap(),s=[],a=[],b(".svoc-editor-badge,.svoc-editor-emblem").remove(),x.detach(),w.detach(),u.cancelCallback()}var t}).on("click","[data-mode]:not([disabled])",function(){if("undo"==this.dataset.mode)return!0;let t=getSelection(),e;if(b(".svoc-toolbar .active").add(this).toggleClass("active"),b(".erasing-target, .comment-target").removeClass("erasing-target comment-target"),b(".mod-start,.mod-indicator").remove(),b(this).is(".active")){var o=this.dataset.mode;switch(b(".edit-svoc").attr("data-mode",o),o){case"role":case"wrap":t.isCollapsed?w.text("적용 텍스트를 드래그 하세요."):(b(".edit-svoc").trigger("mouseup",this.value).attr("data-mode",null),b(this).removeClass("active"));break;case"erasing":w.html("지우려는 태그를 클릭 하세요.<br><h6>하위태그 모두 선택 : shift+클릭</h6>"),t.removeAllRanges();break;case"mod":w.text("수식어 위치를 클릭 하세요."),t.removeAllRanges();break;case"comment":w.text("문법 코멘트를 추가할 요소를 선택하세요."),t.removeAllRanges()}if(t.isCollapsed){if(y.caretPositionFromPoint)e=y.caretPositionFromPoint(d,m);else{if(!y.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;e=y.caretRangeFromPoint(d,m)}let t=e.startContainer;for(;1!=t.nodeType;)t=t.parentNode;b(t).trigger("mouseover")}}else b(".edit-svoc").attr("data-mode",null),w.empty()}).on("click",'[value="undo"], [value="redo"]',function(t){var e;t.preventDefault(),("undo"==this.value||"redo"==this.value&&0<a.length)&&(this.classList.add("active"),t=("undo"==this.value?s:a).pop(),e=b(`.edit-svoc .semantics-result[data-seq="${t[0]}"]`),("undo"==this.value?a:s).push([e.attr("data-seq"),e.html()]),e.html(t[1]),b(".erasing-target").toggleClass("erasing-target"),b(".mod-start,.mod-indicator").remove(),C.drawConnections(e[0]),e.animate({opacity:.5},100).animate({opacity:1},100),b('.svoc-toolbar [value="undo"]').prop("disabled",0==s.length),b('.svoc-toolbar [value="redo"]').prop("disabled",0==a.length),setTimeout(()=>{this.classList.remove("active")},50))});let i=[],r=null,e=!1;function v(){b(y).on("mouseover",'[data-mode="comment"] .semantics-result .sem',function(t){null!=this.dataset.gc&&0!=this.dataset.gc.length||(t.stopPropagation(),this.classList.add("comment-target"))}).on("mouseout",'[data-mode="comment"] .semantics-result *',function(){b(".comment-target").removeClass("comment-target")})}b(y).on("mouseover",'[data-mode="erasing"] .semantics-result *',function(e,o){e.stopPropagation();var s=e.target;if(r=s,a(),b(s).is(".curved_arrow"))for(var t of s.classList)-1<t.indexOf("mfd")&&(b(this).siblings(".curved_arrow."+t).each(function(){i.push(this)}),i.push(b(".rcm.mfd-"+t.substring(3))[0]));function a(){if(null!=s){if(i.push(s),o||e.shiftKey)for(var t of s.getElementsByTagName("span"))i.push(t);s.textContent==s.parentElement.textContent?(s=s.parentElement,i.push(s)):0<s.children.length&&s.children[0].textContent==s.textContent&&i.push(s.children[0])}}null!=s.previousElementSibling&&b(s.previousElementSibling).is('[class*="-start"]:not([class*="cmnt-align-start"])')&&null!=s.nextElementSibling&&b(s.nextElementSibling).is('[class*="-end"]')&&(i.push(s.previousElementSibling),i.push(s.nextElementSibling)),-1<s.className.indexOf("-start")?(s=s.nextElementSibling,a(),null!=s&&null!=s.nextElementSibling&&(s=s.nextElementSibling,i.push(s))):-1<s.className.indexOf("-end")&&(s=s.previousElementSibling,a(),null!=s&&null!=s.previousElementSibling&&(s=s.previousElementSibling,i.push(s))),i.forEach(function(t){t.classList.add("erasing-target")})}).on("mouseout",'[data-mode="erasing"] .semantics-result *',function(t){i.forEach(function(t){b(t).removeClass("erasing-target")}),i=[],r=null,t.stopPropagation()}).on("keydown keyup",function(t){("keydown"==t.type&&!e&&t.shiftKey||"keyup"==t.type&&e&&!t.shiftKey)&&(e=!e,b(y.body).toggleClass("shift",e),null!=r&&b(r).trigger("mouseout").trigger("mouseover",[e]))}).on("click",".erasing-target",function(t){const e=t.target.closest(".semantics-result")||t.target;e.closest('[data-mode="erasing"]')&&(k(e),i.forEach(function(t){0==t.textContent.length||t.matches(".brkt")?b(t).remove():b(t).contents().unwrap()})),b(e).find(".rcm").each(function(){for(var t of this.classList)-1<t.indexOf("mfd")&&0==b(`[data-mfd="${t.substring(4)}"]`).length&&b(this).contents().unwrap()}),b(e).find("[data-mfd]").each(function(){0==b(".rcm.mfd-"+this.dataset.mfd).length&&delete this.dataset.mfd}),t.shiftKey&&getSelection().removeAllRanges(),P(e)}).on("mouseup",'.edit-svoc[data-mode="role"], .edit-svoc[data-mode="wrap"]',function(t,e){t.stopPropagation();t=x.find(".active").val();const o=getSelection();var s=o?.anchorNode?.parentElement?.closest(".semantics-result");if(!o.isCollapsed){if(k(s),"role"==this.dataset.mode){s=o;var a=e||t;const r={s:"S",v:"V",o:"O",c:"C",oc:"o.c.",m:"M",a:"A"},l={a:"부사적 보충어",tor:"to부정사",ger:"동명사",ptc:"분사"},c=s.getRangeAt(0),d=y.createElement("span");d.className="sem "+a,null!=r[a]&&(d.dataset.rc=r[a],d.dataset.rcMin=r[a].substring(0,"oc"==a?4:1));null!=l[a]&&(d.dataset.gc=l[a]);try{c.surroundContents(d)}catch(t){d.appendChild(c.extractContents()),c.insertNode(d)}c.detach(),s.removeAllRanges();a=b(d).closest(".semantics-result")[0];P(a)}else if("wrap"==this.dataset.mode){var n=o;var i=e||t;const m={s:"S",o:"O",c:"C",oc:"o.c.",m:"M",a:"A"},u={ncls:{s:"주어절",o:"목적어절",c:"보어절",oc:"목적보어절",m:"관계절"},acls:"형용사절",advcls:"부사절",phr:"전치사구",adjphr:"형용사구",advphr:"부사구",ptcphr:"부사구(분사구문)",ccls:"등위절"},p=n.getRangeAt(0),f=b(p.startContainer).closest(".semantics-result")[0];switch(i){case"ncls":const v=y.createElement("div");v.className="cls-role-menu",v.style.position="absolute",v.style.top=scrollY+p.getClientRects()[0].top+p.getClientRects()[0].height+"px",v.style.left=scrollX+p.getClientRects()[0].left+"px",v.insertAdjacentHTML("afterbegin",'<button class="cls-role-btn" value="s">s</button><button class="cls-role-btn" value="o">o</button><button class="cls-role-btn" value="c">c</button><button class="cls-role-btn" value="oc">oc</button>'),y.body.appendChild(v);let s=!1;b(y).on("click",function t(e){if(s){if(16==(16&v.compareDocumentPosition(e.target))){var o=y.createElement("span");o.className="sem "+e.target.value,null!=m[e.target.value]&&(o.dataset.rc=m[e.target.value]);try{p.surroundContents(o)}catch(t){o.appendChild(p.extractContents()),p.insertNode(o)}o=y.createElement("span");o.className="sem "+i,o.dataset.gc=u[i][e.target.value];try{p.surroundContents(o)}catch(t){o.appendChild(p.extractContents()),p.insertNode(o)}p.detach(),n.removeAllRanges(),P(f)}b(y).off("click",t),b(v).remove()}else s=!0});break;case"acls":case"advcls":const h=y.createElement("span");h.className="sem m",h.dataset.rc=m.m;try{p.surroundContents(h)}catch(t){h.appendChild(p.extractContents()),p.insertNode(h)}C.trimTextContent(f),p.selectNode(h);default:const g=y.createElement("span");g.className="sem "+i,u[i]&&(g.dataset.gc=u[i]);try{p.surroundContents(g)}catch(t){g.appendChild(p.extractContents()),p.insertNode(g)}p.detach(),n.removeAllRanges(),P(f)}}b(".edit-svoc").attr("data-mode",null),x.find(".active").removeClass("active"),w.empty()}}).on("click",'.edit-svoc:not([data-mode="erasing"]):not([data-mode="mod"]):not([data-mode="comment"]) .sem',function(t){b(".edit-comment").remove();var o=this,s=("touchstart"==t.type?t.touches[0]:t).clientX,a=("touchstart"==t.type?t.touches[0]:t).clientY,n=this.getClientRects(),i=b(this).is(".odd")?1:0,r=b(this).is(".rcm")?1:0,l=i?-1:1,c=r?-1:1,d=["top","bottom"][i],m=["left","right"][r];for(let e of[{data:"rc",pseudo:"::before"},{data:"gc",pseudo:"::after"}]){var u=getComputedStyle(o,e.pseudo),p=parseFloat(u[d]),f=parseFloat(u[m]),v=parseFloat(u.width),u=parseFloat(u.height);if(null!=o.dataset[e.data]&&!isNaN(v)&&!isNaN(u)){p=n[i][d]+l*p,u=p+l*u,f=n[r?n.length-1:0][m]+c*f,v=f+c*v;if(Math.min(p,u,a)!=a&&Math.max(p,u,a)!=a&&Math.min(f,v,s)!=s&&Math.max(f,v,s)!=s){t.stopPropagation();var h=y.createElement("div");function g(t){16!=(16&h.compareDocumentPosition(t.target))&&(b(y).off("mousedown",g),b(h).remove(),b(".edit-svoc").focus())}h.className="edit-comment text-end",h.style.position="absolute",h.insertAdjacentHTML("afterbegin",'<form class="btn-group"><input class="form-control" type="text"'+`placeholder="↵" value="${o.dataset[e.data]}"/>`+'<div class="btn-group ms-1"><button class="btn btn-sm btn-fico" type="submit">확인</button><button class="btn btn-sm btn-outline-fico" type="button">취소</button></div></form>'),y.body.appendChild(h),h.style.top=scrollY+Math.max(p,u)+"px",h.style.left=scrollX+Math.min(f,v)+"px","gc"==e.data&&(h.style.top=scrollY+Math.min(p,u)-h.offsetHeight-10+"px"),h.firstChild.firstChild.focus(),b(y).on("mousedown",g),b(h).find("form").on("submit",function(t){t.preventDefault(),k(o.closest(".semantics-result"));t=b(this).find("input").val().trim();0==t.length?delete o.dataset[e.data]:o.dataset[e.data]=t,b(y).off("mousedown",g),b(h).remove(),C.checkGCDepth(o.closest(".semantics-result")),b(".edit-svoc").focus()}),b(h).find("button:eq(1)").on("click",function(){b(y).off("mousedown",g),b(h).remove(),b(".edit-svoc").focus()});break}}}}).on("mouseover",'[data-mode="mod"] .semantics-result *',function(t){b(".mod-indicator").remove();var e=".cls,.acls,.ncls,.advcls,.phr,.tor,.ger,.adjphr,.ptc";let o=b(this).is(e)?this:0==b(this).closest(e).length?null!=this.dataset.lv?this:null:b(this).closest(e)[0];if(null==o||o.textContent.trim().length<2||null!=o.dataset.mfd)return c=null,!1;t.stopPropagation(),c=o;const s=y.createElement("div");s.className="mod-indicator",s.style.position="absolute",s.style.top=scrollY+o.getClientRects()[0].top-3*n+"px",s.style.left=scrollX+o.getClientRects()[0].left-.8*n+"px",s.textContent="↑",y.body.appendChild(s)}).on("mousemove",".edit-svoc .semantics-result",function(t){d=("touchstart"==t.type?t.touches[0]:t).clientX,m=("touchstart"==t.type?t.touches[0]:t).clientY;let e,o,s;if(0<b(t.target).closest('[data-mode="mod-end"] .semantics-result').length){b(".mod-indicator").remove();const a=y.createElement("div");if(a.className="mod-indicator",a.style.position="absolute",y.caretPositionFromPoint)o=y.caretPositionFromPoint(d,m);else{if(!y.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;o=y.caretRangeFromPoint(d,m)}if("function"==typeof Selection.prototype.modify){if((e=getSelection()).removeAllRanges(),e.addRange(o),e.modify("move","backward","word"),e.modify("extend","forward","word"),0==e.rangeCount||null==e.toString().trim().match(/\w/))return e.removeAllRanges(),!1;if(s=e.getRangeAt(0).getClientRects()[0],e.removeAllRanges(),s.y>m||m>s.y+s.height)return!1}else if("function"==typeof Range.prototype.expand){if(o.expand("word"),null==o.toString().trim().match(/\w/))return!1;if(s=o.getClientRects()[0],o.detach(),s.y>m||m>s.y+s.height)return!1}else console.error("[This browser supports neither Selection.modify nor Range.expand.]");t.stopPropagation(),a.style.top=scrollY+s.top-3*n+"px",a.style.left=scrollX+s.right-n+"px",a.textContent="↓",y.body.appendChild(a)}}).on("click",'[data-mode="mod"] .semantics-result *',function(t){if(null==c)return!1;t.stopPropagation(),b(".mod-indicator").toggleClass("mod-indicator mod-start"),this.closest(".edit-svoc").dataset.mode="mod-end",b(".semantic-edit-guide-msg").text("피수식어 위치를 클릭 하세요.")}).on("click",'[data-mode="mod-end"] .semantics-result',function(t){if(0==b(".mod-indicator").length)return!1;t.stopPropagation(),b(".mod-start").remove(),k(this);var e,o=this.dataset.seq,s=0,a=(b(this).find(".rcm").each(function(){for(var t of this.classList)-1<t.indexOf("mfd")&&(s=Math.max(s,parseFloat(t.split("-")[2])))}),c.dataset.mfd=o+"-"+(s+1),y.createElement("span")),o=(a.className=`sem rcm mfd-${o}-`+(s+1),a.dataset.gc="수식",("touchstart"==t.type?t.touches[0]:t).clientX),t=("touchstart"==t.type?t.touches[0]:t).clientY;if(y.caretPositionFromPoint)e=y.caretPositionFromPoint(o,t);else{if(!y.caretRangeFromPoint)return console.error("[This browser supports neither document.caretRangeFromPoint nor document.caretPositionFromPoint.]"),!1;e=y.caretRangeFromPoint(o,t)}for((o=getSelection()).removeAllRanges(),o.addRange(e),o.modify("move","backward","word"),o.modify("extend","forward","word"),e=o.getRangeAt(0);e.toString().endsWith(" ");)e.setEnd(e.endContainer,e.endOffset-1);0==e.endOffset&&e.setEnd(e.startContainer,e.startContainer.data.length);try{e.surroundContents(a)}catch(t){a.appendChild(e.extractContents()),e.insertNode(a)}o.removeAllRanges(),c=null,b(".mod-indicator").remove(),b(".edit-svoc").attr("data-mode",null),x.find('[data-mode="mod"].active').removeClass("active"),w.empty(),checkGCDepth(this)}).on("click",".comment-target",function(t){const e=t.target.closest(".semantics-result")||t.target,o=this;b(y).off("mouseover",'[data-mode="comment"] .semantics-result .sem').off("mouseout",'[data-mode="comment"] .semantics-result *'),b(".edit-comment").remove();var t=o.getClientRects(),s=o.matches(".odd")?1:0,a=o.matches(".rcm")?1:0,n=s?-1:1,i=a?-1:1,r=["top","bottom"][s],l=["left","right"][a],c=getComputedStyle(o,"::after"),d=parseFloat(c[r]),m=parseFloat(c[l]),u=parseFloat(c.width),c=parseFloat(c.height),s=t[s][r]+n*d,r=s+n*c,d=t[a?t.length-1:0][l]+i*m,n=d+i*u;const p=y.createElement("div");function f(t){16!=(16&p.compareDocumentPosition(t.target))&&(b(y).off("mousedown",f),b(p).remove(),b(".edit-svoc").focus(),v())}p.className="edit-comment text-end",p.style.position="absolute",p.style.top=scrollY+Math.max(s,r)+"px",p.style.left=scrollX+Math.min(d,n)+"px",p.insertAdjacentHTML("afterbegin",'<form class="btn-group"><input class="form-control" type="text" placeholder="↵"/><div class="btn-group ms-1"><button class="btn btn-sm btn-fico" type="submit">확인</button><button class="btn btn-sm btn-outline-fico" type="button">취소</button></div></form>'),y.body.appendChild(p),p.style.top=scrollY+Math.min(s,r)-p.offsetHeight-10+"px",p.firstChild.firstChild.focus(),b(y).on("mousedown",f),b(p).find("form").on("submit",function(t){t.preventDefault(),o.classList.remove("comment-target"),e.closest('[data-mode="comment"]')&&k(e),v();t=b(this).find("input").val().trim();0==t.length?delete o.dataset.gc:o.dataset.gc=t,b(y).off("mousedown",f),b(p).remove(),checkGCDepth(o.closest(".semantics-result")),b(".edit-svoc").focus(),e.closest(".edit-svoc").removeAttribute("data-mode"),x.find('[data-mode="comment"].active').removeClass("active"),w.empty()}),b(p).find("button:eq(1)").on("click",function(){b(y).off("mousedown",f),b(p).remove(),v(),b(".edit-svoc").focus()})}),v()})),void 0===w&&(w=b('<div class="semantic-edit-guide-msg mx-auto"></div>')),this.wrap(b('<div class="edit-svoc" tabindex="0"></div>')).before(b(`<span class="svoc-editor-badge badge fs-6 rounded-pill">${t?"New":"Edit"}</span>`)).before(b('<span class="svoc-editor-emblem position-absolute end-0 me-2 p-1 pb-0 bg-white rounded-pill pe-none">『 <b class="app-name-text">fico </b><b class="text-fc-red" style="font-size:.9rem;">SVOC Editor</b>™』</span>')).before(x).after(w),b(".edit-svoc").focus()),this}}(jQuery,document,tandem);