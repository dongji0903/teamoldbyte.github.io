!function(k,h,q){k.cachedScript=k.cachedScript||function(e,t){return k.ajax(k.extend(t||{},{dataType:"script",cache:!0,url:e}))},k(function(){const t=q.querySelector(".craft-header-section"),n=q.querySelector(".scrolling-section");let s=scrollY;k(h).on("scroll",function(e){requestAnimationFrame(()=>{scrollY>s?115<=scrollY&&(n.style.marginTop="150px",t.classList.add("min")):scrollY<115&&(n.style.marginTop="0",t.classList.remove("min")),s=scrollY})})});let m=new IntersectionObserver(e=>{O(!e[0].isIntersecting)},{threshold:1});let a,l,E,w=[],N,f,g,b,s,o,r;const y="findsvoc-idb",v=1;let x,C,S,L=[];function t(){var e=l?"/"+ntoa(l):"",e=`/craft/battle/${a}${e}/next`;k.getJSON(e,function(s){0==(w=s).length?alert("조회된 문제가 없습니다."):0==f?(x=h.indexedDB.open(y,v)).onsuccess=function(){var e=(C=this.result).transaction(["StepBattle"],"readwrite");S=e.objectStore("StepBattle");let n=0;!function e(){if(n<s.length){const t=s[n++];S.add({bid:t.bid,data:t,solve:""},t.bid).onsuccess=e}else c()}()}:c()}).fail(()=>alert("새로운 문제를 조회할 수 없습니다."))}function c(){E=w.shift(),L=[];var t=(N=q.getElementById("battle-"+E.battleType)).querySelector(".ask"),n=N.querySelector(".simple-ask-block");const o=N.querySelector(".sentence"),l=E.eng;var s=JSON.parse(E.answer||"[]");const r=JSON.parse(E.example||"[]");let c=0,i,d=[];const p=[];switch(scrollTo(0,0),q.querySelector(".craft-header-section").classList.remove("min"),q.querySelector(".scrolling-section").style.marginTop="0",k(N).find(".battle-type-block, .ask-block").show(),k(N).find(".simple-ask-block").hide(),N.querySelector(".battle-type").textContent=E.battleType,k("#save-btn").toggleClass("reverse",Boolean(E.saved)),N.querySelector(".example-btn-section")&&(N.querySelector(".example-btn-section").style.display=""),k(N).show().siblings(".battle-section").hide(),anime({targets:N,duration:1e3,delay:300,left:["100vw",0]}),O(!0),k(N).find(".explain-section").hide().find(".collapse").collapse("hide"),E.battleType){case"1":t.textContent=`다음 문장의 ${E.ask}를 선택하세요.`,n.textContent=t.textContent,r.forEach(([e,t],n,s)=>{(i=l.substring(c,e))&&p.push(i),p.push({el:"span",role:"button",className:"option",textContent:l.substring(e,t),onclick:function(){k(this).toggleClass("selected"),O(0==o.querySelectorAll(".selected").length)}}),n==s.length-1&&t<l.length&&p.push(l.substring(t)),c=t}),o.replaceChildren(createElement(p));break;case"2":E.ask.includes("모든")?t.textContent=`${E.ask.includes("피수식")?"피수식어":"수식어"}를 모두 선택하세요.`:t.textContent=`[${E.ask}] 수식어와 피수식어를 선택하세요.`,n.textContent=t.textContent;var[u,h]=s;const g={el:"span",role:"button",onclick:function(){var e;this.matches(".selected")?(e=L.indexOf(this),L.splice(e,1)[0].classList.remove("selected"),E.ask.includes("모든")||(e=e<2*Math.floor(e/2)+(1-e%2)?e:e-1,L[e]&&L.splice(e,1)[0].classList.remove("selected"))):(this.classList.add("selected"),L.push(this)),O(0==L.length)}};Array.from(u,e=>e.concat("modifier")).concat(Array.from(h,e=>e.concat("modificand"))).sort(([e],[t])=>e-t).forEach(([e,t,n],s,o)=>{(i=l.substring(c,e))&&(i.includes(" ")?Array.from(i.split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},g)).forEach(e=>p.push(e," ")):p.push(i," ")),p.push(Object.assign({className:n+" d-inline-block",textContent:l.substring(e,t)},g)),t<l.length&&p.push(" "),s==o.length-1&&t<l.length&&(-1<l.indexOf(" ",t)?Array.from(l.substring(t).split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},g)).forEach(e=>p.push(e," ")):p.push(l.substring(t))),c=t}),o.replaceChildren(createElement(p));break;case"3":var[[u,h],m,f]=r;(i=l.substring(c,u))&&p.push(i),d=[m,f].sort(()=>Math.random()-.5),p.push({el:"span",className:"pick-right","data-answer":m,children:["[ ",{el:"span",class:"pick-option",textContent:d[0]}," / ",{el:"span",class:"pick-option",textContent:d[1]}," ]"]}),h<l.length&&p.push(l.substring(h)),o.replaceChildren(createElement(p)),N.querySelector(".example-btn-section").replaceChildren(createElement(Array.from(d,e=>({el:"button",className:"btn btn-outline-fico",textContent:e,onclick:function(){k(this).addClass("active").siblings().removeClass("active"),O(!1)}}))));break;case"4":const[[b,y],v,x]=s;r.sort(([e],[t])=>e-t).forEach(([e,t],n,s)=>{(i=l.substring(c,e))&&p.push(i);let o=l.substring(e,t);var a={el:"span",className:"option text-decoration-underline",textContent:o};b==e&&y==t&&(a.className="answer-wrong text-decoration-underline",a.textContent=x,o=x,a["data-answer"]=v),p.push(a),d.push({el:"button",className:"btn btn-outline-fico",textContent:o,onclick:function(){k(this).addClass("active").siblings().removeClass("active"),O(!1)}}),n==s.length-1&&t<l.length&&p.push(l.substring(t)),c=t}),o.replaceChildren(createElement(p)),N.querySelector(".example-btn-section").replaceChildren(createElement(d));break;case"5":o.replaceChildren(E.kor);const C=N.querySelector(".arranged-examples");r.sort(()=>Math.random()-.5).forEach(([e,t])=>{d.push({el:"span",className:"btn btn-outline-fico",textContent:l.substring(e,t),onclick:function(){if(!this.closest(".arranged-examples")&&!this.matches(".selected")){const t=this.cloneNode(!0),e=this.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",C.appendChild(t),this.parentElement.appendChild(e),anime({targets:e,top:[k(this).offset().top,k(t).offset().top],left:[k(this).offset().left,k(t).offset().left],easing:"linear",complete:()=>{e.remove(),t.style.visibility="visible"},duration:100}),t.onclick=()=>{const e=t.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",C.appendChild(e),anime({targets:e,top:[k(t).offset().top,k(this).offset().top],left:[k(t).offset().left,k(this).offset().left],easing:"linear",complete:()=>{e.remove(),t.remove(),k(this).removeClass("selected pe-none"),O(C.childElementCount!=r.length)},duration:100})},k(this).addClass("selected pe-none")}O(C.childElementCount!=r.length)}})}),N.querySelector(".example-btn-section").replaceChildren(createElement(d)),C.replaceChildren(),k(C).sortable();break;case"6":r.sort(([[e]],[[t]])=>e-t).forEach(([[e,t],n],s,o)=>{(i=l.substring(c,e))&&p.push(i),n.split(/\s+/).forEach((e,t)=>{0<t&&p.push(" "),0<e.length&&p.push({el:"input",style:{width:e.length+"em"},pattern:"[0-9A-z!?.,]",placeholder:1<e.length?e.substring(0,1):"",autocapitalize:"off",onfocus:function(){var e=this.getBoundingClientRect().top,t=q.querySelector(".js-next-btn, .js-solve-btn").getBoundingClientRect().top,t=Math.abs(t-e);t<76.5&&scrollTo(scrollX,scrollY+76.5-t)}})}),s==o.length-1&&t<l.length&&p.push(l.substring(t)),c=t}),N.querySelector(".ask-section .sentence.kor").textContent=E.kor,N.querySelector(".example-btn-section").replaceChildren(createElement(p)),k(N).on("input",".example-btn-section input",function(){O(!Array.from(N.querySelectorAll(".example-btn-section input")).every(e=>0<e.value.length))});break;case"7":let e=E.kor.split(/\s+/);const S=N.querySelector(".arranged-examples");let a="";(e=e.reduce((e,t,n,s)=>{var o;return 1<t.length?(o=e.concat([0<a.length?a+" "+t:t]),a="",o):(a+=0<a.length?" "+t:t,n==s.length-1?e.concat([a]):void 0)},[]).concat(r).sort(()=>Math.random()-.5)).forEach(e=>{p.push({el:"span",className:"btn btn-outline-fico",textContent:e,onclick:function(){if(!this.closest(".arranged-examples")&&!this.matches(".selected")){const t=this.cloneNode(!0),e=this.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",S.appendChild(t),this.parentElement.appendChild(e),anime({targets:e,top:[k(this).offset().top,k(t).offset().top],left:[k(this).offset().left,k(t).offset().left],easing:"linear",complete:()=>{e.remove(),t.style.visibility="visible"},duration:100}),t.onclick=()=>{const e=t.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",S.appendChild(e),anime({targets:e,top:[k(t).offset().top,k(this).offset().top],left:[k(t).offset().left,k(this).offset().left],easing:"linear",complete:()=>{e.remove(),t.remove(),k(this).removeClass("selected pe-none"),O(0==S.childElementCount)},duration:100})},k(this).addClass("selected pe-none")}O(0==S.childElementCount)}})}),N.querySelector(".ask-section .sentence.eng").textContent=l,N.querySelector(".example-btn-section").replaceChildren(createElement(p))}q.querySelector(".craft-layout-content-section").style.backgroundPositionY=N.querySelector(".ask-section").getBoundingClientRect().top-328+"px"}function i(e){g=e<13?"E":e<16?"M":e<19?"H":"C",(0==w.length?t:c)(),A()}function A(){var e=o;if(r=3100<b.correct?(s="대장",o=3101,3501):2800<b.correct?(s="중장",o=2801,3101):2500<b.correct?(s="소장",o=2501,2801):2e3<b.correct?(s="준장",o=2001,2501):1700<b.correct?(s="대령",o=1701,2001):1500<b.correct?(s="중령",o=1501,1701):1300<b.correct?(s="소령",o=1301,1501):1100<b.correct?(s="대위",o=1101,1301):900<b.correct?(s="중위",o=901,1101):750<b.correct?(s="소위",o=751,901):600<b.correct?(s="상사",o=601,751):500<b.correct?(s="중사",o=501,601):400<b.correct?(s="하사",o=401,501):300<b.correct?(s="병장",o=301,401):170<b.correct?(s="상병",o=171,301):70<b.correct?(s="일병",o=71,171):30<b.correct?(s="이병",o=31,71):(s="훈련병",o=0,31),e<o){showFireworks({target:k(".battle-section:visible")[0],distance:100,size:10});const n=createElement({el:"img",src:`https://static.findsvoc.com/images/app/craft/${s}.png`,class:"position-absolute start-50 top-50 w-50",style:"transform: translate(-50%, -50%)"});q.body.appendChild(n),anime({targets:n,scale:[0,1],easing:"cubicBezier(0,2,1,2)",duration:1e3,complete:()=>setTimeout(()=>n.remove(),3e3)})}var e=q.querySelector(".progress-bar"),t=(100*(b.correct-o)/r).toFixed(1);e.ariaValueNow=t,e.textContent=t+"%",e.style.width=t+"%"}function O(e){anime({targets:".js-solve-btn,.js-next-btn",duration:500,easing:"easeOutQuart",left:e?"110%":"45%"})}k(q).on("click","#save-btn",function(){k.getJSON("/craft/battle/mybattle/save",{memberId:f,battleId:E.bid,save:!E.saved},e=>{E.saved=e,k(this).toggleClass("reverse",e);const t=createElement({el:"div",class:"toast align-items-center position-absolute end-0 top-0 mt-4 me-5 w-auto text-center",role:"alert","aria-live":"assertive","aria-atomic":"true","data-bs-autohide":"true","data-bs-delay":2e3,textContent:E.saved?"저장되었습니다.":"저장이 취소되었습니다."});this.appendChild(t),bootstrap.Toast.getOrCreateInstance(t).show(),t.addEventListener("hidden.bs.toast",()=>t.remove())})}).on("click",".js-solve-btn",function(){const o=N,l=JSON.parse(E.answer||"[]");var e=JSON.parse(E.example||"[]");let n=!0;switch(k(this).toggleClass("js-solve-btn js-next-btn").text("다음"),k(o).find(".ask-section,.example-btn-section,.arranged-examples").addClass("pe-none"),k(o).find(".battle-type-block, .ask-block, .simple-ask-block").fadeToggle(),E.battleType){case"1":const c=[];e.sort(([e],[t])=>e-t).forEach(([n,s],e)=>{null!=l.find(([e,t])=>n==e&&s==t)&&c.push(e)}),o.querySelectorAll(".option").forEach((e,t)=>{c.includes(t)?e.classList.add("right"):e.matches(".selected")&&(n=!1,e.classList.add("wrong"))});break;case"2":o.querySelectorAll(".option,.modifier,.modificand").forEach(e=>{E.ask.includes("모든")?e.matches(".modifier, .modificand")?e.classList.add("right"):L.includes(e)&&(n=!1,e.classList.add("wrong")):L.includes(e)?e.matches(L.indexOf(e)%2?".modifier":".modificand")?e.classList.add("right"):(e.classList.add("wrong"),n=!1):e.matches(".modifier, .modificand")&&(e.classList.add("right"),n=!1)});break;case"3":var s=o.querySelector(".example-btn-section .active"),r=s.textContent;const i=Array.from(o.querySelectorAll(".example-btn-section button")).indexOf(s);n=!!l.includes(r),o.querySelectorAll(".pick-right .pick-option").forEach((e,t)=>{t==i?e.classList.add(n?"right":"wrong"):n||e.classList.add("right")}),o.querySelector(".example-btn-section").style.display="none";break;case"4":const d=k(o).find(".example-btn-section .active").index(),p=[];e.sort(([e],[t])=>e-t).forEach(([n,s],e)=>{null!=l.find(([e,t])=>n==e&&s==t)&&p.push(e)}),o.querySelectorAll(".sentence .option,.sentence .answer-wrong").forEach((e,t)=>{p.includes(t)?e.classList.add("right"):t==d&&(n=!1,e.classList.add("wrong"))}),o.querySelector(".example-btn-section").style.display="none";break;case"5":n=o.querySelector(".arranged-examples").textContent.replace(/\W/g,"").trim()==E.eng.replace(/\W/g,"").trim(),o.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:E.eng})),o.querySelector(".example-btn-section").style.display="none";break;case"6":const u=Array.from(e,([[],e])=>e.split(/\s+/)).reduce((e,t)=>e.concat(t),[]);o.querySelectorAll(".example-btn-section input").forEach((e,t)=>{e.value.toLowerCase()==u[t].toLowerCase()?e.className="right":(e.className="wrong",n=!1)}),o.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:E.eng}));break;case"7":let t=E.kor.split(/\s+/),a="";t=t.reduce((e,t,n,s)=>{var o;return 1<t.length?(o=e.concat([0<a.length?a+" "+t:t]),a="",o):(a+=0<a.length?" "+t:t,n==s.length-1?e.concat([a]):void 0)},[]),o.querySelectorAll(".arranged-examples .btn").length!=t.length?n=!1:o.querySelectorAll(".arranged-examples .btn").forEach(e=>{t.includes(e.textContent)?e.classList.add("right"):(e.classList.add("wrong"),n=!1)}),o.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:E.kor})),o.querySelector(".example-btn-section").style.display="none"}const t=createElement({el:"div",class:"js-result-msg result-toast",style:{transformOrigin:"top"},textContent:n?"정답입니다.":"오답입니다."});q.querySelector(".craft-header-section").append(t),q.querySelector(".craft-layout-content-section").classList.add("bg-fc-transparent"),anime.timeline({targets:t}).add({begin:()=>{t.style.visibility="visible",t.style.color="#00000000"},bottom:"-2rem",backgroundColor:n?"#00bcd4":"#f44336",width:["2rem","50%"],height:["0rem","2rem"],easing:"easeInOutExpo"}).add({color:"#FFF",easing:"linear"});var a={memberId:f,ageGroup:g,battleId:E.bid,correct:n,save:Boolean(E.saved)};k(o).find(".explain-section").show().find(".comment-section").text(E.comment||"작성된 코멘트가 없습니다."),k.getJSON("/craft/battle/"+E.sentenceId,e=>{return t=E.eng,n=o.querySelector(".explain-section"),s=e,n.querySelector(".trans-section").replaceChildren(createElement(Array.from(s.korList,(e,t)=>({el:"div",className:"row",children:[{el:"div",className:"col-auto ps-2 pe-0",children:[{el:"span",className:"material-icons fs-5",textContent:t>=s.korList.length-3?"manage_accounts":"person",style:"color:"+(t>=s.korList.length-3?["#4F9BA7","#37728E","#1F4775"][t]:"#5169E6")}]},{el:"div",className:"trans-text col",textContent:e.kor}]})))),n.querySelector(".words-section").replaceChildren(0<s.wordList.length?createElement(Array.from(s.wordList,e=>({el:"span",class:"one-word-unit-section",children:[{el:"span",class:"title",textContent:e.title}].concat(Array.from(e.senseList,e=>({el:"span",class:"one-part-unit-section",children:[{el:"span",class:"part",textContent:e.partType},{el:"span",class:"meaning",textContent:e.meaning}]})))}))):"해당 문장에서 fico AI가 설정한 난이도 이상의 단어를 찾지 못했습니다."),k(n).find(".collapse").collapse("show"),tandem.showSemanticAnalysis(t,s.svocTag.svocBytes,k(n).find(".svoc-section").empty()).then(()=>m.observe(n.lastElementChild)),q.querySelector(".craft-header-section").classList.remove("min"),q.querySelector(".scrolling-section").style.marginTop="0",void scrollTo(0,75);var t,n,s}),k.ajax({url:"/craft/battle/evaluation/add",type:"GET",contentType:"application/json",data:a,success:()=>{n&&b.correct++,0==f&&((x=h.indexedDB.open(y,v)).onsuccess=function(){var e=(C=this.result).transaction(["StepBattle"],"readwrite");(S=e.objectStore("StepBattle")).index("bid").openCursor().onsuccess=function(){var e,t=this.result;t&&(t.key==E.bid?((e=t.value).solve=n?"O":"X",t.update(e)):t.continue())}}),O(!0),A()},error:()=>alert("채점 전송에 실패했습니다. 재로그인 후 다시 시도해 주세요.")})}).on("click",".js-next-btn",function(){k(this).toggleClass("js-solve-btn js-next-btn").text("확인"),q.querySelector(".craft-layout-content-section").classList.remove("bg-fc-transparent"),k(N).find(".ask-section,.example-btn-section,.arranged-examples").removeClass("pe-none"),anime({targets:".js-result-msg",bottom:0,height:0,duration:500,easing:"easeInOutExpo",complete:e=>e.animatables.forEach(e=>e.target.remove())}),m.disconnect(),(0<w.length?c:t)()}).on("shown.bs.collapse",".svoc-section",function(){tandem.correctMarkLine(this.querySelector(".semantics-result"))}),h.craft=Object.assign({},h.craft,{initPlayer:function(e,t,n,s,o){f=e,l=s,a=n,b=o,0==f?(q.querySelector("#save-btn").disabled=!0,b={numOfTest:0,correct:0,incorrect:0},(x=h.indexedDB.open(y,v)).onsuccess=function(){var e=(C=this.result).transaction(["StepBattle"],"readonly");S=e.objectStore("StepBattle"),(x=S.openCursor()).onsuccess=function(){var e=this.result;if(e){switch(e.value.solve){case"O":b.correct++;break;case"X":b.incorrect++;break;default:w.push(e.value.data)}e.continue()}else i(t)}},x.onupgradeneeded=function(){C=this.result,(S=C.createObjectStore("StepBattle")).createIndex("bid","bid",{unique:!0}),S.createIndex("data","data"),S.createIndex("solve","solve",{unique:!1})}):i(t)}})}(jQuery,window,document);