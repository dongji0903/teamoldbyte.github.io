!function(y,p,C){y.cachedScript=y.cachedScript||function(e,t){return y.ajax(y.extend(t||{},{dataType:"script",cache:!0,url:e}))},y(function(){const t=C.querySelector(".craft-header-section"),s=C.querySelector(".scrolling-section");let n=scrollY;y(p).on("scroll",function(e){requestAnimationFrame(()=>{scrollY>n?45<=scrollY&&(s.style.marginTop="80px",t.classList.add("min")):scrollY<45&&(s.style.marginTop="0",t.classList.remove("min")),n=scrollY})})});let r,o,S,k=[],u,b,m,n,a,l;const h="findsvoc-idb",g=1;let f,x,v,q=[];function t(){var e=o?"/"+ntoa(o):"",e=`/craft/battle/${r}${e}/next`;y.getJSON(e,function(n){0==(k=n).length?alert("조회된 문제가 없습니다."):0==u?(f=p.indexedDB.open(h,g)).onsuccess=function(){var e=(x=this.result).transaction(["StepBattle"],"readwrite");v=e.objectStore("StepBattle");let s=0;!function e(){if(s<n.length){const t=n[s++];v.add({bid:t.bid,data:t,solve:""},t.bid).onsuccess=e}else c()}()}:c()}).fail(()=>alert("새로운 문제를 조회할 수 없습니다."))}function c(){S=k.shift(),q=[];const o=C.getElementById("battle-"+S.battleType);y(o).find(".battle-type-block, .ask-block").show(),y(o).find(".simple-ask-block").hide(),o.querySelector(".battle-type").textContent=S.battleType,y("#save-btn").toggleClass("reverse",Boolean(S.saved)),o.querySelector(".example-btn-section")&&(o.querySelector(".example-btn-section").style.display=""),y(o).show().siblings(".battle-section").hide(),anime({targets:o,easing:"linear",duration:1e3,left:["100vw",0]}),y(o).find(".js-solve-btn").prop("disabled",!0),y(o).find(".explain-section").hide().find(".collapse").collapse("hide");var e=o.querySelector(".ask"),t=o.querySelector(".simple-ask-block");const a=o.querySelector(".sentence"),l=S.eng;var s=JSON.parse(S.answer||"[]"),n=JSON.parse(S.example||"[]");let c=0,i,d=[];const p=[];switch(S.battleType){case"1":e.textContent=`다음 문장의 ${S.ask}를 선택하세요.`,t.textContent=e.textContent,n.forEach(([e,t],s,n)=>{(i=l.substring(c,e))&&p.push(i),p.push({el:"span",role:"button",className:"option",textContent:l.substring(e,t),onclick:function(){y(this).toggleClass("selected"),y(o).find(".js-solve-btn").prop("disabled",0==a.querySelectorAll(".selected").length)}}),s==n.length-1&&t<l.length&&p.push(l.substring(t)),c=t}),a.replaceChildren(createElement(p));break;case"2":S.ask.includes("모든")?e.textContent=`${S.ask.includes("피수식")?"피수식어":"수식어"}를 모두 선택하세요.`:e.textContent=`[${S.ask}] 수식어와 피수식어를 선택하세요.`,t.textContent=e.textContent;var[r,u]=s;const h={el:"span",role:"button",onclick:function(){var e;this.matches(".selected")?(e=q.indexOf(this),q.splice(e,1)[0].classList.remove("selected"),S.ask.includes("모든")||(e=e<2*Math.floor(e/2)+(1-e%2)?e:e-1,q[e]&&q.splice(e,1)[0].classList.remove("selected"))):(this.classList.add("selected"),q.push(this)),o.querySelector(".js-solve-btn").disabled=0==q.length}};Array.from(r,e=>e.concat("modifier")).concat(Array.from(u,e=>e.concat("modificand"))).sort(([e],[t])=>e-t).forEach(([e,t,s],n,a)=>{(i=l.substring(c,e))&&(i.includes(" ")?Array.from(i.split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},h)).forEach(e=>p.push(e," ")):p.push(i," ")),p.push(Object.assign({className:s+" d-inline-block",textContent:l.substring(e,t)},h)),t<l.length&&p.push(" "),n==a.length-1&&t<l.length&&(-1<l.indexOf(" ",t)?Array.from(l.substring(t).split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},h)).forEach(e=>p.push(e," ")):p.push(l.substring(t))),c=t}),a.replaceChildren(createElement(p));break;case"3":var[[r,u],b,m]=n;(i=l.substring(c,r))&&p.push(i),d=[b,m].sort(()=>Math.random()-.5),p.push({el:"span",className:"pick-right","data-answer":b,children:["[ ",{el:"span",class:"pick-option",textContent:d[0]}," / ",{el:"span",class:"pick-option",textContent:d[1]}," ]"]}),u<l.length&&p.push(l.substring(u)),a.replaceChildren(createElement(p)),o.querySelector(".example-btn-section").replaceChildren(createElement(Array.from(d,e=>({el:"button",className:"btn btn-outline-fico",textContent:e,onclick:function(){y(this).addClass("active").siblings().removeClass("active"),o.querySelector(".js-solve-btn").disabled=!1}}))));break;case"4":const[[g,f],x,v]=s;n.sort(([e],[t])=>e-t).forEach(([e,t],s,n)=>{(i=l.substring(c,e))&&p.push(i);let a=l.substring(e,t);var r={el:"span",className:"option text-decoration-underline",textContent:a};g==e&&f==t&&(r.className="answer-wrong text-decoration-underline",r.textContent=v,a=v,r["data-answer"]=x),p.push(r),d.push({el:"button",className:"btn btn-outline-fico",textContent:a,onclick:function(){y(this).addClass("active").siblings().removeClass("active"),o.querySelector(".js-solve-btn").disabled=!1}}),s==n.length-1&&t<l.length&&p.push(l.substring(t)),c=t}),a.replaceChildren(createElement(p)),o.querySelector(".example-btn-section").replaceChildren(createElement(d));break;case"5":a.replaceChildren(S.kor),n.sort(()=>Math.random()-.5).forEach(([e,t])=>{d.push({el:"span",className:"btn btn-outline-fico mb-1 me-1",textContent:l.substring(e,t),onclick:function(){if(!this.closest(".arranged-examples")&&!this.matches(".selected")){const e=this.cloneNode(!0);o.querySelector(".arranged-examples").appendChild(e),e.onclick=()=>{e.remove(),y(this).removeClass("selected pe-none"),o.querySelector(".js-solve-btn").disabled=0==o.querySelector(".arranged-examples").childElementCount},y(this).addClass("selected pe-none")}o.querySelector(".js-solve-btn").disabled=0==o.querySelector(".arranged-examples").childElementCount}})}),o.querySelector(".example-btn-section").replaceChildren(createElement(d)),o.querySelector(".arranged-examples").replaceChildren(),y(o).find(".arranged-examples").sortable(),o.querySelector(".arranged-examples").style.minHeight=.5*o.querySelector(".example-btn-section").clientHeight+"px"}}function i(e){b=e<13?"E":e<16?"M":e<19?"H":"C",(0==k.length?t:c)(),w()}function w(){var e=a;if(l=3500<m.correct?(n="대장",a=3501):2500<m.correct?(n="중장",a=2501,3501):2e3<m.correct?(n="소장",a=2001,2501):1600<m.correct?(n="준장",a=1601,2001):1300<m.correct?(n="대령",a=1301,1601):1100<m.correct?(n="중령",a=1101,1301):900<m.correct?(n="소령",a=901,1101):700<m.correct?(n="대위",a=701,901):600<m.correct?(n="중위",a=601,701):500<m.correct?(n="소위",a=501,601):400<m.correct?(n="상사",a=401,501):300<m.correct?(n="중사",a=301,401):200<m.correct?(n="하사",a=201,301):150<m.correct?(n="병장",a=151,201):100<m.correct?(n="상병",a=101,151):50<m.correct?(n="일병",a=51,101):20<m.correct?(n="이병",a=21,51):(n="훈련병",a=0,21),e<a){showFireworks({target:y(".battle-section:visible")[0],distance:100,size:10});const s=createElement({el:"img",src:`https://static.findsvoc.com/images/app/craft/${n}.png`,class:"position-absolute start-50 top-50 w-50",style:"transform: translate(-50%, -50%)"});C.body.appendChild(s),anime({targets:s,scale:[0,1],easing:"cubicBezier(0,2,1,2)",duration:1e3,complete:()=>setTimeout(()=>s.remove(),3e3)})}var e=C.querySelector(".progress-bar"),t=(100*(m.correct-a)/l).toFixed(1);e.ariaValueNow=t,e.textContent=t+"%",e.style.width=t+"%"}y(C).on("click","#save-btn",function(){y.getJSON("/craft/battle/mybattle/save",{memberId:u,battleId:S.bid,save:!S.saved},e=>{S.saved=e,y(this).toggleClass("reverse",e);const t=createElement({el:"div",class:"toast align-items-center position-absolute end-0 top-0 mt-4 me-5 w-auto text-center",role:"alert","aria-live":"assertive","aria-atomic":"true","data-bs-autohide":"true","data-bs-delay":2e3,textContent:S.saved?"저장되었습니다.":"저장이 취소되었습니다."});this.appendChild(t),bootstrap.Toast.getOrCreateInstance(t).show(),t.addEventListener("hidden.bs.toast",()=>t.remove())})}).on("click",".js-solve-btn",function(){const a=this.closest(".battle-section"),t=JSON.parse(S.answer||"[]");var e=JSON.parse(S.example||"[]");let r=!0;switch(y(this).toggleClass("js-solve-btn js-next-btn").text("다음").prop("disabled",!0),y(a).find(".ask-section,.example-btn-section,.arranged-examples").addClass("pe-none"),y(a).find(".battle-type-block, .ask-block, .simple-ask-block").fadeToggle(),S.battleType){case"1":const l=[];e.sort(([e],[t])=>e-t).forEach(([s,n],e)=>{null!=t.find(([e,t])=>s==e&&n==t)&&l.push(e)}),a.querySelectorAll(".option").forEach((e,t)=>{l.includes(t)?e.classList.add("right"):e.matches(".selected")&&(r=!1,e.classList.add("wrong"))});break;case"2":a.querySelectorAll(".option,.modifier,.modificand").forEach(e=>{S.ask.includes("모든")?e.matches(".modifier, .modificand")?e.classList.add("right"):q.includes(e)&&(r=!1,e.classList.add("wrong")):q.includes(e)?e.matches(q.indexOf(e)%2?".modifier":".modificand")?e.classList.add("right"):(e.classList.add("wrong"),r=!1):e.matches(".modifier, .modificand")&&(e.classList.add("right"),r=!1)});break;case"3":var s=a.querySelector(".example-btn-section .active"),n=s.textContent;const c=Array.from(a.querySelectorAll(".example-btn-section button")).indexOf(s);r=!!t.includes(n),a.querySelectorAll(".pick-right .pick-option").forEach((e,t)=>{t==c?e.classList.add(r?"right":"wrong"):r||e.classList.add("right")}),a.querySelector(".example-btn-section").style.display="none";break;case"4":const i=y(a).find(".example-btn-section .active").index(),d=[];e.sort(([e],[t])=>e-t).forEach(([s,n],e)=>{null!=t.find(([e,t])=>s==e&&n==t)&&d.push(e)}),a.querySelectorAll(".sentence .option,.sentence .answer-wrong").forEach((e,t)=>{d.includes(t)?e.classList.add("right"):t==i&&(r=!1,e.classList.add("wrong"))}),a.querySelector(".example-btn-section").style.display="none";break;case"5":r=a.querySelector(".arranged-examples").textContent.replace(/\W/g,"").trim()==S.eng.replace(/\W/g,"").trim(),a.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:S.eng})),a.querySelector(".example-btn-section").style.display="none"}var o=createElement({el:"div",class:`toast align-items-center position-absolute top-0 start-50 w-50 text-white text-center ${r?"bg-success":"bg-danger"} border-0 translate-middle-x mt-4`,role:"alert","aria-live":"assertive","aria-atomic":"true","data-bs-autohide":"false",textContent:r?"정답입니다!":"틀렸어요.."}),o=(a.append(o),bootstrap.Toast.getOrCreateInstance(o).show(),{memberId:u,ageGroup:b,battleId:S.bid,correct:r,save:Boolean(S.saved)});y(a).find(".explain-section").show().find(".comment-section").text(S.comment),y.getJSON("/craft/battle/"+S.sentenceId,e=>{return t=S.eng,s=a.querySelector(".explain-section"),e=e,y(s).find(".collapse").collapse("show"),tandem.showSemanticAnalysis(t,e.svocTag.svocBytes,y(s).find(".svoc-section").empty()),s.querySelector(".trans-section").replaceChildren(createElement(Array.from(e.korList,e=>({el:"span",className:"trans-text",textContent:e.kor})))),void s.querySelector(".words-section").replaceChildren(createElement(Array.from(e.wordList,(e,t)=>({el:"span",class:"one-word-unit-section"+(0<t?" ms-3":""),children:[{el:"span",class:"title fw-bold text-blue-700",textContent:e.title}].concat(Array.from(e.senseList,e=>({el:"span",class:"one-part-unit-section ms-2",children:[{el:"span",class:"part text-palegreen",textContent:e.partType},{el:"span",class:"meaning ms-1",textContent:e.meaning}]})))}))));var t,s}),y.ajax({url:"/craft/battle/evaluation/add",type:"GET",contentType:"application/json",data:o,success:()=>{r&&m.correct++,0==u&&((f=p.indexedDB.open(h,g)).onsuccess=function(){var e=(x=this.result).transaction(["StepBattle"],"readwrite");(v=e.objectStore("StepBattle")).index("bid").openCursor().onsuccess=function(){var e,t=this.result;t&&(t.key==S.bid?((e=t.value).solve=r?"O":"X",t.update(e)):t.continue())}});const e=createElement({el:"span",className:"toast-msg",textContent:"4초 뒤에 눌러주세요."}),t=a.querySelector(".js-next-btn");t.parentElement.prepend(e);let s=4;const n=setInterval(()=>{0<--s?e.textContent=s+"초 뒤에 눌러주세요.":(e.remove(),t.disabled=!1,clearInterval(n))},1e3);w()},error:()=>alert("채점 전송에 실패했습니다. 재로그인 후 다시 시도해 주세요.")})}).on("click",".js-next-btn",function(){this.disabled=!0;var e=y(this).toggleClass("js-solve-btn js-next-btn").text("확인").closest(".battle-section");e.find(".toast").remove(),e.find(".ask-section,.example-btn-section,.arranged-examples").removeClass("pe-none"),(0<k.length?c:t)()}).on("shown.bs.collapse",".svoc-section",function(){tandem.correctMarkLine(this.querySelector(".semantics-result"))}),p.craft=Object.assign({},p.craft,{initPlayer:function(e,t,s,n,a){u=e,o=n,r=s,m=a,0==u?(C.querySelector("#save-btn").disabled=!0,m={numOfTest:0,correct:0,incorrect:0},(f=p.indexedDB.open(h,g)).onsuccess=function(){var e=(x=this.result).transaction(["StepBattle"],"readonly");v=e.objectStore("StepBattle"),(f=v.openCursor()).onsuccess=function(){var e=this.result;if(e){switch(e.value.solve){case"O":m.correct++;break;case"X":m.incorrect++;break;default:k.push(e.value.data)}e.continue()}else i(t)}},f.onupgradeneeded=function(){x=this.result,(v=x.createObjectStore("StepBattle")).createIndex("bid","bid",{unique:!0}),v.createIndex("data","data"),v.createIndex("solve","solve",{unique:!1})}):i(t)}})}(jQuery,window,document);