!function(E,q,N){E.cachedScript=E.cachedScript||function(e,t){return E.ajax(E.extend(t||{},{dataType:"script",cache:!0,url:e}))};const s="https://static.findsvoc.com/sound/popdrop.mp3",l="https://static.findsvoc.com/sound/page-flip.mp3",m="https://static.findsvoc.com/sound/coin.mp3",f="https://static.findsvoc.com/sound/egg_crack.mp3",p={el:"div",id:"newRankModal",className:"modal",tabIndex:"-1","data-bs-backdrop":"static",style:{zIndex:1071,background:"radial-gradient(circle, white 25%, #fff4)"},children:[{el:"div",className:"modal-dialog modal-dialog-centered overflow-hidden m-0",style:"max-width: 100%",children:[{el:"div",className:"modal-content bg-transparent border-0",children:[{el:"div",className:"modal-header border-0 d-block text-center"},{el:"div",className:"modal-body w-100 text-center",style:"min-height: 77vmin",children:[{el:"span",className:"circle-dark",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"70vmin",height:"70vmin",backgroundColor:"var(--fc-purple)",borderRadius:"37vmin",zIndex:1},children:[{el:"object",data:"https://static.findsvoc.com/images/app/egg/new-title.svg",style:{position:"absolute",top:"3vmin",left:"37.5%",width:"25%",height:"20%",zIndex:2,overflow:"visible"}}]},{el:"span",className:"circle-dark-dashed",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",borderRadius:"37vmin",backgroundColor:"transparent",border:"2vmin dashed var(--fc-purple)",width:"76vmin",height:"76vmin"}}]},{el:"div",className:"modal-footer d-block border-0 text-center",children:[{el:"button",className:"btn btn-outline-fico rounded-5 col-md-2 col-4 fs-5 fw-bold","data-bs-dismiss":"modal",textContent:"닫기"}]}]}]}]},b=new FicoTTS;E(function(){const e=N.querySelector(".craft-header-section"),t=N.querySelector(".scrolling-section");let n=scrollY,a=(E(q).on("scroll",function(){requestAnimationFrame(()=>{scrollY>n?115<=scrollY&&(t.style.marginTop="150px",e.classList.add("min")):scrollY<115&&(t.style.marginTop="0",e.classList.remove("min")),n=scrollY})}),new NoSleep);N.addEventListener("click",function e(){N.removeEventListener("click",e,!1),a.enable()},!1),WebAudioJS.load(s),WebAudioJS.load(l),WebAudioJS.load(m),WebAudioJS.load(f)});let g=new IntersectionObserver(e=>{D(!e[0].isIntersecting)},{threshold:1});let n=[],i,y,v;let L,I=[],A,x,k,C,S,a,o,r;const w="findsvoc-idb";let O=1,j,T,M;const B=q.indexedDB;let J=[];function t(){var e="step"!=i&&null!=y?"/"+ntoa(y):"",e=`/craft/battle/${i}${e}/next`;E.getJSON(e,function(a){0==(I=a).length?alert("조회된 문제가 없습니다."):0==x?(j=B.open(w,O)).onsuccess=function(){var e=(T=this.result).transaction(["StepBattle"],"readwrite");e.onabort=$,M=e.objectStore("StepBattle");let n=0;!function e(){if(n<a.length){const t=a[n++];M.add({bid:t.bid,data:t,solve:""},t.bid).onsuccess=e}else c()}()}:c()}).fail(()=>alert("새로운 문제를 조회할 수 없습니다."))}function c(){L=I.shift(),J=[];var n=(A=N.getElementById("battle-"+L.battleType)).querySelector(".ask-block .ask"),a=A.querySelector(".simple-ask-block .ask");const s=A.querySelector(".sentence"),o=L.eng;var i=JSON.parse(L.answer||"[]");const r=JSON.parse(L.example||"[]");let c=0,d,p=[];const u=[];switch(scrollTo(0,0),N.querySelector(".craft-header-section").classList.remove("min"),N.querySelector(".scrolling-section").style.marginTop="0",E(A).find(".battle-type-block, .ask-block").show(),E(A).find(".simple-ask-block").hide(),A.querySelector(".battle-type").textContent=L.battleType,E("#save-btn").toggleClass("reverse",Boolean(L.saved)),A.querySelector(".example-btn-section")&&(A.querySelector(".example-btn-section").style.display=""),E(A).show().siblings(".battle-section").hide(),anime({targets:A,duration:1e3,delay:300,left:["100vw",0]}),D(!0),E(A).find(".explain-section").hide().find(".collapse").collapse("hide"),L.battleType){case"1":n.textContent=`다음 문장의 ${L.ask}를 선택하세요.`,a.textContent=n.textContent,r.forEach(([e,t],n,a)=>{(d=o.substring(c,e))&&u.push(d),u.push({el:"span",role:"button",className:"option haptic-btn shadow-none",textContent:o.substring(e,t),onclick:function(){E(this).toggleClass("selected"),D(0==s.querySelectorAll(".selected").length)}}),n==a.length-1&&t<o.length&&u.push(o.substring(t)),c=t}),s.replaceChildren(createElement(u));break;case"2":const g=createElement({el:"span",class:"mod-guide-text",style:{color:"transparent"}});L.ask.includes("모든")?(n.textContent=`${L.ask.includes("피수식")?"피수식어":"수식어"}를 모두 선택하세요.`,g.textContent=`${L.ask.includes("피수식")?"피수식어":"수식어"} 선택`):L.ask.match(/의 수식|의 피수식/)?(n.textContent=L.ask+"어를 선택하세요.",g.textContent=`${L.ask.includes("피수식")?"피수식어":"수식어"} 선택`):(n.textContent=`[${L.ask}] 수식어와 피수식어를 선택하세요.`,g.textContent="수식어 선택");let t;anime({targets:g,begin:()=>A.querySelector(".ask-section").appendChild(g),width:[0,"70vw"],delay:1e3,duration:500,complete:()=>{g.style.color="#ffb266",t=anime({targets:g,color:["#ffffff","#ffb266","#ffffff","#ffb266","#ffffff","#ffb266"],easing:"linear",loop:!0})}}),a.textContent=n.textContent;var[h,m]=i;const y={el:"span",role:"button",onclick:function(){var e;this.matches(".selected")?(e=J.indexOf(this),J.splice(e,1)[0].classList.remove("selected"),null==L.ask.match(/모든|의 수식|의 피수식/)?(e=e<2*Math.floor(e/2)+(1-e%2)?e:e-1,J[e]&&J.splice(e,1)[0].classList.remove("selected"),g.textContent="수식어 선택",t?.play()):0==J.length&&t?.play()):(this.classList.add("selected"),J.push(this),null==L.ask.match(/모든|의 수식|의 피수식/)?(g.textContent=["수식어","피수식어"][J.length%2]+" 선택",t?.play()):(t?.pause(),g.style.color="#ffb266")),D(0==J.length)}};Array.from(h,e=>e.concat("modifier")).concat(Array.from(m,e=>e.concat("modificand"))).sort(([e],[t])=>e-t).forEach(([e,t,n],a,s)=>{(d=o.substring(c,e))&&(d.includes(" ")?Array.from(d.split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block haptic-btn shadow-none",textContent:e},y)).forEach(e=>u.push(e," ")):u.push(d," ")),u.push(Object.assign({className:n+" d-inline-block haptic-btn shadow-none",textContent:o.substring(e,t)},y)),t<o.length&&u.push(" "),a==s.length-1&&t<o.length&&(-1<o.indexOf(" ",t)?Array.from(o.substring(t).split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block haptic-btn shadow-none",textContent:e},y)).forEach(e=>u.push(e," ")):u.push(o.substring(t))),c=t}),s.replaceChildren(createElement(u));break;case"3":var[[h,m],f,b]=r;(d=o.substring(c,h))&&u.push(d),p=[f,b].sort(()=>Math.random()-.5),u.push({el:"span",className:"pick-right","data-answer":f,children:["[ ",{el:"span",class:"pick-option",textContent:p[0]}," / ",{el:"span",class:"pick-option",textContent:p[1]}," ]"]}),m<o.length&&u.push(o.substring(m)),s.replaceChildren(createElement(u)),A.querySelector(".example-btn-section").replaceChildren(createElement(Array.from(p,e=>({el:"button",className:"btn btn-outline-fico haptic-btn shadow-none",textContent:e,onclick:function(){E(this).addClass("active").siblings().removeClass("active"),D(!1)}}))));break;case"4":const[[v,x],k,C]=i;r.sort(([e],[t])=>e-t).forEach(([e,t],n,a)=>{(d=o.substring(c,e))&&u.push(d);let s=o.substring(e,t);var l={el:"span",className:"option text-decoration-underline",textContent:s};v==e&&x==t&&(l.className="answer-wrong text-decoration-underline",l.textContent=C,s=C,l["data-answer"]=k),u.push(l),p.push({el:"button",className:"btn btn-outline-fico haptic-btn shadow-none",textContent:s,onclick:function(){E(this).addClass("active").siblings().removeClass("active"),D(!1)}}),n==a.length-1&&t<o.length&&u.push(o.substring(t)),c=t}),s.replaceChildren(createElement(u)),A.querySelector(".example-btn-section").replaceChildren(createElement(p));break;case"5":s.replaceChildren(L.kor);const S=A.querySelector(".arranged-examples");r.sort(()=>Math.random()-.5).forEach(([e,t])=>{t+=t<o.length-1&&/[,.]/.test(o.charAt(t))?1:0;p.push({el:"span",className:"btn btn-outline-fico haptic-btn shadow-none",textContent:o.substring(e,t),onclick:function(){if(!this.closest(".arranged-examples")&&!this.matches(".selected")){const t=this.cloneNode(!0);let e=E(this).data("clickedOnce");e||(e=this.cloneNode(!0),E(this).data("clickedOnce",e)),t.style.visibility="hidden",e.style.display="block",e.style.position="fixed",S.appendChild(t),this.parentElement.appendChild(e),anime({targets:e,top:[E(this).offset().top,E(t).offset().top],left:[E(this).offset().left,E(t).offset().left],translateZ:0,easing:"linear",complete:()=>{e.style.display="none",t.style.visibility="visible"},duration:100}),t.onclick=()=>{t.style.visibility="hidden",e.style.display="block",anime({targets:e,top:[E(t).offset().top,E(this).offset().top],left:[E(t).offset().left,E(this).offset().left],translateZ:0,easing:"linear",complete:()=>{e.style.display="none",t.remove(),E(this).removeClass("selected pe-none"),D(S.childElementCount!=r.length)},duration:100})},E(this).addClass("selected pe-none")}D(S.childElementCount!=r.length)}})}),A.querySelector(".example-btn-section").replaceChildren(createElement(p)),S.replaceChildren(),E(S).sortable({items:"> .haptic-btn"});break;case"6":r.sort(([[e]],[[t]])=>e-t).forEach(([[e,t],n],a,s)=>{(d=o.substring(c,e))&&u.push(d),n.split(/\s+/).forEach((e,t)=>{0<t&&u.push(" "),0<e.length&&u.push({el:"input",type:"text",style:{width:e.length+"em"},pattern:"[0-9A-z!?.,]",placeholder:1<e.length?e.substring(0,1):"",autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:"false",onfocus:function(){this.placeholder="";var e=this.getBoundingClientRect().top,t=N.querySelector(".js-next-btn, .js-solve-btn").getBoundingClientRect().top,t=Math.abs(t-e);t<76.5&&scrollTo(scrollX,scrollY+76.5-t)},onblur:function(){this.placeholder=1<e.length?e.substring(0,1):""}})}),a==s.length-1&&t<o.length&&u.push(o.substring(t)),c=t}),A.querySelector(".arranged-examples").replaceChildren(),A.querySelector(".ask-section .sentence.kor").textContent=L.kor,A.querySelector(".example-btn-section").replaceChildren(createElement(u)),E(A).on("input",".example-btn-section input",function(){D(!Array.from(A.querySelectorAll(".example-btn-section input")).every(e=>0<e.value.length))});break;case"7":let e=L.kor.split(/\s+/);const w=A.querySelector(".arranged-examples");let l="";(e=e.reduce((e,t,n,a)=>{var s;return 1<t.length?(s=e.concat([0<l.length?l+" "+t:t]),l="",s):(l+=0<l.length?" "+t:t,n==a.length-1?e.concat([l]):void 0)},[]).concat(r).sort(()=>Math.random()-.5)).forEach(e=>{u.push({el:"span",className:"btn btn-outline-fico haptic-btn shadow-none",textContent:e.replace(/[,.!?]$/,""),onclick:function(){if(!this.closest(".arranged-examples")&&!this.matches(".selected")){const t=this.cloneNode(!0);let e=E(this).data("clickedOnce");e||(e=this.cloneNode(!0),E(this).data("clickedOnce",e)),t.style.visibility="hidden",e.style.display="block",e.style.position="fixed",w.appendChild(t),this.parentElement.appendChild(e),anime({targets:e,top:[E(this).offset().top,E(t).offset().top],left:[E(this).offset().left,E(t).offset().left],translateZ:0,easing:"linear",complete:()=>{e.style.display="none",t.style.visibility="visible"},duration:100}),t.onclick=()=>{t.style.visibility="hidden",e.style.display="block",anime({targets:e,top:[E(t).offset().top,E(this).offset().top],left:[E(t).offset().left,E(this).offset().left],translateZ:0,easing:"linear",complete:()=>{e.style.display="none",t.remove(),E(this).removeClass("selected pe-none"),D(0==w.childElementCount)},duration:100})},E(this).addClass("selected pe-none")}D(0==w.childElementCount)}})}),w.replaceChildren(),E(w).sortable({items:"> .haptic-btn"}),A.querySelector(".ask-section .sentence.eng").textContent=o,A.querySelector(".example-btn-section").replaceChildren(createElement(u))}var e=N.querySelector(".craft-layout-content-section");e.style.backgroundPositionY=A.querySelector(".ask-section").getBoundingClientRect().top-(992<=q.innerWidth?e.clientHeight/e.clientWidth>334/355?142*e.clientWidth/355:151*e.clientHeight/355:285*q.innerWidth/355)+"px"}function d(e){k=e<13?"E":e<16?"M":e<19?"H":"C",(0==I.length?t:c)(),R()}function W(){N.getElementById("loginExpiredModal")||N.querySelector(".craft-layout-content-section").appendChild(createElement({el:"div",id:"loginExpiredModal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:-1,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section my-3 text-center text-dark",innerHTML:"로그인 시간이 만료되었습니다."},{el:"div",class:"button-section row g-1",children:[{el:"button",class:"btn btn-fico",onclick:()=>location.assign("/auth/login"),textContent:"로그인"}]}]}]}]}]})),bootstrap.Modal.getOrCreateInstance(N.getElementById("loginExpiredModal")).show()}function u(){N.getElementById("battleExceedModal")||N.querySelector(".craft-layout-content-section").appendChild(createElement({el:"div",id:"battleExceedModal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:-1,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section my-3 text-center text-dark",innerHTML:"일일 최대 플레이 횟수에 도달하였습니다.<br>내일 다시 찾아와 주세요."},{el:"div",class:"button-section row g-1",children:[{el:"button",class:"btn btn-fico",onclick:()=>location.assign("/craft/main"),textContent:"'배틀 플레이 선택'으로 이동"}]}]}]}]}]})),bootstrap.Modal.getOrCreateInstance(N.getElementById("battleExceedModal")).show()}function R(){var e=o;if(0==n.length)E.getJSON("https://static.findsvoc.com/data/craft/rank-list.json",e=>{n=e.reverse(),R()}).fail(()=>alert("계급도를 가져오는데 실패했습니다."));else{for(let e=0,t=n.length;e<t;e++)if(S.correct>n[e].startValue){a=n[e].rankTitle,o=n[e].startValue+1,r=0<e?n[e-1].startValue+1:9999;break}e<o&&(N.getElementById("newRankModal")||N.body.prepend(createElement(p)),E("#newRankModal .modal-body .new-obj").remove(),e=createElement({el:"div",className:"new-obj",style:{position:"absolute",left:"50%",top:"calc(50% + 4vmin)",width:"37.5vmin",height:"50vmin",maxWidth:"50vmin",zIndex:1071,maxHeight:"50vmin",transformOrigin:"center",opacity:0,transform:"translate(-50%,-50%)",background:`center/ cover url(https://static.findsvoc.com/images/app/craft/${a}.svg) no-repeat`}}),E("#newRankModal .modal-body").append(e),E("#newRankModal").modal("show"),anime({targets:"#newRankModal .circle-dark object",scale:[0,1],translateZ:0,duration:1200}),anime({targets:"#newRankModal .circle-dark-dashed",translateZ:0,rotateZ:360,duration:8e3,loop:!0,easing:"linear"}),showFireworks({target:E("#newRankModal .modal-body")[0],particles:20,distance:100,interval:200,size:15}),anime({targets:e,duration:1e3,scale:[0,1],translateZ:0,opacity:[0,1]}));var e=N.querySelector(".progress-bar"),t=(100*(S.correct-o)/(r-o)).toFixed(1);e.ariaValueNow=t,e.textContent=t+"%",e.style.width=t+"%"}}function D(e){anime({targets:".js-solve-btn,.js-next-btn",duration:500,easing:"easeOutQuart",left:e?"110%":"45%"})}function $(e){"QuotaExceededError"==e.target.error.name&&(alert("웹 저장공간을 정리 후 다시 이용해 주세요."),location.replace("/craft/main"))}E(N).on("click","#save-btn",function(){WebAudioJS.play(s),E.getJSON("/craft/battle/mybattle/save",{memberId:x,battleBookId:y,battleId:L.bid,save:!L.saved},e=>{L.saved=e,E(this).toggleClass("reverse",e);const t=createElement({el:"div",class:"toast battle-save-result-msg fade show",role:"alert","aria-live":"assertive","aria-atomic":"true","data-bs-autohide":"true","data-bs-delay":2e3,textContent:L.saved?"저장되었습니다.":"저장이 취소되었습니다."});this.parentElement.appendChild(t),bootstrap.Toast.getOrCreateInstance(t).show(),t.addEventListener("hidden.bs.toast",()=>t.remove())}).always((e,t)=>{"parsererror"==t&&W()})}).on("click",".js-solve-btn",function(){const s=A,o=JSON.parse(L.answer||"[]");var e=JSON.parse(L.example||"[]");let a=!0;switch(E(this).toggleClass("js-solve-btn js-next-btn").text("다음"),E(s).find(".haptic-btn").addClass("pe-none"),E(s).find(".battle-type-block, .ask-block, .simple-ask-block").fadeToggle(),L.battleType){case"1":const c=[];e.sort(([e],[t])=>e-t).forEach(([n,a],e)=>{null!=o.find(([e,t])=>n==e&&a==t)&&c.push(e)}),s.querySelectorAll(".option").forEach((e,t)=>{c.includes(t)?e.classList.add("right"):e.matches(".selected")&&(a=!1,e.classList.add("wrong"))}),r(s.querySelector(".ask-section .sentence"));break;case"2":s.querySelectorAll(".option,.modifier,.modificand").forEach(e=>{e.matches(".selected")||e.classList.add("unselected"),L.ask.includes("모든")?J.includes(e)&&e.matches(".modifier, .modificand")?e.classList.add("right"):J.includes(e)^e.matches(".modifier, .modificand")&&(a=!1,J.includes(e)&&e.classList.add("wrong")):J.includes(e)&&e.matches(J.indexOf(e)%2?".modificand":".modifier")?e.classList.add("right"):J.includes(e)?(e.classList.add("wrong"),a=!1):e.matches(".modificand.unselected,.modifier.unselected")&&(a=!1)}),s.querySelector(".mod-guide-text").remove(),r(s.querySelector(".ask-section .sentence"));break;case"3":var n=s.querySelector(".example-btn-section .active"),i=n.textContent;const d=Array.from(s.querySelectorAll(".example-btn-section button")).indexOf(n);a=!!o.includes(i),s.querySelectorAll(".pick-right .pick-option").forEach((e,t)=>{t==d?e.classList.add(a?"right":"wrong"):a||e.classList.add("right")}),s.querySelector(".example-btn-section").style.display="none",r(s.querySelector(".ask-section .sentence"));break;case"4":const p=E(s).find(".example-btn-section .active").index(),u=[];e.sort(([e],[t])=>e-t).forEach(([n,a],e)=>{null!=o.find(([e,t])=>n==e&&a==t)&&u.push(e)}),r(s.querySelector(".ask-section .sentence")),s.querySelector(".example-btn-section").style.display="none",s.querySelectorAll(".sentence .option,.sentence .answer-wrong").forEach((e,t)=>{var n;u.includes(t)?(e.classList.add("right"),n=createElement({el:"span",textContent:e.dataset.answer,className:"original-text",style:{opacity:0,position:"absolute",left:e.offsetLeft+"px",top:e.offsetTop+"px"}}),e.parentElement.appendChild(n),anime({targets:n,top:"-=20",opacity:1,delay:600})):t==p&&(a=!1,e.classList.add("wrong"))});break;case"5":a=s.querySelector(".arranged-examples").textContent.replace(/\W/g,"").trim()==L.eng.replace(/\W/g,"").trim(),s.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:L.eng})),s.querySelector(".example-btn-section").style.display="none",r(s.querySelector(".arranged-examples .full-sentence"));break;case"6":const h=Array.from(e,([[],e])=>e.split(/\s+/)).reduce((e,t)=>e.concat(t),[]);s.querySelectorAll(".example-btn-section input").forEach((e,t)=>{e.value.trim().toLowerCase()==h[t].toLowerCase()?e.className="right":(e.className="wrong",a=!1)}),s.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:L.eng})),r(s.querySelector(".arranged-examples .full-sentence"));break;case"7":let t=Array.from(L.kor.split(/\s+/),e=>e.replace(/[,.!?]$/,"")),l="";t=t.reduce((e,t,n,a)=>{var s;return 1<t.length?(s=e.concat([0<l.length?l+" "+t:t]),l="",s):(l+=0<l.length?" "+t:t,n==a.length-1?e.concat([l]):void 0)},[]),s.querySelectorAll(".arranged-examples .btn").length!=t.length?(s.querySelectorAll(".arranged-examples .btn").forEach(e=>{t.includes(e.textContent)?e.classList.add("right"):e.classList.add("wrong")}),a=!1):s.querySelectorAll(".arranged-examples .btn").forEach(e=>{t.includes(e.textContent)?e.classList.add("right"):(e.classList.add("wrong"),a=!1)}),s.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:L.kor})),s.querySelector(".example-btn-section").style.display="none",r(s.querySelector(".ask-section .sentence"))}function r(e){e.appendChild(createElement({el:"div",className:"tts-block text-end",style:{transform:"scale(0)"},children:[{el:"button",id:"ttsPlay",class:"btn d-inline w-auto text-info ms-2 p-0 material-icons-outlined fs-2 border-0 shadow-none bg-transparent","data-bs-toggle":"tooltip",title:"문장 듣기/중지","data-active":"on",textContent:"play_circle",onclick:function(){var e="on"==this.dataset.active;this.dataset.active=e?"off":"on",this.textContent=e?"stop_circle":"play_circle",e?b.speakRepeat(L.eng,2,1e3,()=>{this.dataset.active="on",this.textContent="play_circle"}):b.stop()}},{el:"button",id:"ttsSetting",class:"btn d-inline w-auto text-info ms-2 p-0 material-icons-outlined fs-2 border-0 shadow-none bg-transparent","data-bs-toggle":"tooltip",title:"음성 설정",textContent:"tune",onclick:function(){b.stop();var e=this.previousElementSibling;e.dataset.active="on",e.textContent="play_circle",b.openSettings()}}]})),anime({targets:s.querySelector(".tts-block"),scale:1,delay:600,complete:()=>{b.autoEnabled()&&s.querySelector("#ttsPlay")?.dispatchEvent(new Event("click"))}})}v.count++,q.localStorage.setItem("TCBSC_"+ntoa(x),JSON.stringify(v)),WebAudioJS.play(a?m:f);var t=createElement({el:"div",class:"js-result-msg result-toast",style:{transformOrigin:"top"}});N.querySelector(".craft-header-section").append(t),N.querySelector(".craft-layout-content-section").classList.add("bg-fc-transparent"),anime.timeline({targets:t}).add({begin:function(e){e=e.animatables[0].target;e.textContent=a?"정답입니다.":"오답입니다.",e.style.visibility="visible",e.style.color="#00000000",e.style.backgroundColor=a?"#00bcd4":"#f44336"},bottom:"-2em",width:["2rem","50%"],height:["0rem","2rem"],duration:1e3,easing:"easeInOutExpo"}).add({color:"#FFF",easing:"linear"}),a||(q.ANI&&q.ANI?.vibrate?q.ANI.vibrate([200,50,100,50,100]):navigator?.vibrate&&navigator.vibrate([200,50,100,50,100]));const l={memberId:x,ageGroup:k,battleBookId:y,battleId:L.bid,correct:a,save:Boolean(L.saved)};0==x&&null!=C&&(l.memberId56=C),E(s).find(".explain-section").slideDown(500).find(".comment-section").text(L.comment||"작성된 코멘트가 없습니다."),E.getJSON("/craft/battle/"+L.sentenceId,e=>{return t=L.eng,n=s.querySelector(".explain-section"),a=e,n.querySelector(".trans-section").replaceChildren(createElement(Array.from(a.korList,(e,t)=>({el:"div",className:"row",children:[{el:"div",className:"col-auto ps-2 pe-0",children:[{el:"span",className:"material-icons "+(t>=a.korList.length-3?"ai-trans":"user-trans")}]},{el:"div",className:"trans-text col",textContent:e.kor}]})))),n.querySelector(".words-section").replaceChildren(0<a.wordList.length?createElement(Array.from(a.wordList,e=>({el:"span",class:"one-word-unit-section",children:[{el:"span",class:"title",textContent:e.title}].concat(Array.from(e.senseList,e=>({el:"span",class:"one-part-unit-section",children:[{el:"span",class:"part",textContent:e.partType},{el:"span",class:"meaning",textContent:e.meaning}]})))}))):"해당 문장에서 fico AI가 설정한 난이도 이상의 단어를 찾지 못했습니다."),E(n).find(".collapse").collapse("show"),tandem.showSemanticAnalysis(t,a.svocTag.svocBytes,E(n).find(".svoc-section").empty()).then(()=>g.observe(n.lastElementChild)),N.querySelector(".craft-header-section").classList.remove("min"),N.querySelector(".scrolling-section").style.marginTop="0",void scrollTo(0,75);var t,n,a}).always((e,t)=>{"parsererror"==t?W():E.ajax({url:"/craft/battle/evaluation/add",type:"GET",contentType:"application/json",data:l,success:()=>{a&&S.correct++,0==x&&((j=B.open(w,O)).onsuccess=function(){var e=(T=this.result).transaction(["StepBattle"],"readwrite");e.onabort=$,(M=e.objectStore("StepBattle")).index("bid").openCursor().onsuccess=function(){var e,t=this.result;t&&t.key==L.bid&&((e=t.value).solve=a?"O":"X",t.update(e))}}),D(!0),R()},error:()=>alert("채점 전송에 실패했습니다. 재로그인 후 다시 시도해 주세요."),complete:(e,t)=>{"parsererror"==t&&W()}})})}).on("click",".js-next-btn",function(e){50<=v.count?(u(),e.preventDefault(),e.stopPropagation()):(b.stop(),A.querySelector(".tts-block").remove(),WebAudioJS.play(l),E(this).toggleClass("js-solve-btn js-next-btn").text("확인"),N.querySelector(".craft-layout-content-section").classList.remove("bg-fc-transparent"),anime({targets:".js-result-msg",bottom:0,height:0,duration:500,easing:"easeInOutExpo",complete:e=>e.animatables.forEach(e=>e.target.remove())}),g.disconnect(),(0<I.length?c:t)())}).on("shown.bs.collapse",".svoc-section",function(){tandem.correctMarkLine(this.querySelector(".semantics-result"))}).on("click",".haptic-btn",function(){this.textContent.match(/[^\w\s,.!?'"]/)?WebAudioJS.play(s):b.speak(this.textContent)}),q.craft=Object.assign({},q.craft,{initPlayer:function(e,t,n,a,s){if(x=e,y=a,i=n,S=s,q.localStorage.getItem("TCBSC_"+ntoa(x))){if((v=JSON.parse(q.localStorage.getItem("TCBSC_"+ntoa(x)))).date!=(new Date).toLocaleDateString())v.date=(new Date).toLocaleDateString(),v.count=0;else if(50<=v.count)return void u()}else v={date:(new Date).toLocaleDateString(),count:0};function l(){T=this.result,(M=T.createObjectStore("StepBattle")).createIndex("bid","bid",{unique:!0}),M.createIndex("data","data"),M.createIndex("solve","solve",{unique:!1}),d(t)}function o(){var e=this.result;if(e){switch(e.value.solve){case"O":S.correct++;break;case"X":S.incorrect++;break;default:I.push(e.value.data)}e.continue()}else d(t)}0==x?("undefined"==typeof Cookies?E.getScript("https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js",function(){var e=Cookies.get("FMID");e?C=e:location.replace("/craft/main")}):(e=Cookies.get("FMID"))?C=e:location.replace("/craft/main"),N.querySelector("#save-btn").disabled=!0,S={numOfTest:0,correct:0,incorrect:0},(j=B.open(w,O)).onsuccess=function e(){var t;(T=this.result).objectStoreNames.contains("StepBattle")?((t=T.transaction(["StepBattle"],"readonly")).onabort=$,M=t.objectStore("StepBattle"),(j=M.openCursor()).onsuccess=o):((j=B.open(w,++O)).onsuccess=e,j.onupgradeneeded=l)},j.onupgradeneeded=l):d(t)}})}(jQuery,window,document);