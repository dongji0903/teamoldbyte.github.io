!function(S,C,E){S.cachedScript=S.cachedScript||function(e,t){return S.ajax(S.extend(t||{},{dataType:"script",cache:!0,url:e}))};const l="https://static.findsvoc.com/sound/popdrop.mp3",u="https://static.findsvoc.com/sound/page-flip.mp3",$="https://static.findsvoc.com/sound/coin.mp3",D="https://static.findsvoc.com/sound/egg_crack.mp3",F={el:"div",id:"newRankModal",className:"modal",tabIndex:"-1","data-bs-backdrop":"static",style:{zIndex:1071,background:"radial-gradient(circle, white 25%, #fff4)"},children:[{el:"div",className:"modal-dialog modal-dialog-centered overflow-hidden m-0",style:"max-width: 100%",children:[{el:"div",className:"modal-content bg-transparent border-0",children:[{el:"div",className:"modal-header border-0 d-block text-center"},{el:"div",className:"modal-body w-100 text-center",style:"min-height: 77vmin",children:[{el:"span",className:"circle-dark",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"70vmin",height:"70vmin",backgroundColor:"var(--fc-purple)",borderRadius:"37vmin",zIndex:1},children:[{el:"object",data:"https://static.findsvoc.com/images/app/egg/new-title.svg",style:{position:"absolute",top:"3vmin",left:"37.5%",width:"25%",height:"20%",zIndex:2,overflow:"visible"}}]},{el:"span",className:"circle-dark-dashed",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%) translateZ(0)",borderRadius:"37vmin",backgroundColor:"transparent",border:"2vmin dashed var(--fc-purple)",width:"76vmin",height:"76vmin"}}]},{el:"div",className:"modal-footer d-block border-0 text-center",children:[{el:"button",className:"btn btn-outline-fico rounded-5 col-md-2 col-4 fs-5 fw-bold","data-bs-dismiss":"modal",textContent:"닫기"}]}]}]}]},h=new FicoTTS;S(function(){const e=E.querySelector(".craft-header-section"),t=E.querySelector(".scrolling-section");let a=scrollY,n=(S(C).on("scroll",function(){requestAnimationFrame(()=>{scrollY>a?115<=scrollY&&(t.style.marginTop="150px",e.classList.add("min")):scrollY<115&&(t.style.marginTop="0",e.classList.remove("min")),a=scrollY})}),new NoSleep);E.addEventListener("click",function e(){E.removeEventListener("click",e,!1),n.enable()},!1),WebAudioJS.load(l),WebAudioJS.load(u),WebAudioJS.load($),WebAudioJS.load(D)});let _=new IntersectionObserver(e=>{W(!e[0].isIntersecting)},{threshold:1});let o=[],b,i={},g={},f,t=!1,y,v,d=50;const z=25;let q,N=[],I,x,H,k,w,s,r,V,L,p;const A="findsvoc-idb";let M=1,j,O,B;const T=C.indexedDB;let R=[];function a(){var e="step"==b?"/craft/battle/step/next":"/craft/battlebook/next";S.getJSON(e,"step"==b?Object.assign({},i,g,{lastBattleId:f,rankLevel:s.battleLevel}):Object.assign({},g,{lastBattleId:f}),function(n){N=n,t=n.length<z,0==n.length?(null==q&&-1!=f?(f=-1,L=0,G(),a):P)():0==x?(j=T.open(A,M)).onsuccess=function(){var e=(O=this.result).transaction(["StepBattle"],"readwrite");e.onabort=Q,(B=e.objectStore("StepBattle")).openCursor().onsuccess=function e(){if(a<n.length){const t=n[a++];B.add({bid:t.bid,data:t,solve:""},t.bid).onsuccess=e}else c()};let a=0}:c()}).fail(()=>{(null==q&&-1!=f?(f=-1,a):P)()})}function c(){q=N.shift(),R=[];var a=(I=E.getElementById("battle-"+q.battleType)).querySelector(".ask-block .ask"),n=I.querySelector(".simple-ask-block .ask");const l=I.querySelector(".sentence"),s=q.eng;var r=JSON.parse(q.answer||"[]"),c=JSON.parse(q.example||"[]");let i=0,d,p=[];const m=[];switch(scrollTo(0,0),E.querySelector(".craft-header-section").classList.remove("min"),E.querySelector(".scrolling-section").style.marginTop="0",S(I).find(".battle-type-block, .ask-block").show(),S(I).find(".simple-ask-block").hide(),I.querySelector(".battle-type").textContent=q.battleType,S("#save-btn").toggleClass("reverse",Boolean(q.saved)),I.querySelector(".example-btn-section")&&(I.querySelector(".example-btn-section").style.display=""),S(I).show().siblings(".battle-section").hide(),anime({targets:I,duration:1e3,delay:300,left:["100vw",0]}),W(!0),S(I).find(".explain-section").hide().find(".collapse").collapse("hide"),q.battleType){case"1":a.textContent=`다음 문장의 ${q.ask}를 선택하세요.`,n.textContent=a.textContent,c.forEach(([e,t],a,n)=>{(d=s.substring(i,e))&&m.push(d),m.push({el:"span",role:"button",className:"option haptic-btn shadow-none",textContent:s.substring(e,t),onclick:function(){S(this).toggleClass("selected"),W(0==l.querySelectorAll(".selected").length)}}),a==n.length-1&&t<s.length&&m.push(s.substring(t)),i=t}),l.replaceChildren(createElement(m));break;case"2":const f=createElement({el:"span",class:"mod-guide-text",style:{color:"transparent"}});q.ask.includes("모든")?(a.textContent=`${q.ask.includes("피수식")?"피수식어":"수식어"}를 모두 선택하세요.`,f.textContent=`${q.ask.includes("피수식")?"피수식어":"수식어"} 선택`):q.ask.match(/의 수식|의 피수식/)?(a.textContent=q.ask+"어를 선택하세요.",f.textContent=`${q.ask.includes("피수식")?"피수식어":"수식어"} 선택`):(a.textContent=`[${q.ask}] 수식어와 피수식어를 선택하세요.`,f.textContent="수식어 선택");let t;anime({targets:f,begin:()=>I.querySelector(".ask-section").appendChild(f),width:[0,"70vw"],delay:1e3,duration:500,complete:()=>{f.style.color="#ffb266",t=anime({targets:f,color:["#ffffff","#ffb266","#ffffff","#ffb266","#ffffff","#ffb266"],easing:"linear",loop:!0})}}),n.textContent=a.textContent;var[u,h]=r;const y={el:"span",role:"button",onclick:function(){var e;this.matches(".selected")?(e=R.indexOf(this),R.splice(e,1)[0].classList.remove("selected"),null==q.ask.match(/모든|의 수식|의 피수식/)?(e=e<2*Math.floor(e/2)+(1-e%2)?e:e-1,R[e]&&R.splice(e,1)[0].classList.remove("selected"),f.textContent="수식어 선택",t?.play()):0==R.length&&t?.play()):(this.classList.add("selected"),R.push(this),null==q.ask.match(/모든|의 수식|의 피수식/)?(f.textContent=["수식어","피수식어"][R.length%2]+" 선택",t?.play()):(t?.pause(),f.style.color="#ffb266")),W(0==R.length)}};Array.from(u,e=>e.concat("modifier")).concat(Array.from(h,e=>e.concat("modificand"))).sort(([e],[t])=>e-t).forEach(([e,t,a],n,l)=>{(d=s.substring(i,e))&&(d.includes(" ")?Array.from(d.split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block haptic-btn shadow-none",textContent:e},y)).forEach(e=>m.push(e," ")):m.push(d," ")),m.push(Object.assign({className:a+" d-inline-block haptic-btn shadow-none",textContent:s.substring(e,t)},y)),t<s.length&&m.push(" "),n==l.length-1&&t<s.length&&(-1<s.indexOf(" ",t)?Array.from(s.substring(t).split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block haptic-btn shadow-none",textContent:e},y)).forEach(e=>m.push(e," ")):m.push(s.substring(t))),i=t}),l.replaceChildren(createElement(m));break;case"3":var[[u,h],b,g]=c;(d=s.substring(i,u))&&m.push(d),p=[b,g].sort(()=>Math.random()-.5),m.push({el:"span",className:"pick-right","data-answer":b,children:["[ ",{el:"span",class:"pick-option",textContent:p[0]}," / ",{el:"span",class:"pick-option",textContent:p[1]}," ]"]}),h<s.length&&m.push(s.substring(h)),l.replaceChildren(createElement(m)),I.querySelector(".example-btn-section").replaceChildren(createElement(Array.from(p,e=>({el:"button",className:"btn btn-outline-fico haptic-btn shadow-none",textContent:e,onclick:function(){S(this).addClass("active").siblings().removeClass("active"),W(!1)}}))));break;case"4":const[[v,x],k,w]=r;c.sort(([e],[t])=>e-t).forEach(([e,t],a,n)=>{(d=s.substring(i,e))&&m.push(d);let l=s.substring(e,t);var o={el:"span",className:"option text-decoration-underline",textContent:l};v==e&&x==t&&(o.className="answer-wrong text-decoration-underline",o.textContent=w,l=w,o["data-answer"]=k),m.push(o),p.push({el:"button",className:"btn btn-outline-fico haptic-btn shadow-none",textContent:l,onclick:function(){S(this).addClass("active").siblings().removeClass("active"),W(!1)}}),a==n.length-1&&t<s.length&&m.push(s.substring(t)),i=t}),l.replaceChildren(createElement(m)),I.querySelector(".example-btn-section").replaceChildren(createElement(p));break;case"5":l.replaceChildren(q.kor);u=I.querySelector(".arranged-example-section");Array.from(c,([e,t])=>s.substring(e,t)).join("").replace(/\W/g,"").length!=s.replace(/\W/g,"").length?c.forEach(([e,t],a,n)=>{var l=t+(t<s.length-1&&/[,.]/.test(s.charAt(t))?1:0);(d=s.substring(i,e))&&m.push(d),0==e||null!=d&&null!=d.match(/\w/g)?m.push({el:"div",className:"arranged-example d-inline-block","data-full":1}):"object"==typeof m[m.length-1]?m[m.length-1]["data-full"]++:m[m.length-2]["data-full"]++,a==n.length-1&&t<s.length&&m.push(s.substring(t)),i=l}):m.push({el:"div",className:"arranged-example d-inline-block"}),c.sort(()=>Math.random()-.5).forEach(([e,t],a)=>{t+=t<s.length-1&&/[,.]/.test(s.charAt(t))?1:0;p.push({el:"span",className:"btn btn-outline-fico haptic-btn shadow-none","data-opt":a,textContent:s.substring(e,t),onclick:J})}),I.querySelector(".example-btn-section").replaceChildren(createElement(p)),u.replaceChildren(createElement(m)),S(I).find(".arranged-example,.example-btn-section").sortable({items:".haptic-btn",connectWith:".arranged-example:not(.full),.example-btn-section"}).on("sortreceive",(e,t)=>{var a;e.target.matches(".example-btn-section")?(a=t.item[0].dataset.opt,null!=t.sender[0].dataset.full&&t.sender[0].classList.remove("full"),S(I).find(`arranged-example [data-opt="${a}"]`).remove(),S(I).find(`.example-btn-section [data-opt="${a}"]`).not(t.item[0]).show().removeClass("selected pe-none")):null!=e.target.dataset.full&&e.target.childElementCount>=parseInt(e.target.dataset.full)&&e.target.classList.add("full"),W(I.querySelectorAll(".arranged-example .haptic-btn").length!=JSON.parse(q.example).length),S(I).find(".example-btn-section")}).on("sortover",(e,t)=>{var a=t.item[0].dataset.opt;S(I).find(`.example-btn-section [data-opt="${a}"]`).not(t.item[0]).hide()}).on("sortout",(e,t)=>{var a=t.item[0].dataset.opt;t.sender[0]?.matches(".arranged-example")&&S(I).find(`.example-btn-section [data-opt="${a}"]`).not(t.item[0]).show()});break;case"6":c.sort(([[e]],[[t]])=>e-t).forEach(([[e,t],a],n,l)=>{(d=s.substring(i,e))&&m.push(d),a.split(/\s+/).forEach((e,t)=>{0<t&&m.push(" "),0<e.length&&m.push({el:"input",type:"text",style:{width:e.length+"em"},pattern:"[0-9A-z!?.,]",placeholder:1<e.length?e.substring(0,1):"",autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:"false",onfocus:function(){this.placeholder="";var e=this.getBoundingClientRect().top,t=E.querySelector(".js-next-btn, .js-solve-btn").getBoundingClientRect().top,t=Math.abs(t-e);t<76.5&&scrollTo(scrollX,scrollY+76.5-t)},onblur:function(){this.placeholder=1<e.length?e.substring(0,1):""}})}),n==l.length-1&&t<s.length&&m.push(s.substring(t)),i=t}),I.querySelector(".arranged-example-section").replaceChildren(),I.querySelector(".ask-section .sentence.kor").textContent=q.kor,I.querySelector(".example-btn-section").replaceChildren(createElement(m)),S(I).on("input",".example-btn-section input",function(){W(!Array.from(I.querySelectorAll(".example-btn-section input")).every(e=>0<e.value.length))});break;case"7":let e=q.kor.split(/\s+/);I.querySelector(".ask-section .sentence.eng").textContent=s,0<r.length&&(e=q.ask.split(/\s+/),(g=new Range).selectNode(l.firstChild),g.setStart(l.firstChild,r[0][0]),g.setEnd(l.firstChild,r[0][1]),g.insertNode(createElement({el:"span",className:"text-decoration-underline",textContent:g.extractContents().textContent})));b=I.querySelector(".arranged-example-section");let o="";(e=e.reduce((e,t,a,n)=>{var l;return 1<t.length?(l=(e||[]).concat([0<o.length?o+" "+t:t]),o="",l):(o+=0<o.length?" "+t:t,a==n.length-1?(e||[]).concat([o]):void 0)},[]).concat(c).sort(()=>Math.random()-.5)).forEach(e=>{m.push({el:"span",className:"btn btn-outline-fico haptic-btn shadow-none",textContent:e.replace(/[,.!?]$/,""),onclick:J})}),b.replaceChildren(createElement({el:"div",className:"arranged-example d-inline-block"})),S(b).sortable({items:"> .haptic-btn"}),S(I).find(".arranged-example,.example-btn-section").sortable({items:".haptic-btn",connectWith:".arranged-example:not(.full),.example-btn-section"}).on("sortreceive",(e,t)=>{e.target.matches(".example-btn-section")&&(e=t.item[0].dataset.opt,S(I).find(`arranged-example [data-opt="${e}"]`).remove(),S(I).find(`.example-btn-section [data-opt="${e}"]`).not(t.item[0]).show().removeClass("selected pe-none")),W(I.querySelectorAll(".arranged-example .haptic-btn").length!=JSON.parse(q.example).length),S(I).find(".example-btn-section")}).on("sortover",(e,t)=>{var a=t.item[0].dataset.opt;S(I).find(`.example-btn-section [data-opt="${a}"]`).not(t.item[0]).hide()}).on("sortout",(e,t)=>{var a=t.item[0].dataset.opt;t.sender[0]?.matches(".arranged-example")&&S(I).find(`.example-btn-section [data-opt="${a}"]`).not(t.item[0]).show()}),I.querySelector(".example-btn-section").replaceChildren(createElement(m))}var e=E.querySelector(".craft-layout-content-section");e.style.backgroundPositionY=I.querySelector(".ask-section").getBoundingClientRect().top-(992<=C.innerWidth?e.clientHeight/e.clientWidth>334/355?142*e.clientWidth/355:151*e.clientHeight/355:285*C.innerWidth/355)+"px"}function J(e){const t=e.target;e=I.querySelector(t.closest(".example-btn-section")?".arranged-example-section":".example-btn-section");const a=t.cloneNode(!0),n=t.cloneNode(!0);a.style.visibility="hidden",n.style.display="block",n.style.position="fixed",n.style.transform="translateZ(0)",e.matches(".arranged-example-section")&&!e.querySelector(".arranged-example")&&e.appendChild(createElement({el:"span",className:"arranged-example"})),e.matches(".arranged-example-section")&&!e.querySelector(".arranged-example:not(.full)")||((e.querySelector(".arranged-example:not(.full)")||e).appendChild(a),t.parentElement.appendChild(n),anime({targets:n,begin:()=>{var e=a.parentElement;null!=e.dataset.full?e.childElementCount==parseInt(e.dataset.full)&&e.classList.add("full"):t.parentElement.classList.remove("full"),t.remove()},top:[S(t).offset().top,S(a).offset().top],left:[S(t).offset().left,S(a).offset().left],easing:"linear",complete:()=>{n.remove(),a.style.visibility="visible",a.onclick=J},duration:100}),S(t).toggleClass("selected pe-none",e.matches(".arranged-example-section")),I.matches("#battle-5")?W(I.querySelectorAll(".arranged-example .haptic-btn").length!=JSON.parse(q.example).length):I.matches("#battle-7")&&W(0==I.querySelectorAll(".arranged-example .haptic-btn").length))}function m(e){i.age=e,H=e<13?"E":e<16?"M":e<19?"H":"C",0!=(p&L)&&(L=0,f=-1),G().then(()=>{(0==N.length?a:c)()})}function Y(){E.getElementById("loginExpiredModal")||E.querySelector(".craft-layout-content-section").appendChild(createElement({el:"div",id:"loginExpiredModal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:-1,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section my-3 text-center text-dark",innerHTML:"이용 시간이 만료되었습니다."},{el:"div",class:"button-section row g-1",children:[{el:"button",class:"btn btn-fico",onclick:()=>{location.replace(0==x?"/craft/main":"/auth/login")},textContent:0==x?"시작 화면으로":"로그인"}]}]}]}]}]})),bootstrap.Modal.getOrCreateInstance(E.getElementById("loginExpiredModal")).show()}function P(){var e;"step"==b?"대장"==s.rankTitle?(E.getElementById("newRankModal")||E.body.prepend(createElement(F)),S("#newRankModal .modal-body .new-obj").remove(),e=createElement({el:"div",className:"new-obj",children:[{el:"p",className:"fs-3",textContent:"단계별 배틀을 정복하셨습니다."},{el:"p",className:"fs-6",textContent:"다른 배틀북도 정복하는 건 어떨까요?"}],style:{position:"absolute",left:"50%",top:"calc(50% + 4vmin)",zIndex:1071,transformOrigin:"center",opacity:0,transform:"translate(-50%,-50%) translateZ(0)"}}),S("#newRankModal .modal-body").append(e),S("#newRankModal button").text("시작화면으로").click(function(){location.replace("/craft/main")}),S("#newRankModal").modal("show"),anime({targets:"#newRankModal .circle-dark object",scale:[0,1],duration:1200}),anime({targets:"#newRankModal .circle-dark-dashed",rotateZ:360,duration:8e3,loop:!0,easing:"linear"}),showFireworks({target:S("#newRankModal .modal-body")[0],particles:20,distance:100,interval:200,size:15}),anime({targets:e,duration:1e3,scale:[0,1],opacity:[0,1]})):(0==S("#lowVictoryModal").length&&E.querySelector(".craft-layout-content-section").appendChild(createElement({el:"div",id:"lowVictoryModal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:-1,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section my-3 text-center text-dark",innerHTML:"We are sorry to inform you that You perished in battle."},{el:"lottie-player",src:"https://assets1.lottiefiles.com/packages/lf20_k8p8cymw.json",background:"transparent",autoplay:!0,speed:"1",loop:!0},{el:"div",class:"button-section row g-1",children:[{el:"button",class:"btn btn-fico",onclick:()=>location.replace("/craft/main"),textContent:"'배틀 플레이 선택'으로 이동"}]}]}]}]}]})),S("#lowVictoryModal").modal("show")):E.getElementById("lastBattleModal")||E.querySelector(".craft-layout-content-section").appendChild(createElement({el:"div",id:"lastBattleModal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:-1,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section my-3 text-center text-dark",innerHTML:"마지막 배틀입니다."},{el:"div",class:"button-section row g-1",children:[{el:"button",class:"btn btn-fico",onclick:()=>location.replace("/craft/main"),textContent:"'배틀 플레이 선택'으로 이동"},{el:"button",class:"btn btn-outline-fico","data-bs-dismiss":"modal",onclick:()=>{t=!1,f=-1,L=0,a()},textContent:"첫 배틀부터 다시 플레이"}]}]}]}]}]})),bootstrap.Modal.getOrCreateInstance(E.getElementById("lastBattleModal")).show()}function Z(){E.getElementById("battleExceedModal")||E.querySelector(".craft-layout-content-section").appendChild(createElement({el:"div",id:"battleExceedModal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:-1,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section my-3 text-center text-dark",innerHTML:"일일 최대 플레이 횟수에 도달하였습니다.<br>내일 다시 찾아와 주세요."},{el:"div",class:"button-section row g-1",children:[{el:"button",class:"btn btn-fico",onclick:()=>location.replace("/craft/main"),textContent:"'배틀 플레이 선택'으로 이동"}]}]}]}]}]})),bootstrap.Modal.getOrCreateInstance(E.getElementById("battleExceedModal")).show()}async function G(){if("step"!=b)return new Promise(e=>{var t=E.querySelector(".progress-bar"),a=(100*L/p).toFixed(1);t.ariaValueNow=a,t.textContent=a+"%",t.style.width=a+"%",e()});{const n=r;return new Promise((t,e)=>{0==o.length?S.getJSON("https://static.findsvoc.com/data/craft/rank-list.json",e=>{o=e.reverse(),a(),t()}).fail(()=>{alert("계급도를 가져오는데 실패했습니다."),e()}):(a(),t())});function a(){for(let e=0,t=o.length;e<t;e++)if(w.correct>o[e].startValue){s=o[e],r=s.startValue+1,V=0<e?o[e-1].startValue+1:9999;break}n<r&&(E.getElementById("newRankModal")||E.body.prepend(createElement(F)),S("#newRankModal .modal-body .new-obj").remove(),e=createElement({el:"div",className:"new-obj",style:{position:"absolute",left:"50%",top:"calc(50% + 4vmin)",width:"37.5vmin",height:"50vmin",maxWidth:"50vmin",zIndex:1071,maxHeight:"50vmin",transformOrigin:"center",opacity:0,transform:"translate(-50%,-50%) translateZ(0)",background:`center/ cover url(https://static.findsvoc.com/images/app/craft/${s.rankTitle}.svg) no-repeat`}}),S("#newRankModal .modal-body").append(e),S("#newRankModal").modal("show"),anime({targets:"#newRankModal .circle-dark object",scale:[0,1],duration:1200}),anime({targets:"#newRankModal .circle-dark-dashed",rotateZ:360,duration:8e3,loop:!0,easing:"linear"}),showFireworks({target:S("#newRankModal .modal-body")[0],particles:20,distance:100,interval:200,size:15}),anime({targets:e,duration:1e3,scale:[0,1],opacity:[0,1]}));var e=E.querySelector(".progress-bar"),t=(100*(w.correct-r)/(V-r)).toFixed(1);e.ariaValueNow=t,e.textContent=t+"%",e.style.width=t+"%"}}}function W(e){anime({targets:".js-solve-btn,.js-next-btn",duration:500,easing:"easeOutQuart",left:e?"110%":"45%"})}function Q(e){"QuotaExceededError"==e.target.error.name&&(alert("웹 저장공간을 정리 후 다시 이용해 주세요."),location.replace("/craft/main"))}S(E).on("click",".js-view-rnum",function(){"0"==S(this).css("opacity")?S(this).css("opacity",1).text(q.rnum):S(this).css("opacity",0)}).on("click","#save-btn",function(){WebAudioJS.play(l),S.getJSON("/craft/battle/save",{memberId:x,battleBookId:y,battleId:q.bid,save:!q.saved},e=>{q.saved=e,S(this).toggleClass("reverse",e);const t=createElement({el:"div",class:"toast battle-save-result-msg fade show",role:"alert","aria-live":"assertive","aria-atomic":"true","data-bs-autohide":"true","data-bs-delay":2e3,textContent:q.saved?"저장되었습니다.":"저장이 취소되었습니다."});this.parentElement.appendChild(t),bootstrap.Toast.getOrCreateInstance(t).show(),t.addEventListener("hidden.bs.toast",()=>t.remove())}).always((e,t)=>{"parsererror"==t&&Y()})}).on("click",".js-solve-btn",function(){const l=I,s=JSON.parse(q.answer||"[]");var e=JSON.parse(q.example||"[]");let n=!0;switch(S(this).toggleClass("js-solve-btn js-next-btn").text("다음"),S(l).find(".haptic-btn").addClass("pe-none"),S(l).find(".battle-type-block, .ask-block, .simple-ask-block").fadeToggle(),q.battleType){case"1":const i=[];e.sort(([e],[t])=>e-t).forEach(([a,n],e)=>{null!=s.find(([e,t])=>a==e&&n==t)&&i.push(e)}),l.querySelectorAll(".option").forEach((e,t)=>{i.includes(t)?e.classList.add("right"):e.matches(".selected")&&(n=!1,e.classList.add("wrong"))}),c(l.querySelector(".ask-section .sentence"));break;case"2":l.querySelectorAll(".option,.modifier,.modificand").forEach(e=>{e.matches(".selected")||e.classList.add("unselected"),q.ask.includes("모든")?R.includes(e)&&e.matches(".modifier, .modificand")?e.classList.add("right"):R.includes(e)^e.matches(".modifier, .modificand")&&(n=!1,R.includes(e))&&e.classList.add("wrong"):R.includes(e)&&e.matches(R.indexOf(e)%2?".modificand":".modifier")?e.classList.add("right"):R.includes(e)?(e.classList.add("wrong"),n=!1):e.matches(".modificand.unselected,.modifier.unselected")&&(n=!1)}),l.querySelector(".mod-guide-text").remove(),c(l.querySelector(".ask-section .sentence"));break;case"3":var a=l.querySelector(".example-btn-section .active"),r=a.textContent;const d=Array.from(l.querySelectorAll(".example-btn-section button")).indexOf(a);n=!!s.includes(r),l.querySelectorAll(".pick-right .pick-option").forEach((e,t)=>{t==d?e.classList.add(n?"right":"wrong"):n||e.classList.add("right")}),l.querySelector(".example-btn-section").style.display="none",c(l.querySelector(".ask-section .sentence"));break;case"4":const p=S(l).find(".example-btn-section .active").index(),m=[];e.sort(([e],[t])=>e-t).forEach(([a,n],e)=>{null!=s.find(([e,t])=>a==e&&n==t)&&m.push(e)}),c(l.querySelector(".ask-section .sentence")),l.querySelector(".example-btn-section").style.display="none",l.querySelectorAll(".sentence .option,.sentence .answer-wrong").forEach((e,t)=>{var a;m.includes(t)?(e.classList.add("right"),a=createElement({el:"span",textContent:e.dataset.answer,className:"original-text",style:{opacity:0,position:"absolute",left:e.offsetLeft+"px",top:e.offsetTop+"px"}}),e.parentElement.appendChild(a),anime({targets:a,top:"-=30",opacity:1,delay:600})):t==p&&(n=!1,e.classList.add("wrong"))});break;case"5":n=l.querySelector(".arranged-example-section").textContent.replace(/\W/g,"").trim()==q.eng.replace(/\W/g,"").trim(),l.querySelector(".arranged-example-section").prepend(createElement({el:"div",className:"full-sentence",textContent:q.eng})),l.querySelector(".example-btn-section").style.display="none",c(l.querySelector(".arranged-example-section .full-sentence"));break;case"6":const u=Array.from(e,([[],e])=>e.split(/\s+/)).reduce((e,t)=>e.concat(t),[]);l.querySelectorAll(".example-btn-section input").forEach((e,t)=>{e.value.trim().toLowerCase()==u[t].toLowerCase()?e.className="right":(e.className="wrong",n=!1)}),l.querySelector(".arranged-example-section").prepend(createElement({el:"div",className:"full-sentence",textContent:q.eng})),c(l.querySelector(".arranged-example-section .full-sentence"));break;case"7":let t=Array.from((q.answer?q.ask:q.kor).split(/\s+/),e=>e.replace(/[,.!?]$/,"")),o="";t=t.reduce((e,t,a,n)=>{var l;return 1<t.length?(l=(e||[]).concat([0<o.length?o+" "+t:t]),o="",l):(o+=0<o.length?" "+t:t,a==n.length-1?(e||[]).concat([o]):void 0)},[]),l.querySelectorAll(".arranged-example-section .btn").length!=t.length?(l.querySelectorAll(".arranged-example-section .btn").forEach(e=>{t.includes(e.textContent)?e.classList.add("right"):e.classList.add("wrong")}),n=!1):l.querySelectorAll(".arranged-example-section .btn").forEach(e=>{t.includes(e.textContent)?e.classList.add("right"):(e.classList.add("wrong"),n=!1)}),l.querySelector(".arranged-example-section").prepend(createElement({el:"div",className:"full-sentence",textContent:q.answer?q.ask:q.kor})),l.querySelector(".example-btn-section").style.display="none",c(l.querySelector(".ask-section .sentence"))}function c(e){e.appendChild(createElement({el:"div",className:"tts-block text-end",style:{transform:"scale(0)"},children:[{el:"button",id:"ttsPlay",class:"btn d-inline w-auto text-info ms-2 p-0 material-icons-outlined fs-2 border-0 shadow-none bg-transparent","data-bs-toggle":"tooltip",title:"문장 듣기/중지","data-active":"on",textContent:"play_circle",onclick:function(){var e="on"==this.dataset.active;this.dataset.active=e?"off":"on",this.textContent=e?"stop_circle":"play_circle",e?h.speakRepeat(q.eng,2,1e3,()=>{this.dataset.active="on",this.textContent="play_circle"}):h.stop()}},{el:"button",id:"ttsSetting",class:"btn d-inline w-auto text-info ms-2 p-0 material-icons-outlined fs-2 border-0 shadow-none bg-transparent","data-bs-toggle":"tooltip",title:"음성 설정",textContent:"tune",onclick:function(){h.stop();var e=this.previousElementSibling;e.dataset.active="on",e.textContent="play_circle",h.openSettings()}}]})),anime({targets:l.querySelector(".tts-block"),scale:1,delay:600,complete:()=>{h.autoEnabled()&&l.querySelector("#ttsPlay")?.dispatchEvent(new Event("click"))}})}"step"==b&&(v.count++,C.localStorage.setItem("TCBSC_"+ntoa(x),JSON.stringify(v))),WebAudioJS.play(n?$:D);var t=createElement({el:"div",class:"js-result-msg result-toast",style:{transformOrigin:"top"}});E.querySelector(".craft-header-section").append(t),E.querySelector(".craft-layout-content-section").classList.add("bg-fc-transparent"),anime.timeline({targets:t}).add({begin:function(e){e=e.animatables[0].target;e.textContent=n?"정답입니다.":"오답입니다.",e.style.visibility="visible",e.style.color="#00000000",e.style.backgroundColor=n?"#00bcd4":"#f44336"},bottom:"-2em",width:["2rem","50%"],height:["0rem","2rem"],duration:1e3,easing:"easeInOutExpo"}).add({color:"#FFF",easing:"linear"}),n||(C.ANI&&C.ANI?.vibrate?C.ANI.vibrate([200,50,100,50,100]):navigator?.vibrate&&navigator.vibrate([200,50,100,50,100])),f=q.bid;const o={memberId:x,ageGroup:H,battleBookId:y,battleBookMarkId:g.markId,battleId:q.bid,correct:n,save:Boolean(q.saved)};0==x&&null!=k&&(o.memberId56=k),null!=g&&null!=g.markType&&(o.markType=g.markType),S(l).find(".explain-section").slideDown(500).find(".comment-section").text(q.comment||"작성된 코멘트가 없습니다."),S.getJSON("/craft/battle/"+q.sentenceId,e=>{return t=q.eng,a=l.querySelector(".explain-section"),n=e,a.querySelector(".trans-section").replaceChildren(createElement(Array.from(n.korList,(e,t)=>({el:"div",className:"row",children:[{el:"div",className:"col-auto ps-2 pe-0",children:[{el:"span",className:"material-icons "+(t>=n.korList.length-3?"ai-trans":"user-trans")}]},{el:"div",className:"trans-text col",textContent:e.kor}]})))),a.querySelector(".words-section").replaceChildren(0<n.wordList.length?createElement(Array.from(n.wordList,e=>({el:"span",class:"one-word-unit-section",children:[{el:"span",class:"title",textContent:e.title}].concat(Array.from(e.senseList,e=>({el:"span",class:"one-part-unit-section",children:[{el:"span",class:"part",textContent:e.partType},{el:"span",class:"meaning",textContent:e.meaning}]})))}))):"해당 문장에서 fico AI가 설정한 난이도 이상의 단어를 찾지 못했습니다."),S(a).find(".collapse").collapse("show"),tandem.showSemanticAnalysis(t,n.svocTag.svocBytes,S(a).find(".svoc-section").empty()).then(()=>_.observe(a.lastElementChild)),E.querySelector(".craft-header-section").classList.remove("min"),E.querySelector(".scrolling-section").style.marginTop="0",void scrollTo(0,75);var t,a,n}).always((e,t)=>{"parsererror"==t?Y():S.ajax({url:"/craft/battle/evaluation/add",type:"GET",contentType:"application/json",data:o,success:()=>{n&&w.correct++,0==x&&((j=T.open(A,M)).onsuccess=function(){var e=(O=this.result).transaction(["StepBattle"],"readwrite");e.onabort=Q,(B=e.objectStore("StepBattle")).index("bid").openCursor().onsuccess=function(){var e,t=this.result;t&&(t.key==q.bid&&((e=t.value).solve=n?"O":"X",t.update(e)),t.continue())}}),W(!0),null!=L&&L++,G()},error:()=>alert("채점 전송에 실패했습니다. 재로그인 후 다시 시도해 주세요."),complete:(e,t)=>{"parsererror"==t&&Y()}})})}).on("click",".js-next-btn",function(e){h.stop(),"step"==b&&v.count>=d?(Z(),e.preventDefault(),e.stopPropagation()):(I.querySelector(".tts-block").remove(),WebAudioJS.play(u),S(this).toggleClass("js-solve-btn js-next-btn").text("확인"),E.querySelector(".craft-layout-content-section").classList.remove("bg-fc-transparent"),anime({targets:".js-result-msg",bottom:0,height:0,duration:500,easing:"easeInOutExpo",complete:e=>e.animatables.forEach(e=>e.target.remove())}),_.disconnect(),(0<N.length?c:t?P:a)())}).on("shown.bs.collapse",".svoc-section",function(){tandem.correctMarkLine(this.querySelector(".semantics-result"))}).on("click",".haptic-btn",function(){this.textContent.match(/[^\w\s,.!?'"]/)?WebAudioJS.play(l):h.speak(this.textContent)}),C.craft=Object.assign({},C.craft,{initPlayer:function(a,e,t,n,l,o){if(b=e,w=t,(g=n).regDate=new Date(n.regDate),0==(x=n?.memberId||0)&&(d=25),y=n.battleBookId,f=n.lastBattleId,null!=l&&(L=l),null!=o&&(p=o),"step"==b)if(C.localStorage.getItem("TCBSC_"+ntoa(x))){if((v=JSON.parse(C.localStorage.getItem("TCBSC_"+ntoa(x)))).date!=(new Date).toLocaleDateString())v.date=(new Date).toLocaleDateString(),v.count=0;else if(v.count>=d)return void Z()}else v={date:(new Date).toLocaleDateString(),count:0};function s(){O=this.result,(B=O.createObjectStore("StepBattle")).createIndex("bid","bid",{unique:!0}),B.createIndex("data","data"),B.createIndex("solve","solve",{unique:!1}),m(a)}0==x?("undefined"==typeof Cookies?S.getScript("https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js",function(){var e=Cookies.get("FMID");e?k=e:location.replace("/craft/main")}):(e=Cookies.get("FMID"))?k=e:location.replace("/craft/main"),i.age=parseInt(localStorage.getItem("FM_AGE")),E.querySelector("#save-btn").disabled=!0,w={numOfTest:0,correct:0,incorrect:0},(j=T.open(A,M)).onsuccess=function e(){var t;(O=this.result).objectStoreNames.contains("StepBattle")?((t=O.transaction(["StepBattle"],"readonly")).onabort=Q,B=t.objectStore("StepBattle"),(j=B.openCursor()).onsuccess=c):((j=T.open(A,++M)).onsuccess=e,j.onupgradeneeded=s)},j.onupgradeneeded=s):m(a);let r=0;function c(){var e,t=this.result;t?(e=t.value.data,/[OX]/.test(t.value.solve)?(w["O"==t.value.solve?"correct":"incorrect"]++,e.rnum>r&&(r=e.rnum,f=e.bid)):N.push(e),t.continue()):(N.sort((e,t)=>e.rnum-t.rnum),m(a))}}})}(jQuery,window,document);