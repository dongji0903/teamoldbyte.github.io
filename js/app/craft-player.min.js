!function(q,E,w){q.cachedScript=q.cachedScript||function(e,t){return q.ajax(q.extend(t||{},{dataType:"script",cache:!0,url:e}))},q(function(){const t=w.querySelector(".craft-header-section"),n=w.querySelector(".scrolling-section");let s=scrollY;q(E).on("scroll",function(e){requestAnimationFrame(()=>{scrollY>s?115<=scrollY&&(n.style.marginTop="150px",t.classList.add("min")):scrollY<115&&(n.style.marginTop="0",t.classList.remove("min")),s=scrollY})})});let h=new IntersectionObserver(e=>{T(!e[0].isIntersecting)},{threshold:1});let s=[],l,f,m;let N,L=[],A,g,b,y,a,o,r;const v="findsvoc-idb",x=1;let C,k,S,O=[];function t(){var e="step"!=l&&null!=f?"/"+ntoa(f):"",e=`/craft/battle/${l}${e}/next`;q.getJSON(e,function(s){0==(L=s).length?alert("조회된 문제가 없습니다."):0==g?(C=E.indexedDB.open(v,x)).onsuccess=function(){var e=(k=this.result).transaction(["StepBattle"],"readwrite");S=e.objectStore("StepBattle");let n=0;!function e(){if(n<s.length){const t=s[n++];S.add({bid:t.bid,data:t,solve:""},t.bid).onsuccess=e}else i()}()}:i()}).fail(()=>alert("새로운 문제를 조회할 수 없습니다."))}function i(){N=L.shift(),O=[];var t=(A=w.getElementById("battle-"+N.battleType)).querySelector(".ask-block .ask"),n=A.querySelector(".simple-ask-block .ask");const a=A.querySelector(".sentence"),o=N.eng;var s=JSON.parse(N.answer||"[]");const r=JSON.parse(N.example||"[]");let i=0,c,d=[];const p=[];switch(scrollTo(0,0),w.querySelector(".craft-header-section").classList.remove("min"),w.querySelector(".scrolling-section").style.marginTop="0",q(A).find(".battle-type-block, .ask-block").show(),q(A).find(".simple-ask-block").hide(),A.querySelector(".battle-type").textContent=N.battleType,q("#save-btn").toggleClass("reverse",Boolean(N.saved)),A.querySelector(".example-btn-section")&&(A.querySelector(".example-btn-section").style.display=""),q(A).show().siblings(".battle-section").hide(),anime({targets:A,duration:1e3,delay:300,left:["100vw",0]}),T(!0),q(A).find(".explain-section").hide().find(".collapse").collapse("hide"),N.battleType){case"1":t.textContent=`다음 문장의 ${N.ask}를 선택하세요.`,n.textContent=t.textContent,r.forEach(([e,t],n,s)=>{(c=o.substring(i,e))&&p.push(c),p.push({el:"span",role:"button",className:"option",textContent:o.substring(e,t),onclick:function(){q(this).toggleClass("selected"),T(0==a.querySelectorAll(".selected").length)}}),n==s.length-1&&t<o.length&&p.push(o.substring(t)),i=t}),a.replaceChildren(createElement(p));break;case"2":const g=createElement({el:"span",class:"mod-guide-text"});N.ask.includes("모든")?(t.textContent=`${N.ask.includes("피수식")?"피수식어":"수식어"}를 모두 선택하세요.`,g.textContent=`${N.ask.includes("피수식")?"피수식어":"수식어"} 선택`):N.ask.match(/의 수식|의 피수식/)?(t.textContent=N.ask+"어를 선택하세요.",g.textContent=`${N.ask.includes("피수식")?"피수식어":"수식어"} 선택`):(t.textContent=`[${N.ask}] 수식어와 피수식어를 선택하세요.`,g.textContent="수식어 선택"),anime.timeline({targets:g}).add({begin:()=>A.querySelector(".ask-section").appendChild(g),width:[0,"70vw"],delay:1e3,duration:500}).add({delay:0,color:["#ffffff","#ffb266","#ffffff","#ffb266","#ffffff","#ffb266"],easing:"linear"}),n.textContent=t.textContent;var[u,h]=s;const b={el:"span",role:"button",onclick:function(){var e;this.matches(".selected")?(e=O.indexOf(this),O.splice(e,1)[0].classList.remove("selected"),null==N.ask.match(/모든|의 수식|의 피수식/)&&(e=e<2*Math.floor(e/2)+(1-e%2)?e:e-1,O[e]&&O.splice(e,1)[0].classList.remove("selected"),g.textContent="수식어 선택"),anime({targets:g,easing:"linear",color:["#FFFFFF","#ffb266","#FFFFFF","#ffb266","#FFFFFF","#ffb266"]})):(this.classList.add("selected"),O.push(this),null==N.ask.match(/모든|의 수식|의 피수식/)&&(g.textContent=["수식어","피수식어"][O.length%2]+" 선택")),T(0==O.length)}};Array.from(u,e=>e.concat("modifier")).concat(Array.from(h,e=>e.concat("modificand"))).sort(([e],[t])=>e-t).forEach(([e,t,n],s,a)=>{(c=o.substring(i,e))&&(c.includes(" ")?Array.from(c.split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},b)).forEach(e=>p.push(e," ")):p.push(c," ")),p.push(Object.assign({className:n+" d-inline-block",textContent:o.substring(e,t)},b)),t<o.length&&p.push(" "),s==a.length-1&&t<o.length&&(-1<o.indexOf(" ",t)?Array.from(o.substring(t).split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},b)).forEach(e=>p.push(e," ")):p.push(o.substring(t))),i=t}),a.replaceChildren(createElement(p));break;case"3":var[[u,h],f,m]=r;(c=o.substring(i,u))&&p.push(c),d=[f,m].sort(()=>Math.random()-.5),p.push({el:"span",className:"pick-right","data-answer":f,children:["[ ",{el:"span",class:"pick-option",textContent:d[0]}," / ",{el:"span",class:"pick-option",textContent:d[1]}," ]"]}),h<o.length&&p.push(o.substring(h)),a.replaceChildren(createElement(p)),A.querySelector(".example-btn-section").replaceChildren(createElement(Array.from(d,e=>({el:"button",className:"btn btn-outline-fico",textContent:e,onclick:function(){q(this).addClass("active").siblings().removeClass("active"),T(!1)}}))));break;case"4":const[[y,v],x,C]=s;r.sort(([e],[t])=>e-t).forEach(([e,t],n,s)=>{(c=o.substring(i,e))&&p.push(c);let a=o.substring(e,t);var l={el:"span",className:"option text-decoration-underline",textContent:a};y==e&&v==t&&(l.className="answer-wrong text-decoration-underline",l.textContent=C,a=C,l["data-answer"]=x),p.push(l),d.push({el:"button",className:"btn btn-outline-fico",textContent:a,onclick:function(){q(this).addClass("active").siblings().removeClass("active"),T(!1)}}),n==s.length-1&&t<o.length&&p.push(o.substring(t)),i=t}),a.replaceChildren(createElement(p)),A.querySelector(".example-btn-section").replaceChildren(createElement(d));break;case"5":a.replaceChildren(N.kor);const k=A.querySelector(".arranged-examples");r.sort(()=>Math.random()-.5).forEach(([e,t])=>{d.push({el:"span",className:"btn btn-outline-fico",textContent:o.substring(e,t),onclick:function(){if(!this.closest(".arranged-examples")&&!this.matches(".selected")){const t=this.cloneNode(!0),e=this.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",k.appendChild(t),this.parentElement.appendChild(e),anime({targets:e,top:[q(this).offset().top,q(t).offset().top],left:[q(this).offset().left,q(t).offset().left],easing:"linear",complete:()=>{e.remove(),t.style.visibility="visible"},duration:100}),t.onclick=()=>{const e=t.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",k.appendChild(e),anime({targets:e,top:[q(t).offset().top,q(this).offset().top],left:[q(t).offset().left,q(this).offset().left],easing:"linear",complete:()=>{e.remove(),t.remove(),q(this).removeClass("selected pe-none"),T(k.childElementCount!=r.length)},duration:100})},q(this).addClass("selected pe-none")}T(k.childElementCount!=r.length)}})}),A.querySelector(".example-btn-section").replaceChildren(createElement(d)),k.replaceChildren(),q(k).sortable();break;case"6":r.sort(([[e]],[[t]])=>e-t).forEach(([[e,t],n],s,a)=>{(c=o.substring(i,e))&&p.push(c),n.split(/\s+/).forEach((e,t)=>{0<t&&p.push(" "),0<e.length&&p.push({el:"input",type:"text",style:{width:e.length+"em"},pattern:"[0-9A-z!?.,]",placeholder:1<e.length?e.substring(0,1):"",autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:"false",onfocus:function(){var e=this.getBoundingClientRect().top,t=w.querySelector(".js-next-btn, .js-solve-btn").getBoundingClientRect().top,t=Math.abs(t-e);t<76.5&&scrollTo(scrollX,scrollY+76.5-t)}})}),s==a.length-1&&t<o.length&&p.push(o.substring(t)),i=t}),A.querySelector(".arranged-examples").replaceChildren(),A.querySelector(".ask-section .sentence.kor").textContent=N.kor,A.querySelector(".example-btn-section").replaceChildren(createElement(p)),q(A).on("input",".example-btn-section input",function(){T(!Array.from(A.querySelectorAll(".example-btn-section input")).every(e=>0<e.value.length))});break;case"7":let e=N.kor.split(/\s+/);const S=A.querySelector(".arranged-examples");let l="";(e=e.reduce((e,t,n,s)=>{var a;return 1<t.length?(a=e.concat([0<l.length?l+" "+t:t]),l="",a):(l+=0<l.length?" "+t:t,n==s.length-1?e.concat([l]):void 0)},[]).concat(r).sort(()=>Math.random()-.5)).forEach(e=>{p.push({el:"span",className:"btn btn-outline-fico",textContent:e,onclick:function(){if(!this.closest(".arranged-examples")&&!this.matches(".selected")){const t=this.cloneNode(!0),e=this.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",S.appendChild(t),this.parentElement.appendChild(e),anime({targets:e,top:[q(this).offset().top,q(t).offset().top],left:[q(this).offset().left,q(t).offset().left],easing:"linear",complete:()=>{e.remove(),t.style.visibility="visible"},duration:100}),t.onclick=()=>{const e=t.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",S.appendChild(e),anime({targets:e,top:[q(t).offset().top,q(this).offset().top],left:[q(t).offset().left,q(this).offset().left],easing:"linear",complete:()=>{e.remove(),t.remove(),q(this).removeClass("selected pe-none"),T(0==S.childElementCount)},duration:100})},q(this).addClass("selected pe-none")}T(0==S.childElementCount)}})}),S.replaceChildren(),A.querySelector(".ask-section .sentence.eng").textContent=o,A.querySelector(".example-btn-section").replaceChildren(createElement(p))}var e=w.querySelector(".craft-layout-content-section");e.style.backgroundPositionY=A.querySelector(".ask-section").getBoundingClientRect().top-(992<=E.innerWidth?e.clientHeight/e.clientWidth>334/355?142*e.clientWidth/355:151*e.clientHeight/355:285*E.innerWidth/355)+"px"}function c(e){b=e<13?"E":e<16?"M":e<19?"H":"C",(0==L.length?t:i)(),I()}function d(){w.getElementById("battleExceedModal")||w.querySelector(".craft-layout-content-section").appendChild(createElement({el:"div",id:"battleExceedModal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:-1,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section my-3 text-center text-dark",innerHTML:"일일 최대 플레이 횟수에 도달하였습니다.<br>내일 다시 찾아와 주세요."},{el:"div",class:"button-section row g-1",children:[{el:"button",class:"btn btn-fico",onclick:()=>location.assign("/craft/main"),textContent:"크래프트 메인으로 이동"}]}]}]}]}]})),bootstrap.Modal.getOrCreateInstance(w.getElementById("battleExceedModal")).show()}function I(){var e=o;if(0==s.length)q.getJSON("https://static.findsvoc.com/data/craft/rank-list.json",e=>{s=e.reverse(),I()}).fail(()=>alert("계급도를 가져오는데 실패했습니다."));else{for(let e=0,t=s.length;e<t;e++)if(y.correct>s[e].startValue){a=s[e].rankTitle,o=s[e].startValue+1,r=0<e?s[e-1].startValue+1:9999;break}if(e<o){showFireworks({target:q(".battle-section:visible")[0],distance:100,size:10});const n=createElement({el:"img",src:`https://static.findsvoc.com/images/app/craft/${a}.svg`,class:"position-absolute start-50 top-50 w-50",style:"transform: translate(-50%, -50%)"});w.body.appendChild(n),anime({targets:n,scale:[0,1],easing:"cubicBezier(0,2,1,2)",duration:1e3,complete:()=>setTimeout(()=>n.remove(),3e3)})}var e=w.querySelector(".progress-bar"),t=(100*(y.correct-o)/r).toFixed(1);e.ariaValueNow=t,e.textContent=t+"%",e.style.width=t+"%"}}function T(e){anime({targets:".js-solve-btn,.js-next-btn",duration:500,easing:"easeOutQuart",left:e?"110%":"45%"})}q(w).on("click","#save-btn",function(){q.getJSON("/craft/battle/mybattle/save",{memberId:g,battleBookId:f,battleId:N.bid,save:!N.saved},e=>{N.saved=e,q(this).toggleClass("reverse",e);const t=createElement({el:"div",class:"toast align-items-center position-absolute end-0 top-0 mt-4 me-5 w-auto text-center",role:"alert","aria-live":"assertive","aria-atomic":"true","data-bs-autohide":"true","data-bs-delay":2e3,textContent:N.saved?"저장되었습니다.":"저장이 취소되었습니다."});this.appendChild(t),bootstrap.Toast.getOrCreateInstance(t).show(),t.addEventListener("hidden.bs.toast",()=>t.remove())})}).on("click",".js-solve-btn",function(){const a=A,o=JSON.parse(N.answer||"[]");var e=JSON.parse(N.example||"[]");let s=!0;switch(q(this).toggleClass("js-solve-btn js-next-btn").text("다음"),q(a).find(".ask-section,.example-btn-section,.arranged-examples").addClass("pe-none"),q(a).find(".battle-type-block, .ask-block, .simple-ask-block").fadeToggle(),N.battleType){case"1":const i=[];e.sort(([e],[t])=>e-t).forEach(([n,s],e)=>{null!=o.find(([e,t])=>n==e&&s==t)&&i.push(e)}),a.querySelectorAll(".option").forEach((e,t)=>{i.includes(t)?e.classList.add("right"):e.matches(".selected")&&(s=!1,e.classList.add("wrong"))});break;case"2":a.querySelectorAll(".option,.modifier,.modificand").forEach(e=>{e.matches(".selected")||e.classList.add("unselected"),N.ask.includes("모든")?O.includes(e)&&e.matches(".modifier, .modificand")?e.classList.add("right"):O.includes(e)^e.matches(".modifier, .modificand")&&(s=!1,O.includes(e)&&e.classList.add("wrong")):O.includes(e)&&e.matches(O.indexOf(e)%2?".modifier":".modificand")?e.classList.add("right"):s=(O.includes(e)&&e.classList.add("wrong"),!1)}),a.querySelector(".mod-guide-text").remove();break;case"3":var n=a.querySelector(".example-btn-section .active"),r=n.textContent;const c=Array.from(a.querySelectorAll(".example-btn-section button")).indexOf(n);s=!!o.includes(r),a.querySelectorAll(".pick-right .pick-option").forEach((e,t)=>{t==c?e.classList.add(s?"right":"wrong"):s||e.classList.add("right")}),a.querySelector(".example-btn-section").style.display="none";break;case"4":const d=q(a).find(".example-btn-section .active").index(),p=[];e.sort(([e],[t])=>e-t).forEach(([n,s],e)=>{null!=o.find(([e,t])=>n==e&&s==t)&&p.push(e)}),a.querySelectorAll(".sentence .option,.sentence .answer-wrong").forEach((e,t)=>{var n;p.includes(t)?(e.classList.add("right"),n=createElement({el:"span",textContent:e.dataset.answer,className:"original-text",style:{opacity:0,position:"absolute",left:e.offsetLeft+"px",top:e.offsetTop+"px"}}),e.parentElement.appendChild(n),anime({targets:n,top:"-=20",opacity:1,delay:600})):t==d&&(s=!1,e.classList.add("wrong"))}),a.querySelector(".example-btn-section").style.display="none";break;case"5":s=a.querySelector(".arranged-examples").textContent.replace(/\W/g,"").trim()==N.eng.replace(/\W/g,"").trim(),a.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:N.eng})),a.querySelector(".example-btn-section").style.display="none";break;case"6":const u=Array.from(e,([[],e])=>e.split(/\s+/)).reduce((e,t)=>e.concat(t),[]);a.querySelectorAll(".example-btn-section input").forEach((e,t)=>{e.value.toLowerCase()==u[t].toLowerCase()?e.className="right":(e.className="wrong",s=!1)}),a.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:N.eng}));break;case"7":let t=N.kor.split(/\s+/),l="";t=t.reduce((e,t,n,s)=>{var a;return 1<t.length?(a=e.concat([0<l.length?l+" "+t:t]),l="",a):(l+=0<l.length?" "+t:t,n==s.length-1?e.concat([l]):void 0)},[]),a.querySelectorAll(".arranged-examples .btn").length!=t.length?(a.querySelectorAll(".arranged-examples .btn").forEach(e=>{t.includes(e.textContent)?e.classList.add("right"):e.classList.add("wrong")}),s=!1):a.querySelectorAll(".arranged-examples .btn").forEach(e=>{t.includes(e.textContent)?e.classList.add("right"):(e.classList.add("wrong"),s=!1)}),a.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:N.kor})),a.querySelector(".example-btn-section").style.display="none"}m.count++,E.localStorage.setItem("TCBSC",JSON.stringify(m));const t=createElement({el:"div",class:"js-result-msg result-toast",style:{transformOrigin:"top"},textContent:s?"정답입니다.":"오답입니다."});w.querySelector(".craft-header-section").append(t),w.querySelector(".craft-layout-content-section").classList.add("bg-fc-transparent"),anime.timeline({targets:t}).add({begin:()=>{t.style.visibility="visible",t.style.color="#00000000"},bottom:"-2rem",backgroundColor:s?"#00bcd4":"#f44336",width:["2rem","50%"],height:["0rem","2rem"],duration:1e3,easing:"easeInOutExpo"}).add({color:"#FFF",easing:"linear"}),s||(E.ANI&&E.ANI?.vibrate?E.ANI.vibrate([200,50,100,50,100]):navigator?.vibrate&&navigator.vibrate([200,50,100,50,100]));var l={memberId:g,ageGroup:b,battleBookId:f,battleId:N.bid,correct:s,save:Boolean(N.saved)};q(a).find(".explain-section").show().find(".comment-section").text(N.comment||"작성된 코멘트가 없습니다."),q.getJSON("/craft/battle/"+N.sentenceId,e=>{return t=N.eng,n=a.querySelector(".explain-section"),s=e,n.querySelector(".trans-section").replaceChildren(createElement(Array.from(s.korList,(e,t)=>({el:"div",className:"row",children:[{el:"div",className:"col-auto ps-2 pe-0",children:[{el:"span",className:"material-icons "+(t>=s.korList.length-3?"ai-trans":"user-trans")}]},{el:"div",className:"trans-text col",textContent:e.kor}]})))),n.querySelector(".words-section").replaceChildren(0<s.wordList.length?createElement(Array.from(s.wordList,e=>({el:"span",class:"one-word-unit-section",children:[{el:"span",class:"title",textContent:e.title}].concat(Array.from(e.senseList,e=>({el:"span",class:"one-part-unit-section",children:[{el:"span",class:"part",textContent:e.partType},{el:"span",class:"meaning",textContent:e.meaning}]})))}))):"해당 문장에서 fico AI가 설정한 난이도 이상의 단어를 찾지 못했습니다."),q(n).find(".collapse").collapse("show"),tandem.showSemanticAnalysis(t,s.svocTag.svocBytes,q(n).find(".svoc-section").empty()).then(()=>h.observe(n.lastElementChild)),w.querySelector(".craft-header-section").classList.remove("min"),w.querySelector(".scrolling-section").style.marginTop="0",void scrollTo(0,75);var t,n,s}),q.ajax({url:"/craft/battle/evaluation/add",type:"GET",contentType:"application/json",data:l,success:()=>{s&&y.correct++,0==g&&((C=E.indexedDB.open(v,x)).onsuccess=function(){var e=(k=this.result).transaction(["StepBattle"],"readwrite");(S=e.objectStore("StepBattle")).index("bid").openCursor().onsuccess=function(){var e,t=this.result;t&&(t.key==N.bid?((e=t.value).solve=s?"O":"X",t.update(e)):t.continue())}}),T(!0),I()},error:()=>alert("채점 전송에 실패했습니다. 재로그인 후 다시 시도해 주세요.")})}).on("click",".js-next-btn",function(e){50<=m.count?(d(),e.preventDefault(),e.stopPropagation()):(q(this).toggleClass("js-solve-btn js-next-btn").text("확인"),w.querySelector(".craft-layout-content-section").classList.remove("bg-fc-transparent"),q(A).find(".ask-section,.example-btn-section,.arranged-examples").removeClass("pe-none"),anime({targets:".js-result-msg",bottom:0,height:0,duration:500,easing:"easeInOutExpo",complete:e=>e.animatables.forEach(e=>e.target.remove())}),h.disconnect(),(0<L.length?i:t)())}).on("shown.bs.collapse",".svoc-section",function(){tandem.correctMarkLine(this.querySelector(".semantics-result"))}),E.craft=Object.assign({},E.craft,{initPlayer:function(e,t,n,s,a){if(g=e,f=s,l=n,y=a,E.localStorage.getItem("TCBSC")){if((m=JSON.parse(E.localStorage.TCBSC)).date!=(new Date).toLocaleDateString())m.date=(new Date).toLocaleDateString(),m.count=0;else if(50<=m.count)return void d()}else m={date:(new Date).toLocaleDateString(),count:0};0==g?(w.querySelector("#save-btn").disabled=!0,y={numOfTest:0,correct:0,incorrect:0},(C=E.indexedDB.open(v,x)).onsuccess=function(){var e=(k=this.result).transaction(["StepBattle"],"readonly");S=e.objectStore("StepBattle"),(C=S.openCursor()).onsuccess=function(){var e=this.result;if(e){switch(e.value.solve){case"O":y.correct++;break;case"X":y.incorrect++;break;default:L.push(e.value.data)}e.continue()}else c(t)}},C.onupgradeneeded=function(){k=this.result,(S=k.createObjectStore("StepBattle")).createIndex("bid","bid",{unique:!0}),S.createIndex("data","data"),S.createIndex("solve","solve",{unique:!1})}):c(t)}})}(jQuery,window,document);