!function(x,u,C){x.cachedScript=x.cachedScript||function(e,t){return x.ajax(x.extend(t||{},{dataType:"script",cache:!0,url:e}))},x(function(){const t=C.querySelector(".craft-header-section"),s=C.querySelector(".scrolling-section");let n=scrollY;x(u).on("scroll",function(e){requestAnimationFrame(()=>{scrollY>n?115<=scrollY&&(s.style.marginTop="150px",t.classList.add("min")):scrollY<115&&(s.style.marginTop="0",t.classList.remove("min")),n=scrollY})})});let h=new IntersectionObserver(e=>{N(!e[0].isIntersecting)},{threshold:1});let o,r,k,S=[],q,m,b,f,n,a,l;const g="findsvoc-idb",y=1;let v,w,E,O=[];function t(){var e=r?"/"+ntoa(r):"",e=`/craft/battle/${o}${e}/next`;x.getJSON(e,function(n){0==(S=n).length?alert("조회된 문제가 없습니다."):0==m?(v=u.indexedDB.open(g,y)).onsuccess=function(){var e=(w=this.result).transaction(["StepBattle"],"readwrite");E=e.objectStore("StepBattle");let s=0;!function e(){if(s<n.length){const t=n[s++];E.add({bid:t.bid,data:t,solve:""},t.bid).onsuccess=e}else c()}()}:c()}).fail(()=>alert("새로운 문제를 조회할 수 없습니다."))}function c(){k=S.shift(),O=[];var e=(q=C.getElementById("battle-"+k.battleType)).querySelector(".ask"),t=q.querySelector(".simple-ask-block");const a=q.querySelector(".sentence"),r=k.eng;var s=JSON.parse(k.answer||"[]");const n=JSON.parse(k.example||"[]");let l=0,c,i=[];const d=[];switch(scrollTo(0,0),C.querySelector(".craft-header-section").classList.remove("min"),C.querySelector(".scrolling-section").style.marginTop="0",x(q).find(".battle-type-block, .ask-block").show(),x(q).find(".simple-ask-block").hide(),q.querySelector(".battle-type").textContent=k.battleType,x("#save-btn").toggleClass("reverse",Boolean(k.saved)),q.querySelector(".example-btn-section")&&(q.querySelector(".example-btn-section").style.display=""),x(q).show().siblings(".battle-section").hide(),anime({targets:q,duration:1e3,delay:300,left:["100vw",0]}),N(!0),x(q).find(".explain-section").hide().find(".collapse").collapse("hide"),k.battleType){case"1":e.textContent=`다음 문장의 ${k.ask}를 선택하세요.`,t.textContent=e.textContent,n.forEach(([e,t],s,n)=>{(c=r.substring(l,e))&&d.push(c),d.push({el:"span",role:"button",className:"option",textContent:r.substring(e,t),onclick:function(){x(this).toggleClass("selected"),N(0==a.querySelectorAll(".selected").length)}}),s==n.length-1&&t<r.length&&d.push(r.substring(t)),l=t}),a.replaceChildren(createElement(d));break;case"2":k.ask.includes("모든")?e.textContent=`${k.ask.includes("피수식")?"피수식어":"수식어"}를 모두 선택하세요.`:e.textContent=`[${k.ask}] 수식어와 피수식어를 선택하세요.`,t.textContent=e.textContent;var[o,p]=s;const m={el:"span",role:"button",onclick:function(){var e;this.matches(".selected")?(e=O.indexOf(this),O.splice(e,1)[0].classList.remove("selected"),k.ask.includes("모든")||(e=e<2*Math.floor(e/2)+(1-e%2)?e:e-1,O[e]&&O.splice(e,1)[0].classList.remove("selected"))):(this.classList.add("selected"),O.push(this)),N(0==O.length)}};Array.from(o,e=>e.concat("modifier")).concat(Array.from(p,e=>e.concat("modificand"))).sort(([e],[t])=>e-t).forEach(([e,t,s],n,a)=>{(c=r.substring(l,e))&&(c.includes(" ")?Array.from(c.split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},m)).forEach(e=>d.push(e," ")):d.push(c," ")),d.push(Object.assign({className:s+" d-inline-block",textContent:r.substring(e,t)},m)),t<r.length&&d.push(" "),n==a.length-1&&t<r.length&&(-1<r.indexOf(" ",t)?Array.from(r.substring(t).split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},m)).forEach(e=>d.push(e," ")):d.push(r.substring(t))),l=t}),a.replaceChildren(createElement(d));break;case"3":var[[o,p],u,h]=n;(c=r.substring(l,o))&&d.push(c),i=[u,h].sort(()=>Math.random()-.5),d.push({el:"span",className:"pick-right","data-answer":u,children:["[ ",{el:"span",class:"pick-option",textContent:i[0]}," / ",{el:"span",class:"pick-option",textContent:i[1]}," ]"]}),p<r.length&&d.push(r.substring(p)),a.replaceChildren(createElement(d)),q.querySelector(".example-btn-section").replaceChildren(createElement(Array.from(i,e=>({el:"button",className:"btn btn-outline-fico",textContent:e,onclick:function(){x(this).addClass("active").siblings().removeClass("active"),N(!1)}}))));break;case"4":const[[b,f],g,y]=s;n.sort(([e],[t])=>e-t).forEach(([e,t],s,n)=>{(c=r.substring(l,e))&&d.push(c);let a=r.substring(e,t);var o={el:"span",className:"option text-decoration-underline",textContent:a};b==e&&f==t&&(o.className="answer-wrong text-decoration-underline",o.textContent=y,a=y,o["data-answer"]=g),d.push(o),i.push({el:"button",className:"btn btn-outline-fico",textContent:a,onclick:function(){x(this).addClass("active").siblings().removeClass("active"),N(!1)}}),s==n.length-1&&t<r.length&&d.push(r.substring(t)),l=t}),a.replaceChildren(createElement(d)),q.querySelector(".example-btn-section").replaceChildren(createElement(i));break;case"5":a.replaceChildren(k.kor);const v=q.querySelector(".arranged-examples");n.sort(()=>Math.random()-.5).forEach(([e,t])=>{i.push({el:"span",className:"btn btn-outline-fico",textContent:r.substring(e,t),onclick:function(){if(!this.closest(".arranged-examples")&&!this.matches(".selected")){const t=this.cloneNode(!0),e=this.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",v.appendChild(t),this.parentElement.appendChild(e),anime({targets:e,top:[x(this).offset().top,x(t).offset().top],left:[x(this).offset().left,x(t).offset().left],easing:"linear",complete:()=>{e.remove(),t.style.visibility="visible"},duration:100}),t.onclick=()=>{const e=t.cloneNode(!0);t.style.visibility="hidden",e.style.position="fixed",v.appendChild(e),anime({targets:e,top:[x(t).offset().top,x(this).offset().top],left:[x(t).offset().left,x(this).offset().left],easing:"linear",complete:()=>{e.remove(),t.remove(),x(this).removeClass("selected pe-none"),N(v.childElementCount!=n.length)},duration:100})},x(this).addClass("selected pe-none")}N(v.childElementCount!=n.length)}})}),q.querySelector(".example-btn-section").replaceChildren(createElement(i)),v.replaceChildren(),x(v).sortable();break;case"6":n.sort(([[e]],[[t]])=>e-t).forEach(([[e,t],s],n,a)=>{(c=r.substring(l,e))&&d.push(c),s.split(/\s+/).forEach((e,t)=>{d.push((0<t?" ":"")+e.substring(0,1)),1<e.length&&d.push({el:"input",style:{width:e.length-1+"em"}})}),n==a.length-1&&t<r.length&&d.push(r.substring(t)),l=t}),q.querySelector(".ask-section .sentence.kor").textContent=k.kor,q.querySelector(".example-btn-section").replaceChildren(createElement(d))}}function i(e){b=e<13?"E":e<16?"M":e<19?"H":"C",(0==S.length?t:c)(),L()}function L(){var e=a;if(l=3500<f.correct?(n="대장",a=3501):2500<f.correct?(n="중장",a=2501,3501):2e3<f.correct?(n="소장",a=2001,2501):1600<f.correct?(n="준장",a=1601,2001):1300<f.correct?(n="대령",a=1301,1601):1100<f.correct?(n="중령",a=1101,1301):900<f.correct?(n="소령",a=901,1101):700<f.correct?(n="대위",a=701,901):600<f.correct?(n="중위",a=601,701):500<f.correct?(n="소위",a=501,601):400<f.correct?(n="상사",a=401,501):300<f.correct?(n="중사",a=301,401):200<f.correct?(n="하사",a=201,301):150<f.correct?(n="병장",a=151,201):100<f.correct?(n="상병",a=101,151):50<f.correct?(n="일병",a=51,101):20<f.correct?(n="이병",a=21,51):(n="훈련병",a=0,21),e<a){showFireworks({target:x(".battle-section:visible")[0],distance:100,size:10});const s=createElement({el:"img",src:`https://static.findsvoc.com/images/app/craft/${n}.png`,class:"position-absolute start-50 top-50 w-50",style:"transform: translate(-50%, -50%)"});C.body.appendChild(s),anime({targets:s,scale:[0,1],easing:"cubicBezier(0,2,1,2)",duration:1e3,complete:()=>setTimeout(()=>s.remove(),3e3)})}var e=C.querySelector(".progress-bar"),t=(100*(f.correct-a)/l).toFixed(1);e.ariaValueNow=t,e.textContent=t+"%",e.style.width=t+"%"}function N(e){anime({targets:".js-solve-btn,.js-next-btn",duration:500,easing:"easeOutQuart",left:e?"110%":"45%"})}x(C).on("click","#save-btn",function(){x.getJSON("/craft/battle/mybattle/save",{memberId:m,battleId:k.bid,save:!k.saved},e=>{k.saved=e,x(this).toggleClass("reverse",e);const t=createElement({el:"div",class:"toast align-items-center position-absolute end-0 top-0 mt-4 me-5 w-auto text-center",role:"alert","aria-live":"assertive","aria-atomic":"true","data-bs-autohide":"true","data-bs-delay":2e3,textContent:k.saved?"저장되었습니다.":"저장이 취소되었습니다."});this.appendChild(t),bootstrap.Toast.getOrCreateInstance(t).show(),t.addEventListener("hidden.bs.toast",()=>t.remove())})}).on("click",".js-solve-btn",function(){const n=q,t=JSON.parse(k.answer||"[]");var e=JSON.parse(k.example||"[]");let s=!0;switch(x(this).toggleClass("js-solve-btn js-next-btn").text("다음"),x(n).find(".ask-section,.example-btn-section,.arranged-examples").addClass("pe-none"),x(n).find(".battle-type-block, .ask-block, .simple-ask-block").fadeToggle(),k.battleType){case"1":const c=[];e.sort(([e],[t])=>e-t).forEach(([s,n],e)=>{null!=t.find(([e,t])=>s==e&&n==t)&&c.push(e)}),n.querySelectorAll(".option").forEach((e,t)=>{c.includes(t)?e.classList.add("right"):e.matches(".selected")&&(s=!1,e.classList.add("wrong"))});break;case"2":n.querySelectorAll(".option,.modifier,.modificand").forEach(e=>{k.ask.includes("모든")?e.matches(".modifier, .modificand")?e.classList.add("right"):O.includes(e)&&(s=!1,e.classList.add("wrong")):O.includes(e)?e.matches(O.indexOf(e)%2?".modifier":".modificand")?e.classList.add("right"):(e.classList.add("wrong"),s=!1):e.matches(".modifier, .modificand")&&(e.classList.add("right"),s=!1)});break;case"3":var a=n.querySelector(".example-btn-section .active"),o=a.textContent;const i=Array.from(n.querySelectorAll(".example-btn-section button")).indexOf(a);s=!!t.includes(o),n.querySelectorAll(".pick-right .pick-option").forEach((e,t)=>{t==i?e.classList.add(s?"right":"wrong"):s||e.classList.add("right")}),n.querySelector(".example-btn-section").style.display="none";break;case"4":const d=x(n).find(".example-btn-section .active").index(),p=[];e.sort(([e],[t])=>e-t).forEach(([s,n],e)=>{null!=t.find(([e,t])=>s==e&&n==t)&&p.push(e)}),n.querySelectorAll(".sentence .option,.sentence .answer-wrong").forEach((e,t)=>{p.includes(t)?e.classList.add("right"):t==d&&(s=!1,e.classList.add("wrong"))}),n.querySelector(".example-btn-section").style.display="none";break;case"5":s=n.querySelector(".arranged-examples").textContent.replace(/\W/g,"").trim()==k.eng.replace(/\W/g,"").trim(),n.querySelector(".arranged-examples").prepend(createElement({el:"div",className:"full-sentence",textContent:k.eng})),n.querySelector(".example-btn-section").style.display="none"}const r=createElement({el:"div",class:"js-result-msg result-toast",textContent:s?"정답입니다.":"오답입니다."});C.querySelector(".craft-header-section").append(r),anime.timeline({targets:r}).add({begin:()=>{r.style.visibility="visible",r.style.color="#00000000"},bottom:"-2rem",backgroundColor:s?"#00bcd4":"#f44336",width:["2rem","50%"],height:["0rem","2rem"],easing:"easeInOutExpo"}).add({color:"#FFF",easing:"linear"}).add({delay:2e3,begin:()=>r.style.transformOrigin="top",bottom:0,height:0,easing:"easeInOutExpo",complete:()=>r.remove()});var l={memberId:m,ageGroup:b,battleId:k.bid,correct:s,save:Boolean(k.saved)};x(n).find(".explain-section").show().find(".comment-section").text(k.comment),x.getJSON("/craft/battle/"+k.sentenceId,e=>{return t=k.eng,s=n.querySelector(".explain-section"),e=e,s.querySelector(".trans-section").replaceChildren(createElement(Array.from(e.korList,e=>({el:"span",className:"trans-text",textContent:e.kor})))),s.querySelector(".words-section").replaceChildren(createElement(Array.from(e.wordList,e=>({el:"span",class:"one-word-unit-section",children:[{el:"span",class:"title",textContent:e.title}].concat(Array.from(e.senseList,e=>({el:"span",class:"one-part-unit-section",children:[{el:"span",class:"part",textContent:e.partType},{el:"span",class:"meaning",textContent:e.meaning}]})))})))),x(s).find(".collapse").collapse("show"),tandem.showSemanticAnalysis(t,e.svocTag.svocBytes,x(s).find(".svoc-section").empty()).then(()=>h.observe(s.lastElementChild)),C.querySelector(".craft-header-section").classList.remove("min"),C.querySelector(".scrolling-section").style.marginTop="0",void scrollTo(0,75);var t,s}),x.ajax({url:"/craft/battle/evaluation/add",type:"GET",contentType:"application/json",data:l,success:()=>{s&&f.correct++,0==m&&((v=u.indexedDB.open(g,y)).onsuccess=function(){var e=(w=this.result).transaction(["StepBattle"],"readwrite");(E=e.objectStore("StepBattle")).index("bid").openCursor().onsuccess=function(){var e,t=this.result;t&&(t.key==k.bid?((e=t.value).solve=s?"O":"X",t.update(e)):t.continue())}}),N(!0),L()},error:()=>alert("채점 전송에 실패했습니다. 재로그인 후 다시 시도해 주세요.")})}).on("click",".js-next-btn",function(){x(this).toggleClass("js-solve-btn js-next-btn").text("확인"),x(q).find(".ask-section,.example-btn-section,.arranged-examples").removeClass("pe-none"),h.disconnect(),(0<S.length?c:t)()}).on("shown.bs.collapse",".svoc-section",function(){tandem.correctMarkLine(this.querySelector(".semantics-result"))}),u.craft=Object.assign({},u.craft,{initPlayer:function(e,t,s,n,a){m=e,r=n,o=s,f=a,0==m?(C.querySelector("#save-btn").disabled=!0,f={numOfTest:0,correct:0,incorrect:0},(v=u.indexedDB.open(g,y)).onsuccess=function(){var e=(w=this.result).transaction(["StepBattle"],"readonly");E=e.objectStore("StepBattle"),(v=E.openCursor()).onsuccess=function(){var e=this.result;if(e){switch(e.value.solve){case"O":f.correct++;break;case"X":f.incorrect++;break;default:S.push(e.value.data)}e.continue()}else i(t)}},v.onupgradeneeded=function(){w=this.result,(E=w.createObjectStore("StepBattle")).createIndex("bid","bid",{unique:!0}),E.createIndex("data","data"),E.createIndex("solve","solve",{unique:!1})}):i(t)}})}(jQuery,window,document);