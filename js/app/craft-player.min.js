!function e(k,t,E){if(k.cachedScript=k.cachedScript||function(e,t){return k.ajax(k.extend(t||{},{dataType:"script",cache:!0,url:e}))},"undefined"==typeof createElement)k.cachedScript("https://static.findsvoc.com/js/util/DOM-util.min.js",{success:()=>e(k,t,E)});else{let a,r,C,N=[],i,o,v=[];function u(){var e=r?"/"+ntoa(r):"",e=`/craft/battle/${a}${e}/next`;k.getJSON(e,function(e){N=e,s()})}function s(){C=N.shift(),v=[];const c=E.getElementById("battle-"+C.battleType),e=(c.querySelector(".battle-type").textContent=C.battleType,k(c).show().siblings().hide(),c.querySelector(".ask")),a=c.querySelector(".sentence"),l=C.eng;var t=JSON.parse(C.answer||"[]");const s=JSON.parse(C.example||"[]");let i=0,o,u=[];const d=[];switch(C.battleType){case"1":e.textContent=`다음 문장의 ${C.ask}를 선택하세요.`,s.forEach(([e,t],s,n)=>{(o=l.substring(i,e))&&d.push(o),d.push({el:"span",role:"button",className:"option",textContent:l.substring(e,t),onclick:function(){k(this).toggleClass("selected"),k(c).find(".js-solve-btn").prop("disabled",0==a.querySelectorAll(".selected").length)}}),s==n.length-1&&t<l.length&&d.push(l.substring(t)),i=t}),a.replaceChildren(createElement(d));break;case"2":e.textContent=`[${C.ask}] 수식어와 피수식어를 선택하세요.`;var[n,r]=t;const p={el:"span",role:"button",onclick:function(){var e;this.matches(".selected")?(e=v.indexOf(this),v.splice(e,1)[0].classList.remove("selected"),e=e<2*Math.floor(e/2)+(1-e%2)?e:e-1,v[e]&&v.splice(e,1)[0].classList.remove("selected")):(this.classList.add("selected"),v.push(this)),c.querySelector(".js-solve-btn").disabled=0==v.length}},h=Array.from(n,e=>e.concat("modifier")).concat(Array.from(r,e=>e.concat("modificand")));h.sort(([e],[t])=>e-t).forEach(([e,t,s],n,a)=>{(o=l.substring(i,e))&&(o.includes(" ")?Array.from(o.split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},p)).forEach(e=>d.push(e," ")):d.push(o," ")),d.push(Object.assign({className:s+" d-inline-block",textContent:l.substring(e,t)},p)),t<l.length&&d.push(" "),n==a.length-1&&t<l.length&&(-1<l.indexOf(" ",t)?Array.from(l.substring(t).split(" ").filter(e=>0<e.length),e=>Object.assign({className:"option d-inline-block",textContent:e},p)).forEach(e=>d.push(e," ")):d.push(l.substring(t))),i=t}),a.replaceChildren(createElement(d));break;case"3":const[[b,m],g,f]=s;(o=l.substring(i,b))&&d.push(o),u=[g,f].sort(()=>Math.random()-.5),d.push({el:"span",className:"pick-right","data-answer":g,textContent:`[ ${u.join(" / ")} ]`}),m<l.length&&d.push(l.substring(m)),a.replaceChildren(createElement(d)),c.querySelector(".example-btn-section").replaceChildren(createElement(Array.from(u,e=>({el:"button",className:"btn btn-outline-secondary w-100",textContent:e,onclick:function(){k(this).addClass("active").siblings().removeClass("active"),c.querySelector(".js-solve-btn").disabled=!1}}))));break;case"4":const[[y,x],S]=t;s.sort(([e],[t])=>e-t).forEach(([e,t],s,n)=>{(o=l.substring(i,e))&&d.push(o);var a=l.substring(e,t);const r={el:"span",className:"option text-decoration-underline",textContent:a};y==e&&x==t&&(r.className="answer-wrong text-decoration-underline",r["data-answer"]=S),d.push(r),u.push({el:"button",className:"btn btn-outline-secondary w-100",textContent:a,onclick:function(){k(this).addClass("active").siblings().removeClass("active"),c.querySelector(".js-solve-btn").disabled=!1}}),s==n.length-1&&t<l.length&&d.push(l.substring(t)),i=t}),a.replaceChildren(createElement(d)),c.querySelector(".example-btn-section").replaceChildren(createElement(u));break;case"5":a.replaceChildren(C.kor),s.sort(()=>Math.random()-.5).forEach(([e,t])=>{u.push({el:"button",className:"btn btn-outline-secondary",textContent:l.substring(e,t),onclick:function(){(this.closest(".arranged-examples")?c.querySelector(".example-btn-section"):c.querySelector(".arranged-examples")).appendChild(this),c.querySelector(".js-solve-btn").disabled=0==c.querySelector(".arranged-examples").childElementCount}})}),c.querySelector(".example-btn-section").replaceChildren(createElement(u))}c.querySelector(".source").textContent=C.source}function d(e,s){let n=0,a=[];return e.childNodes.forEach(e=>{var t=e.textContent.replaceAll(/[\n\u200b]/gm,"").length;e.className&&("string"==typeof s?e.matches(s):e==s)&&a.push([n,n+t]),n+=t}),a}k(E).on("click",".js-solve-btn",function(){this.disabled=!0;const n=this.closest(".battle-section"),a=JSON.parse(C.answer||"[]"),e=JSON.parse(C.example||"[]");let r=!0;switch(C.battleType){case"1":const l=[];e.sort(([e],[t])=>e-t).forEach(([s,n],e)=>{null!=a.find(([e,t])=>s==e&&n==t)&&l.push(e)}),n.querySelectorAll(".option").forEach((e,t)=>{l.includes(t)?e.className="text-primary":e.matches(".selected")&&(r=!1,e.className="text-danger")});break;case"2":let[t,s]=Array.from(a,e=>Array.from(e,e=>JSON.stringify(e)));n.querySelectorAll(".option").forEach(e=>{t.includes(JSON.stringify(d(n,e)[0]))||s.includes(JSON.stringify(d(n,e)[0]))?e.className="text-primary":e.matches(".selected")&&(r=!1,e.className="text-danger")});break;case"3":var c=n.querySelector(".example-btn-section .active").textContent;r=!!a.includes(c);break;case"4":c=k(n).find(".example-btn-section .active").index();r=c==Array.from(e,e=>JSON.stringify(e)).indexOf(JSON.stringify(a[0]));break;case"5":r=n.querySelector(".arranged-examples").textContent.replace(/\W/g,"").trim()==C.eng.replace(/\W/g,"").trim()}var t={memberId:i,ageGroup:o,battleId:C.bid,correct:r,save:!1};k.ajax({url:"/craft/battle/play/submit",type:"POST",contentType:"application/json",data:JSON.stringify(t),success:()=>{(0<N.length?s:u)()},error:()=>alert("채점 전송에 실패했습니다. 재로그인 후 다시 시도해 주세요.")})}),t.craft=Object.assign({},t.craft,{initPlayer:function(e,t,s,n){i=e,r=n,a=s,o=t<13?"E":t<16?"M":t<19?"H":"C",u()}})}}(jQuery,window,document);