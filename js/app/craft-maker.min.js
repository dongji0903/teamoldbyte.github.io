!function e(O,q,I){if(O.cachedScript=O.cachedScript||function(e,t){return O.ajax(O.extend(t||{},{dataType:"script",cache:!0,url:e}))},"undefined"==typeof createElement)O.cachedScript("https://static.findsvoc.com/js/util/DOM-util.min.js",{success:()=>e(O,q,I)});else{let u,v={},o=[],d=[],a=[],y=[],p={step:[{bbid:10000001,title:"단계별 배틀"}]},k,x,n=0,N;const H="data-battle-type",F="(코멘트 없음)";let m=[],f=[],S=(O.getJSON("https://static.findsvoc.com/data/craft/maker-toolbar.json",e=>{v=e,u=createElement(e.craftPanel),o=e.battleAsks,d=e.battleTypeInfos,a=e.commonEditorBtns}),{}),w={},C={},l=createElement({el:"div",className:"btn-toolbar row col-md-3",role:"toolbar"});O(I).on("click",".battle-type-section .btn, .battle-diffLevel-section .btn, .battle-category-section select",function(){let n={};var e=this.closest(".add-battle-section");let o=e.querySelector(".battles-counter-section"),a;o||(o=createElement(v.battleCounterPanel),O.getJSON("/craft/battle/stats/total",e=>{o.querySelector(".counter-total").textContent=e+"건"}).fail(()=>alertModal("전체 배틀 갯수를 조회할 수 없습니다.")),e.querySelector(".battle-type-section").before(o)),n=this.matches(".battle-type-section .btn")?(a="type",{battleType:I.getElementById(this.htmlFor).value}):this.matches(".battle-diffLevel-section .btn")?(a="level",{diffLevel:P(I.getElementById(this.htmlFor).value,e.querySelector(".battle-context").textContent.trim().length)}):(a="gc",{categoryId:parseInt(this.value)}),O.getJSON("/craft/battle/stats/"+a,n,function(e){let t;switch(a){case"type":(t=o.querySelector(".counter-same-type")).replaceChildren(createElement(Array.from(e,(e,t)=>[{el:"label",className:"bg-fc-yellow col-auto ms-2 rounded-pill",textContent:"#"+(t+1)},{el:"span",className:"col-auto ps-1 pe-0",textContent:e+"건"}])));break;case"level":(t=o.querySelector(".counter-same-difflevel")).replaceChildren(createElement([{el:"span",className:"col-auto",textContent:n.diffLevel+`: ${e}건`}]));break;case"gc":(t=o.querySelector(".counter-same-category")).replaceChildren(createElement({el:"span",className:"col-auto",textContent:y.find(e=>e.cid==n.categoryId).title+`: ${e}건`}))}null!=O.fn.bounce&&O(t).bounce()}).fail(()=>alertModal("배틀 갯수 조회에 실패했습니다."))}).on("change",".select-book-type",function(){const t=this.value;var e=O(this).closest(".add-battle-section");const n=e.find(".select-book");if("new"==this.value){if(O.cachedScript("https://cdn.jsdelivr.net/npm/compressorjs/dist/compressor.min.js",{success:()=>Compressor.setDefaults({quality:.8,width:210,height:315,maxWidth:210,maxHeight:315,resize:"cover"})}),e.find(".battle-book-section,.add-book-section").collapse("toggle"),n.empty(),this.value="",!O(this).data("bookPanelOpened")){e=e.find(".add-book-section");openSummernote(e.find(".input-book-desc"));const a="_"+(new Date).getTime();e.find('input[type="radio"]').each(function(){this.name+=a,this.id+=a}),e.find("label[for]").each(function(){this.htmlFor+=a}),O(this).data("bookPanelOpened",!0)}}else p[t]?o():O.getJSON(`/craft/battlebook/my/${this.value}/list`,e=>{p[t]=e,o()});function o(){n[0].replaceChildren(createElement(Array.from(p[t],e=>({el:"option",value:e.battleBookId,textContent:e.title||"제목 없음"}))))}}).on("click",".js-edit-battlebook-cover",function(e){O(this).find(".input-book-cover").trigger("click")}).on("click",".input-book-cover",function(e){e.stopPropagation()}).on("change",".input-book-cover",function(e){const t=O(this).closest(".add-book-section").find(".battlebook-cover-preview");let n=e.target.files[0];if(null==n)return!1;const o=new FileReader;o.onload=function(){t.css("background-image",`url(${this.result})`).css("opacity","1"),URL.revokeObjectURL(o.result),t.siblings(".js-cancel-battlebook-cover").show()},new Compressor(n,{success(e){o.readAsDataURL(e)},error(e){o.readAsDataURL(n)}})}).on("click",".js-cancel-battlebook-cover",function(e){e.preventDefault(),e.stopPropagation(),O(this).closest(".add-book-section").find(".battlebook-cover-preview").css("background-image","").siblings(".input-book-cover").val(null)[0].checkValidity(),O(this).hide()}).on("click",".js-cancel-add-book",function(){O(this).closest(".add-battle-section").find(".battle-book-section,.add-book-section").collapse("toggle")}).on("click",".js-add-battlebook",function(){const t=O(this).closest(".add-book-section");var e=t.find(".input-book-cover")[0];const n={T:"theme",G:"grammar"}[t.find(".input-book-type:checked").val().toUpperCase()];let o=new FormData(t[0]);if(t[0].checkValidity()){const l=[];function a(){O.ajax({type:"POST",url:"/craft/battlebook/add",data:o,processData:!1,contentType:!1,success:function(e){(alertModal||alert)("배틀북을 등록했습니다."),p[n]&&p[n].push(Object.assign({battleBookId:e.bbid},e)),t.closest(".add-battle-section").find(".select-book-type").val(n).trigger("change"),t.add(t.prev()).collapse("toggle"),t[0].reset(),t.find('.input-book-type[value="T"]').prop("checked",!0),t.find('.input-open-type[value="R"]').prop("checked",!0),t.find(".input-book-price").val(0),t.find(".battlebook-cover-preview").css("background-image",""),t.find(".input-book-desc").summernote("reset")},error:function(){(alertModal||alert)("배틀북 등록에 실패했습니다.")}})}o.forEach((e,t)=>{t.match(/_\d+/)&&(o.append(t.replace(/_\d+/,""),e),l.push(t))}),l.forEach(e=>o.delete(e)),o.append("ownerId",N),o.delete("files"),e.value?new Compressor(e.files[0],{success(e){o.delete("coverImage"),o.append("coverImage",e,e.name),a()},error(e){a()}}):(o.delete("coverImage"),a())}}).on("change",".battle-type-section input[type=radio]",function(){var e=O(this).closest(".battle-section-panel").data("semantics");h(this.closest(".add-battle-section").querySelector(".craft-maker-container"),e,parseInt(this.value))}).on("change",".ask-select",function(){var e=this.closest(".add-battle-section"),t=this.querySelector("option:checked"),n=t.dataset.tag,o=e.querySelector(".askTag"),o=(o.value=n||"",e.querySelector(".battle-type-section input:checked").value);"2"==o&&(t.value.includes("의 피수식")||t.value.includes("의 수식"))&&(n=t.value.includes("의 피수식")?"피수식":"수식",e=t.value.replace("의 "+n,""),null!=(o=prompt(`???의 ${n}어를 고르세요.
???에 들어갈 단어를 입력하세요.`,e))&&0<o.length?(t.value=o+"의 "+n,t.innerHTML=`(지정)${o}의 ${n}어를 선택하세요.`):t.selected=!1)}).on("change",".battle-category-section select",function(){this.closest(".add-battle-section").querySelector(".askTag").value=C[parseInt(this.value)]||""}).on("change",".battle-maker [role=toolbar] [type=checkbox]",function(){var e=this.closest(".battle-maker");this.checked?(e.dataset.wrapper=this.value,this.closest("[role=toolbar]").querySelectorAll("[type=checkbox]:checked").forEach(e=>{0!=this.compareDocumentPosition(e)&&(e.checked=!1)}),getSelection().isCollapsed||E(this.closest(".battle-maker"))):e.dataset.wrapper=""}).on("click",".battle-context *",function(){this.closest(".battle-maker")&&("SPAN"==this.nodeName?("7"==this.closest(".battle-context").dataset.battleType&&(this.closest(".battle-maker").querySelector(".select-kor .custom-trans")?.remove(),this.closest(".battle-maker").querySelector(".select-kor").classList.remove("pe-none")),this.outerHTML=this.innerHTML):this.remove())}).on("click",".battle-maker [value=undo], .battle-maker [value=redo]",function(){var e="undo"==this.value,t=(e?m:f).pop(),n=this.closest(".battle-maker"),o=n.querySelector(".battle-context");(e?f:m).push(o.innerHTML),o.innerHTML=t,O(o).animate({opacity:.5},100).animate({opacity:1},100),n.querySelector("[value=undo]").disabled=0==m.length,n.querySelector("[value=redo]").disabled=0==f.length}).on("keyup",function(e){var t=e.target.closest(".battle-maker");t&&(e.ctrlKey&&"Z"==e.key.toUpperCase()?O(t).find("[value=undo]").trigger("click"):e.ctrlKey&&"Y"==e.key.toUpperCase()&&O(t).find("[value=redo]").trigger("click"))}).on("input change",".add-battle-section :input,.add-battle-section textarea",function(){O(this.closest(".add-battle-section")).find(".js-add-battle").prop("disabled",!1)}).on("change",".select-kor",function(){this.closest(".battle-maker").querySelector(".kor-answer")&&(this.closest(".battle-maker").querySelector(".kor-answer").value=this.selectedOptions[0].text)}).on("click",".js-add-battle",function(){const l=this.closest(".add-battle-section"),s=parseInt(l.querySelector(".select-book").value);if(Number.isNaN(s))alertModal("❗배틀북을 선택해 주세요.");else{const c=l.closest(".battle-section-panel"),r=l.querySelector(".battle-context"),d=parseInt(l.querySelector(".battle-category-section select").value),u=l.querySelector(".battle-type-section input:checked").value;var e=l.querySelector(".battle-diffLevel-section input:checked").value,t=l.querySelector(".ask-select").value.trim();const p=l.querySelector(".askTag").value.trim();var n=l.querySelector(".comment").value.trim();const m=l.querySelector(".source").value.trim();var o=r.textContent.trim().length;if(1500<n.length)alertModal("배틀 해설의 길이가 너무 깁니다.");else{const f={battleBookId:s,categoryId:d,battleType:u,ask:t,askTag:p,comment:n,source:m,diffLevel:e,engLength:o,sentenceId:O(c).data("sentenceId"),memberId:N,example:"",answer:"",diffSpecificLevel:P(e,o)};switch(u){case"1":var[a,i]=[L(r,".answer, .option"),L(r,".answer")];if(0==i.length)return void alertModal("문제로 만들 어구를 선택해 주세요.");if(a.length==i.length)return void alertModal("오답 보기를 선택해 주세요.");Object.assign(f,{example:JSON.stringify(a),answer:JSON.stringify(i)});break;case"2":a=L(r,".modifier"),i=L(r,".modificand");if(t.includes("모든 피수식")&&(0<a.length||0==i.length))return void alertModal("피수식어만 1개 이상 선택해 주세요.");if(t.includes("모든 수식")&&(0<i.length||0==a.length))return void alertModal("수식어만 1개 이상 선택해 주세요.");if(!t.includes("모든")&&0==(a.length&&i.length))return void alertModal("수식어/피수식어를 1쌍 이상 선택해 주세요.");f.answer=JSON.stringify([a,i]);break;case"3":a=r.querySelector(".pick-right");if(!a)return void alertModal("문제로 만들 어구를 선택해 주세요.");f.example=JSON.stringify([L(r,".pick-right")[0],a.textContent.trim(),a.dataset.wrong.trim()]),f.answer=JSON.stringify([a.textContent.trim()]);break;case"4":i=r.querySelector(".answer-wrong");if(null==r.querySelector(".option"))return void alertModal("오답 보기를 선택해 주세요.");if(!i)return void alertModal("문제로 만들 어구를 선택해 주세요.");f.example=JSON.stringify(L(r,".option, .answer-wrong")),f.answer=JSON.stringify([L(r,".answer-wrong")[0],i.textContent.trim(),i.dataset.wrong.trim()]);break;case"5":if(0==r.querySelectorAll(".option").length)return void alertModal("보기를 추가해 주세요.");f.ask=l.querySelector(".select-kor").value,f.example=JSON.stringify(L(r,".option"));break;case"6":{if(null==r.querySelector(".fill-right"))return void alertModal("문제로 만들 어구를 선택해 주세요.");const h=r.querySelectorAll(".fill-right");f.ask=l.querySelector(".select-kor").value,f.example=JSON.stringify(Array.from(L(r,".fill-right"),(e,t)=>[e,h[t].textContent.trim()]));break}case"7":{0<r.querySelectorAll(".option").length?f.ask=JSON.stringify(L(r,".option")):f.ask=JSON.stringify([[0,o]]);const b=l.querySelector(".kor-answer");if(!b.value)return void alertModal("정답 해석을 입력해 주세요.",()=>b.focus());f.answer=JSON.stringify(l.querySelector(".kor-answer").value.trim().split(/\s*\/\s*/)),f.example=JSON.stringify(l.querySelector(".battle-opt-ext").value.trim().split(/\s*\/\s*/));break}case"8":{a=r.querySelector(".pick-right");const g=l.querySelector(".battle-opt-ext");if(!a)return void alertModal("문제로 만들 어구를 선택해 주세요.");if(!g.value.trim().split(/\s*\/\s*/).join(""))return void alertModal("오답 보기를 입력해 주세요.",()=>g.focus());f.example=JSON.stringify([L(r,".pick-right")[0],a.textContent.trim(),g.value.trim().split(/\s*\/\s*/)]),f.answer=JSON.stringify([a.textContent.trim()]);break}}O.ajax({url:"/craft/battle/add",type:"POST",contentType:"application/json",data:JSON.stringify(f),success:function(e){D(p,S),D(m,w),C[d]=p,l.querySelector(".select-kor .custom-trans")&&(l.querySelector(".select-kor .custom-trans").remove(),l.querySelector(".select-kor").classList.remove("pe-none")),I.getElementById("craftResultModal")||I.body.appendChild(createElement(v.addResultModal)),O(l).find("textarea.comment").summernote("reset"),O("#craftResultModal .battle-id").text(e.battleId),O("#craftResultModal .group-count").text(e.groupCount),k={type:l.querySelector(".select-book-type").value,bookId:s},!x&&0<f.source.length&&q.location.pathname.startsWith("/workbook/passage")&&(x=f.source),r.replaceChildren(r.textContent),f.battleId=e.battleId,f.grammarTitle=y.find(e=>e.cid==d).title;var e=c.querySelector(".existing-battles-section"),t=A(O(c).data("eng"),f);let n=e.querySelector(`.js-open-existing-battle[${H}="${u}"]`),o;n?(a=n.querySelector(".battle-count"),n.appendChild(createElement({el:"span",class:"badge bg-danger",textContent:"New"})),a.textContent=parseInt(a.textContent)+1,o=I.querySelector(n.dataset.bsTarget)):(e.querySelector(`[${H}]`)||e.replaceChildren(),a=Date.now()+1,[n,o]=M(u,1,a,[]),n=createElement(n),o=createElement(o),e.append(n),O(n).css("height",0).animate({height:"100%"},500,function(){this.style.height="auto"}),n.appendChild(createElement({el:"span",class:"badge bg-danger",textContent:"New"})),e.append(o));var a=createElement(t);O(a).find(".js-delete-battle").after(createElement({el:"span",class:"badge bg-danger",textContent:"New"})),o.append(a),O(a).css("display","none").slideDown(),O("#craftResultModal").modal("show").on("hidden.bs.modal",()=>{n.scrollIntoView({behavior:"instant",block:"nearest"})})},error:function(e){alertModal(e)}})}}}).on("click",".js-delete-battle",function(){const n=this.closest(".battle-preview-one"),o=n.closest(".battle-preview"),a=o.previousElementSibling;var e=n.dataset.battleId;O.post("/craft/battle/del/"+e,function(){alertModal("배틀이 삭제되었습니다."),n.remove();var e=a.querySelector(".battle-count"),t=parseInt(e.textContent)-1;0<t?e.textContent=t:(o.remove(),a.remove())}).fail(()=>alertModal("배틀 삭제에 실패했습니다."))});const $=/[^\s,.!?;:…]/,_=/^(\s|[,.!?;:…])/,W=/(\s|[,.!?;:…])$/,U=/('m|'re|'s|'d|'ll|'ve)$/,s={A:[{limit:30,rank:"이병"},{limit:60,rank:"일병"},{limit:1/0,rank:"병장"}],B:[{limit:50,rank:"하사"},{limit:70,rank:"상사"},{limit:100,rank:"소위"},{limit:120,rank:"대위"},{limit:1/0,rank:"소령"}],C:[{limit:150,rank:"대령"},{limit:200,rank:"준장"},{limit:1/0,rank:"소장"}]};function h(e,t,n){e.replaceChildren(),f=[],m=[];var o=createElement({el:"div",className:"battle-maker row",tabIndex:0}),e=(e.append(o),Array.from(d)[n-1]),a=([1,2].includes(n)&&e.forEach(e=>{null!=e.selector&&null!=t.querySelector(".sem"+e.selector)&&(e.recommended=!0)}),j(n,o),tandem?.cleanSvocDOMs(t).textContent),l=a.length;{var s=l,i=o;const c=Date.now(),r={el:"div",className:"battle-diffLevel-section col-12 col-md-3 row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"난이도"}]};[{text:"쉬움",value:"A"},{text:"보통",value:"B"},{text:"어려움",value:"C"}].forEach(function(e,t){var n=2==t&&150<s||1==t&&s<=150&&80<s||0==t;r.children.push({el:"input",type:"radio",autocomplete:"off",name:"btnRadioBattleLevel"+c,id:"btnRadioBattleLevel"+c+t,className:"btn-check battle-level-select",checked:n,value:e.value}),r.children.push({el:"label",textContent:e.text,"data-bs-toggle":n?"tooltip":"",htmlFor:"btnRadioBattleLevel"+c+t,"data-bs-html":"true","data-bs-title":"문장 길이로 시스템이 파악한<br>최소 난이도입니다.","data-bs-trigger":"manual",className:"col btn col-auto px-4 ms-1 rounded-pill btn-outline-fico"})}),T(r,i)}o.appendChild(createElement([{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"길이"},{el:"span",className:"col-auto my-auto eng-length",textContent:l}])),o.prepend(createElement({el:"div",className:"col-12 col-md-3 row",children:[{el:"label",textContent:"질문",className:"col-auto lh-1 my-auto text-fc-purple fw-bold"},{el:"select",className:"form-select ask-select col",children:b(n,e)}]})),[1,2].includes(n)&&(i=o.closest(".add-battle-section").querySelector(".ask-select"),O(i).trigger("change")),[3,4,5].includes(n)&&(l=o.closest(".add-battle-section")?.querySelector(".battle-category-section select"),O(l).trigger("change")),g(a,o),o.querySelector(".battle-context").dataset.battleType=n}function j(e,t){var n=v["battle"+e];l.innerHTML="",T(n,l);for(let e=0,t=a.length;e<t;e++)T(a[e],l);t.prepend(l.cloneNode(!0)),t.dataset.wrapper=t.querySelector(".btn-toolbar input:checked")?.value||"",[5,6,7].includes(e)&&t.appendChild(createElement({el:"div",className:"col-12 row mt-3",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"해석"},{el:"select",className:"select-kor form-select d-inline-block col",children:[{el:"option",value:"",textContent:"해석을 선택해 주세요.",disabled:!0,selected:!0}].concat(Array.from(O(t).closest(".battle-section-panel").data("transList"),({id:e,text:t})=>({el:"option",value:e,textContent:t.trim(),"data-trans":t.trim(),selected:!1})))}]})),7==e&&t.appendChild(createElement({el:"div",className:"col-12 row mt-3",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"정답"},{el:"input",type:"text",className:"kor-answer form-control d-inline-block col","data-bs-toggle":"tooltip",placeholder:"문장 혹은 문장의 일부에 대한 정답 해석을 선택하거나 직접 입력해 주세요. / 기호로 구분하여 보기에 표시됩니다. 예) 우리에게 불가능한/문장은/없습니다.",title:"문장 혹은 문장의 일부에 대한 정답 해석을 선택하거나 직접 입력해 주세요. / 기호로 구분하여 보기에 표시됩니다. 예) 우리에게 불가능한/문장은/없습니다.","data-bs-template":'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner w-max-100"></div></div>'}]})),[7,8].includes(e)&&(n="오답 보기로 추가할 단어나 구들을 입력해 주세요. / 기호로 구분됩니다. 예) "+(7===e?"우리가/우리를":"we/us"),t.appendChild(createElement({el:"div",className:"col-12 row mt-3",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"오답"},{el:"input",type:"text",className:"battle-opt-ext form-control col lh-1 my-auto",title:n,"data-bs-toggle":"tooltip","data-bs-template":'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner w-max-100"></div></div>',placeholder:n}]})))}function b(o,e){const a=[];return e.forEach((e,t)=>{var n={el:"option"};e.recommended&&(n.className="bg-fc-light-purple"),n.value=e.tag||"#"+o,e.tag&&(n["data-tag"]=e.tag),n.innerHTML=R(o,e.tag),0==t&&2!=o&&(n.selected=!0),a.push(n)}),2==parseInt(o)&&(e=null!=e.find(e=>e.recommended),a.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"의 피수식",innerHTML:"(지정)___의 피수식어를 선택하세요."}),a.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"의 수식",innerHTML:"(지정)___의 수식어를 선택하세요."}),a.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"모든 피수식",innerHTML:"피수식어를 모두 선택하세요."}),a.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"모든 수식",selected:!0,innerHTML:"수식어를 모두 선택하세요."})),a}function g(e,t,n){T({el:"div",className:"row pe-2",children:[{el:"label",className:"col-auto lh-1 my-auto text-white fw-bold",textContent:"본문"},{el:"div",className:"battle-context fs-5 bg-white mt-3 px-2 col form-control",children:n?B(e,n):e,onmouseup:()=>E(t)}]},t)}function E(e){var t=getSelection(),n=e.dataset.wrapper;if(!t.isCollapsed&&n){var o=e.querySelector(".battle-context");if(t.toString().replace(/\W/g,"")!=o.textContent.replace(/\W/g,"")&&8&t.anchorNode.compareDocumentPosition(o)&t.focusNode.compareDocumentPosition(o)){var a=parseInt(o.dataset.battleType);if(([3,4].includes(a)&&n.match(/pick-right|answer-wrong/)||7==a||8==a)&&0<o.getElementsByClassName(n).length)alertModal("이 유형의 배틀은 복수 정답을 허용하지 않습니다.\n기존 정답을 눌러 지워 주세요."),getSelection().removeAllRanges();else{for((t.anchorNode.compareDocumentPosition(t.focusNode)&Node.DOCUMENT_POSITION_PRECEDING||0==t.anchorNode.compareDocumentPosition(t.focusNode)&&t.anchorOffset>t.focusOffset)&&t.setBaseAndExtent(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset);0<t.anchorOffset&&t.anchorNode.textContent.charAt(t.anchorOffset).match($)&&t.anchorNode.textContent.charAt(t.anchorOffset-1).match($)&&(![1,3].includes(a)||!t.toString().trim().match(U));)t.setBaseAndExtent(t.anchorNode,t.anchorOffset-1,t.focusNode,t.focusOffset);for(;t.toString().match(_);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset+1,t.focusNode,t.focusOffset);for(;t.focusOffset<t.focusNode.textContent.length&&t.focusNode.textContent.charAt(t.focusOffset-1).match($)&&t.focusNode.textContent.charAt(t.focusOffset).match($)&&(![1,3].includes(a)||!(2<t.focusNode.textContent.length&&t.focusNode.textContent.substring(t.focusOffset,t.focusOffset+3).trim().match(U)));)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset+1);for(;t.toString().match(W);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset-1);if(0!=t.toString().trim().length&&t.toString().replace(/\W/g,"")!=o.textContent.replace(/\W/g,"")){l=o,m.push(l.innerHTML),f=[],l.closest(".battle-maker").querySelector('[role=toolbar] [value="undo"]').disabled=!1;for(var l=I.createElement("span"),s=(l.className=n,t.getRangeAt(0)),i=(l.textContent=s.extractContents().textContent,s.insertNode(l),t.removeAllRanges(),I.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>0===e.textContent.length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}));i.nextNode();)i.currentNode.parentNode.removeChild(i.currentNode);for(var c,r,d=I.createTreeWalker(o,NodeFilter.SHOW_ELEMENT);d.nextNode();){let e=d.currentNode["textContent"];e.startsWith(" ")&&(r=e.match(/^\s+/)[0],c=I.createTextNode(r),d.currentNode.parentNode.insertBefore(c,d.currentNode),d.currentNode.textContent=e.substring(r.length),e=d.currentNode.textContent),e.endsWith(" ")&&(c=e.match(/\s+$/)[0],r=I.createTextNode(c),d.currentNode.parentNode.insertBefore(r,d.nextSibling),d.currentNode.textContent=e.substring(0,e.length-c.length))}[3,4,7].includes(a)&&n.match(/pick-right|answer-wrong/)&&((s=prompt(l.textContent+"의 오답을 입력하세요."))?l.dataset.wrong=s:o.innerHTML=m.pop()),7==a&&((n=prompt("선택한 구간의 해석을 입력하세요."))?((l=e.querySelector(".select-kor .custom-trans")||e.querySelector(".select-kor").appendChild(createElement({el:"option",className:"custom-trans",selected:!0,children:["(출제자 해석) ",{el:"span",className:"custom-input"}]}))).value=n,l.dataset.trans=n,l.querySelector(".custom-input").textContent=n,e.querySelector(".kor-answer").value=n):o.innerHTML=m.pop())}}}}}function M(e,t,n,o){return[{el:"div",className:"js-open-existing-battle d-inline-block btn border",role:"button","data-battle-type":e,"data-bs-toggle":"collapse","data-bs-target":"#"+("existingBattleView"+n),children:[`Battle #${e}: `,{el:"span",className:"battle-count",textContent:t}," 건 ",{el:"span",className:"fold-icon text-xl align-middle"}]},{el:"div",id:"existingBattleView"+n,className:"battle-preview fade collapse",children:o}]}function T(e,t){!function o(a,l){Array.isArray(a)?a.forEach((e,t)=>a[t]=o(e,l)):"object"==typeof a&&Object.entries(a).forEach(([e,n])=>{n&&Array.isArray(n)&&n.forEach((e,t)=>n[t]=o(e,l)),a[e]=n});return l.apply(this,[a])}(e,e=>(e.className||"div"!=e.el?e.title&&"checkbox"!=e.type&&(e["data-toggle"]="tooltip",e["data-placement"]="bottom"):e.className="btn-group col-auto",e));e=createElement(e);e.querySelectorAll("[type=checkbox]").forEach(e=>{e.className||(e.className="btn-check");var t="btn-check-"+n++,t=(e.id=t,createElement({el:"label",htmlFor:t,className:"btn btn-outline-fico",textContent:e.textContent}));e.title&&(t.title=e.title,t.dataset.toggle="tooltip",t.dataset.placement="bottom"),e.after(t)}),t.append(e)}function L(e,n){let o=0,a=[];return e.childNodes.forEach(e=>{var t=e.textContent.replaceAll(/[\n\u200b]/gm,"").length;e.className&&e.matches(n)&&a.push([o,o+t]),o+=t}),a}function J(e,t){return e[0]-t[0]}function A(r,e){var t=Date.now();const{battleId:n,battleType:d,ask:u,answer:o,example:a,askTag:l,diffLevel:s,categoryId:i,memberId:c,engLength:p,sentenceId:m,grammarTitle:f,comment:h,source:b}=e,g={el:"div",dataset:{battleId:n,battleType:d,ask:u,answer:o,example:a,memberId:c,engLength:p,sentenceId:m},className:"battle-preview-one m-1 ms-0 bg-light border border-2 px-2",children:[{el:"div",className:"row",children:[{el:"div",className:"col-auto",children:[{el:"label",className:"fw-bold me-2",textContent:"질문:"},{el:"span",textContent:R(parseInt(d),u)}]},{el:"div",className:"diff-section col-auto position-relative","data-diff":s,onmouseover:N==c?function(){O(this).find(".js-open-edit-battle-diff").toggle(!O(this).find(".edit-diff-section").is(":visible"))}:"",onmouseleave:N==c?function(){O(this).find(".js-open-edit-battle-diff").hide()}:"",children:[{el:"label",className:"fw-bold me-2",textContent:"난이도:"},{el:"span",textContent:s},{el:"button",class:"js-open-edit-battle-diff btn btn-sm btn-fico",textContent:"수정",style:"display: none;",onclick:function(){const e=O(this).prev("span").hide();O(this).closest(".diff-section").find(".edit-diff-section").show().find("input").filter(function(){return this.value==e.text()}).prop("checked",!0)}}].concat(c==N?[{el:"div",class:"edit-diff-section",style:"display: none;",children:[{el:"input",type:"radio",id:"diff"+t,name:"diff"+t,class:"btn-check",value:"A"},{el:"label",htmlFor:"diff"+t,class:"col-auto btn btn-sm btn-outline-fico rounded-pill",textContent:"쉬움"},{el:"input",type:"radio",id:"diff"+(t+1),name:"diff"+t,class:"btn-check",value:"B"},{el:"label",htmlFor:"diff"+(t+1),class:"col-auto btn btn-sm btn-outline-fico rounded-pill",textContent:"보통"},{el:"input",type:"radio",id:"diff"+(t+2),name:"diff"+t,class:"btn-check",value:"C"},{el:"label",htmlFor:"diff"+(t+2),class:"col-auto btn btn-sm btn-outline-fico rounded-pill",textContent:"어려움"},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){O(this).closest(".edit-diff-section").hide(),O(this).closest(".diff-section").find("span").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){const e=O(this).siblings("input:checked").val();var t=O(this).closest(".battle-preview-one"),n=Object.assign({},t.get(0).dataset);n.battleId=parseInt(n.battleId),n.memberId=parseInt(n.memberId),n.sentenceId=parseInt(n.sentenceId),n.engLength=parseInt(n.engLength),n.categoryId=parseInt(t.find(".grammar-section")[0].dataset.cid),n.source=t.find(".source-section")[0].dataset.source,n.askTag=t.find(".tag-section")[0].dataset.tag,n.comment=t.find(".comment-section")[0].dataset.comment,O.ajax({url:"/craft/battle/edit",type:"post",contentType:"application/json",data:JSON.stringify(Object.assign({},n,{diffLevel:e})),success:()=>{alertModal("난이도를 수정했습니다.",()=>{O(this).closest(".edit-diff-section").hide(),O(this).closest(".diff-section").attr("data-diff",e).find("span").text(e).show()})},error:function(){alertModal("난이도 수정에 실패했습니다.")}})}}]}]:[])},{el:"div",className:"grammar-section col-auto position-relative","data-cid":i,onmouseover:N==c?function(){O(this).find(".js-open-edit-battle-grammar").toggle(!O(this).find(".edit-grammar-section").is(":visible"))}:"",onmouseleave:N==c?function(){O(this).find(".js-open-edit-battle-grammar").hide()}:"",children:[{el:"label",className:"fw-bold me-2",textContent:"문법:"},{el:"span",textContent:f||"(미입력)"},{el:"button",class:"js-open-edit-battle-grammar btn btn-sm btn-fico",textContent:"수정",style:"display: none;",onclick:function(){O(this).prev("span").hide();var e=O(this).closest(".grammar-section");e.find(".edit-grammar-section").show().find("select").val(e.attr("data-cid"))}}].concat(N==c?[{el:"div",class:"edit-grammar-section",style:"display: none;",children:[{el:"select",class:"form-select",children:Array.from(y,e=>({el:"option",value:e.cid,textContent:(e.parentCategory?"└─ ":"")+e.title,selected:e.cid==i}))},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){O(this).closest(".edit-grammar-section").hide(),O(this).closest(".grammar-section").find("span").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){const t=parseInt(O(this).siblings("select").val());O.ajax({url:"/craft/battle/edit/category",type:"post",contentType:"application/json",data:JSON.stringify({battleId:n,categoryId:t}),success:()=>{alertModal("문법 카테고리를 수정했습니다.",()=>{O(this).closest(".edit-grammar-section").hide(),O(this).closest(".grammar-section").attr("data-cid",t).find("span").text(y.find(e=>e.cid==t).title).show()})},error:function(){alertModal("문법 카테고리 수정에 실패했습니다.")}})}}]}]:[])},{el:"div",className:"col-auto source-section position-relative","data-source":b,onmouseover:N==c?function(){O(this).find(".js-open-edit-battle-source").toggle(!O(this).find(".edit-source-section").is(":visible"))}:"",onmouseleave:N==c?function(){O(this).find(".js-open-edit-battle-source").hide()}:"",children:[{el:"label",className:"fw-bold me-2",textContent:"출처:"},{el:"span",textContent:b||"(출처없음)"},{el:"button",class:"js-open-edit-battle-source btn btn-sm btn-fico",textContent:"수정",style:"display: none;",onclick:function(){O(this).prev("span").hide(),O(this).closest(".source-section").find(".edit-source-section").show().find("input").val(O(this).prev("span").text())}}].concat(c==N?[{el:"div",class:"edit-source-section",style:"display: none;",children:[{el:"input",type:"text",class:"form-control",value:b||"",onclick:function e(){O(this).autocomplete({minLength:1,delay:50,source:function(e,t){const n=e.term&&e.term.trim();n in w?t(w[n]):O.getJSON("/craft/battle/source/search/{}".replace("{}",n),function(e){0<e.length&&(w[n]=e.sort()),t(e)}).fail(()=>{t([])})}}),this.removeEventListener("click",e)}},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){O(this).closest(".edit-source-section").hide(),O(this).closest(".source-section").find("span").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){const e=O(this).siblings("input").val().trim();var t=O(this).closest(".battle-preview-one"),n=Object.assign({},t.get(0).dataset);n.battleId=parseInt(n.battleId),n.memberId=parseInt(n.memberId),n.sentenceId=parseInt(n.sentenceId),n.engLength=parseInt(n.engLength),n.diffLevel=t.find(".diff-section")[0].dataset.diff,n.categoryId=parseInt(t.find(".grammar-section")[0].dataset.cid),n.askTag=t.find(".tag-section")[0].dataset.tag,n.comment=t.find(".comment-section")[0].dataset.comment,O.ajax({url:"/craft/battle/edit",type:"post",contentType:"application/json",data:JSON.stringify(Object.assign({},n,{source:e})),success:()=>{alertModal("출처를 수정했습니다.",()=>{O(this).closest(".edit-source-section").hide(),O(this).closest(".source-section").attr("data-source",e).find("span").text(e).show()})},error:function(){alertModal("출처 수정에 실패했습니다.")}})}}]}]:[])},{el:"div",className:"col-auto tag-section position-relative","data-tag":l,onmouseover:N==c?function(){O(this).find(".js-open-edit-battle-tag").toggle(!O(this).find(".edit-tag-section").is(":visible"))}:"",onmouseleave:N==c?function(){O(this).find(".js-open-edit-battle-tag").hide()}:"",children:[{el:"label",className:"fw-bold me-2",textContent:"태그:"},{el:"span",textContent:l||"(태그없음)"},{el:"button",class:"js-open-edit-battle-tag btn btn-sm btn-fico",textContent:"수정",style:"display: none;",onclick:function(){O(this).prev("span").hide(),O(this).closest(".tag-section").find(".edit-tag-section").show().find("input").val(O(this).prev("span").text())}}].concat(c==N?[{el:"div",class:"edit-tag-section",style:"display: none;",children:[{el:"input",type:"text",class:"form-control",value:l||"",onclick:function e(){O(this).autocomplete({minLength:1,delay:50,source:function(e,t){const n=e.term&&e.term.trim();n in S?t(S[n]):O.getJSON("/craft/battle/tag/search/{}".replace("{}",n),function(e){0<e.length&&(S[n]=e.sort()),t(e)}).fail(()=>{t([])})}}),this.removeEventListener("click",e)}},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){O(this).closest(".edit-tag-section").hide(),O(this).closest(".tag-section").find("span").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){const e=O(this).siblings("input").val().trim();O.ajax({url:"/craft/battle/edit/tag",type:"post",contentType:"application/json",data:JSON.stringify({battleId:n,askTag:e}),success:()=>{alertModal("태그를 수정했습니다.",()=>{O(this).closest(".edit-tag-section").hide(),O(this).closest(".tag-section").attr("data-tag",e).find("span").text(e).show()})},error:function(){alertModal("태그 수정에 실패했습니다.")}})}}]}]:[])}]},{el:"div",className:"context-section mt-2",onmouseover:N==c?function(){O(this).find(".js-open-edit-battle-context").toggle(!O(this).find(".edit-context-section").is(":visible"))}:"",onmouseleave:N==c?function(){O(this).find(".js-open-edit-battle-context").hide()}:"",children:[{el:"label",className:"col-1 fw-bold me-2",textContent:"본문"},{el:"div",className:"battle-context pb-3","data-battle-type":d,children:B(r,e)},N==c?{el:"button",className:"js-open-edit-battle-context btn btn-sm btn-fico",textContent:"본문 수정",style:"display: none;",onclick:function(){var e=O(this).closest(".context-section");const t=e.find(".edit-context-section").show().find(".battle-maker").empty()[0];var n=O(this).closest(".battle-preview-one")[0],e=parseInt(e.children(".battle-context").attr("data-battle-type"));switch(j(e,t),t.appendChild(O(this).prev(".battle-context")[0].cloneNode(!0)),e){case 5:case 6:t.querySelector(".select-kor").value=n.dataset.ask;break;case 7:t.querySelector(".kor-answer").value=JSON.parse(n.dataset.answer).join(" / ");case 8:t.querySelector(".battle-opt-ext").value=JSON.parse(n.dataset.example)[2].join(" / ")}O(this).prev(".battle-context").hide(),t.querySelector(".battle-context").classList.add("my-2","p-3","bg-white"),t.querySelector(".battle-context").onmouseup=function(){E(t)}}}:"",N==c?{el:"div",className:"edit-context-section bg-info position-relative p-3",style:"display: none;",children:[{el:"div",className:"battle-maker"},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){O(this).closest(".edit-context-section").hide(),O(this).closest(".context-section").children(".battle-context").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){var e=O(this).closest(".edit-context-section").find(".battle-context")[0],t=e.closest(".battle-maker"),n=O(this).closest(".battle-preview-one");const o=Object.assign({},n.get(0).dataset);switch(o.battleId=parseInt(o.battleId),o.memberId=parseInt(o.memberId),o.sentenceId=parseInt(o.sentenceId),o.engLength=parseInt(o.engLength),o.diffLevel=n.find(".diff-section")[0].dataset.diff,o.categoryId=parseInt(n.find(".grammar-section")[0].dataset.cid),o.source=n.find(".source-section")[0].dataset.source,o.askTag=n.find(".tag-section")[0].dataset.tag,o.comment=n.find(".comment-section")[0].dataset.comment,d){case"1":var[a,l]=[L(e,".answer, .option"),L(e,".answer")];if(0==l.length)return void alertModal("문제로 만들 어구를 선택해 주세요.");if(a.length==l.length)return void alertModal("오답 보기를 선택해 주세요.");Object.assign(o,{example:JSON.stringify(a),answer:JSON.stringify(l)});break;case"2":a=L(e,".modifier"),l=L(e,".modificand");if(u.includes("모든 피수식")&&(0<a.length||0==l.length))return void alertModal("피수식어만 1개 이상 선택해 주세요.");if(u.includes("모든 수식")&&(0<l.length||0==a.length))return void alertModal("수식어만 1개 이상 선택해 주세요.");if(!u.includes("모든")&&0==(a.length&&l.length))return void alertModal("수식어/피수식어를 1쌍 이상 선택해 주세요.");o.answer=JSON.stringify([a,l]);break;case"3":a=e.querySelector(".pick-right");if(!a)return void alertModal("문제로 만들 어구를 선택해 주세요.");o.example=JSON.stringify([L(e,".pick-right")[0],a.textContent.trim(),a.dataset.wrong.trim()]),o.answer=JSON.stringify([a.textContent.trim()]);break;case"4":l=e.querySelector(".answer-wrong");if(null==e.querySelector(".option"))return void alertModal("보기 어구를 선택해 주세요.");if(!l)return void alertModal("정답 어구를 선택해 주세요.");o.example=JSON.stringify(L(e,".option, .answer-wrong")),o.answer=JSON.stringify([L(e,".answer-wrong")[0],l.textContent.trim(),l.dataset.wrong.trim()]);break;case"5":if(0==e.querySelectorAll(".option").length)return void alertModal("보기를 추가해 주세요.");o.ask=t.querySelector(".select-kor").value,o.example=JSON.stringify(L(e,".option"));break;case"6":{if(null==e.querySelector(".fill-right"))return void alertModal("문제로 만들 어구를 선택해 주세요.");const s=e.querySelectorAll(".fill-right");o.ask=t.querySelector(".select-kor").value,o.example=JSON.stringify(Array.from(L(e,".fill-right"),(e,t)=>[e,s[t].textContent.trim()]));break}case"7":{0<e.querySelectorAll(".option").length?o.ask=JSON.stringify(L(e,".option")):o.ask=JSON.stringify([[0,p]]);const i=t.querySelector(".kor-answer");if(!i.value)return void alertModal("정답 해석을 입력해 주세요.",()=>i.focus());o.answer=JSON.stringify(t.querySelector(".kor-answer").value.trim().split(/\s*\/\s*/)),o.example=JSON.stringify(t.querySelector(".battle-opt-ext").value.trim().split(/\s*\/\s*/));break}case"8":{a=e.querySelector(".pick-right");const c=t.querySelector(".battle-opt-ext");if(!a)return void alertModal("문제로 만들 어구를 선택해 주세요.");if(!c.value.trim().split(/\s*\/\s*/).join(""))return void alertModal("오답 보기를 입력해 주세요.",()=>c.focus());o.example=JSON.stringify([L(e,".pick-right")[0],a.textContent.trim(),c.value.trim().split(/\s*\/\s*/)]),o.answer=JSON.stringify([a.textContent.trim()]);break}}O.ajax({url:"/craft/battle/edit",type:"post",contentType:"application/json",data:JSON.stringify(Object.assign({},o)),success:()=>{alertModal("본문을 수정했습니다.",()=>{g.dataset.ask=o.ask,g.dataset.example=o.example,g.dataset.answer=o.answer,O(this).closest(".edit-context-section").hide(),O(this).closest(".context-section").children(".battle-context").show()[0].replaceChildren(createElement(B(r,o)))})},error:function(){alertModal("본문 수정에 실패했습니다.")}})}}]}:""]},{el:"div",className:"row pb-3 comment-section","data-comment":h||"",children:[{el:"label",className:"col-1 fw-bold me-2",textContent:"코멘트"},{el:"div",className:"col-10 position-relative",children:[{el:"span",className:"comment short text-truncate",role:"button",style:"display: block",textContent:O("<div></div>").html(h||F).text(),onclick:function(){O(this).add(O(this).siblings(".comment")).toggle()}},{el:"div",className:"comment long ws-breakspaces",role:"button",style:"display: none;",innerHTML:h||F,onclick:function(){O(this).add(O(this).siblings(".comment")).toggle()}},N==c?{el:"button",className:"js-open-edit-battle-comment col-auto position-absolute mt-3 btn btn-sm btn-fico",textContent:"코멘트 수정",onclick:function(){var e=O(this).closest(".comment-section").find(".edit-comment-section"),t=(e.add(this).toggle(),O(this).siblings(".comment").hide(),O(this).siblings(".comment.long").html()==F?"":O(this).siblings(".comment.long").html());openSummernote(e.find("textarea").val(t))}}:""]}].concat(N==c?[{el:"div",className:"edit-comment-section",style:"display: none;",children:[{el:"textarea",maxLength:1500},{el:"div",class:"btn-group btn-set float-end mt-0 mt-sm-2",children:[{el:"button",class:"btn btn-sm btn-outline-fico",textContent:"취소",onclick:function(){O(this).closest(".edit-comment-section").hide().closest(".comment-section").find(".comment.long").show(),O(this).closest(".edit-comment-section").children("textarea").summernote("destroy"),O(this).closest(".comment-section").find(".js-open-edit-battle-comment").show()}},{el:"button",class:"btn btn-sm btn-fico",textContent:"수정",onclick:function(){const t=O(this).closest(".edit-comment-section").children("textarea").val().trim();O.ajax({url:"/craft/battle/edit/comment",type:"post",contentType:"application/json",data:JSON.stringify({battleId:n,comment:t}),success:()=>{alertModal("코멘트를 수정했습니다.",()=>{O(this).closest(".edit-comment-section").hide().children("textarea").summernote("destroy");var e=O(this).closest(".comment-section");e.attr("data-comment",t),e.find(".comment.long").html(t||F).show(),e.find(".comment.short").text(e.find(".comment.long").text()).hide(),e.find(".js-open-edit-battle-comment").show()})},error:()=>{alertModal("코멘트 수정에 실패했습니다.")}})}}]}]}]:[])}]};return N==c&&g.children.push({el:"div",class:"position-relative",style:{width:"fit-content"},children:[{el:"button",className:"btn btn-sm btn-fico js-delete-battle",textContent:"배틀 삭제"}]}),g}function B(l,e){const o=JSON.parse(e.answer||"[]");var t=JSON.parse(e.example||"[]");let s=0;const i=[];var{battleType:e,ask:n}=e;const c=(e,t)=>l.substring(e,t),r=(t,n)=>{return o.find(e=>e[0]==t&&e[1]==n)?"answer":"option"};switch(e){case"1":t.sort(J).forEach(([e,t],n,o)=>{i.push(c(s,e)),i.push({el:"span",className:r(e,t),textContent:l.substring(e,t)}),n==o.length-1&&t<l.length&&i.push(l.substring(t)),s=t});break;case"2":var[a,d]=o;[...a.map(e=>[...e,"modifier"]),...d.map(e=>[...e,"modificand"])].sort(J).forEach(([e,t,n],o,a)=>{i.push(c(s,e)),i.push({el:"span",className:n,textContent:l.substring(e,t)}),o==a.length-1&&t<l.length&&i.push(l.substring(t)),s=t});break;case"3":var[[a,d],,u]=t;i.push(c(s,a)),i.push({el:"span",className:"pick-right","data-wrong":u,textContent:l.substring(a,d)}),d<l.length&&i.push(l.substring(d));break;case"4":{const[[p,m],,f]=o;t.sort(J).forEach(([e,t],n,o)=>{var a=c(s,e),a=(a&&i.push(a),{el:"span",className:r(e,t),textContent:l.substring(e,t)});p==e&&m==t&&(a.className="answer-wrong",a["data-wrong"]=f),i.push(a),n==o.length-1&&t<l.length&&i.push(l.substring(t)),s=t});break}case"5":t.sort(J).forEach(([e,t],n,o)=>{var a=c(s,e);a&&i.push(a),i.push({el:"span",className:"option",textContent:l.substring(e,t)}),n==o.length-1&&t<l.length&&i.push(l.substring(t)),s=t});break;case"6":t.sort((e,t)=>e[0][0]-t[0][0]).forEach(([[e,t]],n,o)=>{var a=c(s,e);a&&i.push(a),i.push({el:"span",className:"fill-right",textContent:l.substring(e,t)}),n==o.length-1&&t<l.length&&i.push(l.substring(t)),s=t});break;case"7":var[u,a]=JSON.parse(n)[0],d=c(s,u),u=l.substring(u,a),a=l.substring(a);d&&i.push(d),i.push(d,{el:"span",className:"option",textContent:u},a);break;case"8":var[d,u]=t[0],a=c(s,d),d=l.substring(d,u),u=l.substring(u);a&&i.push(a),i.push({el:"span",className:"pick-right",textContent:d},u)}return i}function D(o,a){if(0<o.length)for(let t=0,n=o.length;t<n;t++)for(let e=t+1;e<=n;e++){var l=o.substring(t,e);l in a||(a[l]=[]),a[l].includes(o)||a[l].push(o),a[l].sort()}}function R(e,t){let n=o[e-1].replace("{}",t);return 1===e&&n.includes("절의")?n=n.replace("문장의","문장에서"):2===e&&(t.includes("의 수식")||t.includes("의 피수식"))?n+="어를 선택하세요.":8===e&&(n=t),n}function P(e,t){let n;return n=s[e]?s[e].find(({limit:e})=>t<=e)?.rank:n}q.craft=Object.assign({},q.craft,{openBattleMakerPanel:async function t(n,a,l,s,i){if(O.fn.autocomplete){const o=u.querySelector(".battle-category-section select");if(0==y.length)O.getJSON("/grammar/category/list",e=>{y=e,e=Array.from(y,e=>({el:"option",value:e.cid,textContent:(e.parentCategory?"└─ ":"")+e.title})),o.append(createElement(e)),t(n,a,l,s,i)});else{N=a;const c=tandem.cleanSvocDOMs(s).innerText;let o=u.cloneNode(!0);var e;"undefined"==typeof openSummernote&&await O.cachedScript("https://static.findsvoc.com/js/util/summernote.editor.min.js"),u.querySelector(".battle-comment-section textarea.comment~.note-editor")||(0<(e=O(n).closest(".one-sentence-unit-section")).length&&0<e.find(".note-list .note-text").length&&O(o).find(".battle-comment-section textarea.comment").val(e.find(".note-list .note-text").html()),await openSummernote(O(o).find(".battle-comment-section textarea.comment").removeClass("d-inline"))),O(o).data("semantics",s).data("sentenceId",l).data("eng",c).data("transList",i.filter(e=>!!e.id));const r=Date.now();o.querySelectorAll("[data-radio]").forEach((e,t)=>{const n=""+e.dataset.radio+r+t;e.querySelectorAll("input[type=radio]").forEach((e,t)=>{e.name=n,e.id=n+t,e.nextElementSibling.htmlFor=n+t})}),O.getJSON("/craft/battle/search/"+l,e=>{let t={};e.forEach(e=>{null==t[e.battleType]&&(t[e.battleType]=[]),t[e.battleType].push(e)});const n=o.querySelector(".existing-battles-section");n.replaceChildren(),0==Object.entries(t).length?n.append("등록된 배틀이 없습니다."):Object.entries(t).forEach((e,t)=>{t=Date.now()+t,n.append(createElement(M(e[0],e[1].length,t,Array.from(e[1],e=>A(c,e)))))})}),n.replaceChildren(),h(o.querySelector(".craft-maker-container"),s,1),n.append(o),O(o).find(".ask-select").trigger("change"),O(o).find(".askTag, .source").each(function(){const o=`/craft/battle/${this.matches(".askTag")?"tag":"source"}/search/{}`,a=this.matches(".askTag")?S:w;O(this).autocomplete({minLength:1,delay:50,source:function(e,t){const n=e.term&&e.term.trim();n in a?t(a[n]):O.getJSON(o.replace("{}",n),function(e){0<e.length&&(a[n]=e.sort()),t(e)}).fail(()=>{t([])})}})}),0<O(".workbook-title-section").length&&O(o).find(".source").val(O(".workbook-title-section").text().trim()).prop("readOnly",!0),k&&(o.querySelector(".select-book-type").value=k.type,o.querySelector("select.select-book").replaceChildren(createElement(Array.from(p[k.type],e=>({el:"option",value:e.battleBookId,textContent:e.title||"제목 없음"})))),o.querySelector("select.select-book").value=k.bookId),x&&(o.querySelector("input.source").value=x)}}else{I.head.append(createElement([{el:"link",rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.css"},{el:"link",rel:"stylesheet",href:"https://static.findsvoc.com/css/app/craft-maker.min.css"}]));const d=O.fn.tooltip;O.cachedScript("https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.js",{success:()=>{O.fn.tooltip=d,t(n,a,l,s,i)}})}},appendToolbar:j,getAsks:function(e){return d[parseInt(e)-1]},previewBattle:A,combineAsk:R,createAskOptions:b,createRangedSentenceBlock:B,calcDiffSpecific:P,findPositions:L,appendContext:g})}}(jQuery,window,document);