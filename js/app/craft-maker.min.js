!function e(k,C,w){if(k.cachedScript=k.cachedScript||function(e,t){return k.ajax(k.extend(t||{},{dataType:"script",cache:!0,url:e}))},"undefined"==typeof createElement)k.cachedScript("https://static.findsvoc.com/js/util/DOM-util.min.js",{success:()=>e(k,C,w)});else{let u,m={},a=[],d=[],p=[],f=[],b,l=0,g;const M="data-battle-type";let h=[],y=[],v=(k.getJSON("https://static.findsvoc.com/data/tandem/craft-toolbar.json",e=>{m=e,u=createElement(e.craftPanel),a=e.battleAsks,d=e.battleTypeInfos,p=e.commonEditorBtns}),{}),x={},S={},N=createElement({el:"div",className:"btn-toolbar row col-md-3",role:"toolbar"});function q(e,t,l){e.replaceChildren(),y=[],h=[];var a=createElement({el:"div",className:"battle-maker row",tabIndex:0}),e=(e.append(a),Array.from(d)[l-1]);[1,2].includes(l)&&e.forEach(e=>{null!=e.selector&&null!=t.querySelector(".sem"+e.selector)&&(e.recommended=!0)});{var n=l,o=a,r=m["battle"+n];N.innerHTML="",A(r,N);for(let e=0,t=p.length;e<t;e++)A(p[e],N);o.prepend(N.cloneNode(!0));const c=Date.now(),i={el:"div",className:"battle-diffLevel-section col-12 col-md-3 row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"난이도"}]},u=([{text:"쉬움",value:"A"},{text:"보통",value:"B"},{text:"어려움",value:"C"}].forEach(function(e,t){i.children.push({el:"input",type:"radio",autocomplete:"off",name:"btnRadioBattleLevel"+c,id:"btnRadioBattleLevel"+c+t,className:"btn-check battle-level-select",checked:0==t,value:e.value}),i.children.push({el:"label",textContent:e.text,"data-bs-toggle":0<t?"tooltip":"",htmlFor:"btnRadioBattleLevel"+c+t,"data-bs-html":"true","data-bs-title":"문장 길이로 시스템이 파악한<br>최소 난이도입니다.","data-bs-trigger":"manual",className:"col btn col-auto px-4 ms-1 rounded-pill btn-outline-fico"})}),A(i,o),o.appendChild(createElement([{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"길이"},{el:"span",className:"col-auto my-auto eng-length"}])),o.closest(".add-battle-section").querySelector(".battle-category-section select"));5<=n&&o.appendChild(createElement({el:"div",className:"col-12 row mt-3",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"해석"},{el:"select",className:"select-kor form-select d-inline-block col",children:Array.from(k(o).closest(".battle-section-panel").data("transList"),(e,t)=>({el:"option",value:e.id,textContent:e.text.trim(),"data-trans":e.text.trim()}))}]})),7==n&&o.appendChild(createElement({el:"div",className:"col-12 row mt-3",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"오답"},{el:"input",type:"text",className:"battle-kor-ext form-control col lh-1 my-auto",placeholder:"선택지로 추가할 단어들을 입력해 주세요. 추가될 단어들은 / 기호로 구분됩니다. 예) 우리가/우리를"}]})),2<n&&k(u).trigger("change")}var s,r=tandem?.cleanSvocDOMs(t).textContent.length,o=(a.querySelector(".eng-length").textContent=r,a.querySelector('.battle-level-select[value="C"]')),n=a.querySelector('.battle-level-select[value="B"]');150<r?(o.checked=!0,bootstrap.Tooltip.getOrCreateInstance(o.nextElementSibling).enable(),bootstrap.Tooltip.getOrCreateInstance(n.nextElementSibling).disable()):(bootstrap.Tooltip.getOrCreateInstance(o.nextElementSibling).disable(),80<r?(n.checked=!0,bootstrap.Tooltip.getOrCreateInstance(n.nextElementSibling).enable()):bootstrap.Tooltip.getOrCreateInstance(n.nextElementSibling).disable()),a.querySelector('.battle-level-select[value="B"]').checked=80<r,a.querySelector('.battle-level-select[value="C"]').checked=150<r,a.prepend(createElement({el:"div",className:"col-12 col-md-3 row",children:[{el:"label",textContent:"질문",className:"col-auto lh-1 my-auto text-fc-purple fw-bold"},{el:"select",className:"form-select ask-select col",children:E(l,e)}]})),[1,2].includes(l)&&(o=a.closest(".add-battle-section").querySelector(".ask-select"),k(o).trigger("change")),s=a,A({el:"div",className:"row pe-2",children:[{el:"label",className:"col-auto lh-1 my-auto text-white fw-bold",textContent:"본문"},{el:"div",className:"battle-context fs-5 bg-white mt-3 px-2 col form-control",textContent:tandem.cleanSvocDOMs(t).innerText,onmouseup:()=>O(s)}]},s)}function E(a,e){const n=[];return e.forEach((e,t)=>{var l={el:"option"};e.recommended&&(l.className="bg-fc-light-purple"),l.value=e.tag||"#"+a,e.tag&&(l["data-tag"]=e.tag),l.innerHTML=o(a,e.tag),0==t&&2!=a&&(l.selected=!0),n.push(l)}),2==parseInt(a)&&(e=null!=e.find(e=>e.recommended),n.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"의 피수식",innerHTML:"(지정)___의 피수식어를 선택하세요."}),n.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"의 수식",innerHTML:"(지정)___의 수식어를 선택하세요."}),n.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"모든 피수식",innerHTML:"피수식어를 모두 선택하세요."}),n.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"모든 수식",selected:!0,innerHTML:"수식어를 모두 선택하세요."})),n}function O(e){var t=getSelection(),l=e.querySelector("[role=toolbar] [type=checkbox]:checked"),a=/[^\s,.!?;:…]/,n=/^(\s|[,.!?;:…])/,o=/(\s|[,.!?;:…])$/,r=/('m|'re|'s|'d|'ll|'ve)$/;if(!t.isCollapsed&&l){var s=e.querySelector(".battle-context");if(t.toString().replace(/\W/g,"")!=s.textContent.replace(/\W/g,"")&&8&t.anchorNode.compareDocumentPosition(s)&t.focusNode.compareDocumentPosition(s)){var c,i=parseInt(e.closest(".add-battle-section").querySelector(".battle-type-section input:checked").value);if([3,4].includes(i)&&l.value.match(/pick-right|answer-wrong/)&&0<s.getElementsByClassName(l.value).length||7==i&&0<s.getElementsByClassName(l.value).length)alert("이 유형의 배틀은 복수 정답을 허용하지 않습니다.\n기존 정답을 눌러 지워 주세요.");else{for((2==t.anchorNode.compareDocumentPosition(t.focusNode)||0==t.anchorNode.compareDocumentPosition(t.focusNode)&&t.anchorOffset>t.focusOffset)&&t.setBaseAndExtent(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset);0<t.anchorOffset&&t.anchorNode.textContent.charAt(t.anchorOffset).match(a)&&t.anchorNode.textContent.charAt(t.anchorOffset-1).match(a)&&(![1,3].includes(i)||!t.toString().trim().match(r));)t.setBaseAndExtent(t.anchorNode,t.anchorOffset-1,t.focusNode,t.focusOffset);for(;t.toString().match(n);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset+1,t.focusNode,t.focusOffset);for(;t.focusOffset<t.focusNode.textContent.length-1&&t.focusNode.textContent.charAt(t.focusOffset-1).match(a)&&t.focusNode.textContent.charAt(t.focusOffset).match(a)&&(![1,3].includes(i)||!(2<t.focusNode.textContent.length&&t.focusNode.textContent.substring(t.focusOffset,t.focusOffset+3).trim().match(r)));)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset+1);for(;t.toString().match(o);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset-1);0!=t.toString().trim().length&&t.toString().replace(/\W/g,"")!=s.textContent.replace(/\W/g,"")&&(s=s,h.push(s.innerHTML),y=[],s.closest(".battle-maker").querySelector('[role=toolbar] [value="undo"]').disabled=!1,(s=w.createElement("span")).className=l.value,c=t.getRangeAt(0),s.textContent=c.extractContents().textContent,c.insertNode(s),t.removeAllRanges(),l.value.match(/pick-right|answer-wrong/)&&((c=prompt(s.textContent+"의 오답을 입력하세요."))?s.dataset.wrong=c:k(s.firstChild).unwrap()),7==i&&((l=prompt("선택한 구간의 해석을 입력하세요."))?(e.querySelector(".select-kor").appendChild(createElement({el:"option",className:"custom-trans",value:l,"data-trans":l,textContent:l,selected:!0})),e.querySelector(".select-kor").classList.add("pe-none")):k(s.firstChild).unwrap()))}}}}function T(e,t,l,a){return[{el:"div",className:"js-open-existing-battle d-inline-block btn border",role:"button","data-battle-type":e,"data-bs-toggle":"collapse","data-bs-target":"#"+("existingBattleView"+l),children:[`Battle #${e}: `,{el:"span",className:"battle-count",textContent:t}," 건 ",{el:"span",className:"fold-icon text-xl align-middle"}]},{el:"div",id:"existingBattleView"+l,className:"battle-preview fade collapse",children:a}]}function A(e,t){!function a(n,o){Array.isArray(n)?n.forEach((e,t)=>n[t]=a(e,o)):"object"==typeof n&&Object.entries(n).forEach(([e,l])=>{l&&Array.isArray(l)&&l.forEach((e,t)=>l[t]=a(e,o)),n[e]=l});return o.apply(this,[n])}(e,e=>(e.className||"div"!=e.el?e.title&&"checkbox"!=e.type&&(e["data-toggle"]="tooltip",e["data-placement"]="bottom"):e.className="btn-group col-auto",e));e=createElement(e);e.querySelectorAll("[type=checkbox]").forEach(e=>{e.className||(e.className="btn-check");var t="btn-check-"+l++,t=(e.id=t,createElement({el:"label",htmlFor:t,className:"btn btn-outline-fico",textContent:e.textContent}));e.title&&(t.title=e.title,t.dataset.toggle="tooltip",t.dataset.placement="bottom"),e.after(t)}),t.append(e)}function I(e,l){let a=0,n=[];return e.childNodes.forEach(e=>{var t=e.textContent.replaceAll(/[\n\u200b]/gm,"").length;e.className&&e.matches(l)&&n.push([a,a+t]),a+=t}),n}function c(e,t){return e[0]-t[0]}function L(e,t){e={el:"div","data-id":t.battleId,className:"battle-preview-one m-1 ms-5 bg-light border border-2 px-2",children:[{el:"div",className:"row",children:[{el:"div",className:"col-auto",children:[{el:"label",className:"fw-bold me-2",textContent:"질문:"},{el:"span",textContent:o(parseInt(t.battleType),t.askTag)}]},{el:"div",className:"col-auto",children:[{el:"label",className:"fw-bold me-2",textContent:"난이도:"},{el:"span",textContent:t.diffLevel}]},{el:"div",className:"col-auto",children:[{el:"label",className:"fw-bold me-2",textContent:"문법:"},{el:"span",textContent:t.grammarTitle}]}]},{el:"div",className:"battle-context pb-3",children:n(e,t)}]};return g==t.memberId&&e.children.push({el:"div",children:[{el:"button",className:"btn btn-sm btn-fico js-delete-battle",textContent:"삭제"}]}),e}function n(n,e){const o=JSON.parse(e.answer||"[]");var t,l,a=JSON.parse(e.example||"[]");let r=0;const s=[];return"1"==e.battleType?a.sort(c).forEach((t,e,l)=>{var a=n.substring(r,t[0]);a&&s.push(a),s.push({el:"span",className:o.find(e=>e[0]==t[0]&&e[1]==t[1])?"answer":"option",textContent:n.substring(t[0],t[1])}),e==l.length-1&&t[1]<n.length&&s.push(n.substring(t[1])),r=t[1]}):"2"==e.battleType?([l,t]=o,Array.from(l,e=>e.concat("modifier")).concat(Array.from(t,e=>e.concat("modificand"))).sort(c).forEach((e,t,l)=>{var a=n.substring(r,e[0]);a&&s.push(a),s.push({el:"span",className:e[2],textContent:n.substring(e[0],e[1])}),t==l.length-1&&e[1]<n.length&&s.push(n.substring(e[1])),r=e[1]})):"3"==e.battleType?((l=n.substring(r,a[0][0]))&&s.push(l),s.push({el:"span",className:"pick-right","data-wrong":a[2],textContent:n.substring(a[0][0],a[0][1])}),a[0][1]<n.length&&s.push(n.substring(a[0][1]))):"4"==e.battleType?a.sort(c).forEach((e,t,l)=>{var a=n.substring(r,e[0]),a=(a&&s.push(a),{el:"span",className:"option",textContent:n.substring(e[0],e[1])});o[0][0]==e[0]&&o[0][1]==e[1]&&(a.className="answer-wrong",a["data-wrong"]=o[2]),s.push(a),t==l.length-1&&e[1]<n.length&&s.push(n.substring(e[1])),r=e[1]}):"5"==e.battleType?a.sort(c).forEach((e,t,l)=>{var a=n.substring(r,e[0]);a&&s.push(a),s.push({el:"span",className:"option",textContent:n.substring(e[0],e[1])}),t==l.length-1&&e[1]<n.length&&s.push(n.substring(e[1])),r=e[1]}):"6"==e.battleType?a.sort((e,t)=>e[0][0]-t[0][0]).forEach((e,t,l)=>{var a=n.substring(r,e[0][0]);a&&s.push(a),s.push({el:"span",className:"fill-right",textContent:n.substring(e[0][0],e[0][1])}),t==l.length-1&&e[0][1]<n.length&&s.push(n.substring(e[0][1])),r=e[0][1]}):"7"==e.battleType&&(s.push({el:"div",className:"row",children:[{el:"label",class:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"영문"},{el:"span",textContent:n}]}),s.push({el:"div",className:"row",children:[{el:"label",class:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"정답"},{el:"span",textContent:e.kor}]}),s.push({el:"div",className:"row",children:[{el:"label",class:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"보기"},{el:"span",children:Array.from(e.kor.split(/\s+/),e=>({el:"span",class:"btn border border-dark",textContent:e})).concat(Array.from(a.filter(e=>0<e.length),e=>({el:"span",class:"btn border border-danger",textContent:e})))}]})),s}function j(a,n){if(0<a.length)for(let t=0,l=a.length;t<l;t++)for(let e=t+1;e<=l;e++){var o=a.substring(t,e);o in n||(n[o]=[]),n[o].includes(a)||n[o].push(a),n[o].sort()}}function o(e,t){let l=a[e-1].replace("{}",t);return 1==e&&l.match(/종속절의|주절의/)?l=l.replace("문장의","문장에서"):2==e&&(t.includes("의 수식")||t.includes("의 피수식"))&&(l+="어를 선택하세요."),l}function B(e,t){let l;return"A"==e?l=t<=30?"이병":t<=60?"일병":"병장":"B"==e?l=t<=50?"하사":t<=70?"상사":t<=100?"소위":t<=120?"대위":"소령":"C"==e&&(l=t<=150?"대령":t<=200?"준장":"소장"),l}k(w).on("click",".battle-type-section .btn, .battle-diffLevel-section .btn, .battle-category-section select",function(){let l={};var e=this.closest(".add-battle-section");let a=e.querySelector(".battles-counter-section"),n;a||(a=createElement(m.battleCounterPanel),k.getJSON("/craft/battle/stats/total",e=>{a.querySelector(".counter-total").textContent=e+"건"}).fail(()=>alert("전체 배틀 갯수를 조회할 수 없습니다.")),e.querySelector(".battle-type-section").before(a)),l=this.matches(".battle-type-section .btn")?(n="type",{battleType:w.getElementById(this.htmlFor).value}):this.matches(".battle-diffLevel-section .btn")?(n="level",{diffLevel:B(w.getElementById(this.htmlFor).value,e.querySelector(".battle-context").textContent.trim().length)}):(n="gc",{categoryId:parseInt(this.value)}),k.getJSON("/craft/battle/stats/"+n,l,function(e){let t;switch(n){case"type":(t=a.querySelector(".counter-same-type")).replaceChildren(createElement(Array.from(e,(e,t)=>[{el:"label",className:"bg-fc-yellow col-auto ms-2 rounded-pill",textContent:"#"+(t+1)},{el:"span",className:"col-auto ps-1 pe-0",textContent:e+"건"}])));break;case"level":(t=a.querySelector(".counter-same-difflevel")).replaceChildren(createElement([{el:"span",className:"col-auto",textContent:l.diffLevel+`: ${e}건`}]));break;case"gc":(t=a.querySelector(".counter-same-category")).replaceChildren(createElement({el:"span",className:"col-auto",textContent:f.find(e=>e.cid==l.categoryId).title+`: ${e}건`}))}null!=k.fn.bounce&&k(t).bounce()}).fail(()=>alert("배틀 갯수 조회에 실패했습니다."))}).on("change",".battle-type-section input[type=radio]",function(){var e=k(this).closest(".battle-section-panel").data("semantics");q(this.closest(".add-battle-section").querySelector(".craft-maker-container"),e,parseInt(this.value))}).on("change",".ask-select",function(){var e=this.closest(".add-battle-section"),t=this.querySelector("option:checked"),l=t.dataset.tag,a=e.querySelector(".askTag"),a=(a.value=l||"",e.querySelector(".battle-type-section input:checked").value);"2"==a&&(t.value.includes("의 피수식")||t.value.includes("의 수식"))&&(l=t.value.includes("의 피수식")?"피수식":"수식",e=t.value.replace("의 "+l,""),null!=(a=prompt(`???의 ${l}어를 고르세요.
???에 들어갈 단어를 입력하세요.`,e))&&0<a.length?(t.value=a+"의 "+l,t.innerHTML=`(지정)${a}의 ${l}어를 선택하세요.`):t.selected=!1)}).on("change",".battle-category-section select",function(){this.closest(".add-battle-section").querySelector(".askTag").value=S[parseInt(this.value)]||""}).on("change",".battle-maker [role=toolbar] [type=checkbox]",function(){this.checked&&(this.closest("[role=toolbar]").querySelectorAll("[type=checkbox]:checked").forEach(e=>{0!=this.compareDocumentPosition(e)&&(e.checked=!1)}),getSelection().isCollapsed||O(this.closest(".battle-maker")))}).on("click",".battle-context *",function(){this.closest(".battle-maker")&&("SPAN"==this.nodeName?(7==this.closest(".add-battle-section").querySelector(".battle-type-section .btn-check:checked").value&&(this.closest(".battle-maker").querySelector(".select-kor .custom-trans").remove(),this.closest(".battle-maker").querySelector(".select-kor").classList.remove("pe-none")),this.outerHTML=this.innerHTML):this.remove())}).on("click",".battle-maker [value=undo], .battle-maker [value=redo]",function(){var e="undo"==this.value,t=(e?h:y).pop(),l=this.closest(".battle-maker"),a=l.querySelector(".battle-context");(e?y:h).push(a.innerHTML),a.innerHTML=t,k(a).animate({opacity:.5},100).animate({opacity:1},100),l.querySelector("[value=undo]").disabled=0==h.length,l.querySelector("[value=redo]").disabled=0==y.length}).on("keyup",function(e){var t=e.target.closest(".battle-maker");t&&(e.ctrlKey&&"Z"==e.key.toUpperCase()?k(t).find("[value=undo]").trigger("click"):e.ctrlKey&&"Y"==e.key.toUpperCase()&&k(t).find("[value=redo]").trigger("click"))}).on("click",".js-add-battle",function(){const o=this.closest(".add-battle-section"),r=o.closest(".battle-section-panel"),s=o.querySelector(".battle-context"),c=parseInt(o.querySelector(".battle-category-section select").value),i=o.querySelector(".battle-type-section input:checked").value;var e=o.querySelector(".battle-diffLevel-section input:checked").value,t=o.querySelector(".ask-select").value.trim();const u=o.querySelector(".askTag").value.trim();var l=o.querySelector(".comment").value.trim();const d=o.querySelector(".source").value.trim();var a=s.textContent.trim().length;const p={categoryId:c,battleType:i,ask:t,askTag:u,comment:l,source:d,diffLevel:e,engLength:a,sentenceId:k(r).data("sentenceId"),memberId:g,example:"",answer:"",diffSpecificLevel:B(e,a)};switch(i){case"1":p.example=JSON.stringify(I(s,".answer, .option")),p.answer=JSON.stringify(I(s,".answer"));break;case"2":var n=I(s,".modifier"),h=I(s,".modificand");if(t.includes("모든 피수식")&&(0<n.length||0==h.length))return void alert("피수식어만 1개 이상 선택해 주세요.");if(t.includes("모든 수식")&&(0<h.length||0==n.length))return void alert("수식어만 1개 이상 선택해 주세요.");if(!t.includes("모든")&&0==(n.length&&h.length))return void alert("수식어/피수식어를 1쌍 이상 선택해 주세요.");p.answer=JSON.stringify([n,h]);break;case"3":n=s.querySelector(".pick-right");if(!n)return void alert("문제로 만들 어구를 선택해 주세요.");p.example=JSON.stringify([I(s,".pick-right")[0],n.textContent.trim(),n.dataset.wrong.trim()]),p.answer=JSON.stringify([n.textContent.trim()]);break;case"4":h=s.querySelector(".answer-wrong");if(null==s.querySelector(".option"))return void alert("보기 어구를 선택해 주세요.");p.example=JSON.stringify(I(s,".option, .answer-wrong")),p.answer=JSON.stringify([I(s,".answer-wrong")[0],h.textContent.trim(),h.dataset.wrong.trim()]);break;case"5":if(0==s.querySelectorAll(".option").length)return void alert("보기를 추가해 주세요.");p.ask=o.querySelector(".select-kor").value,p.example=JSON.stringify(I(s,".option"));break;case"6":if(null==s.querySelector(".fill-right"))return void alert("문제로 만들 어구를 선택해 주세요.");let l=s.querySelectorAll(".fill-right");p.ask=o.querySelector(".select-kor").value,p.example=JSON.stringify(Array.from(I(s,".fill-right"),(e,t)=>[e,l[t].textContent.trim()]));break;case"7":0<s.querySelectorAll(".option").length&&(p.answer=JSON.stringify(I(s,".option"))),p.ask=o.querySelector(".select-kor").value,p.example=JSON.stringify(Array.from(o.querySelector(".battle-kor-ext").value.trim().split("/"),e=>e.trim()))}k.ajax({url:"/craft/battle/add",type:"POST",contentType:"application/json",data:JSON.stringify(p),success:function(e){j(u,v),j(d,x),S[c]=u,o.querySelector(".select-kor .custom-trans")&&(o.querySelector(".select-kor .custom-trans").remove(),o.querySelector(".select-kor").classList.remove("pe-none")),w.getElementById("craftResultModal")||w.body.appendChild(createElement(m.addResultModal)),k("#craftResultModal .battle-id").text(e.battleId),k("#craftResultModal .group-count").text(e.groupCount),k("#craftResultModal").modal("show"),!b&&0<p.source.length&&C.location.pathname.startsWith("/workbook/passage")&&(b=p.source),s.replaceChildren(s.textContent),p.battleId=e.battleId,p.grammarTitle=f.find(e=>e.cid==c).title,"7"==p.battleType&&(p.kor=null!=p.answer?p.ask:k(r).data("transList").find(e=>e.id==parseInt(p.ask)).text.trim());var e=r.querySelector(".existing-battles-section"),t=L(k(r).data("eng"),p);let l=e.querySelector(`[${M}="${i}"]`),a;l?((n=l.querySelector(".battle-count")).textContent=parseInt(n.textContent)+1,a=w.querySelector(l.dataset.bsTarget)):(e.querySelector(`[${M}]`)||e.replaceChildren(),n=Date.now()+1,[l,a]=T(i,1,n,[]),l=createElement(l),a=createElement(a),e.append(l),k(l).css("height",0).animate({height:"100%"},500,function(){this.style.height="auto"}),e.append(a));var n=createElement(t);a.append(n),k(n).css("display","none").slideDown()},error:function(e){alert(e)}})}).on("click",".js-delete-battle",function(){const l=this.closest(".battle-preview-one"),a=l.closest(".battle-preview"),n=a.previousElementSibling;var e=l.dataset.id;k.post("/craft/battle/del/"+e,function(){alert("배틀이 삭제되었습니다."),l.remove();var e=n.querySelector(".battle-count"),t=parseInt(e.textContent)-1;0<t?e.textContent=t:(a.remove(),n.remove())}).fail(()=>alert("배틀 삭제에 실패했습니다."))}),C.craft=Object.assign({},C.craft,{openBattleMakerPanel:function t(l,n,o,r,s){if(k.fn.autocomplete){const a=u.querySelector(".battle-category-section select");if(0==f.length)k.getJSON("/grammar/category/list",e=>{f=e,e=Array.from(f,e=>({el:"option",value:e.cid,textContent:(e.parentCategory?"└─ ":"")+e.title})),a.append(createElement(e)),t(l,n,o,r,s)});else{g=n;const c=tandem.cleanSvocDOMs(r).innerText;let a=u.cloneNode(!0);k(a).data("semantics",r).data("sentenceId",o).data("eng",c).data("transList",s);const i=Date.now();a.querySelectorAll("[data-radio]").forEach((e,t)=>{const l=""+e.dataset.radio+i+t;e.querySelectorAll("input[type=radio]").forEach((e,t)=>{e.name=l,e.id=l+t,e.nextElementSibling.htmlFor=l+t})}),k.getJSON("/craft/battle/search/"+o,e=>{let t={};e.forEach(e=>{null==t[e.battleType]&&(t[e.battleType]=[]),t[e.battleType].push(e)});const l=a.querySelector(".existing-battles-section");l.replaceChildren(),0==Object.entries(t).length?l.append("등록된 배틀이 없습니다."):Object.entries(t).forEach((e,t)=>{t=Date.now()+t,l.append(createElement(T(e[0],e[1].length,t,Array.from(e[1],t=>{let e;return e="7"==t.battleType?Object.assign({},t,{kor:s.find(e=>e.id==parseInt(t.ask)).text.trim()}):t,L(c,e)}))))})}),l.replaceChildren(),q(a.querySelector(".craft-maker-container"),r,1),l.append(a),k(a).find(".ask-select").trigger("change"),k(a).find(".askTag, .source").each(function(){const a=`/craft/battle/${this.matches(".askTag")?"tag":"source"}/search/{}`,n=this.matches(".askTag")?v:x;k(this).autocomplete({minLength:1,delay:50,source:function(e,t){const l=e.term&&e.term.trim();l in n?t(n[l]):k.getJSON(a.replace("{}",l),function(e){0<e.length&&(n[l]=e.sort()),t(e)}).fail(()=>{t([])})}})}),b&&(a.querySelector("input.source").value=b)}}else{w.head.append(createElement([{el:"link",rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.css"},{el:"link",rel:"stylesheet",href:"https://static.findsvoc.com/css/app/craft-maker.min.css"}]));const e=k.fn.tooltip;k.cachedScript("https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.js",{success:()=>{k.fn.tooltip=e,t(l,n,o,r,s)}})}},getAsks:function(e){return d[parseInt(e)-1]},previewBattle:L,combineAsk:o,createAskOptions:E,createBattleContext:n,calcDiffSpecific:B,findPositions:I})}}(jQuery,window,document);