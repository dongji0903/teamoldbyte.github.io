!function(i,e,d){let b={},m=[],l=0,p=[],u=[];i.getJSON("https://static.findsvoc.com/data/tandem/craft-toolbar.json",e=>{b=e,m=e.common});const h=[[{role:"s",ask:"다음 문장의 주어(부)를 선택하세요."},{role:"v",ask:"다음 문장의 동사(부)를 선택하세요."},{role:"o",ask:"다음 문장의 목적어(부)를 선택하세요."},{role:"c",ask:"다음 문장의 보어(부)를 선택하세요."},{role:"oc",ask:"다음 문장의 목적보어(부)를 선택하세요."}],[{role:"phr",ask:"[전치사] 수식어와 피수식어를 선택하세요."},{role:"verbid",ask:"[준동사] 수식어와 피수식어를 선택하세요."},{role:"rel",ask:"[관계사] 수식어와 피수식어를 선택하세요."},{role:"adj",ask:"[형용사] 수식어와 피수식어를 선택하세요."},{role:"appo",ask:"[동격어구/절] 수식어와 피수식어를 선택하세요."}],[{role:"BetweenTwo",ask:"다음 문장에서 적절한 보기를 선택하세요."}],[{role:"wrong",ask:"다음 문장에서 어법상 틀린 것을 선택하세요."}],[{role:"arrange",ask:"다음 어구들을 해석에 맞게 배치해 보세요."}]];d.head.insertAdjacentHTML("beforeend",'<style>.battle-maker {line-height:3;counter-set: quizIndex 0;counter-reset: quizIndex;border-style: outset;border-radius: 1rem;outline: none;padding: 0rem 1rem;}.battle-context .answer, .battle-context .option, .battle-context .answer-wrong {position: relative;counter-increment: quizIndex;text-decoration:underline;}.battle-context .answer::after,.battle-context .option::after, .battle-context .answer-wrong::after {position: absolute;width: calc(1em + 2px);line-height: 1;top: 1.5em;left: calc(50% - .5em - 1px);text-align: center;content: "["counter(quizIndex)"]"}.battle-context .answer { color: red; }.battle-context .modifier,.battle-context .modificand {position:relative;text-decoration:underline;}.battle-context .modifier::after,.battle-context .modificand::after {position: absolute;width: calc(1em + 2px);line-height: 1;top: 1.5em;left: calc(50% - .5em - 1px);text-align: center;}.battle-context .modificand::after { content: "피수식어"}.battle-context .modifier::after { content: "수식어"}.battle-context .pick-right, .battle-context .answer-wrong {position:relative; color: blue;}.battle-context .pick-right::before, .battle-context .answer-wrong::before {position: absolute; left: 0; bottom: 0; color: red; content: attr(data-wrong)}.battle-context * { cursor: pointer;}.battle-context *:hover { background: gold}</style>');let c=r({el:"div",className:"battle-section-panel"}),f=(c.insertAdjacentHTML("afterbegin",`	<!-- 기존 문제 조회 영역 -->
	<div class="existing-battle-section border-bottom mb-3 pb-3">
		<h5 class="mb-3">기존 등록 배틀 조회</h5>
		<!-- 조회 결과 -->
		<div>
			<div class="js-open-existing-battles" role="button" data-bs-toggle="collapse">
				• Battle <span class="existing-battle-type">0</span> 으로 등록 ( <span class="existing-battle-count">0</span> 건 ) <span class="fold-icon text-xl align-middle"></span>
			</div>
		</div>
		<!-- 기존 등록 배틀 상세보기 영역 -->
		<div class="js-existing-battle-view fade collapsed">
			<p>---- 기존 등록 배틀 상세보기 영역. 추가 구현 예정 ----</p>
			
		</div>
	</div>						
	<!-- 배틀 추가 등록 영역 -->
	<div class="add-battle-section">
		<!-- 배틀 타입 선택 -->
		<div class="battle-type-section mb-3">
			<h5 class="mb-3">배틀 타입 선택</h5>
			<input type="radio" name="battleTypeSelect" autocomplete="off" value="1">
			1. 성분 찾기
			<input type="radio" name="battleTypeSelect" autocomplete="off" value="2">
			2. 수식어 찾기
			<input type="radio" name="battleTypeSelect" autocomplete="off" value="3">
			3. 맞는 어법 찾기
			<input type="radio" name="battleTypeSelect" autocomplete="off" value="4">
			4. 틀린 어법 찾기
			<input type="radio" name="battleTypeSelect" autocomplete="off" value="5">
			5. 문장요소 배열하기
		</div>
		<!-- 문제 입력 -->
		<div class="add-detail-battle-section">
			<div class="battle-editor-section">
				<h5 class="mb-3">문제</h5>
				<!-- 문제 입력 에디터 -->
				<div class="craft-maker-container">
				</div>
			</div>
			<div class="row g-2 mb-3">
				<!-- 카테고리 입력 -->
				<div class="battle-category-section col-12 col-md-6">
					<h5 class="mb-3">카테고리</h5>
					<select class="form-select">
					</select>
				</div>
				<!-- 난이도 입력 -->
				<div class="battle-diffLevel-section col-12 col-md-6">
					<h5 class="mb-3">난이도</h5>
					<select class="form-select">
						<option value="E">쉬움</option>
						<option value="N" selected>보통</option>
						<option value="D">어려움</option>
					</select>
				</div>
			</div>
			<!-- 질문에 대한 태그 입력 -->
			<div class="battle-askTag-section mb-3">
				<h5 class="mb-3">질문에 대한 태그</h5>
				<input type="text" class="askTag form-control" placeholder="ex) 목적어(부), 관계사(카테고리명)">
			</div>
			<!-- 문제 해설 -->
			<div class="battle-comment-section mb-3">
				<h5 class="mb-3">해설</h5>
				<textarea class="comment form-control" rows="2" placeholder="문제에 대한 해설, 참조 링크 등"></textarea>
			</div>
			<div class="battle-source-section mb-3">
				<h5 class="mb-3">출처</h5>
				<input type="text" class="source form-control" placeholder="ex) OOO 워크북, 2022년 6월 고3 모의고사 등">
			</div>
			<div class="button-section text-end">
				<button type="button" class="js-add-battle btn btn-fico">등록</button>
			</div>
		</div>
	</div>`),d.createElement("div"));function t(e,t,a){e.innerHTML="",u=[],p=[];const o=d.createElement("div");o.className="battle-maker";let n=h[a-1];1==a&&(n.forEach(e=>{null!=t.querySelector(".sem."+e.role)&&(e.recommended=!0)}),n.sort((e,t)=>e.recommended?t.recommended?0:-1:1));var a=b["battle"+a],l=o;f.innerHTML="",g(a,f);for(let e=0,t=m.length;e<t;e++)g(m[e],f);l.prepend(f.cloneNode(!0));{a=n,l=o;const r=d.createElement("select");r.className="form-select ask-select",a.forEach(e=>{const t=d.createElement("option");e.recommended&&(t.className="bg-dark text-white"),t.value="find"+e.role.toUpperCase(),t.innerHTML=e.ask,r.append(t)}),l.querySelector("[role=toolbar]").prepend(r),i(r).wrap('<div class="col-auto"></div>')}{a=t;var c=o;const s=d.createElement("div");s.className="battle-context bg-white my-3 px-2",s.textContent=tandem.cleanSvocDOMs(a).innerText,s.onmouseup=()=>v(c),c.append(s)}e.append(o)}function v(e){const t=getSelection();var a=e.querySelector("[role=toolbar] [type=checkbox]:checked");if(!t.isCollapsed&&a&&t.toString().trim()!=e.querySelector(".battle-context").textContent.trim()){x(e.querySelector(".battle-context"));const o=d.createElement("span"),n=(o.className=a.value,t.getRangeAt(0));o.textContent=n.extractContents().textContent,n.insertNode(o),t.removeAllRanges(),o.matches(".pick-right,.answer-wrong")&&((e=prompt(o.textContent+"의 오답을 입력하세요."))?o.dataset.wrong=e:i(o.firstChild).unwrap())}}function r(t){const a=d.createElement(t.el);return Object.keys(t).forEach(e=>{["el","children"].includes(e)||(a[e]=t[e])}),a}function g(a,e){const o=r(a);if(!a.className)switch(a.el){case"button":o.className="btn btn-outline-dark col-auto btn-sm";break;case"div":o.className="btn-group col-auto"}if(!a.title||a.type&&"checkbox"==a.type||(o.dataset.toggle="tooltip",o.dataset.placement="bottom"),e.append(o),a.type&&"checkbox"==a.type){a.className||(o.className="btn-check");var t="btn-check-"+l++;o.id=t;const n=d.createElement("label");n.className="btn btn-outline-fico",n.htmlFor=t,n.innerHTML=a.innerHTML,a.title&&(n.title=a.title,n.dataset.toggle="tooltip",n.dataset.placement="bottom"),e.append(n)}if(a.children)for(let e=0,t=a.children.length;e<t;e++)g(a.children[e],i(o))}function s(e,a){let o=0,n=[];return e.childNodes.forEach(e=>{var t=e.textContent.replaceAll(/[\n\u200b]/gm,"").length;e.className&&e.matches(a)&&n.push([o,o+t]),o+=t}),n}function x(e){p.push(e.innerHTML),u=[],e.closest(".battle-maker").querySelector('[role=toolbar] [value="undo"]').disabled=!1}f.className="row g-2 btn-toolbar",f.setAttribute("role","toolbar"),i(d).on("change",".battle-type-section input[type=radio]",function(){var e=i(this).closest(".battle-section-panel").data("semantics");t(this.closest(".add-battle-section").querySelector(".craft-maker-container"),e,this.value)}).on("change",".battle-maker [role=toolbar] [type=checkbox]",function(){const e=this.closest(".battle-maker");var t=e.querySelector(".battle-context");this.checked&&(this.closest("[role=toolbar]").querySelectorAll("[type=checkbox]:checked").forEach(e=>{0!=this.compareDocumentPosition(e)&&(e.checked=!1)}),getSelection().isCollapsed||(x(t),v(this.closest(".battle-maker"))))}).on("click",".battle-context *",function(){"SPAN"==this.nodeName?this.outerHTML=this.innerHTML:this.remove()}).on("click",".battle-maker [value=undo], .battle-maker [value=redo]",function(){var e="undo"==this.value,t=(e?p:u).pop();const a=this.closest(".battle-maker"),o=a.querySelector(".battle-context");(e?u:p).push(o.innerHTML),o.innerHTML=t,i(o).animate({opacity:.5},100).animate({opacity:1},100),a.querySelector("[value=undo]").disabled=0==p.length,a.querySelector("[value=redo]").disabled=0==u.length}).on("click",".js-add-battle",function(){const e=this.closest(".add-battle-section"),t=i(e).closest(".battle-section-panel"),a=e.querySelector(".battle-context");let o="",n="";var l=Number(e.querySelector("[name=battleTypeSelect]:checked").value);switch(l){case 1:o=s(a,".answer, .option"),n=s(a,".answer");break;case 2:n=[s(a,".modifier")[0],s(a,".modificand")[0]];break;case 3:let e=a.querySelector(".pick-right");o=[s(a,".pick-right")[0],e.textContent.trim(),e.dataset.wrong.trim()],n=[e.textContent.trim()];break;case 4:let t=a.querySelector(".answer-wrong");o=s(a,".option, .answer-wrong"),n=[s(a,".answer-wrong")[0],t.textContent.trim()];break;case 5:o=s(a,".option")}l={sentenceId:t.data("sentenceId"),categoryId:Number(e.querySelector(".battle-category-section select").value),memberId:t.data("memberId"),battleType:l,ask:e.querySelector(".ask-select").value.trim(),example:JSON.stringify(o),answer:JSON.stringify(n),askTag:e.querySelector(".askTag").value.trim(),comment:e.querySelector(".comment").value.trim(),source:e.querySelector(".source").value.trim(),diffLevel:e.querySelector(".battle-diffLevel-section select").value};i.ajax({url:"/craft/battle/add",type:"POST",contentType:"application/json",data:JSON.stringify(l),success:function(e){alert(`[등록 결과]
battleId: ${e.battleId}
groupCount: `+e.groupCount)},error:function(e){alert(e)}})}),e.craft={openBattleMakerPanel:function(e,t,a,o){const n=c.querySelector(".battle-category-section select");let l=c.cloneNode(!0);i(l).data("semantics",o).data("memberId",t).data("sentenceId",a),i.getJSON("/craft/battle/search/"+a,e=>{}),0==n.childElementCount&&(n.append(r({el:"option",selected:"selected",disabled:"disabled",innerHTML:"카테고리 선택"})),i.getJSON("/grammar/category/list",e=>{e.forEach(e=>{n.append(r({el:"option",value:e.cid,textContent:(e.parentCategory?"└─":"")+e.title}))}),l.querySelector(".battle-category-section select").innerHTML=n.innerHTML})),e.innerHTML="",e.append(l)},attachBattleMaker:t}}(jQuery,window,document);