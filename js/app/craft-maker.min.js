!function(i,e,d){let u={},b=[],n=0,f=[],p=[];i.getJSON("https://static.findsvoc.com/data/tandem/craft-toolbar.json",e=>{u=e,b=e.common});const m=[[{selector:".s",ask:"find S",fullAsk:"다음 문장의 주어(부)를 선택하세요."},{selector:".v",ask:"find V",fullAsk:"다음 문장의 동사(부)를 선택하세요."},{selector:".o",ask:"find O",fullAsk:"다음 문장의 목적어(부)를 선택하세요."},{selector:".c",ask:"find C",fullAsk:"다음 문장의 보어(부)를 선택하세요."},{selector:".oc",ask:"find OC",fullAsk:"다음 문장의 목적보어(부)를 선택하세요."},{selector:'.s[data-rc="s.s."]',ask:"find SS",fullAsk:"다음 문장의 진짜주어(부)를 선택하세요."},{selector:'.o[data-rc="i.o."]',ask:"find IO",fullAsk:"다음 문장의 간접목적어(부)를 선택하세요."},{selector:'.o[data-rc="d.o."]',ask:"find DO",fullAsk:"다음 문장의 직접목적어(부)를 선택하세요."},{selector:".ptc",ask:"find PTC",fullAsk:"다음 문장의 분사를 선택하세요."},{selector:".ger",ask:"find GER",fullAsk:"다음 문장의 동명사를 선택하세요."},{selector:".tor",ask:"find TOR",fullAsk:"다음 문장의 to부정사를 선택하세요."}],[{selector:".adjphr[data-mfd],.phr[data-mfd]",ask:"find MOD[phr]",fullAsk:"[전치사] 수식어와 피수식어를 선택하세요."},{selector:".tor[data-mfd],.ptc[data-mfd]",ask:"find MOD[verbid]",fullAsk:"[준동사] 수식어와 피수식어를 선택하세요."},{selector:".acls[data-mfd]",ask:"find MOD[rel]",fullAsk:"[관계사] 수식어와 피수식어를 선택하세요."},{ask:"find MOD[adj]",fullAsk:"[형용사] 수식어와 피수식어를 선택하세요."},{ask:"find MOD[appo]",fullAsk:"[동격어구/절] 수식어와 피수식어를 선택하세요."}],[{ask:"sel correct",fullAsk:"다음 문장에서 적절한 보기를 선택하세요."}],[{ask:"sel incorrect",fullAsk:"다음 문장에서 어법상 틀린 것을 선택하세요."}],[{ask:"arrange order",fullAsk:"다음 어구들을 해석에 맞게 배치해 보세요."}]];d.head.insertAdjacentHTML("beforeend",'<style>.battle-maker {line-height:3;counter-set: quizIndex 0;counter-reset: quizIndex;border-style: outset;border-radius: 1rem;outline: none;padding: 0rem 1rem;}.battle-context .answer, .battle-context .option, .battle-context .answer-wrong {position: relative;counter-increment: quizIndex;text-decoration:underline;}.battle-context .answer::after,.battle-context .option::after, .battle-context .answer-wrong::after {position: absolute;width: calc(1em + 2px);line-height: 1;top: 1.5em;left: 0;text-align: center;content: "["counter(quizIndex)"]"}.battle-context .answer { color: red; }.battle-context .modifier,.battle-context .modificand {position:relative;text-decoration:underline;}.battle-context .modifier::after,.battle-context .modificand::after {position: absolute;width: calc(1em + 2px);line-height: 1;top: 1.5em;left: calc(50% - .5em - 1px);text-align: center;}.battle-context .modificand::after { content: "피수식어"}.battle-context .modifier::after { content: "수식어"}.battle-context .pick-right, .battle-context .answer-wrong {position:relative; color: blue;}.battle-context .pick-right::before, .battle-context .answer-wrong::before {position: absolute; left: 0; bottom: 0; color: red; content: attr(data-wrong)}.battle-context * { cursor: pointer;}.battle-context *:hover,.battle-context *:hover::before,.battle-context *:hover::after { background: gold}</style>');let s=g({el:"div",className:"battle-section-panel"}),h=(s.insertAdjacentHTML("afterbegin",`	<!-- 기존 문제 조회 영역 -->
	<div class="existing-battle-section border-bottom pb-3 row">
		<label class="col-auto lh-1 my-auto text-fc-red fw-bold">기존 등록 배틀 조회</label>
		<!-- 조회 결과 -->
		<div class="existing-battles-section col-auto">
			<div class="js-open-existing-battle" role="button" data-bs-toggle="collapse">
				• Battle <span class="existing-battle-type">0</span> 으로 등록 ( <span class="existing-battle-count">0</span> 건 ) <span class="fold-icon text-xl align-middle"></span>
			</div>
		</div>
	</div>						
	<!-- 배틀 추가 등록 영역 -->
	<div class="add-battle-section py-3">
		<!-- 배틀 타입 선택 -->
		<div class="battle-type-section pb-3 row" data-radio="btnradioBattletype">
			<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">배틀 타입 선택</label>
			<input type="radio" class="btn-check" autocomplete="off" value="1" checked>
			<label class="btn rounded-pill btn-outline-fico col-auto">1. 성분 찾기</label>
			<input type="radio" class="btn-check" autocomplete="off" value="2">
			<label class="btn rounded-pill btn-outline-fico col-auto">2. 수식어 찾기</label>
			<input type="radio" class="btn-check" autocomplete="off" value="3">
			<label class="btn rounded-pill btn-outline-fico col-auto">3. 맞는 어법 찾기</label>
			<input type="radio" class="btn-check" autocomplete="off" value="4">
			<label class="btn rounded-pill btn-outline-fico col-auto">4. 틀린 어법 찾기</label>
			<input type="radio" class="btn-check" autocomplete="off" value="5">
			<label class="btn rounded-pill btn-outline-fico col-auto">5. 문장요소 배열하기</label>
		</div>
		<!-- 문제 입력 -->
		<div class="add-detail-battle-section">
			<div class="battle-editor-section pb-3">
				<!-- 문제 입력 에디터 -->
				<div class="craft-maker-container">
				</div>
			</div>
			<div class="row py-3">
				<!-- 카테고리 입력 -->
				<div class="battle-category-section col-12 col-md-4 row">
					<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">카테고리</label>
					<select class="form-select d-inline-block w-auto col">
					</select>
				</div>
				<!-- 난이도 입력 -->
				<div class="battle-diffLevel-section col-12 col-md-4 row" data-radio="btnradioBattlelevel">
					<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">난이도</label>
					<input type="radio" class="btn-check battle-level-select" autocomplete="off" value="E" checked>
					<label class="col btn rounded-pill btn-outline-fico">쉬움</label>
					<input type="radio" class="btn-check battle-level-select" autocomplete="off" value="N">
					<label class="col btn rounded-pill btn-outline-fico">보통</label>
					<input type="radio" class="btn-check battle-level-select" autocomplete="off" value="D">
					<label class="col btn rounded-pill btn-outline-fico">어려움</label>
				</div>
				<!-- 질문에 대한 태그 입력 -->
				<div class="battle-askTag-section col row">
					<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">태그</label>
					<input type="text" class="askTag form-control d-inline-block col" placeholder="ex) 목적어(부), 관계사(카테고리명)">
				</div>
			</div>
			<div class="battle-source-section pb-3 row">
				<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">출처</label>
				<input type="text" class="source form-control d-inline col" placeholder="ex) OOO 워크북, 2022년 6월 고3 모의고사 등">
			</div>
			<!-- 문제 해설 -->
			<div class="battle-comment-section pb-3 row">
				<label class="col-auto text-fc-purple fw-bold">해설</label>
				<textarea class="comment form-control d-inline col" rows="2" placeholder="문제에 대한 해설, 참조 링크 등"></textarea>
			</div>
			<div class="button-section text-center">
				<button type="button" class="js-add-battle btn btn-fico">등록</button>
			</div>
		</div>
	</div>`),d.createElement("div"));function r(e,t,o){e.innerHTML="",p=[],f=[];var a=g({el:"div",className:"battle-maker",tabIndex:0});let l=m[o-1];l.forEach(e=>{null!=e.selector&&null!=t.querySelector(".sem"+e.selector)&&(e.recommended=!0)}),l.sort((e,t)=>e.recommended?t.recommended?0:-1:1);var o=u["battle"+o],n=a;h.innerHTML="",x(o,h);for(let e=0,t=b.length;e<t;e++)x(b[e],h);n.prepend(h.cloneNode(!0));{o=l,n=a;const s=d.createElement("select");s.className="form-select ask-select",o.forEach(e=>{const t=d.createElement("option");e.recommended&&(t.className="bg-fc-light-purple"),t.value=e.ask,t.innerHTML=e.fullAsk,s.append(t)}),n.querySelector("[role=toolbar]").prepend(s),i(s).wrap('<div class="btn-group col-auto"></div>'),s.insertAdjacentHTML("beforebegin",'<label class="col-auto lh-1 my-auto me-2 text-fc-purple fw-bold">질문</label>')}{o=t;var c=a;const r=d.createElement("div");r.className="battle-context fs-5 bg-white my-3 px-2",r.textContent=tandem.cleanSvocDOMs(o).innerText,r.onmouseup=()=>k(c),c.append(r)}e.append(a)}function k(e){let t=getSelection();var o=e.querySelector("[role=toolbar] [type=checkbox]:checked");if(!t.isCollapsed&&o&&t.toString().trim()!=e.querySelector(".battle-context").textContent.trim()){v(e.querySelector(".battle-context"));var e=Number(e.closest(".add-battle-section").querySelector(".battle-type-section input:checked").value);if(![1,3].includes(e)){for((2==t.anchorNode.compareDocumentPosition(t.focusNode)||0==t.anchorNode.compareDocumentPosition(t.focusNode)&&t.anchorOffset>t.focusOffset)&&t.setBaseAndExtent(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset);0<t.anchorOffset&&t.anchorNode.textContent.charAt(t.anchorOffset).match(/\S/)&&t.anchorNode.textContent.charAt(t.anchorOffset-1).match(/\S/);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset-1,t.focusNode,t.focusOffset);for(;t.toString().match(/^\s/);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset+1,t.focusNode,t.focusOffset);for(;t.focusOffset<t.focusNode.textContent.length-1&&t.focusNode.textContent.charAt(t.focusOffset-1).match(/\S/)&&t.focusNode.textContent.charAt(t.focusOffset).match(/\S/);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset+1);for(;t.toString().match(/\s$/);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset-1)}const a=d.createElement("span"),l=(a.className=o.value,t.getRangeAt(0));a.textContent=l.extractContents().textContent,l.insertNode(a),t.removeAllRanges(),a.matches(".pick-right,.answer-wrong")&&((e=prompt(a.textContent+"의 오답을 입력하세요."))?a.dataset.wrong=e:i(a.firstChild).unwrap())}}function g(t){const o=d.createElement(t.el);return Object.keys(t).forEach(e=>{["el","children"].includes(e)||(o[e]=t[e])}),o}function x(o,e){const a=g(o);if(!o.className)switch(o.el){case"button":a.className="btn btn-outline-dark col-auto btn-sm";break;case"div":a.className="btn-group col-auto"}if(!o.title||o.type&&"checkbox"==o.type||(a.dataset.toggle="tooltip",a.dataset.placement="bottom"),e.append(a),o.type&&"checkbox"==o.type){o.className||(a.className="btn-check");var t="btn-check-"+n++;a.id=t;const l=d.createElement("label");l.className="btn btn-outline-fico",l.htmlFor=t,l.innerHTML=o.innerHTML,o.title&&(l.title=o.title,l.dataset.toggle="tooltip",l.dataset.placement="bottom"),e.append(l)}if(o.children)for(let e=0,t=o.children.length;e<t;e++)x(o.children[e],i(a))}function c(e,o){let a=0,l=[];return e.childNodes.forEach(e=>{var t=e.textContent.replaceAll(/[\n\u200b]/gm,"").length;e.className&&e.matches(o)&&l.push([a,a+t]),a+=t}),l}function v(e){f.push(e.innerHTML),p=[],e.closest(".battle-maker").querySelector('[role=toolbar] [value="undo"]').disabled=!1}h.className="row g-2 btn-toolbar m-1",h.setAttribute("role","toolbar"),i(d).on("change",".battle-type-section input[type=radio]",function(){var e=i(this).closest(".battle-section-panel").data("semantics");r(this.closest(".add-battle-section").querySelector(".craft-maker-container"),e,this.value)}).on("change",".battle-maker [role=toolbar] [type=checkbox]",function(){const e=this.closest(".battle-maker");var t=e.querySelector(".battle-context");this.checked&&(this.closest("[role=toolbar]").querySelectorAll("[type=checkbox]:checked").forEach(e=>{0!=this.compareDocumentPosition(e)&&(e.checked=!1)}),getSelection().isCollapsed||(v(t),k(this.closest(".battle-maker"))))}).on("click",".battle-context *",function(){"SPAN"==this.nodeName?this.outerHTML=this.innerHTML:this.remove()}).on("click",".battle-maker [value=undo], .battle-maker [value=redo]",function(){var e="undo"==this.value,t=(e?f:p).pop();const o=this.closest(".battle-maker"),a=o.querySelector(".battle-context");(e?p:f).push(a.innerHTML),a.innerHTML=t,i(a).animate({opacity:.5},100).animate({opacity:1},100),o.querySelector("[value=undo]").disabled=0==f.length,o.querySelector("[value=redo]").disabled=0==p.length}).on("keyup",function(e){var t=e.target.closest(".battle-maker");t&&(e.ctrlKey&&"Z"==e.key.toUpperCase()?i(t).find("[value=undo]").trigger("click"):e.ctrlKey&&"Y"==e.key.toUpperCase()&&i(t).find("[value=redo]").trigger("click"))}).on("click",".js-add-battle",function(){const e=this.closest(".add-battle-section"),t=i(e).closest(".battle-section-panel"),o=e.querySelector(".battle-context");let a="",l="";var n=e.querySelector(".battle-type-section input:checked").value;switch(n){case"1":a=c(o,".answer, .option"),l=c(o,".answer");break;case"2":l=[c(o,".modifier")[0],c(o,".modificand")[0]];break;case"3":let e=o.querySelector(".pick-right");a=[c(o,".pick-right")[0],e.textContent.trim(),e.dataset.wrong.trim()],l=[e.textContent.trim()];break;case"4":let t=o.querySelector(".answer-wrong");a=c(o,".option, .answer-wrong"),l=[c(o,".answer-wrong")[0],t.textContent.trim()];break;case"5":a=c(o,".option")}n={sentenceId:t.data("sentenceId"),categoryId:Number(e.querySelector(".battle-category-section select").value),memberId:t.data("memberId"),battleType:n,ask:e.querySelector(".ask-select").value.trim(),example:JSON.stringify(a),answer:JSON.stringify(l),askTag:e.querySelector(".askTag").value.trim(),comment:e.querySelector(".comment").value.trim(),source:e.querySelector(".source").value.trim(),diffLevel:e.querySelector(".battle-diffLevel-section input:checked").value};i.ajax({url:"/craft/battle/add",type:"POST",contentType:"application/json",data:JSON.stringify(n),success:function(e){alert(`[등록 결과]
battleId: ${e.battleId}
groupCount: `+e.groupCount)},error:function(e){alert(e)}})}),e.craft={openBattleMakerPanel:function(e,t,o,a){const l=s.querySelector(".battle-category-section select");let n=s.cloneNode(!0);const c=Date.now();i(n).data("semantics",a).data("memberId",t).data("sentenceId",o),n.querySelectorAll("[data-radio]").forEach((e,t)=>{const o=""+e.dataset.radio+c+t;e.querySelectorAll("input[type=radio]").forEach((e,t)=>{e.name=o,e.id=o+t,e.nextElementSibling.htmlFor=o+t})}),i.getJSON("/craft/battle/search/"+o,e=>{let t={};e.forEach(e=>{null==t[e.battleType]&&(t[e.battleType]=[]),t[e.battleType].push(e)});const a=n.querySelector(".existing-battles-section");a.innerHTML="",0==Object.entries(t).length?a.append("등록된 배틀이 없습니다."):Object.entries(t).forEach((e,t)=>{t=Date.now()+t;const o=g({el:"div",className:"js-open-existing-battle",role:"button"});o.dataset.bsToggle="collapse",o.dataset.bsTarget=".js-existing-battle-view"+t,o.innerHTML=`• Battle <span class="existing-battle-type">${e[0]}</span> (으)로 등록 ( ${e[1].length} 건 ) <span class="fold-icon text-xl align-middle"></span>`,a.append(o);t=g({el:"div",className:`js-existing-battle-view${t} fade collapse`,textContent:JSON.stringify(e[1])});a.append(t)})}),0==l.childElementCount&&i.getJSON("/grammar/category/list",e=>{e.forEach(e=>{l.append(g({el:"option",value:e.cid,textContent:(e.parentCategory?"└─ ":"")+e.title}))}),n.querySelector(".battle-category-section select").innerHTML=l.innerHTML}),e.innerHTML="",r(n.querySelector(".craft-maker-container"),a,1),e.append(n)},attachBattleMaker:r}}(jQuery,window,document);