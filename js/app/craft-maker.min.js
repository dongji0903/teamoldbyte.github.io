!async function e(N,t,S){if(N.cachedScript=N.cachedScript||function(e,t){return N.ajax(N.extend(t||{},{dataType:"script",cache:!0,url:e}))},"undefined"==typeof createElement)N.cachedScript("https://static.findsvoc.com/js/util/DOM-util.min.js",{success:()=>e(N,t,S)});else{let d,a=[],r=[],y=[],s={step:[{battleBookId:10000001,title:"단계별 배틀"}]},b,o,n=0,v,u;const J="data-battle-type",B="(코멘트 없음)";let p=[],f=[];const D=await N.get("https://static.findsvoc.com/fragment/craft/maker_templates.min.html",e=>{d=N(e).find(".battle-section-panel")[0]},"html");N.getJSON("https://static.findsvoc.com/data/craft/maker-toolbar.json",e=>{a=e.battleAsks,r=e.battleTypeInfos});let x={},k={},g={},l=createElement({el:"div",className:"btn-toolbar row gx-2",role:"toolbar"});N(S).on("click",".js-collapse-existing-battles",function(){var e=N(this).closest(".battle-section-panel").find(".existing-battles-section");e.is(".collapsing")||(e.collapse("toggle"),N(this).toggleClass("expanded"))}).on("shown.bs.collapse",".battle-book-section",function(){N(this).find(".select-book-type")[0].focus(),anime({targets:N(this).find(".select-book-type")[0],borderWidth:["1px","5px","1px"],easing:"linear",duration:300,loop:2})}).on("change",".select-book-type",function(){const t=this.value;const e=N(this).closest(".add-battle-section").find(".select-book");function n(){e[0].replaceChildren(createElement(Array.from(s[t],e=>({el:"option",value:e.battleBookId,textContent:e.title||"제목 없음",selected:!1})))),e.val(null)[0].focus(),anime({targets:e[0],borderWidth:["1px","5px","1px"],easing:"linear",duration:300})}"new"==this.value?(confirmModal("배틀북 등록 화면으로 이동합니다.",()=>location.assign("/battlebook/add")),this.value=null,e.empty()):s[t]?n():N.getJSON(`/craft/battlebook/my/${this.value}/list`,e=>{s[t]=e,n()})}).on("change","select.select-book ",function(){if(this.value){const t=N(this).closest(".battle-section-panel");var e=N(this).closest(".battle-book-section");e.one("hide.bs.collapse",function(){t.find(".summary-book").collapse("show").find(".input-info").text(N(".select-book-type :selected").text()+" > "+N(".select-book :selected").text())}).collapse("hide"),(e.data("prevOpenSection")?e.data("prevOpenSection"):t.find(".battle-editor-section")).collapse("show")}}).on("click","select.select-book",function(e){N(this).data("selecting")?N(this).data("selecting",!1).trigger("change"):N(this).data("selecting",!0)}).on("blur","select.select-book",function(){N(this).data("selecting",!1)}).on("shown.bs.collapse",".battle-editor-section",function(){anime({targets:this.querySelectorAll(".battle-type-block"),scale:1.1,direction:"alternate",easing:"linear",duration:150})}).on("mouseenter",".battle-type-block",function(){var e=N(this).data("battle-type");N(".battle-type-guide-block").hide(),N(".battle-type-guide-block.battle-type-"+e).show()}).on("mouseleave",".battle-type-block",function(){N(".battle-type-guide-block").hide()}).on("click",".js-context-complete",function(){const t=N(this).closest(".battle-section-panel"),a=this.closest(".add-battle-section"),s=N(a).find(".battle-maker .battle-context")[0];var e=N(a).find(".battle-type-block input:checked").val(),n=N(a).find(".ask-select").val().trim();const o={battleType:e};switch(e){case"1":var[l,i]=[I(s,".answer, .option"),I(s,".answer")];if(0==i.length)return void alertModal("정답이 될 부분을 마우스로 드래그하여 지정하세요.");if(l.length==i.length)return void alertModal("정답이 아닌 부분들을 ‘보기 선택’ 버튼을 선택하여 마우스로 영역을 지정하세요. ");Object.assign(o,{example:JSON.stringify(l),answer:JSON.stringify(i)});break;case"2":l=I(s,".modifier"),i=I(s,".modificand");if(n.includes("모든 피수식")){if(0<l.length)return void alertModal("피수식어만 찾는 문제입니다. 수식어가 선택돼있습니다.");if(0==i.length)return void alertModal("선택된 피수식어가 없습니다. 피수식어들을 마우스로 지정하세요.")}else if(n.includes("모든 수식")){if(0<i.length)return void alertModal("수식어만 찾는 문제입니다. 피수식어가 선택돼있습니다.");if(0==l.length)return void alertModal("선택된 수식어가 없습니다. 수식어들을 마우스로 지정하세요.")}else if(!n.includes("모든")&&0==(l.length&&i.length))return void alertModal("수식어,피수식어를 각각 마우스로 지정하세요.");o.answer=JSON.stringify([l,i]);break;case"3":l=s.querySelector(".pick-right");if(!l)return void alertModal("틀린 보기를 지정할 영역을 선택하세요.");o.example=JSON.stringify([I(s,".pick-right")[0],l.textContent.trim(),l.dataset.wrong.trim()]),o.answer=JSON.stringify([l.textContent.trim()]);break;case"4":i=s.querySelector(".answer-wrong");if(null==s.querySelector(".option"))return void alertModal("문제가 없는 보기들을 추가해 주세요.");if(!i)return void alertModal("틀린 보기를 지정할 영역을 선택하세요.");o.example=JSON.stringify(I(s,".option, .answer-wrong")),o.answer=JSON.stringify([I(s,".answer-wrong")[0],i.textContent.trim(),i.dataset.wrong.trim()]);break;case"5":if(!N(a).find(".select-kor").val())return void alertModal("문제로 제시할 한국어 해석을 선택해 주세요.",()=>N(a).find(".select-kor").focus());if(0==s.querySelectorAll(".option").length)return void alertModal("배치할 대상이 될 어휘들을 마우스로 지정해 주세요.");o.ask=a.querySelector(".select-kor").value,o.kor=N(a).find(".select-kor :selected").text(),o.example=JSON.stringify(I(s,".option"));break;case"6":{if(!N(a).find(".select-kor").val())return void alertModal("문제로 제시할 한국어 해석을 선택해 주세요.",()=>N(a).find(".select-kor").focus());if(null==s.querySelector(".fill-right"))return void alertModal("영어 문장에서 빈 칸으로 만들 영역을 마우스로 지정하세요.");const c=s.querySelectorAll(".fill-right");o.ask=a.querySelector(".select-kor").value,o.kor=N(a).find(".select-kor :selected").text(),o.example=JSON.stringify(Array.from(I(s,".fill-right"),(e,t)=>[e,c[t].textContent.trim()]));break}case"7":{0<s.querySelectorAll(".option").length?o.ask=JSON.stringify(I(s,".option")):o.ask=JSON.stringify([[0,s.textContent.length]]);const r=a.querySelector(".kor-answer");if(!r.value)return void alertModal("정답 해석을 입력해 주세요.",()=>r.focus());o.answer=JSON.stringify(a.querySelector(".kor-answer").value.trim().split(/\s*\/\s*/)),o.example=JSON.stringify(a.querySelector(".battle-opt-ext").value.trim().split(/\s*\/\s*/));break}case"8":{l=s.querySelector(".pick-right");const d=a.querySelector(".battle-opt-ext");if(!l)return void alertModal("문장에서 빈 칸으로 표시할 영역을 마우스로 지정하세요");if(!d.value.trim().split(/\s*\/\s*/).join(""))return void alertModal("오답 보기로 추가할 어휘들을 입력해 주세요.",()=>d.focus());o.example=JSON.stringify([I(s,".pick-right")[0],l.textContent.trim(),d.value.trim().split(/\s*\/\s*/)]),o.answer=JSON.stringify([l.textContent.trim()]);break}}e=N(this).closest(".battle-editor-section");e.data("command",o).one("hide.bs.collapse",function(){const n=N(a).find(".battle-type-block input:checked");t.find(".summary-type").collapse("show").find(".input-info").each((e,t)=>{0==e?N(t).text(n.next("label").find(".type-text").text()):1==e&&N(t).text(N(a).find(".ask-select :selected").text())});var e=createElement(function(l,e){const a=e.answer?"string"==typeof e.answer?JSON.parse(e.answer):e.answer:[],t=e.example?"string"==typeof e.example?JSON.parse(e.example):e.example:[];let i=0;const c=[],{battleType:n,ask:s,kor:o}=e,r=(e,t)=>l.substring(e,t),d=(t,n)=>{return a.find(e=>e[0]==t&&e[1]==n)?"answer":"option"};switch(n){case"1":t.sort(M).forEach(([e,t],n,a)=>{c.push(r(i,e)),c.push({el:"span",className:d(e,t),textContent:r(e,t)}),n==a.length-1&&t<l.length&&c.push(l.substring(t)),i=t});break;case"2":var[u,p]=a;[...u.map((e,t)=>[...e,"modifier",t]),...p.map((e,t)=>[...e,"sem modificand mfd-"+t])].sort(M).forEach(([e,t,n,a],s,o)=>{c.push(r(i,e)),c.push({el:"span",className:n,textContent:r(e,t),dataset:"number"==typeof a?{mfd:a}:""}),s==o.length-1&&t<l.length&&c.push(l.substring(t)),i=t});break;case"3":var[[u,p],f,m]=t;c.push(r(i,u)),c.push("[ "),c.push({el:"span",class:"text-decoration-underline",textContent:f}),c.push(`/${m} ]`),p<l.length&&c.push(l.substring(p));break;case"4":{const[[x,k],,N]=a;t.sort(M).forEach(([e,t],n,a)=>{var s=r(i,e),s=(s&&c.push(s),{el:"span",className:d(e,t),textContent:r(e,t)});x==e&&k==t&&(s.className="text-danger answer",s.textContent=N),c.push(s),n==a.length-1&&t<l.length&&c.push(l.substring(t)),i=t});break}case"5":c.push({el:"span",class:"text-fc-red me-2",textContent:o}),c.push({el:"br"}),t.sort(M).forEach(([e,t],n,a)=>{var s=r(i,e);s&&c.push(s),c.push({el:"span",className:"text-decoration-underline",innerHTML:r(e,t).replaceAll(/./g,"&nbsp;")}),n==a.length-1&&t<l.length&&c.push(l.substring(t)),i=t}),c.push({el:"br"}),c.push({el:"label",textContent:"보기:",class:"fw-bold"}),t.sort(M).forEach(([e,t])=>{c.push({el:"span",class:"ms-2",textContent:`[${r(e,t)}]`})});break;case"6":c.push({el:"span",class:"text-fc-red me-2",textContent:o}),c.push({el:"br"}),t.sort((e,t)=>e[0][0]-t[0][0]).forEach(([[e,t]],n,a)=>{var s=r(i,e),s=(s&&c.push(s),r(e,t));c.push({el:"span",className:"text-decoration-underline",innerHTML:s.charAt(0)+s.substring(1).replaceAll(/./g,"&nbsp;")}),n==a.length-1&&t<l.length&&c.push(l.substring(t)),i=t});break;case"7":var[f,m]=JSON.parse(s)[0],h=r(i,f),b=r(f,m),g=l.substring(m);c.push({el:"span",class:"text-fc-red",children:[h,{el:"span",class:"text-decoration-underline",textContent:b},g]}),c.push({el:"br"}),c.push({el:"label",textContent:"보기:",class:"fw-bold"}),a.concat(t).forEach(e=>{0<e.length&&c.push({el:"span",class:"ms-2"+(a.includes(e)?" text-danger":""),textContent:`[${e}]`})});break;case"8":var[h,b]=t[0],g=r(i,h),y=r(h,b),v=l.substring(b);g&&c.push(g),c.push({el:"span",className:"text-decoration-underline",innerHTML:y.replaceAll(/./g,"&nbsp;")},v),c.push({el:"br"}),c.push({el:"label",textContent:"보기:",class:"fw-bold"}),a.concat(t[2]).forEach(e=>{c.push({el:"span",class:"ms-2"+(a.includes(e)?" text-danger":""),textContent:`[${e}]`})})}return c}(s.textContent,o));t.find(".summary-context").collapse("show").one("shown.bs.collapse",function(){tandem.drawConnections(this.querySelector(".input-info"))}).find(".input-info").empty().append(e)}).collapse("hide"),(e.data("prevOpenSection")?e.data("prevOpenSection"):N(a).find(".battle-detail-section")).collapse("show")}).on("click",".js-detail-complete",function(){const a=N(this).closest(".battle-detail-section").find(".battle-category-section select");if(a.val()){const s=N(this).closest(".add-battle-section");var e=N(this).closest(".battle-detail-section");e.one("hide.bs.collapse",function(){s.find(".summary-detail").collapse("show").find(".input-info").each((e,t)=>{switch(e){case 0:var n=N("<div></div>").html(s.find(".battle-comment-section textarea.comment").val().trim());N(t).text(n.text());break;case 1:N(t).text(a.find("option:selected").text());break;case 2:N(t).text(s.find(".battle-askTag-section input:text").val().trim())}})}).collapse("hide"),(e.data("prevOpenSection")?e.data("prevOpenSection"):s.find(".battle-diffLevel-section")).collapse("show")}else alertModal("출제할 문제가 속하는 문법 분류를 선택해 주세요.",()=>a.focus())}).on("shown.bs.collapse",".battle-diffLevel-section",function(){N(this).closest(".add-battle-section").find(".battle-level-select:checked").next().tooltip("show"),N(this).closest(".add-battle-section").find(".js-add-battle").show().bounce()}).on("hide.bs.collapse",".battle-diffLevel-section",function(){N(this).find('[data-bs-toggle="tooltip"]').each(function(){bootstrap.Tooltip.getOrCreateInstance(this).hide()}),N(this).closest(".add-battle-section").find(".js-add-battle").hide()}).on("click",".js-open-edit",function(){if(this.closest('[class^="summary"]')){var t=N(this).closest(".add-battle-section"),n=t.find(".phase.show"),a=this.closest('[class^="summary"]');let e;switch(a.className.match(/summary-(\w+)/)[1]){case"book":e=".battle-book-section";break;case"type":e=".battle-editor-section",t.find(".summary-context").collapse("hide");break;case"context":e=".battle-editor-section",t.find(".summary-type").collapse("hide");break;case"detail":e=".battle-detail-section"}N(a).collapse("hide"),t.find(e).collapse("show").data("prevOpenSection",n),n.collapse("hide")}}).on("change",".battle-type-block input[type=radio]",function(){var e=N(this).closest(".battle-section-panel").data("semantics");i(this.closest(".add-battle-section").querySelector(".craft-maker-container"),e,parseInt(this.value)),anime&&anime({targets:this.closest(".add-battle-section").querySelector(".ask-select"),scaleY:1.5,direction:"alternate",easing:"linear",duration:150})}).on("change",".ask-select",function(){var e=this.closest(".battle-section-panel"),t=this.querySelector("option:checked"),n=t?.dataset?.tag,a=e.querySelector(".askTag"),a=(a.value=n||"",e.querySelector(".battle-type-block input:checked").value);"2"==a&&(t?.value?.includes("의 피수식")||t?.value?.includes("의 수식"))&&(n=t.value.includes("의 피수식")?"피수식":"수식",e=t.value.replace("의 "+n,""),null!=(a=prompt(`질문 : "???의 ${n}어를 고르세요."
???에 표시할 어휘를 입력하세요.`,e))&&0<a.length?(t.value=a+"의 "+n,t.innerHTML=`(지정)${a}의 ${n}어를 선택하세요.`):t.selected=!1)}).on("change",".battle-category-section select",function(){this.closest(".add-battle-section").querySelector(".askTag").value=g[parseInt(this.value)]||""}).on("change",".battle-maker [role=toolbar] [type=checkbox]",function(){var e=this.closest(".battle-maker");this.checked?(e.dataset.wrapper=this.value,this.closest("[role=toolbar]").querySelectorAll("[type=checkbox]:checked").forEach(e=>{0!=this.compareDocumentPosition(e)&&(e.checked=!1)}),getSelection().isCollapsed||C(this.closest(".battle-maker"))):e.dataset.wrapper=""}).on("click",".battle-context *",function(){this.closest(".battle-maker")&&("SPAN"==this.nodeName?("7"==this.closest(".battle-context").dataset.battleType&&(this.closest(".battle-maker").querySelector(".select-kor .custom-trans")?.remove(),this.closest(".battle-maker").querySelector(".select-kor").classList.remove("pe-none")),this.outerHTML=this.innerHTML):this.remove())}).on("click",".battle-maker [value=undo], .battle-maker [value=redo]",function(){var e="undo"==this.value,t=(e?p:f).pop(),n=this.closest(".battle-maker"),a=n.querySelector(".battle-context");(e?f:p).push(a.innerHTML),a.innerHTML=t,N(a).animate({opacity:.5},100).animate({opacity:1},100),n.querySelector("[value=undo]").disabled=0==p.length,n.querySelector("[value=redo]").disabled=0==f.length}).on("keyup",function(e){var t=e.target.closest(".battle-maker");t&&(e.ctrlKey&&"Z"==e.key.toUpperCase()?N(t).find("[value=undo]").trigger("click"):e.ctrlKey&&"Y"==e.key.toUpperCase()&&N(t).find("[value=redo]").trigger("click"))}).on("input change",".add-battle-section :input,.add-battle-section textarea",function(){N(this.closest(".add-battle-section")).find(".js-add-battle").prop("disabled",!1)}).on("change",".select-kor",function(){this.closest(".battle-maker").querySelector(".kor-answer")&&(this.closest(".battle-maker").querySelector(".kor-answer").value=this.selectedOptions[0].text)}).on("click",".js-add-battle",function(){const c=this.closest(".add-battle-section"),r=parseInt(c.querySelector(".select-book").value);if(Number.isNaN(r))alertModal("❗배틀북을 선택해 주세요.");else{const d=c.closest(".battle-section-panel"),u=c.querySelector(".battle-context"),p=parseInt(c.querySelector(".battle-category-section select").value),f=c.querySelector(".battle-type-block input:checked").value;var e=c.querySelector(".battle-diffLevel-section input:checked").value,t=c.querySelector(".ask-select").value.trim();const m=c.querySelector(".askTag").value.trim();var n=N(c).find("textarea.comment").summernote("code").trim(),a=u.textContent.trim().length;if(1500<n.length)alertModal("배틀 해설의 길이가 너무 깁니다.");else{const h=Object.assign({battleBookId:r,categoryId:p,battleType:f,ask:t,askTag:m,comment:n,source:o,diffLevel:e,engLength:a,sentenceId:N(d).data("sentenceId"),memberId:v,example:"",answer:"",diffSpecificLevel:L(e,a)},N(c).find(".battle-editor-section").data("command"));N.ajax({url:"/craft/battle/add",type:"POST",contentType:"application/json",data:JSON.stringify(h),success:function(e){N(c).find(".battle-diffLevel-section").trigger("hide.bs.collapse");var a=m,s=x;if(0<a.length)for(let t=0,n=a.length;t<n;t++)for(let e=t+1;e<=n;e++){var o=a.substring(t,e);o in s||(s[o]=[]),s[o].includes(a)||s[o].push(a),s[o].sort()}g[p]=m,c.querySelector(".select-kor .custom-trans")&&(c.querySelector(".select-kor .custom-trans").remove(),c.querySelector(".select-kor").classList.remove("pe-none")),S.getElementById("craftResultModal")||S.body.appendChild(N(D).find("#craftResultModal").clone(!0)[0]),N(c).find("textarea.comment").summernote("reset"),N("#craftResultModal .battle-id").text(e.battleId),N("#craftResultModal .group-count").text(e.groupCount),b={type:c.querySelector(".select-book-type").value,bookId:r},u.replaceChildren(u.textContent),h.battleId=e.battleId,h.grammarTitle=y.find(e=>e.cid==p).title;var e=d.querySelector(".existing-battles-section"),t=j(N(d).data("eng"),h);let n=e.querySelector(`.js-open-existing-battle[${J}="${f}"]`),l;n?(i=n.querySelector(".battle-count"),n.appendChild(createElement({el:"span",class:"badge bg-danger",textContent:"New"})),i.textContent=parseInt(i.textContent)+1,l=S.querySelector(n.dataset.bsTarget)):(e.querySelector(`[${J}]`)||e.replaceChildren(),i=Date.now()+1,[n,l]=O(f,1,i,[]),n=createElement(n),l=createElement(l),e.append(n),N(n).css("height",0).animate({height:"100%"},500,function(){this.style.height="auto"}),n.appendChild(createElement({el:"span",class:"badge bg-danger",textContent:"New"})),e.append(l));var i=createElement(t);N(i).find(".js-delete-battle").after(createElement({el:"span",class:"badge bg-danger",textContent:"New"})),l.append(i),N(i).css("display","none").slideDown(),N("#craftResultModal").modal("show").on("hidden.bs.modal",()=>{N(c).slideUp(()=>{N(c).remove(),N(d).find(".open-add-battle-section").slideDown()}),n.scrollIntoView({behavior:"instant",block:"nearest"})})},error:function(e){alertModal(e)}})}}}).on("click",".js-delete-battle",function(){const n=this.closest(".battle-preview-one"),a=n.closest(".battle-preview"),s=a.previousElementSibling;var e=n.dataset.battleId;N.post("/craft/battle/del/"+e,function(){alertModal("배틀이 삭제되었습니다."),n.remove();var e=s.querySelector(".battle-count"),t=parseInt(e.textContent)-1;0<t?e.textContent=t:(a.remove(),s.remove())}).fail(()=>alertModal("배틀 삭제에 실패했습니다."))}).on("click",".js-open-add-battle",function(){const e=N(d).find(".add-battle-section").clone(!0);N(this).closest(".open-add-battle-section").before(e).slideUp(()=>{A(e[0])})});const H=/[^\s,.!?;:…]/,$=/^(\s|[,.!?;:…])/,R=/(\s|[,.!?;:…])$/,F=/('m|'re|'s|'d|'ll|'ve)$/,c={A:[{limit:30,rank:"이병"},{limit:60,rank:"일병"},{limit:1/0,rank:"병장"}],B:[{limit:50,rank:"하사"},{limit:70,rank:"상사"},{limit:100,rank:"소위"},{limit:120,rank:"대위"},{limit:1/0,rank:"소령"}],C:[{limit:150,rank:"대령"},{limit:200,rank:"준장"},{limit:1/0,rank:"소장"}]};function i(e,t,n){e.replaceChildren(),f=[],p=[];var a,s=createElement({el:"div",className:"battle-maker row g-2",tabIndex:0}),o=(e.append(s),Array.from(r)[n-1]),o=([1,2].includes(n)&&o.forEach(e=>{null!=e.selector&&null!=t.querySelector(".sem"+e.selector)&&(e.recommended=!0)}),e.closest(".battle-section-panel").querySelector(".ask-select").replaceChildren(createElement(m(n,o))),[1,2].includes(n)&&(o=s.closest(".battle-section-panel").querySelector(".ask-select"),N(o).trigger("change")),w(n,s),tandem?.cleanSvocDOMs(t).textContent),l=o.length;{var i=l;(l=N(e).closest(".battle-section-panel").find(".battle-diffLevel-section").empty()[0]).appendChild(createElement([{el:"div",className:"text-fc-purple fw-bold my-auto",textContent:"Step 4) 난이도 선택"},{el:"span",className:"sub-title mt-0 mb-2 d-block",textContent:"문장의 길이와 fico score를 참조하여 출제한 문제의 적절한 난이도를 선택해주세요."}]));const c=Date.now();q([{el:"label",className:"col-1 lh-1 my-auto text-fc-purple fw-bold",textContent:"난이도"}].concat(Array.from([{text:"쉬움",value:"A"},{text:"보통",value:"B"},{text:"어려움",value:"C"}],(e,t)=>{var n=2==t&&150<i||1==t&&i<=150&&80<i||0==t&&i<=80;return[{el:"input",type:"radio",autocomplete:"off",name:"btnRadioBattleLevel"+c,id:"btnRadioBattleLevel"+c+t,className:"btn-check battle-level-select",checked:n,value:e.value},{el:"label",textContent:e.text,"data-bs-toggle":n?"tooltip":"",htmlFor:"btnRadioBattleLevel"+c+t,"data-bs-html":"true","data-bs-title":"문장 길이로 시스템이 파악한<br>최소 난이도입니다.",className:"diff-btn col btn col-auto px-4 ms-1 rounded-pill btn-outline-fico"+(2==t?" me-auto":"")}]})),l),l.appendChild(createElement([{el:"label",className:"col-1 lh-1 my-auto text-fc-purple fw-bold",textContent:"길이"},{el:"span",className:"col-auto my-auto eng-length me-auto",textContent:i}]))}[3,4,5].includes(n)&&(e=s.closest(".add-battle-section")?.querySelector(".battle-category-section select"),N(e).trigger("change")),h(o,s);l=s.querySelector(".battle-context").dataset.battleType=n,e=s;[5,6,7].includes(l)&&((a=N(D).find(".craft-editor-ext-kor-select").clone(!0)).find(".select-kor").append(createElement(Array.from(N(e).closest(".battle-section-panel").data("transList"),({id:e,text:t})=>({el:"option",value:e,textContent:t.trim(),"data-trans":t.trim(),selected:!1})))),N(e).append(a)),7==l&&N(e).append(N(D).find(".craft-editor-ext-kor-input").clone(!0)),[7,8].includes(l)&&(a=N(D).find(".craft-editor-ext-wrong-input").clone(!0),l=" 예) "+(7===l?"우리가/우리를":"we/us"),a.find(".battle-opt-ext").attr("title",a.find(".battle-opt-ext").attr("title")+l).attr("title",a.find(".battle-opt-ext").attr("title")+l),N(e).append(a))}function w(e,t){N(l).empty().append(N(D).find(".craft-editor-btns-common,.craft-editor-btns-"+e).clone(!0));const n=Date.now();N(l).find("input").each((e,t)=>t.id="checkBox"+(n+e)),N(l).find("label").each((e,t)=>t.htmlFor="checkBox"+(n+e)),t.prepend(l.cloneNode(!0)),t.dataset.wrapper=t.querySelector(".btn-toolbar input:checked")?.value||""}function m(a,e){const s=[];return e.forEach((e,t)=>{var n={el:"option"};e.recommended&&(n.className="bg-fc-light-purple"),n.value=e.tag||"#"+a,e.tag&&(n["data-tag"]=e.tag),n.innerHTML=T(a,e.tag),0==t&&2!=a&&(n.selected=!0),s.push(n)}),2==parseInt(a)&&(e=null!=e.find(e=>e.recommended),s.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"의 피수식",innerHTML:"(지정)___의 피수식어를 선택하세요."}),s.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"의 수식",innerHTML:"(지정)___의 수식어를 선택하세요."}),s.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"모든 피수식",innerHTML:"피수식어를 모두 선택하세요."}),s.unshift({el:"option",className:e?"bg-fc-light-purple":"",value:"모든 수식",selected:!0,innerHTML:"수식어를 모두 선택하세요."})),s}function h(e,t,n){q({el:"div",className:"row g-0",children:[{el:"div",className:"battle-context fs-5 bg-white mt-3 px-2 col form-control",children:n?E(e,n):e,onmouseup:()=>C(t)}]},t)}function C(e){var t=getSelection(),n=e.dataset.wrapper;if(!t.isCollapsed&&n){var a=e.querySelector(".battle-context");if(t.toString().replace(/\W/g,"")!=a.textContent.replace(/\W/g,"")&&8&t.anchorNode.compareDocumentPosition(a)&t.focusNode.compareDocumentPosition(a)){var s=parseInt(a.dataset.battleType);if(([3,4].includes(s)&&n.match(/pick-right|answer-wrong/)||7==s||8==s)&&0<a.getElementsByClassName(n).length)alertModal("이 유형의 배틀은 복수 정답을 허용하지 않습니다.\n기존 정답을 눌러 지워 주세요."),getSelection().removeAllRanges();else{for((t.anchorNode.compareDocumentPosition(t.focusNode)&Node.DOCUMENT_POSITION_PRECEDING||0==t.anchorNode.compareDocumentPosition(t.focusNode)&&t.anchorOffset>t.focusOffset)&&t.setBaseAndExtent(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset);0<t.anchorOffset&&t.anchorNode.textContent.charAt(t.anchorOffset).match(H)&&t.anchorNode.textContent.charAt(t.anchorOffset-1).match(H)&&(![1,3].includes(s)||!t.toString().trim().match(F));)t.setBaseAndExtent(t.anchorNode,t.anchorOffset-1,t.focusNode,t.focusOffset);for(;t.toString().match($);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset+1,t.focusNode,t.focusOffset);for(;t.focusOffset<t.focusNode.textContent.length&&t.focusNode.textContent.charAt(t.focusOffset-1).match(H)&&t.focusNode.textContent.charAt(t.focusOffset).match(H)&&(![1,3].includes(s)||!(2<t.focusNode.textContent.length&&t.focusNode.textContent.substring(t.focusOffset,t.focusOffset+3).trim().match(F)));)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset+1);for(;t.toString().match(R);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset-1);if(0!=t.toString().trim().length&&t.toString().replace(/\W/g,"")!=a.textContent.replace(/\W/g,"")){o=a,p.push(o.innerHTML),f=[],o.closest(".battle-maker").querySelector('[role=toolbar] [value="undo"]').disabled=!1;for(var o=S.createElement("span"),l=(o.className=n,t.getRangeAt(0)),i=(o.textContent=l.extractContents().textContent,l.insertNode(o),t.removeAllRanges(),S.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>0===e.textContent.length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}));i.nextNode();)i.currentNode.parentNode.removeChild(i.currentNode);for(var c,r,d=S.createTreeWalker(a,NodeFilter.SHOW_ELEMENT);d.nextNode();){let e=d.currentNode["textContent"];e.startsWith(" ")&&(r=e.match(/^\s+/)[0],c=S.createTextNode(r),d.currentNode.parentNode.insertBefore(c,d.currentNode),d.currentNode.textContent=e.substring(r.length),e=d.currentNode.textContent),e.endsWith(" ")&&(c=e.match(/\s+$/)[0],r=S.createTextNode(c),d.currentNode.parentNode.insertBefore(r,d.nextSibling),d.currentNode.textContent=e.substring(0,e.length-c.length))}[3,4,7].includes(s)&&n.match(/pick-right|answer-wrong/)&&((l=prompt(o.textContent+"의 오답을 입력하세요."))?o.dataset.wrong=l:a.innerHTML=p.pop()),7==s&&((n=prompt("선택한 구간의 해석을 입력하세요."))?((o=e.querySelector(".select-kor .custom-trans")||e.querySelector(".select-kor").appendChild(createElement({el:"option",className:"custom-trans",selected:!0,children:["(출제자 해석) ",{el:"span",className:"custom-input"}]}))).value=n,o.dataset.trans=n,o.querySelector(".custom-input").textContent=n,e.querySelector(".kor-answer").value=n):a.innerHTML=p.pop())}}}}}function O(e,t,n,a){return[{el:"div",className:"js-open-existing-battle d-inline-block btn border",role:"button","data-battle-type":e,"data-bs-toggle":"collapse","data-bs-target":"#"+("existingBattleView"+n),children:[`Battle #${e}: `,{el:"span",className:"battle-count",textContent:t}," 건 ",{el:"span",className:"fold-icon text-xl align-middle"}]},{el:"div",id:"existingBattleView"+n,className:"battle-preview fade collapse show",children:a}]}function q(e,t){!function a(s,o){Array.isArray(s)?s.forEach((e,t)=>s[t]=a(e,o)):"object"==typeof s&&Object.entries(s).forEach(([e,n])=>{n&&Array.isArray(n)&&n.forEach((e,t)=>n[t]=a(e,o)),s[e]=n});return o.apply(this,[s])}(e,e=>(e.className||"div"!=e.el?e.title&&"checkbox"!=e.type&&(e["data-toggle"]="tooltip",e["data-placement"]="bottom"):e.className="btn-group col-8",e));e=createElement(e);e.querySelectorAll("[type=checkbox]").forEach(e=>{e.className||(e.className="btn-check");var t="btn-check-"+n++,t=(e.id=t,createElement({el:"label",htmlFor:t,className:"btn btn-outline-fico",textContent:e.textContent}));e.title&&(t.title=e.title,t.dataset.toggle="tooltip",t.dataset.placement="bottom"),e.after(t)}),t.append(e)}function I(e,n){let a=0,s=[];return e.childNodes.forEach(e=>{var t=e.textContent.replaceAll(/[\n\u200b]/gm,"").length;e.className&&e.matches(n)&&s.push([a,a+t]),a+=t}),s}function M(e,t){return e[0]-t[0]}function j(r,e){var t=Date.now();const{battleId:n,battleType:d,ask:u,answer:a,example:s,askTag:o,diffLevel:l,categoryId:i,memberId:c,engLength:p,sentenceId:f,grammarTitle:m,comment:h,source:b}=e,g={el:"div",dataset:{battleId:n,battleType:d,ask:u,answer:a,example:s,memberId:c,engLength:p,sentenceId:f},className:"battle-preview-one m-1 ms-0 bg-light border border-2 px-2",children:[{el:"div",className:"row",children:[{el:"div",className:"col-auto",children:[{el:"label",className:"fw-bold me-2",textContent:"질문:"},{el:"span",textContent:T(parseInt(d),u)}]},{el:"div",className:"diff-section col-auto position-relative","data-diff":l,onmouseover:v==c?function(){N(this).find(".js-open-edit-battle-diff").toggle(!N(this).find(".edit-diff-section").is(":visible"))}:"",onmouseleave:v==c?function(){N(this).find(".js-open-edit-battle-diff").hide()}:"",children:[{el:"label",className:"fw-bold me-2",textContent:"난이도:"},{el:"span",textContent:l},{el:"button",class:"js-open-edit-battle-diff btn btn-sm btn-fico",textContent:"수정",style:"display: none;",onclick:function(){const e=N(this).prev("span").hide();N(this).closest(".diff-section").find(".edit-diff-section").show().find("input").filter(function(){return this.value==e.text()}).prop("checked",!0)}}].concat(c==v?[{el:"div",class:"edit-diff-section",style:"display: none;",children:[{el:"input",type:"radio",id:"diff"+t,name:"diff"+t,class:"btn-check",value:"A"},{el:"label",htmlFor:"diff"+t,class:"col-auto btn btn-sm btn-outline-fico rounded-pill",textContent:"쉬움"},{el:"input",type:"radio",id:"diff"+(t+1),name:"diff"+t,class:"btn-check",value:"B"},{el:"label",htmlFor:"diff"+(t+1),class:"col-auto btn btn-sm btn-outline-fico rounded-pill",textContent:"보통"},{el:"input",type:"radio",id:"diff"+(t+2),name:"diff"+t,class:"btn-check",value:"C"},{el:"label",htmlFor:"diff"+(t+2),class:"col-auto btn btn-sm btn-outline-fico rounded-pill",textContent:"어려움"},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){N(this).closest(".edit-diff-section").hide(),N(this).closest(".diff-section").find("span").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){const e=N(this).siblings("input:checked").val();var t=N(this).closest(".battle-preview-one"),n=Object.assign({},t.get(0).dataset);n.battleId=parseInt(n.battleId),n.memberId=parseInt(n.memberId),n.sentenceId=parseInt(n.sentenceId),n.engLength=parseInt(n.engLength),n.categoryId=parseInt(t.find(".grammar-section")[0].dataset.cid),n.source=t.find(".source-section")[0].dataset.source,n.askTag=t.find(".tag-section")[0].dataset.tag,n.comment=t.find(".comment-section")[0].dataset.comment,N.ajax({url:"/craft/battle/edit",type:"post",contentType:"application/json",data:JSON.stringify(Object.assign({},n,{diffLevel:e})),success:()=>{alertModal("난이도를 수정했습니다.",()=>{N(this).closest(".edit-diff-section").hide(),N(this).closest(".diff-section").attr("data-diff",e).find("span").text(e).show()})},error:function(){alertModal("난이도 수정에 실패했습니다.")}})}}]}]:[])},{el:"div",className:"grammar-section col-auto position-relative","data-cid":i,onmouseover:v==c?function(){N(this).find(".js-open-edit-battle-grammar").toggle(!N(this).find(".edit-grammar-section").is(":visible"))}:"",onmouseleave:v==c?function(){N(this).find(".js-open-edit-battle-grammar").hide()}:"",children:[{el:"label",className:"fw-bold me-2",textContent:"문법:"},{el:"span",textContent:m||"(미입력)"},{el:"button",class:"js-open-edit-battle-grammar btn btn-sm btn-fico",textContent:"수정",style:"display: none;",onclick:function(){N(this).prev("span").hide();var e=N(this).closest(".grammar-section");e.find(".edit-grammar-section").show().find("select").val(e.attr("data-cid"))}}].concat(v==c?[{el:"div",class:"edit-grammar-section",style:"display: none;",children:[{el:"select",class:"form-select",children:Array.from(y,e=>({el:"option",value:e.cid,textContent:(e.parentCategory?"└─ ":"")+e.title,selected:e.cid==i}))},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){N(this).closest(".edit-grammar-section").hide(),N(this).closest(".grammar-section").find("span").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){const t=parseInt(N(this).siblings("select").val());N.ajax({url:"/craft/battle/edit/category",type:"post",contentType:"application/json",data:JSON.stringify({battleId:n,categoryId:t}),success:()=>{alertModal("문법 카테고리를 수정했습니다.",()=>{N(this).closest(".edit-grammar-section").hide(),N(this).closest(".grammar-section").attr("data-cid",t).find("span").text(y.find(e=>e.cid==t).title).show()})},error:function(){alertModal("문법 카테고리 수정에 실패했습니다.")}})}}]}]:[])},{el:"div",className:"col-auto source-section position-relative","data-source":b,onmouseover:v==c?function(){N(this).find(".js-open-edit-battle-source").toggle(!N(this).find(".edit-source-section").is(":visible"))}:"",onmouseleave:v==c?function(){N(this).find(".js-open-edit-battle-source").hide()}:"",children:[{el:"label",className:"fw-bold me-2",textContent:"출처:"},{el:"span",textContent:b||"(출처없음)"},{el:"button",class:"js-open-edit-battle-source btn btn-sm btn-fico",textContent:"수정",style:"display: none;",onclick:function(){N(this).prev("span").hide(),N(this).closest(".source-section").find(".edit-source-section").show().find("input").val(N(this).prev("span").text())}}].concat(c==v?[{el:"div",class:"edit-source-section",style:"display: none;",children:[{el:"input",type:"text",class:"form-control",value:b||"",onclick:function e(){N(this).autocomplete({minLength:1,delay:50,source:function(e,t){const n=e.term&&e.term.trim();n in k?t(k[n]):N.getJSON("/craft/battle/source/search/{}".replace("{}",n),function(e){0<e.length&&(k[n]=e.sort()),t(e)}).fail(()=>{t([])})}}),this.removeEventListener("click",e)}},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){N(this).closest(".edit-source-section").hide(),N(this).closest(".source-section").find("span").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){const e=N(this).siblings("input").val().trim();var t=N(this).closest(".battle-preview-one"),n=Object.assign({},t.get(0).dataset);n.battleId=parseInt(n.battleId),n.memberId=parseInt(n.memberId),n.sentenceId=parseInt(n.sentenceId),n.engLength=parseInt(n.engLength),n.diffLevel=t.find(".diff-section")[0].dataset.diff,n.categoryId=parseInt(t.find(".grammar-section")[0].dataset.cid),n.askTag=t.find(".tag-section")[0].dataset.tag,n.comment=t.find(".comment-section")[0].dataset.comment,N.ajax({url:"/craft/battle/edit",type:"post",contentType:"application/json",data:JSON.stringify(Object.assign({},n,{source:e})),success:()=>{alertModal("출처를 수정했습니다.",()=>{N(this).closest(".edit-source-section").hide(),N(this).closest(".source-section").attr("data-source",e).find("span").text(e).show()})},error:function(){alertModal("출처 수정에 실패했습니다.")}})}}]}]:[])},{el:"div",className:"col-auto tag-section position-relative","data-tag":o,onmouseover:v==c?function(){N(this).find(".js-open-edit-battle-tag").toggle(!N(this).find(".edit-tag-section").is(":visible"))}:"",onmouseleave:v==c?function(){N(this).find(".js-open-edit-battle-tag").hide()}:"",children:[{el:"label",className:"fw-bold me-2",textContent:"태그:"},{el:"span",textContent:o||"(태그없음)"},{el:"button",class:"js-open-edit-battle-tag btn btn-sm btn-fico",textContent:"수정",style:"display: none;",onclick:function(){N(this).prev("span").hide(),N(this).closest(".tag-section").find(".edit-tag-section").show().find("input").val(N(this).prev("span").text())}}].concat(c==v?[{el:"div",class:"edit-tag-section",style:"display: none;",children:[{el:"input",type:"text",class:"form-control",value:o||"",onclick:function e(){N(this).autocomplete({minLength:1,delay:50,source:function(e,t){const n=e.term&&e.term.trim();n in x?t(x[n]):N.getJSON("/craft/battle/tag/search/{}".replace("{}",n),function(e){0<e.length&&(x[n]=e.sort()),t(e)}).fail(()=>{t([])})}}),this.removeEventListener("click",e)}},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){N(this).closest(".edit-tag-section").hide(),N(this).closest(".tag-section").find("span").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){const e=N(this).siblings("input").val().trim();N.ajax({url:"/craft/battle/edit/tag",type:"post",contentType:"application/json",data:JSON.stringify({battleId:n,askTag:e}),success:()=>{alertModal("태그를 수정했습니다.",()=>{N(this).closest(".edit-tag-section").hide(),N(this).closest(".tag-section").attr("data-tag",e).find("span").text(e).show()})},error:function(){alertModal("태그 수정에 실패했습니다.")}})}}]}]:[])}]},{el:"div",className:"context-section mt-2",onmouseover:v==c?function(){N(this).find(".js-open-edit-battle-context").toggle(!N(this).find(".edit-context-section").is(":visible"))}:"",onmouseleave:v==c?function(){N(this).find(".js-open-edit-battle-context").hide()}:"",children:[{el:"label",className:"col-1 fw-bold me-2",textContent:"본문"},{el:"div",className:"battle-context pb-3","data-battle-type":d,children:E(r,e)},v==c?{el:"button",className:"js-open-edit-battle-context btn btn-sm btn-fico",textContent:"본문 수정",style:"display: none;",onclick:function(){var e=N(this).closest(".context-section");const t=e.find(".edit-context-section").show().find(".battle-maker").empty()[0];var n=N(this).closest(".battle-preview-one")[0],e=parseInt(e.children(".battle-context").attr("data-battle-type"));switch(w(e,t),t.appendChild(N(this).prev(".battle-context")[0].cloneNode(!0)),e){case 5:case 6:t.querySelector(".select-kor").value=n.dataset.ask;break;case 7:t.querySelector(".kor-answer").value=JSON.parse(n.dataset.answer).join(" / ");case 8:t.querySelector(".battle-opt-ext").value=JSON.parse(n.dataset.example)[2].join(" / ")}N(this).prev(".battle-context").hide(),t.querySelector(".battle-context").classList.add("my-2","p-3","bg-white"),t.querySelector(".battle-context").onmouseup=function(){C(t)}}}:"",v==c?{el:"div",className:"edit-context-section bg-info position-relative p-3",style:"display: none;",children:[{el:"div",className:"battle-maker"},{el:"button",class:"col-auto btn btn-outline-fico",textContent:"취소",onclick:function(){N(this).closest(".edit-context-section").hide(),N(this).closest(".context-section").children(".battle-context").show()}},{el:"button",class:"col-auto btn btn-fico",textContent:"수정",onclick:function(){var e=N(this).closest(".edit-context-section").find(".battle-context")[0],t=e.closest(".battle-maker"),n=N(this).closest(".battle-preview-one");const a=Object.assign({},n.get(0).dataset);switch(a.battleId=parseInt(a.battleId),a.memberId=parseInt(a.memberId),a.sentenceId=parseInt(a.sentenceId),a.engLength=parseInt(a.engLength),a.diffLevel=n.find(".diff-section")[0].dataset.diff,a.categoryId=parseInt(n.find(".grammar-section")[0].dataset.cid),a.source=n.find(".source-section")[0].dataset.source,a.askTag=n.find(".tag-section")[0].dataset.tag,a.comment=n.find(".comment-section")[0].dataset.comment,d){case"1":var[s,o]=[I(e,".answer, .option"),I(e,".answer")];if(0==o.length)return void alertModal("문제로 만들 어구를 선택해 주세요.");if(s.length==o.length)return void alertModal("오답 보기를 선택해 주세요.");Object.assign(a,{example:JSON.stringify(s),answer:JSON.stringify(o)});break;case"2":s=I(e,".modifier"),o=I(e,".modificand");if(u.includes("모든 피수식")&&(0<s.length||0==o.length))return void alertModal("피수식어만 1개 이상 선택해 주세요.");if(u.includes("모든 수식")&&(0<o.length||0==s.length))return void alertModal("수식어만 1개 이상 선택해 주세요.");if(!u.includes("모든")&&0==(s.length&&o.length))return void alertModal("수식어/피수식어를 1쌍 이상 선택해 주세요.");a.answer=JSON.stringify([s,o]);break;case"3":s=e.querySelector(".pick-right");if(!s)return void alertModal("문제로 만들 어구를 선택해 주세요.");a.example=JSON.stringify([I(e,".pick-right")[0],s.textContent.trim(),s.dataset.wrong.trim()]),a.answer=JSON.stringify([s.textContent.trim()]);break;case"4":o=e.querySelector(".answer-wrong");if(null==e.querySelector(".option"))return void alertModal("보기 어구를 선택해 주세요.");if(!o)return void alertModal("정답 어구를 선택해 주세요.");a.example=JSON.stringify(I(e,".option, .answer-wrong")),a.answer=JSON.stringify([I(e,".answer-wrong")[0],o.textContent.trim(),o.dataset.wrong.trim()]);break;case"5":if(0==e.querySelectorAll(".option").length)return void alertModal("보기를 추가해 주세요.");a.ask=t.querySelector(".select-kor").value,a.example=JSON.stringify(I(e,".option"));break;case"6":{if(null==e.querySelector(".fill-right"))return void alertModal("문제로 만들 어구를 선택해 주세요.");const l=e.querySelectorAll(".fill-right");a.ask=t.querySelector(".select-kor").value,a.example=JSON.stringify(Array.from(I(e,".fill-right"),(e,t)=>[e,l[t].textContent.trim()]));break}case"7":{0<e.querySelectorAll(".option").length?a.ask=JSON.stringify(I(e,".option")):a.ask=JSON.stringify([[0,p]]);const i=t.querySelector(".kor-answer");if(!i.value)return void alertModal("정답 해석을 입력해 주세요.",()=>i.focus());a.answer=JSON.stringify(t.querySelector(".kor-answer").value.trim().split(/\s*\/\s*/)),a.example=JSON.stringify(t.querySelector(".battle-opt-ext").value.trim().split(/\s*\/\s*/));break}case"8":{s=e.querySelector(".pick-right");const c=t.querySelector(".battle-opt-ext");if(!s)return void alertModal("문제로 만들 어구를 선택해 주세요.");if(!c.value.trim().split(/\s*\/\s*/).join(""))return void alertModal("오답 보기를 입력해 주세요.",()=>c.focus());a.example=JSON.stringify([I(e,".pick-right")[0],s.textContent.trim(),c.value.trim().split(/\s*\/\s*/)]),a.answer=JSON.stringify([s.textContent.trim()]);break}}N.ajax({url:"/craft/battle/edit",type:"post",contentType:"application/json",data:JSON.stringify(Object.assign({},a)),success:()=>{alertModal("본문을 수정했습니다.",()=>{g.dataset.ask=a.ask,g.dataset.example=a.example,g.dataset.answer=a.answer,N(this).closest(".edit-context-section").hide(),N(this).closest(".context-section").children(".battle-context").show()[0].replaceChildren(createElement(E(r,a)))})},error:function(){alertModal("본문 수정에 실패했습니다.")}})}}]}:""]},{el:"div",className:"row pb-3 comment-section","data-comment":h||"",children:[{el:"label",className:"col-1 fw-bold me-2",textContent:"코멘트"},{el:"div",className:"col-10 position-relative",children:[{el:"span",className:"comment short text-truncate",role:"button",style:"display: block",textContent:N("<div></div>").html(h||B).text(),onclick:function(){N(this).add(N(this).siblings(".comment")).toggle()}},{el:"div",className:"comment long ws-breakspaces",role:"button",style:"display: none;",innerHTML:h||B,onclick:function(){N(this).add(N(this).siblings(".comment")).toggle()}},v==c?{el:"button",className:"js-open-edit-battle-comment col-auto position-absolute mt-3 btn btn-sm btn-fico",textContent:"코멘트 수정",onclick:function(){var e=N(this).closest(".comment-section").find(".edit-comment-section"),t=(e.add(this).toggle(),N(this).siblings(".comment").hide(),N(this).siblings(".comment.long").html()==B?"":N(this).siblings(".comment.long").html());openSummernote(e.find("textarea").val(t))}}:""]}].concat(v==c?[{el:"div",className:"edit-comment-section",style:"display: none;",children:[{el:"textarea",maxLength:1500},{el:"div",class:"btn-group btn-set float-end mt-0 mt-sm-2",children:[{el:"button",class:"btn btn-sm btn-outline-fico",textContent:"취소",onclick:function(){N(this).closest(".edit-comment-section").hide().closest(".comment-section").find(".comment.long").show(),N(this).closest(".edit-comment-section").children("textarea").summernote("destroy"),N(this).closest(".comment-section").find(".js-open-edit-battle-comment").show()}},{el:"button",class:"btn btn-sm btn-fico",textContent:"수정",onclick:function(){const t=N(this).closest(".edit-comment-section").children("textarea").summernote("code").trim();N.ajax({url:"/craft/battle/edit/comment",type:"post",contentType:"application/json",data:JSON.stringify({battleId:n,comment:t}),success:()=>{alertModal("코멘트를 수정했습니다.",()=>{N(this).closest(".edit-comment-section").hide().children("textarea").summernote("destroy");var e=N(this).closest(".comment-section");e.attr("data-comment",t),e.find(".comment.long").html(t||B).show(),e.find(".comment.short").text(e.find(".comment.long").text()).hide(),e.find(".js-open-edit-battle-comment").show()})},error:()=>{alertModal("코멘트 수정에 실패했습니다.")}})}}]}]}]:[])}]};return v==c&&g.children.push({el:"div",class:"position-relative",style:{width:"fit-content"},children:[{el:"button",className:"btn btn-sm btn-fico js-delete-battle",textContent:"배틀 삭제"}]}),g}function E(o,e){const a=e.answer?"string"==typeof e.answer?JSON.parse(e.answer):e.answer:[];var t=e.example?"string"==typeof e.example?JSON.parse(e.example):e.example:[];let l=0;const i=[];var{battleType:e,ask:n}=e;const c=(e,t)=>o.substring(e,t),r=(t,n)=>{return a.find(e=>e[0]==t&&e[1]==n)?"answer":"option"};switch(e){case"1":t.sort(M).forEach(([e,t],n,a)=>{i.push(c(l,e)),i.push({el:"span",className:r(e,t),textContent:c(e,t)}),n==a.length-1&&t<o.length&&i.push(o.substring(t)),l=t});break;case"2":var[s,d]=a;[...s.map(e=>[...e,"modifier"]),...d.map(e=>[...e,"modificand"])].sort(M).forEach(([e,t,n],a,s)=>{i.push(c(l,e)),i.push({el:"span",className:n,textContent:c(e,t)}),a==s.length-1&&t<o.length&&i.push(o.substring(t)),l=t});break;case"3":var[[s,d],,u]=t;i.push(c(l,s)),i.push({el:"span",className:"pick-right","data-wrong":u,textContent:c(s,d)}),d<o.length&&i.push(o.substring(d));break;case"4":{const[[p,f],,m]=a;t.sort(M).forEach(([e,t],n,a)=>{var s=c(l,e),s=(s&&i.push(s),{el:"span",className:r(e,t),textContent:c(e,t)});p==e&&f==t&&(s.className="answer-wrong",s["data-wrong"]=m),i.push(s),n==a.length-1&&t<o.length&&i.push(o.substring(t)),l=t});break}case"5":t.sort(M).forEach(([e,t],n,a)=>{var s=c(l,e);s&&i.push(s),i.push({el:"span",className:"option",textContent:c(e,t)}),n==a.length-1&&t<o.length&&i.push(o.substring(t)),l=t});break;case"6":t.sort((e,t)=>e[0][0]-t[0][0]).forEach(([[e,t]],n,a)=>{var s=c(l,e);s&&i.push(s),i.push({el:"span",className:"fill-right",textContent:c(e,t)}),n==a.length-1&&t<o.length&&i.push(o.substring(t)),l=t});break;case"7":var[u,s]=JSON.parse(n)[0],d=c(l,u),u=c(u,s),s=o.substring(s);d&&i.push(d),i.push(d,{el:"span",className:"option",textContent:u},s);break;case"8":var[d,u]=t[0],s=c(l,d),d=c(d,u),u=o.substring(u);s&&i.push(s),i.push({el:"span",className:"pick-right",textContent:d},u)}return i}function T(e,t){let n=a[e-1].replace("{}",t);return 1===e&&n.includes("절의")?n=n.replace("문장의","문장에서"):2===e&&(t.includes("의 수식")||t.includes("의 피수식"))?n+="어를 선택하세요.":8===e&&(n=t),n}function L(e,t){let n;return n=c[e]?c[e].find(({limit:e})=>t<=e)?.rank:n}function A(e){e.querySelector(".battle-comment-section textarea.comment~.note-editor")||(0<(t=N(e).closest(".one-sentence-unit-section")).length&&0<t.find(".note-list .note-text").length&&N(e).find(".battle-comment-section textarea.comment").val(t.find(".note-list .note-text").html()),openSummernote(N(e).find(".battle-comment-section textarea.comment").removeClass("d-inline"))),N(e).find(".askTag, .source").each(function(){const a=`/craft/battle/${this.matches(".askTag")?"tag":"source"}/search/{}`,s=this.matches(".askTag")?x:k;N(this).autocomplete({minLength:1,delay:50,source:function(e,t){const n=e.term&&e.term.trim();n in s?t(s[n]):N.getJSON(a.replace("{}",n),function(e){0<e.length&&(s[n]=e.sort()),t(e)}).fail(()=>{t([])})}})});const a=Date.now();e.querySelectorAll("[data-radio]").forEach((e,t)=>{const n=""+e.dataset.radio+a+t;e.querySelectorAll("input[type=radio]").forEach((e,t)=>{e.name=n,e.id=n+t,e.nextElementSibling.htmlFor=n+t})});var{eng:t,semantics:n}=N(e).closest(".battle-section-panel").data();N(e).find(".original-sentence").text(t),i(e.querySelector(".craft-maker-container"),n,1),N(e).find(".battle-category-section select").val(""),0<N(".workbook-title-section").length&&(o=N(".workbook-title-section").text().trim()),b?(e.querySelector(".select-book-type").value=b.type,e.querySelector("select.select-book").replaceChildren(createElement(Array.from(s[b.type],e=>({el:"option",value:e.battleBookId,textContent:e.title||"제목 없음"})))),e.querySelector("select.select-book").value=b.bookId):e.querySelector(".select-book-type").value="",e.querySelector(".select-book-type").focus()}t.craft=Object.assign({},t.craft,{openBattleMakerPanel:async function t(n,s,o,l,i,c){if(N.fn.autocomplete){const a=d.querySelector(".battle-category-section select");if(0==y.length)N.getJSON("/grammar/category/list",e=>{y=e,(e=Array.from(y,e=>({el:"option",value:e.cid,textContent:(e.parentCategory?"└─ ":"")+e.title}))).unshift({el:"option",value:"",textContent:"문제가 속하는 문법 분류를 선택해 주세요.",disabled:!0,selected:!0}),a.append(createElement(e)),t(n,s,o,l,i,c)});else{v=s,u=o,["A","S"].includes(u)||d.querySelector('.select-book-type option[value="step"]').remove();const r=tandem.cleanSvocDOMs(i).innerText;let a=d.cloneNode(!0);"undefined"==typeof openSummernote&&await N.cachedScript("https://static.findsvoc.com/js/util/summernote.editor.min.js"),N(a).data("semantics",i).data("sentenceId",l).data("eng",r).data("transList",c.filter(e=>!!e.id)),N.getJSON("/craft/battle/search/"+l,e=>{let t={};e.forEach(e=>{null==t[e.battleType]&&(t[e.battleType]=[]),t[e.battleType].push(e)});const n=a.querySelector(".existing-battles-section");n.replaceChildren(),0==Object.entries(t).length?n.append("등록된 배틀이 없습니다."):Object.entries(t).forEach((e,t)=>{t=Date.now()+t,n.append(createElement(O(e[0],e[1].length,t,Array.from(e[1],e=>j(r,e)))))})}),n.replaceChildren(),n.append(a),A(a.querySelector(".add-battle-section"))}}else{S.head.append(createElement([{el:"link",rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.css"},{el:"link",rel:"stylesheet",href:"https://static.findsvoc.com/css/app/craft-maker.min.css"}]));const e=N.fn.tooltip;N.cachedScript("https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.js",{success:()=>{N.fn.tooltip=e,t(n,s,o,l,i,c)}})}},appendToolbar:w,getAsks:function(e){return r[parseInt(e)-1]},previewBattle:j,combineAsk:T,createAskOptions:m,createRangedSentenceBlock:E,calcDiffSpecific:L,findPositions:I,appendContext:h})}}(jQuery,window,document);