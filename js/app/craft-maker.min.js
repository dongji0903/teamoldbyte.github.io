!function(i,e,d){i.cachedScript=i.cachedScript||function(e,t){return i.ajax(i.extend(t||{},{dataType:"script",cache:!0,url:e}))};let u={},b=[],c=0,f=[],p=[];i.getJSON("https://static.findsvoc.com/data/tandem/craft-toolbar.json",e=>{u=e,b=e.common});const m=[[{selector:".s",ask:"#1",tag:"주어(부)",fullAsk:"다음 문장의 주어(부)를 선택하세요."},{selector:".v",ask:"#1",tag:"동사(부)",fullAsk:"다음 문장의 동사(부)를 선택하세요."},{selector:".o",ask:"#1",tag:"목적어(부)",fullAsk:"다음 문장의 목적어(부)를 선택하세요."},{selector:".c",ask:"#1",tag:"보어(부)",fullAsk:"다음 문장의 보어(부)를 선택하세요."},{selector:".oc",ask:"#1",tag:"목적보어(부)",fullAsk:"다음 문장의 목적보어(부)를 선택하세요."},{selector:'.s[data-rc="s.s."]',tag:"진짜주어(부)",ask:"#1",fullAsk:"다음 문장의 진짜주어(부)를 선택하세요."},{selector:'.o[data-rc="i.o."]',tag:"간접목적어(부)",ask:"#1",fullAsk:"다음 문장의 간접목적어(부)를 선택하세요."},{selector:'.o[data-rc="d.o."]',tag:"직접목적어(부)",ask:"#1",fullAsk:"다음 문장의 직접목적어(부)를 선택하세요."},{selector:".ptc",ask:"#1",tag:"분사",fullAsk:"다음 문장의 분사를 선택하세요."},{selector:".ger",ask:"#1",tag:"동명사",fullAsk:"다음 문장의 동명사를 선택하세요."},{selector:".tor",ask:"#1",tag:"to부정사",fullAsk:"다음 문장의 to부정사를 선택하세요."}],[{selector:".adjphr[data-mfd],.phr[data-mfd]",ask:"#2",tag:"전치사",fullAsk:"[전치사] 수식어와 피수식어를 선택하세요."},{selector:".tor[data-mfd],.ptc[data-mfd]",ask:"#2",tag:"준동사",fullAsk:"[준동사] 수식어와 피수식어를 선택하세요."},{selector:".acls[data-mfd]",ask:"#2",tag:"관계사",fullAsk:"[관계사] 수식어와 피수식어를 선택하세요."},{ask:"#2",tag:"형용사",fullAsk:"[형용사] 수식어와 피수식어를 선택하세요."},{ask:"#2",tag:"동격어구/절",fullAsk:"[동격어구/절] 수식어와 피수식어를 선택하세요."}],[{ask:"#3",fullAsk:"다음 문장에서 적절한 보기를 선택하세요."}],[{ask:"#4",fullAsk:"다음 문장에서 어법상 틀린 것을 선택하세요."}],[{ask:"#5",fullAsk:"다음 어구들을 해석에 맞게 배치해 보세요."}]];d.head.insertAdjacentHTML("beforeend",'<style>.battle-maker { counter-set: quizIndex 0;counter-reset: quizIndex; outline: none; }.battle-context { line-height: 3; }.battle-context .answer, .battle-context .option, .battle-context .answer-wrong {position: relative;counter-increment: quizIndex;text-decoration:underline;}.battle-context .answer::after,.battle-context .option::after, .battle-context .answer-wrong::after {position: absolute;width: calc(1em + 2px);line-height: 1;top: 1.5em;left: 0;text-align: center;content: "["counter(quizIndex)"]"}.battle-context .answer { color: red; }.battle-context .modifier,.battle-context .modificand {position:relative;text-decoration:underline;}.battle-context .modifier::after,.battle-context .modificand::after {position: absolute;width: calc(1em + 2px);line-height: 1;top: 1.5em;left: calc(50% - .5em - 1px);text-align: center;}.battle-context .modificand::after { content: "피수식어"}.battle-context .modifier::after { content: "수식어"}.battle-context .pick-right, .battle-context .answer-wrong {position:relative; color: blue;}.battle-context .pick-right::before, .battle-context .answer-wrong::before {position: absolute; left: 0; bottom: 0; color: red; content: attr(data-wrong)}.battle-context * { cursor: pointer;}.battle-context *:hover,.battle-context *:hover::before,.battle-context *:hover::after { background: gold}</style>');let s=k({el:"div",className:"battle-section-panel"}),h=(s.insertAdjacentHTML("afterbegin",`	<!-- 기존 문제 조회 영역 -->
	<div class="existing-battle-section pb-3 row">
		<label class="col-auto lh-1 ms-3 my-auto text-fc-red fw-bold">기존 등록 배틀 조회</label>
		<!-- 조회 결과 -->
		<div class="existing-battles-section col-auto">
			<div class="js-open-existing-battle" role="button" data-bs-toggle="collapse">
				• Battle <span class="existing-battle-type">0</span> 으로 등록 ( <span class="existing-battle-count">0</span> 건 ) <span class="fold-icon text-xl align-middle"></span>
			</div>
		</div>
	</div>						
	<!-- 배틀 추가 등록 영역 -->
	<div class="add-battle-section p-3 bg-white rounded-3">
		<!-- 배틀 타입 선택 -->
		<div class="battle-type-section pb-3 row" data-radio="btnradioBattletype">
			<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">배틀 타입 선택</label>
			<input type="radio" class="btn-check" autocomplete="off" value="1" checked>
			<label class="btn rounded-pill btn-outline-fico col-auto mx-2">1. 성분 찾기</label>
			<input type="radio" class="btn-check" autocomplete="off" value="2">
			<label class="btn rounded-pill btn-outline-fico col-auto mx-2">2. 수식어 찾기</label>
			<input type="radio" class="btn-check" autocomplete="off" value="3">
			<label class="btn rounded-pill btn-outline-fico col-auto mx-2">3. 맞는 어법 찾기</label>
			<input type="radio" class="btn-check" autocomplete="off" value="4">
			<label class="btn rounded-pill btn-outline-fico col-auto mx-2">4. 틀린 어법 찾기</label>
			<input type="radio" class="btn-check" autocomplete="off" value="5">
			<label class="btn rounded-pill btn-outline-fico col-auto mx-2">5. 문장요소 배열하기</label>
		</div>
		<!-- 문제 입력 -->
		<div class="add-detail-battle-section">
			<div class="battle-editor-section pb-3">
				<!-- 문제 입력 에디터 -->
				<div class="craft-maker-container">
				</div>
			</div>
			<div class="row pb-3">
				<!-- 카테고리 입력 -->
				<div class="battle-category-section col-12 col-md-3 row">
					<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">카테고리</label>
					<select class="form-select d-inline-block w-auto col">
					</select>
				</div>
				<!-- 난이도 입력 -->
				<div class="battle-diffLevel-section col-12 col-md-3 row" data-radio="btnradioBattlelevel">
					<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">난이도</label>
					<input type="radio" class="btn-check battle-level-select" autocomplete="off" value="E" checked>
					<label class="col btn col-3 rounded-pill btn-outline-fico">쉬움</label>
					<input type="radio" class="btn-check battle-level-select" autocomplete="off" value="N">
					<label class="col btn col-3 ms-1 rounded-pill btn-outline-fico">보통</label>
					<input type="radio" class="btn-check battle-level-select" autocomplete="off" value="D">
					<label class="col btn col-3 ms-1 rounded-pill btn-outline-fico">어려움</label>
				</div>
				<!-- 질문에 대한 태그 입력 -->
				<div class="battle-askTag-section col-12 col-md-3 row">
					<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">태그</label>
					<input type="text" class="askTag form-control d-inline-block col" placeholder="ex) 목적어(부), 관계사(카테고리명)">
				</div>
				<!-- 질문 출처 입력 -->
				<div class="battle-source-section col row me-md-2">
					<label class="col-auto lh-1 my-auto text-fc-purple fw-bold">출처</label>
					<input type="text" class="source form-control d-inline col" placeholder="ex) OOO 워크북, 2022년 6월 고3 모의고사 등">
				</div>
			</div>

			<!-- 문제 해설 -->
			<div class="battle-comment-section pb-3 row me-md-2">
				<label class="col-auto text-fc-purple fw-bold">해설</label>
				<textarea class="comment form-control d-inline col h-auto" rows="2" placeholder="문제에 대한 해설, 참조 링크 등"></textarea>
			</div>
			<div class="button-section text-center">
				<button type="button" class="js-add-battle btn btn-fico btn-lg">등록</button>
			</div>
		</div>
	</div>`),d.createElement("div"));function r(e,t,a){e.innerHTML="",p=[],f=[];const o=k({el:"div",className:"battle-maker",tabIndex:0});let l=m[a-1];l.forEach(e=>{null!=e.selector&&null!=t.querySelector(".sem"+e.selector)&&(e.recommended=!0)}),l.sort((e,t)=>e.recommended?t.recommended?0:-1:1);var a=u["battle"+a],c=o;h.innerHTML="",x(a,h);for(let e=0,t=b.length;e<t;e++)x(b[e],h);c.prepend(h.cloneNode(!0));{a=l,c=o;const s=d.createElement("select");s.className="form-select ask-select",a.forEach((e,t)=>{const a=d.createElement("option");e.recommended&&(a.className="bg-fc-light-purple"),a.value=e.ask,e.tag&&(a.dataset.tag=e.tag),a.innerHTML=e.fullAsk,0==t&&(a.selected=!0),s.append(a)}),c.querySelector("[role=toolbar]").prepend(s),i(s).wrap('<div class="btn-group col-auto"></div>'),s.insertAdjacentHTML("beforebegin",'<label class="col-auto lh-1 my-auto me-2 text-fc-purple fw-bold">질문</label>')}{a=t;var n=o;const r=d.createElement("div");r.className="battle-context fs-5 bg-white mt-2 px-2 form-control",r.textContent=tandem.cleanSvocDOMs(a).innerText,r.onmouseup=()=>g(n),n.append(r)}e.append(o);c=o.closest(".add-battle-section").querySelector(".ask-select");i(c).trigger("change")}function g(e){let t=getSelection();var a=e.querySelector("[role=toolbar] [type=checkbox]:checked");if(!t.isCollapsed&&a&&t.toString().trim()!=e.querySelector(".battle-context").textContent.trim()){v(e.querySelector(".battle-context"));var e=Number(e.closest(".add-battle-section").querySelector(".battle-type-section input:checked").value);if(![1,3].includes(e)){for((2==t.anchorNode.compareDocumentPosition(t.focusNode)||0==t.anchorNode.compareDocumentPosition(t.focusNode)&&t.anchorOffset>t.focusOffset)&&t.setBaseAndExtent(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset);0<t.anchorOffset&&t.anchorNode.textContent.charAt(t.anchorOffset).match(/\S/)&&t.anchorNode.textContent.charAt(t.anchorOffset-1).match(/\S/);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset-1,t.focusNode,t.focusOffset);for(;t.toString().match(/^\s/);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset+1,t.focusNode,t.focusOffset);for(;t.focusOffset<t.focusNode.textContent.length-1&&t.focusNode.textContent.charAt(t.focusOffset-1).match(/\S/)&&t.focusNode.textContent.charAt(t.focusOffset).match(/\S/);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset+1);for(;t.toString().match(/\s$/);)t.setBaseAndExtent(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset-1)}const o=d.createElement("span"),l=(o.className=a.value,t.getRangeAt(0));o.textContent=l.extractContents().textContent,l.insertNode(o),t.removeAllRanges(),o.matches(".pick-right,.answer-wrong")&&((e=prompt(o.textContent+"의 오답을 입력하세요."))?o.dataset.wrong=e:i(o.firstChild).unwrap())}}function k(t){const a=d.createElement(t.el);return Object.keys(t).forEach(e=>{["el","children"].includes(e)||(a[e]=t[e])}),a}function x(a,e){const o=k(a);if(!a.className)switch(a.el){case"button":o.className="btn btn-outline-dark col-auto btn-sm";break;case"div":o.className="btn-group col-auto"}if(!a.title||a.type&&"checkbox"==a.type||(o.dataset.toggle="tooltip",o.dataset.placement="bottom"),e.append(o),a.type&&"checkbox"==a.type){a.className||(o.className="btn-check");var t="btn-check-"+c++;o.id=t;const l=d.createElement("label");l.className="btn btn-outline-fico",l.htmlFor=t,l.innerHTML=a.innerHTML,a.title&&(l.title=a.title,l.dataset.toggle="tooltip",l.dataset.placement="bottom"),e.append(l)}if(a.children)for(let e=0,t=a.children.length;e<t;e++)x(a.children[e],i(o))}function n(e,a){let o=0,l=[];return e.childNodes.forEach(e=>{var t=e.textContent.replaceAll(/[\n\u200b]/gm,"").length;e.className&&e.matches(a)&&l.push([o,o+t]),o+=t}),l}function v(e){f.push(e.innerHTML),p=[],e.closest(".battle-maker").querySelector('[role=toolbar] [value="undo"]').disabled=!1}h.className="row g-2 btn-toolbar",h.setAttribute("role","toolbar"),i(d).on("change",".battle-type-section input[type=radio]",function(){var e=i(this).closest(".battle-section-panel").data("semantics");r(this.closest(".add-battle-section").querySelector(".craft-maker-container"),e,this.value)}).on("change",".ask-select",function(){var e=this.querySelector("option:checked").dataset.tag;const t=this.closest(".add-battle-section").querySelector(".askTag");t.value=e||""}).on("change",".battle-maker [role=toolbar] [type=checkbox]",function(){const e=this.closest(".battle-maker");var t=e.querySelector(".battle-context");this.checked&&(this.closest("[role=toolbar]").querySelectorAll("[type=checkbox]:checked").forEach(e=>{0!=this.compareDocumentPosition(e)&&(e.checked=!1)}),getSelection().isCollapsed||(v(t),g(this.closest(".battle-maker"))))}).on("click",".battle-context *",function(){"SPAN"==this.nodeName?this.outerHTML=this.innerHTML:this.remove()}).on("click",".battle-maker [value=undo], .battle-maker [value=redo]",function(){var e="undo"==this.value,t=(e?f:p).pop();const a=this.closest(".battle-maker"),o=a.querySelector(".battle-context");(e?p:f).push(o.innerHTML),o.innerHTML=t,i(o).animate({opacity:.5},100).animate({opacity:1},100),a.querySelector("[value=undo]").disabled=0==f.length,a.querySelector("[value=redo]").disabled=0==p.length}).on("keyup",function(e){var t=e.target.closest(".battle-maker");t&&(e.ctrlKey&&"Z"==e.key.toUpperCase()?i(t).find("[value=undo]").trigger("click"):e.ctrlKey&&"Y"==e.key.toUpperCase()&&i(t).find("[value=redo]").trigger("click"))}).on("click",".js-add-battle",function(){const e=this.closest(".add-battle-section"),t=i(e).closest(".battle-section-panel"),a=e.querySelector(".battle-context");let o="",l="";var c=e.querySelector(".battle-type-section input:checked").value;switch(c){case"1":o=n(a,".answer, .option"),l=n(a,".answer");break;case"2":l=[n(a,".modifier")[0],n(a,".modificand")[0]];break;case"3":let e=a.querySelector(".pick-right");o=[n(a,".pick-right")[0],e.textContent.trim(),e.dataset.wrong.trim()],l=[e.textContent.trim()];break;case"4":let t=a.querySelector(".answer-wrong");o=n(a,".option, .answer-wrong"),l=[n(a,".answer-wrong")[0],t.textContent.trim(),t.dataset.wrong.trim()];break;case"5":o=n(a,".option")}c={sentenceId:t.data("sentenceId"),categoryId:Number(e.querySelector(".battle-category-section select").value),memberId:t.data("memberId"),battleType:c,ask:e.querySelector(".ask-select").value.trim(),example:JSON.stringify(o),answer:JSON.stringify(l),askTag:e.querySelector(".askTag").value.trim(),comment:e.querySelector(".comment").value.trim(),source:e.querySelector(".source").value.trim(),diffLevel:e.querySelector(".battle-diffLevel-section input:checked").value};i.ajax({url:"/craft/battle/add",type:"POST",contentType:"application/json",data:JSON.stringify(c),success:function(e){alert(`[등록 결과]
battleId: ${e.battleId}
groupCount: `+e.groupCount)},error:function(e){alert(e)}})}),e.craft={openBattleMakerPanel:function(e,t,a,o){i.fn.autocomplete||i.cachedScript("https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.js");const l=s.querySelector(".battle-category-section select");let c=s.cloneNode(!0);const n=Date.now();i(c).data("semantics",o).data("memberId",t).data("sentenceId",a),c.querySelectorAll("[data-radio]").forEach((e,t)=>{const a=""+e.dataset.radio+n+t;e.querySelectorAll("input[type=radio]").forEach((e,t)=>{e.name=a,e.id=a+t,e.nextElementSibling.htmlFor=a+t})}),i.getJSON("/craft/battle/search/"+a,e=>{let t={};e.forEach(e=>{null==t[e.battleType]&&(t[e.battleType]=[]),t[e.battleType].push(e)});const o=c.querySelector(".existing-battles-section");o.innerHTML="",0==Object.entries(t).length?o.append("등록된 배틀이 없습니다."):Object.entries(t).forEach((e,t)=>{t=Date.now()+t;const a=k({el:"div",className:"js-open-existing-battle",role:"button"});a.dataset.bsToggle="collapse",a.dataset.bsTarget=".js-existing-battle-view"+t,a.innerHTML=`• Battle <span class="existing-battle-type">${e[0]}</span> (으)로 등록 ( ${e[1].length} 건 ) <span class="fold-icon text-xl align-middle"></span>`,o.append(a);t=k({el:"div",className:`js-existing-battle-view${t} fade collapse`,textContent:JSON.stringify(e[1])});o.append(t)})}),0==l.childElementCount&&i.getJSON("/grammar/category/list",e=>{e.forEach(e=>{l.append(k({el:"option",value:e.cid,textContent:(e.parentCategory?"└─ ":"")+e.title}))}),c.querySelector(".battle-category-section select").innerHTML=l.innerHTML}),e.innerHTML="",r(c.querySelector(".craft-maker-container"),o,1),e.append(c),i(c).find(".ask-select").trigger("change")},attachBattleMaker:r}}(jQuery,window,document);