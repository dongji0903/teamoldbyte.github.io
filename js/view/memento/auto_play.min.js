async function pageinit(s,n){const i=new FicoTTS,l=document.querySelector(".autoplay-progress svg"),r=document.querySelector(".autoplay-progress span");let d=await $.get("https://static.findsvoc.com/fragment/memento/auto_play.min.html",jQuery.noop,"html");const c="MementoAutoPlayConfigs";var e=JSON.parse(localStorage.getItem(c)||"{}");let p=e.ttsAutoplay??!0,u=!0,m=e.sentenceAutoLoad??!0,g=e.stopOnLastSlide??!0,f=e.autoplay??!1,y=e.autoplayDelay??1e4,v,h=[];if(0==(s??[]).length)alertModal("학습할 단어가 없습니다.<br>내가 작성하거나 구독한 <b>워크북에서</b><br>학습이 필요한 단어를 <b>보관</b>해 보세요.<br><br>이전 화면으로 돌아갑니다.",()=>history.back()),$(".operation-section").addClass("pe-none opacity-50");else{$(".swiper-wrapper").append(k(s)),$("#startAutoPlay, .cover-before-play").on("click",function(){$("#startAutoPlay").prop("disabled",!0).tooltip("hide"),$("#finishAutoPlay").prop("disabled",!1),$(".cover-before-play").hide(),$(".autoplay-top-mobile-menu .start-btn").toggleClass("start-btn finish-btn").find(".fas").toggleClass("fa-play fa-pause"),$(".example-sentence-section, .options-cover").show(),v=new Swiper(".swiper",{centeredSlides:!0,spaceBetween:"20%",autoHeight:!0,autoplay:!!f&&{disableOnInteraction:!1,stopOnLastSlide:g,delay:y},pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},on:{afterInit(e){$(e.pagination.el).show(),$(e.navigation.nextEl).add(e.navigation.prevEl).show();const a=[0,1,2].toSorted(()=>Math.random()-.5)[0];var t=$(e.slides[e.activeIndex]);t.find(".js-view-sentence .cover-text").each((e,t)=>{$(t).toggle(e==a)}),0==h.length&&h.push(parseInt(e.slides[0].dataset.keepWordId)),u=!1,(p||f)&&t.find(".js-pause").addClass("fa-pause").removeClass("fa-play"),p&&b(t.find(".word-unit-section .title").text().trim(),t.find(".js-pause")),m&&t.find(".js-view-sentence:visible").click()},autoplayTimeLeft(e,t,a){e.enabled&&(t<=0?!f||e.isEnd&&g?$("#finishAutoPlay").trigger("click"):e.slideNext():(l.style.setProperty("--progress",100-a),r.textContent=Math.ceil(t/1e3)+"s"))},beforeSlideChangeStart(e){i.stop(()=>$(e.slides[e.activeIndex]).find(".js-pause").removeClass("fa-pause").addClass("fa-play"))},slideChange(e){const a=[0,1,2].toSorted(()=>Math.random()-.5)[0];e=$(e.slides[e.activeIndex]);e.find(".js-view-sentence .cover-text").each((e,t)=>{$(t).toggle(e==a)}),h.includes(parseInt(e[0].dataset.keepWordId))||h.push(parseInt(e[0].dataset.keepWordId)),m&&e.find(".js-view-sentence:visible").click()},transitionEnd(e){var t=$(e.slides[e.activeIndex]),a=t.find(".js-pause");(f||p)&&a.removeClass("fa-play").addClass("fa-pause"),f&&(e.autoplay.running&&e.autoplay.paused?e.autoplay.resume():e.autoplay.running||e.autoplay.start()),p&&(u=!1,b(t.find(".word-unit-section .title").text().trim(),a))}}})}),$("#finishAutoPlay").on("click",function(){endKeepWordId=parseInt(v.slides[v.activeIndex].dataset.keepWordId),$(this).prop("disabled",!0).tooltip("hide"),$(".cover-before-play").show(),i.stop(),$(v.pagination.el).hide(),$(v.navigation.nextEl).add(v.navigation.prevEl).hide(),v.destroy(),v=null,$("#finishModal").modal("show"),$("#startAutoPlay").prop("disabled",!1),$(".autoplay-top-mobile-menu .finish-btn").toggleClass("start-btn finish-btn").find(".fas").toggleClass("fa-play fa-pause")});let t=scrollY,a;const w=$(".mobile-config-section-open-btn-block").get(0),x=($(window).on("scroll",function(e){a^t<scrollY&&(a=t<scrollY,t>=scrollY&&(anime({targets:w,translateY:0,duration:300,easing:"easeOutQuad"}),$(".mobile-config-section-open-btn.active").button("toggle"),anime({targets:".mobile-config-section-open-btn .fas",rotate:"0deg",duration:300,easing:"easeOutQuad"})),anime({targets:$(w).find(".mobile-config-section-open-btn").get(0),translateY:t<scrollY?0:"100%",duration:300,easing:"easeOutQuad"})),t=scrollY}),$(".mobile-config-section-open-btn").on("click",function(){var e=this.classList.contains("active");anime({targets:w,translateY:e?"-100%":0,duration:300,easing:"easeOutQuad"}),anime({targets:".mobile-config-section-open-btn .fas",rotate:e?"180deg":"0deg",duration:300,easing:"easeOutQuad"})}),$("#finishModal").on("click","#goTest",function(){n<20?alertModal(`현재 보관된 단어는 총 ${n}개 입니다.
테스트를 위해 최소 20개의 보관된 단어가 필요합니다.`):document.forms.submitTestForm.submit()}),$('form[name="submitTestForm"]').on("formdata",function(e){h.sort(),e.originalEvent.formData.append("keepWordIds",h)}),$(document).on("click",".js-view-sentence",function(){$.get(`/memento/kick/autoplay/sentence/${this.dataset.wid}/`+this.dataset.sid,e=>{$(this).hide().siblings(".eng").show().html(e).siblings(".workbook-title").show().siblings(".guide-text").show()}).fail(()=>alertModal("문장 조회에 실패했습니다."))}),$(".js-eng-auto-open").on("click",function(){m=!$(this).is(".active"),$(this).toggleClass("active",m)}).toggleClass("active",m),$("#infoNotDisplayCheck").on("click",function(){$(".example-eng-info").remove()}),"MementoAutoPlayGuideConfirmed");!JSON.parse(localStorage.getItem(x)||"false")&&devSize.isPhone()&&$("#startModal").modal("show"),$("#startModalNotDisplayCheck").on("click",function(){localStorage.setItem(x,"true")}),$(document).on("click",".example-sentence-section .cover-text",function(){$(".example-eng-info").css("scale",0).show(),anime({targets:".example-eng-info",scale:[0,1],duration:800})});let e=1;$(".js-prev-words,.js-next-words").on("click",function(){parseInt(this.dataset.pagenum),e;e=parseInt(this.dataset.pagenum),$.getJSON("/memento/kick/autoplay/"+e,e=>{var t=e?.totalPages,a=e?.number+1,t=($(".js-prev-words").toggle(1<a).attr("data-pagenum",a-1),$(".js-next-words").toggle(a<t).attr("data-pagenum",a+1),k(e?.content));v?(v.autoplay.stop(),v.slides.forEach(e=>e.remove()),v.appendSlide(t),$(v.pagination.el).hide(),$(v.navigation.nextEl).add(v.navigation.prevEl).hide(),v.destroy(),i.stop(),v=null,$("#startAutoPlay").prop("disabled",!1),$(".autoplay-top-mobile-menu").find(".start-btn,.finish-btn").addClass("start-btn").removeClass("finish-btn").find(".fas").addClass("fa-play").removeClass("fa-pause")):$(".swiper-wrapper").empty().append(t),$(".cover-before-play").show()})});const C=$('form[name="submitDateTestForm"]');flatpickr.l10ns.ko.firstDayOfWeek=1;let o=[];$(".changeTerm").each((e,t)=>{o.push($(t).flatpickr({mode:"range",locale:"ko",maxDate:Date.now(),clickOpens:!1,onChange:e=>{2===e.length&&confirmModal(`${e[0].format("yyyy년 MM월 dd일")}부터 ${e[1].format("yyyy년 MM월 dd일")}까지(${(e[1].getTime()-e[0].getTime())/864e5+1}일)<br> 테스트를 진행하시겠습니까?`,()=>{C.data("dateRange",e)[0].submit()})}}))}),$(".changeTerm").on("click",function(e){o.find(e=>$(e.element).is(":visible")).toggle()}),C.on("formdata",function(e){var t=C.data("dateRange");e.originalEvent.formData.append("from",t[0].format("yyyy-MM-dd")),e.originalEvent.formData.append("to",t[1].format("yyyy-MM-dd"))}),new bootstrap.Tooltip($(".js-open-slide-interval:visible")[0],{trigger:"click",placement:"right",html:!0,title:$('<div class="text-center" style="width:6rem"><label class="form-label">슬라이드<br>재생 간격</label><input type="number" class="js-change-slide-interval form-control pe-0 me-1 d-inline" value="'+y/1e3+'" style="width:4rem">초</div>')[0]}),$(document).on("shown.bs.tooltip",".js-open-slide-interval",function(){$(".js-change-slide-interval")[0].focus()}).on("blur",".js-change-slide-interval",function(){$(".js-open-slide-interval").tooltip("hide")}).on("change",".js-change-slide-interval",function(){y=1e3*parseInt(this.value),v&&(v.autoplay?.stop(),v.params.autoplay.delay=y,v.autoplay.timeLeft=y-v.autoplay.timeLeft,v.update(),v.autoplay.start())}),$(".moveAutoPlayTest").on("click",()=>{confirmModal("단어 자동모음 테스트를 시작할까요?",()=>{location.assign("/memento/kick/autoplay/run-test")})}),$(".moveMementoTrace").on("click",()=>{confirmModal("보관한 단어 목록으로 이동할까요?",()=>{location.assign("/memento/trace")})}),$(".moveMemento").on("click",()=>{confirmModal("메멘토 테스트를 시작할까요?",()=>{location.assign("/memento/kick/autoplay/memento-test")})}),$(".moveWordSelectTest").on("click",()=>{confirmModal("단어 선택 테스트를 시작할까요?",()=>{location.assign("/memento/kick/autoplay/mapping-test")})}),$(".unsaveWord").on("click",function(){v?(v.autoplay.paused||v.autoplay.pause(),confirmModal("지금 보고 있는 단어를 외우셨습니까?",()=>{const e=v.activeIndex,a=$(v.slides[e]).find(".word-unit-section .title:eq(0)").text().trim(),o=v.slides[e].dataset["keepWordId"];$.ajax({url:"/memento/word/change-status",type:"POST",contentType:"application/json",data:JSON.stringify({keepWordId:o,del:!0}),success:()=>{var t=o;if(sessionStorage.getItem(I)){let e=JSON.parse(sessionStorage.getItem(I));e&&(e=e.filter(e=>e.keepWordId!=t),sessionStorage.setItem(I,JSON.stringify(e)))}alertModal(`단어 <b>${a}</b>를 외웠고, 보관 해제하였습니다.`,()=>{anime({targets:"#delWordCount .num-text",rotateX:["0deg","720deg"],complete:e=>{e=e.animatables[0].target;e.textContent=parseInt(e.textContent)+1}}),v.slides[e+1]?v.slideNext():1<v.slides.length?v.slidePrev():(i.stop(),v.autoplay.pause()),v.removeSlide(e)})},error:()=>alertModal("단어 보관 해제에 실패했습니다.")})},()=>{u||v.autoplay.resume()})):alertModal("단어학습 중이어야 합니다.")}),$(".js-auto-slidenext").on("click",function(){f=!$(this).is(".active"),$(this).toggleClass("active",f),v&&(f?(v.params.autoplay.delay=y,v.params.autoplay.disableOnInteraction=!1,v.params.autoplay.stopOnLastSlide=g,v.autoplay.start(),v.autoplay.resume(),$(".js-pause").css("display","").removeClass("fa-play").addClass("fa-pause")):(v.autoplay.pause(),v.autoplay.stop(),f||p||$(".js-pause").hide()))}).toggleClass("active",f),$(".js-change-loop").on("click",function(){g=$(this).is(".active"),$(this).toggleClass("active",!g),v&&(v.params.autoplay.stopOnLastSlide=g,v.update())}).toggleClass("active",!g),$(".js-change-tts-autoplay").on("click",function(){p=!$(this).is(".active"),$(this).toggleClass("active",p);var e=$(v.slides[v.activeIndex]);p?(b(e.find(".word-unit-section .title:eq(0)").text().trim(),e.find(".js-pause").removeClass("fa-play").addClass("fa-pause")),$(".js-pause").css("display","")):(i.stop(),f||p||$(".js-pause").hide())}).toggleClass("active",p),$(".js-save-configs").on("click",function(){localStorage.setItem(c,JSON.stringify({ttsAutoplay:p,autoplay:f,autoplayDelay:y,stopOnLastSlide:g,sentenceAutoLoad:m})),$(this).prev(".toast").toast("show")}),$(document).on("click",".js-pause",function(){const e=$(this);this.matches(".fa-pause")?(v.autoplay.pause(),u=!0,i.stop(()=>e.toggleClass("fa-pause fa-play"))):(u=!1,b(e.closest(".word-unit-section").find(".title").text().trim(),e),e.toggleClass("fa-pause fa-play"),v.autoplay.running&&v.autoplay.resume())}),$(".autoplay-top-mobile-menu").on("click",".start-btn,.finish-btn",function(){$(this.matches(".start-btn")?"#startAutoPlay":"#finishAutoPlay").trigger("click")}),$("#toggleFullscreen").on("click",function(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}),$(document.documentElement).on("fullscreenchange",function(){document.fullscreenElement?($("#toggleFullscreen").attr("data-bs-original-title","학습모드를 종료합니다."),$("#toggleFullscreen").tooltip(),$("#toggleFullscreen i").removeClass("fa-expand").addClass("fa-compress")):($("#toggleFullscreen").attr("data-bs-original-title","학습모드를 켭니다."),$("#toggleFullscreen").tooltip(),$("#toggleFullscreen i").addClass("fa-expand").removeClass("fa-compress"))});const I="savedWordList";function b(e,t){p&&!u&&i.speakRepeat(e,2e3,500,()=>{t.removeClass("fa-pause").addClass("fa-play")})}function k(e){return Array.from(e,e=>{var t=$(d).find(".swiper-slide").clone();return t.attr("data-keep-word-id",e.keepWordId),t.find(".data-save-date").text(new Date(e.saveDate).format("yyyy.MM.dd (e)")),t.find(".data-word-title").text(e.wordTitle),t.find(".workbook-title").text(e.workBookTitle||""),t.find(".data-phonetic").html(e.phonetic?.replace(/미국식?/g,"美")?.replace(/영국식?/g,"英")||""),t.find(".word-sense-list-container").empty().append(Array.from(e.senseList,e=>{var t=$(d).find(".one-part-unit-section:eq(0)");return t.find(".part").text(e.partType),t.find(".meaning").text(e.meaning),t[0]})),t.find(".js-view-sentence").attr({"data-sid":e.sentenceId,"data-wid":e.wordId}),t[0]})}}}