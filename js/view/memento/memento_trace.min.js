async function pageinit(s,e,t){$.scrollUp({scrollText:'<i class="fas fa-angle-double-up"></i>',scrollSpeed:0});let a,i=($.ajax({url:"https://static.findsvoc.com/js/util/tts-util.min.js",dataType:"script",cache:!0}).then(()=>{a=new FicoTTS}),"https://static.findsvoc.com/sound/yeah.mp3"),d="https://static.findsvoc.com/sound/unfortune.mp3",l="https://static.findsvoc.com/sound/spring-bounce.mp3",r="https://static.findsvoc.com/sound/cartoon-pop.mp3",c=await $.get("https://static.findsvoc.com/fragment/memento/memento_list.min.html",jQuery.noop,"html"),n={language:"ko",firstDayOfTheWeek:2},m="mementoTodayLuck",p=Math.min(5,Math.floor(e/20))||1,g,f=!1,u="yyyy-MM-dd",o=0,h=$(".page-scroll")[0],y=new IntersectionObserver(e=>{var t;e[0].isIntersecting&&(e=e[0].target.dataset.pagenum,t=$("#sortBtn")[0].dataset.sort,$.getJSON("/memento/trace/"+e,{sort:t},e=>v(e)))});function v(e){y&&y.unobserve(h);t=e.content;var t=Array.from(t,e=>{var t=$(c).find(".memento-trace-block:eq(0)").clone(),a=(t[0].dataset.keepWordId=e.keepWordId||0,t[0].dataset.wordId=e.wordId||0,e.del&&t.children().prepend('<div class="completed-stamp"></div>'),t.find(".data-word-title").text(e.wordTitle),t.find(".data-save-date").text(new Date(e.saveDate).format("d MMM yyyy")),e.mementoDtoList.length),n=10*Math.ceil(a/10),o=Math.min(9,Math.floor(Math.max(0,a-1)/10)),n=(t.find(".data-test-count").text(a),t.find(".data-test-goal").text(n),t.find(".progress").attr("ariaValueNow",a%10).find(".progress-bar").css({width:((a-1)%10+1)/10*100+"%",backgroundColor:["#38b8c9","#f9d76f","#fcaf17","#f79900","#f86c6b","#d93838","#b71b1b","#a1176b","#8a33a3","#6c63ff"][o]}),t.find(".calendar-section"));return n.addClass("fico-theme"),b(n[0],e),"true"!=$("#toggleCalendarsBtn").attr("data-active")||$(".memento-list-section").is(".find-lucky-mode")?t.find(".low-part").hide():t.find(".js-toggle-lowpart").addClass("active")[0].ariaPressed=!0,t[0]});$(".memento-list-section").append(t),anime({targets:t,scale:[0,1],easing:"linear",duration:300,delay:anime.stagger(150),update:e=>{e.animations?.forEach(function(e){1==e.currentValue&&e.animatable.target.removeAttribute("style")})}}),!e.last&&y?(h.dataset.pagenum=e.number+2,y.observe(h)):y&&y.disconnect()}function b(t,i){if(i.mementoDtoList.length<=0){let e=jsCalendar.new($(t).addClass("pe-none opacity-50")[0],0,n);void e.goto(new Date)}else{let s=i.mementoDtoList.sort((e,t)=>Date.parse(t.testDate)-Date.parse(e.testDate)),e=(t.id||(t.id=""+Date.now()+o++),jsCalendar.new(t,new Date(i.saveDate),Object.assign({min:new Date(i.saveDate),max:new Date},n)));e.onDateRender(function(e,t,a){t.classList.remove("saved","completed","correct","wrong","today"),delete t.dataset.bsToggle,delete t.dataset.bsHtml,delete t.dataset.bsTitle;let n="",o=e.format(u);var e=new Date(i.saveDate).format(u);o==e&&(t.classList.add("saved"),t.dataset.bsToggle="tooltip",t.dataset.bsHtml="true",n+='<p class="mb-0">단어 보관 날짜</p>',t.dataset.bsTitle=n),a.isSelected&&(a=(e=s.filter(e=>new Date(e.testDate).format(u)==o)).filter(e=>e.pass),t.classList.add(.5<a.length/e.length?"correct":"wrong"),t.dataset.bsToggle="tooltip",t.dataset.bsHtml="true",n+=`<p class="mb-0">맞힘:${a.length}/틀림:${e.length-a.length}</p>`,t.dataset.bsTitle=n),i.del&&o==new Date(i.updateDate).format(u)&&(t.classList.add("completed"),t.dataset.bsToggle="tooltip",t.dataset.bsHtml="true",n='<p class="mb-0">암기 완료 날짜</p>',t.dataset.bsTitle=n),o==(new Date).format(u)&&t.classList.add("today")}),e.select(Array.from(i.mementoDtoList,e=>new Date(e.testDate))),e.goto(i.del?new Date(i.updateDate):new Date(s[0]?.testDate))}}function w(e,t){let a=e.find(".calendar-section").get(0),n=e.find(".sentence-section").get(0);$(0==t?a:n).css("visibility","visible"),anime({targets:a,opacity:[t,1-t],easing:"linear",duration:300,complete:e=>{0!=t&&$(a).css("visibility","hidden")}}),anime({targets:n,opacity:[1-t,t],easing:"linear",duration:300,complete:e=>{1!=t&&$(n).css("visibility","hidden")}})}v({content:s,last:t,number:0}),$(document).on("click",".js-check-complete",function(){let n=this,o=$(this).closest(".memento-trace-block");confirmModal("이 단어를 암기완료 하셨습니까?",()=>{let a=parseInt(o[0].dataset.keepWordId),e=o.find(".data-word-title").text().trim();$.ajax({url:"/memento/word/change-status",type:"POST",contentType:"application/json",data:JSON.stringify({keepWordId:a,del:!0}),success:()=>{var t=a;if(sessionStorage.getItem(k)){let e=JSON.parse(sessionStorage.getItem(k));e&&(e=e.filter(e=>e.keepWordId!=t),sessionStorage.setItem(k,JSON.stringify(e)))}alertModal(`단어 <b>${e}</b>를 암기 완료했습니다.`,()=>{o.children().prepend('<div class="completed-stamp"></div>').find(".calendar-section .today").addClass("completed"),$(n).addClass("pe-none opacity-50");var e=s.find(e=>e.keepWordId==a);e.del=!0,e.updateDate=(new Date).format(u),b(o.find(".calendar-section").empty()[0],e)})}})})}).on("click",".js-view-sentence",function(){let t=$(this).closest(".memento-trace-block");var e=parseInt(t[0].dataset.keepWordId);t.find(".sentence-section").is(".loaded")?(w(t,t.find(".calendar-section").is(":visible")?1:0),t.find(".low-part").slideDown()):$.get("/memento/trace/keep-sentence/"+e,e=>{t.find(".sentence-section").addClass("loaded").find(".eng").html(e),t.find(".low-part").slideDown(),w(t,1)})}).on("click",".js-close-sentence",function(){w($(this).closest(".memento-trace-block"),0)}).on("click",".js-goto-workbook",function(){var e=$(this).closest(".memento-trace-block"),e=parseInt(e[0].dataset.keepWordId);location.assign("/memento/trace/move-workbook/"+ntoa(e))}).on("click",".js-toggle-lowpart",function(){var e=!$(this).is(".active");$(this).closest(".memento-trace-block").find(".low-part")[e?"slideDown":"slideUp"](250),$(this).toggleClass("active")}).on("click",".js-get-luck",async function(){e<20||0==(g=await(async()=>{var e,t=localStorage.getItem(m);return t&&JSON.parse(t).date==(new Date).format(u)?JSON.parse(t):(e=await(async()=>await(await fetch("/memento/keepword/winnings")).json())(),t={date:(new Date).format(u),luckies:e,try:0,achievement:!1},localStorage.setItem(m,JSON.stringify(t)),t)})()).luckies.length?alertModal("아직 Today's Luck을 진행하기에 보관 단어 수가 부족합니다."):($("#todayLuckModal .lucky-count").text(g.luckies.filter(e=>"LUCKY"!=e).length),$("#todayLuckModal").modal("show"),$.ajax({url:"https://static.findsvoc.com/js/util/audio-util.min.js",dataType:"script",cache:!0}).then(()=>{WebAudioJS.load(i),WebAudioJS.load(d),WebAudioJS.load(l),WebAudioJS.load(r)}))}).on("click",".find-lucky-mode .memento-trace-block:not(.verified)",function(){if(f)alertModal("아직 확인 중인 단어가 있습니다\n잠시 뒤 시도하세요.");else{let n=$(this),o=parseInt(this.dataset.keepWordId);var e=parseInt(this.dataset.wordId);let t=n.find(".data-word-title").text().trim();f=!0,WebAudioJS.play(r),$.getJSON("/memento/trace/keepword-meaning/"+e,async e=>{a.stop(),a.speakRepeat(t,10,200),n.find(".low-part").append(createElement({el:"div",class:"position-absolute w-100 h-100 top-0 start-0 text-center meaning-section",style:{backgroundColor:"#142a39",color:"#f6f0a0"},children:[{el:"div",class:"count-timer-section w-100",children:["단어 복습 한 번 더!",{el:"br"},"(",{el:"span",class:"time",textContent:7},"초 뒤 에그를 확인합니다.)"]}].concat(Array.from(e,e=>({el:"div",children:[{el:"span",textContent:e.partType,style:{fontFamily:'"Apple SD Gothic Neo","Segoe UI"',color:"#0aa190",fontWeight:"bold"}},{el:"span",textContent:e.meaning,style:{fontSize:"1.1rem",color:"#fff"}}]})))})).slideDown(250,()=>{let e={time:7};anime({targets:e,time:0,easing:"linear",duration:7e3,update:()=>{n.find(".count-timer-section .time").text(Math.ceil(e.time))},complete:()=>{if(a.stop(),g.luckies.includes(ntoa(o))){let t=g.luckies.indexOf(ntoa(o)),a=0==t?9:2630*Math.random()<1e3?0:2630*Math.random()<1700?1:2630*Math.random()<2200?2:2630*Math.random()<2500?3:2630*Math.random()<2600?4:2630*Math.random()<2620?5:2630*Math.random()<2626?6:2630*Math.random()<2629?7:8;if(g.try<=p){let e=$("#hiddenDivs #successLuckCover").clone();e.find(".egg-container").append(createElement({el:"div",style:{borderRadius:"50% 50% 50% 50%/60% 60% 40% 40%",width:"50%",height:"100%",margin:"auto",transform:"scale(0)",background:`center/ contain url(https://static.findsvoc.com/images/app/egg/egg-${1+a}.png) no-repeat`}})),n.children().append(e),anime({targets:e.find(".egg-container>div")[0],scale:[0,1],rotate:["0deg","720deg"],duration:1e3,easing:"easeOutQuad",complete:()=>{e.find(".js-go-mypage").prop("disabled",!1),$.ajax({type:"POST",url:"/memento/luck/win",data:JSON.stringify([{keepWordId:o,eggColor:a,gold:9==a}]),contentType:"application/json",success:()=>{g.luckies.splice(t,1,"LUCKY"),0==t&&(g.achievement=!0),g.try=g.try+1,localStorage.setItem(m,JSON.stringify(g))},error:()=>{alertModal("일시적 오류로 에그 획득에 실패했습니다.")},complete:()=>{f=!1,n.addClass("verified")}})}}),WebAudioJS.play(i),showFireworks({target:e.find(".egg-container")[0],interval:300,count:1,time:1e3})}else{g.try=g.try+1,localStorage.setItem(m,JSON.stringify(g)),f=!1,n.addClass("verified");var e=$("#hiddenDivs #lateLuckCover").clone();e.find(".egg-container").append(createElement({el:"div",style:{borderRadius:"50% 50% 50% 50%/60% 60% 40% 40%",width:"50%",height:"100%",margin:"auto",transform:"scale(0)",background:`center/ contain url(https://static.findsvoc.com/images/app/egg/egg-${1+a}.png) no-repeat`}})),n.children().append(e),anime({targets:e.find(".egg-container>div")[0],scale:[0,1],rotate:["0deg","720deg"],opacity:{delay:2e3,duration:1e3,value:[1,.1]},duration:2e3,easing:"easeOutQuad"}),WebAudioJS.play(d)}}else{g.try=g.try+1,localStorage.setItem(m,JSON.stringify(g)),f=!1,n.addClass("verified");e=$("#hiddenDivs #failLuckCover").clone();n.children().append(e),n.find("lottie-player")[0].stop(),n.find("lottie-player")[0].play(),WebAudioJS.play(l)}}})})})}}),$("#todayLuckStart").on("click",function(){$(".memento-list-section").addClass("find-lucky-mode"),$("#menuBtnGroup>button,.memento-word-menu").addClass("pe-none opacity-50"),$(".memento-trace-block .collapse-lowpart-btn").removeClass("active"),$(".memento-trace-block .low-part").slideUp(250),$("#todayLuckModal").modal("hide"),$("#exitFindLuckyMode").show()}),$("#exitFindLuckyMode").on("click",function(){$(this).hide();var e=JSON.parse($("#toggleCalendarsBtn")[0].dataset.active);$(".memento-list-section").removeClass("find-lucky-mode").find(".meaning-section").remove(),$("#menuBtnGroup>button,.memento-word-menu").removeClass("pe-none opacity-50"),$(".memento-trace-block .low-part")[e?"slideDown":"slideUp"](250)}),$("#sortBtn").on("click",function(){var e="recent"==this.dataset.sort?"alphabet":"recent";this.dataset.sort=e,$.getJSON("/memento/trace/1",{sort:e},e=>{$(".memento-list-section").empty(),v(e)}),$(this).find("i").toggleClass("fa-sort-alpha-down fa-sort-numeric-down-alt"),$(this).find("span").text("recent"==e?"알파벳순":"최근순")}),$("#toggleCalendarsBtn").on("click",function(){var e=JSON.parse(this.dataset.active);$(".memento-trace-block .collapse-lowpart-btn").toggleClass("active",!e),$(".memento-trace-block .low-part")[e?"slideUp":"slideDown"](250),this.dataset.active=!e,$(this).toggleClass("active",!e),$(this).find("i").toggleClass("fa-calendar-alt fa-calendar-times"),$(this).find("span").text(e?"상세 모드":"심플 모드")});let k="savedWordList"}