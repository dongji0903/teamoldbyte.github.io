async function pageinit(n,e){const g=new FicoTTS,t="https://static.findsvoc.com/sound/yeah.mp3",a="https://static.findsvoc.com/sound/page-flip.mp3",s=($.ajax({url:"https://static.findsvoc.com/js/util/audio-util.min.js",dataType:"script",cache:!0}).then(()=>{WebAudioJS.load(t),WebAudioJS.load(a)}),$.ajax({url:"https://cdn.jsdelivr.net/npm/typewriter-effect@2.20.1/dist/core.min.js",dataType:"script",cache:!0}),document.querySelector(".autoplay-progress svg")),i=document.querySelector(".autoplay-progress span");let u=await $.get("https://static.findsvoc.com/fragment/memento/auto_play_test.min.html",jQuery.noop,"html");const o="MementoAutoPlayTestConfigs";var l=JSON.parse(localStorage.getItem(o)||"{}");let m=l.wordAutoplay??!0,f=l.sentenceAutoplay??!0,h=l.sentenceRepeat??1,b,y;const v=new Set;location.pathname.includes("/mapping-test")&&$("#mappingTestCoverGuide").show(),$(".swiper-slide.end").before(function(d){{if("mapping-test"!=e)return Array.from(d,(e,o)=>{const{keepWordId:s,eng:i,kor:t,title:n,sentenceLeftPart:a,sentenceRightPart:l}=e,r=$(u).find(".swiper-slide.eng-test").clone();var c=r.find(".sentence-section .eng:first-child"),p=r.find(".sentence-section .eng:last-child"),c=(a?c.text(a):c.remove(),r.find(".sentence-section .invisible").text(n),l?p.text(l):p.remove(),r.find(".kor-section .kor").text(t),d.filter((e,t)=>o!=t));return c.sort(()=>Math.random()-.5),r.find(".options-section").append(Array.from(c.slice(0,7).concat([e]).sort(()=>Math.random()-.5),n=>{var e=$(u).find(".option-block").eq(0).clone();const a=n.keepWordId==s;return e.find(".option").text(n.title),e.on("click",".option",function(){const o=this;r.find(".option").addClass("pe-none"),Promise.all([Promise.resolve(y.pause()),new Promise((e,t)=>{$.ajax({url:"/memento/test/record",type:"POST",data:{keepWordId:s,pass:a},success:function(){v.add(s),$(o).addClass("active"),$(b.pagination.bullets[b.activeIndex]).addClass("position-relative").append(createElement({el:"span",class:"pagination-bullet-check fas fa-check fa-sm top-0 start-0",style:{position:"absolute",color:"#0dcaf0",transform:"translate(-10%, -50%)"}})),e()},error:()=>{r.find(".option").removeClass("pe-none"),alertModal("풀이 제출에 실패했습니다."),t()}})}),new Promise((e,t)=>{m?g.speak(n.title,()=>{f?setTimeout(()=>g.speakRepeat(i,h,250,()=>e()),500):setTimeout(()=>e(),500)}):f?g.speakRepeat(i,h,250,()=>setTimeout(()=>e(),500)):setTimeout(()=>e(),1e3)})]).then(()=>k())}),e})),r});{const n=[];return d?.forEach(e=>{e?.keepWordDtoList?.forEach(t=>{n.some(e=>e.title==t.title)||n.push(t)})}),Array.from(d,a=>{const{kor:e,keepWordDtoList:s}=a,i=$(u).find(".swiper-slide.mapping-test").clone();i.find(".kor-section .kor").text(e),i.find(".guide-section .option-count").text(s.length);let o=Array.from(s);return(o=o.length<8?o.concat(n.sort(()=>Math.random()-.5).filter(t=>!o.some(e=>t.keepWordId==e.keepWordId)).slice(0,8-o.length)):o).sort(()=>Math.random()-.5),i.find(".options-section").append(Array.from(o,e=>{var t=$(u).find(".option-block").eq(0).clone();return t.find(".option").text(e.title).data("keepWordId",e.keepWordId).on("click",function(){m&&g.stop(()=>g.speak(e.title)),i.find(".choose-complete-section").toggle(i.find(".option.active").length==s.length)}),t})),i.on("click",".js-choose-complete",function(){const n=$(this).addClass("pe-none"),e=i.find(".option.active").get();var t=Array.from(s,t=>({keepWordId:t.keepWordId,pass:e.some(e=>$(e).data("keepWordId")==t.keepWordId)}));y.pause(),$.ajax({url:"/memento/test/records",type:"POST",data:JSON.stringify(t),contentType:"application/json",success:()=>{s.forEach(e=>{v.add(e.keepWordId)}),i.find(".option").addClass("pe-none"),i.find(".option").get().forEach(t=>{s.some(e=>e.keepWordId==$(t).data("keepWordId"))?$(t).addClass("answer"):$(t).addClass("not-answer")}),$(b.pagination.bullets[b.activeIndex]).addClass("position-relative").append(createElement({el:"span",class:"pagination-bullet-check fas fa-check fa-sm top-0 start-0",style:{position:"absolute",color:"#0dcaf0",transform:"translate(-10%, -50%)"}}));var e=a.eng.replace(/\W/g,"").length,t=60*e/1275,o=createElement({el:"div",style:{marginTop:"1rem",color:"var(--slate)",fontSize:"1.2rem"}});i.find(".kor-section").append(o),new Typewriter(o,{delay:1e3*t/e,cursor:""}).typeString(a.eng).callFunction(()=>{anime({targets:n.siblings(".js-next-slide").get(),duration:400,rotateX:["180deg","0deg"],easing:"linear",complete:e=>{e.animatables[0].target.classList.remove("pe-none")}}),anime({targets:n.get(),duration:400,easing:"linear",rotateX:["0deg","180deg"],update:e=>{50<e.progress&&n.css("zIndex",-1)}})}).start()},error:()=>{alertModal("풀이 제출에 실패했습니다."),n.removeClass("pe-none"),reject()}}),new Promise((e,t)=>{f?g.stop(()=>g.speakRepeat(a.eng,h,250,()=>setTimeout(()=>e(),500))):setTimeout(()=>e(),1e3)})}),i})}}}(n)),$("#startAutoPlay, .cover-before-play").on("click",function(){if($("#startAutoPlay").prop("disabled",!0).tooltip("hide"),$("#finishAutoPlay").prop("disabled",!1),$(".cover-before-play,.cover-before-play-cover").hide(),$("#waitingLottie").show(),$(".autoplay-top-mobile-menu .start-btn").toggleClass("start-btn finish-btn").find(".fas").toggleClass("fa-play fa-pause"),$(".example-sentence-section, .options-cover").show(),b)b.enable();else{let o;b=new Swiper(".swiper",{centeredSlides:!0,pagination:{el:".swiper-pagination",clickable:!0},on:{afterInit(e){$(e.pagination.el).show(),$(e.pagination.bullets[e.slides.length-1]).toggleClass("swiper-pagination-bullet swiper-pagination-hidden");const t=n.length;o={time:20*t,ext:0,loop:0},y=anime({targets:o,easing:"linear",duration:2e4*t,time:0,update:e=>{s.style.setProperty("--progress",e.progress/100-1),i.textContent=Math.ceil(o.time)+"s",50<e.progress&&(s.style.stroke="#d16464",i.style.color="#d16464"),90<e.progress&&(s.style.scale=1.3,i.style.scale=1.3)},complete:e=>{y=anime({targets:o,easing:"linear",duration:2e4*t,time:[0,20*t],loop:100,update:e=>{o.ext=20*o.loop*t+o.time,s.style.setProperty("--progress",e.progress/100),i.textContent=`+${Math.floor(o.ext)}s`},loopComplete:e=>{o.loop++,o.time=0}})}})},transitionStart(e){g.stop(),WebAudioJS.play(a)},transitionEnd(e){y.paused&&y.play(),$(e.slides[e.activeIndex-1]).find("button").attr("tabIndex",-1).trigger("blur"),e.allowSlideNext=e.activeIndex!=e.slides.length-2||v.size==e.slides.length-1},reachEnd(e){$(e.pagination.el).hide(),y.pause(),$(".operation-section,.config-section").css("visibility","hidden"),$(".time-result-msg .expected-time").text(20*n.length),$(".time-result-msg .elapsed-time").text(Math.round(20*n.length-o.time)),0<o.ext?($(".time-over-msg").slideDown(),$(".time-result-msg .elapsed-time").text(Math.round(20*n.length+o.ext)),$(".time-result-msg .additional-msg").text(Math.round(o.ext)+"초 초과!")):0<o.time&&o.time>20*n.length/10?$(".time-result-msg .additional-msg").text(Math.round(o.time)+"초나 여유있게 풀어냈습니다!"):$(".time-result-msg .additional-msg").text("아슬아슬했습니다! 좀 더 암기하기를 추천합니다."),$(".autoplay-progress").hide(),WebAudioJS.play(t),showFireworks({target:e.slides[e.slides.length-1],size:15,particles:15}),e.disable()}}})}}),$("#finishAutoPlay").on("click",function(){$(this).prop("disabled",!0).tooltip("hide"),$(".cover-before-play").show(),y.pause(),$(".autoplay-top-mobile-menu .finish-btn").toggleClass("start-btn finish-btn").find(".fas").toggleClass("fa-play fa-pause"),0<v.size?confirmModal("지금 바로 테스트 결과를 보시겠습니까?",()=>{$("#getResultForm").submit()},()=>{$(".cover-before-play").hide(),$(this).prop("disabled",!1),$(".autoplay-top-mobile-menu .start-btn").toggleClass("start-btn finish-btn").find(".fas").toggleClass("fa-play fa-pause"),y.completed||y.play()}):confirmModal("아직 푼 문제가 없습니다. 뒤로 돌아가시겠습니까?",()=>{history.back()},()=>{$(".cover-before-play").hide(),$(this).prop("disabled",!1),$(".autoplay-top-mobile-menu .start-btn").toggleClass("start-btn finish-btn").find(".fas").toggleClass("fa-play fa-pause"),y.completed||y.play()})});let r=scrollY,c;const p=$(".mobile-config-section-open-btn-block").get(0),d=($(window).on("scroll",function(e){c^r<scrollY&&(c=r<scrollY,r>=scrollY&&(anime({targets:p,translateY:0,duration:300,easing:"easeOutQuad"}),$(".mobile-config-section-open-btn.active").button("toggle"),anime({targets:".mobile-config-section-open-btn .fas",rotate:"0deg",duration:300,easing:"easeOutQuad"})),anime({targets:$(p).find(".mobile-config-section-open-btn").get(0),translateY:r<scrollY?0:"100%",duration:300,easing:"easeOutQuad"})),r=scrollY}),$(".mobile-config-section-open-btn").on("click",function(){var e=this.classList.contains("active");anime({targets:p,translateY:e?"-100%":0,duration:300,easing:"easeOutQuad"}),anime({targets:".mobile-config-section-open-btn .fas",rotate:e?"180deg":"0deg",duration:300,easing:"easeOutQuad"})}),"MementoAutoPlayTestGuideConfirmed");function k(){setTimeout(()=>{var{slides:e,activeIndex:t,pagination:o}=b;if(o.bullets[t].querySelector(".pagination-bullet-check")){$(e[t]).find("button").attr("tabIndex",-1).trigger("blur");var n=o.bullets.findIndex(e=>!e.querySelector(".pagination-bullet-check")),a=e.length-1;for(let e=t;e<a;e++)if(!o.bullets[e].querySelector(".pagination-bullet-check"))return void b.slideTo(e);b.allowSlideNext=!0,b.slideTo(n)}},200)}!JSON.parse(localStorage.getItem(d)||"false")&&devSize.isPhone()&&$("#startModal").modal("show"),$("#startModalNotDisplayCheck").on("click",function(){localStorage.setItem(d,"true")}),$("#getResultForm").on("formdata",function(e){e.originalEvent.formData.append("keepWordIds",Array.from(v).toString())}),$(".autoplay-top-mobile-menu").on("click",".start-btn,.finish-btn",function(){$(this.matches(".start-btn")?"#startAutoPlay":"#finishAutoPlay").trigger("click")}),$("#toggleFullscreen").on("click",function(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}),$(document.documentElement).on("fullscreenchange",function(){document.fullscreenElement?($("#toggleFullscreen").attr("data-bs-original-title","학습모드를 종료합니다."),$("#toggleFullscreen").tooltip(),$("#toggleFullscreen i").removeClass("fa-expand").addClass("fa-compress")):($("#toggleFullscreen").attr("data-bs-original-title","학습모드를 켭니다."),$("#toggleFullscreen").tooltip(),$("#toggleFullscreen i").addClass("fa-expand").removeClass("fa-compress"))}),$(".js-change-word-autoplay").toggleClass("fa-volume-up",m).toggleClass("fa-volume-mute opacity-50",!m).attr("data-active",m).on("click",function(){var e=!JSON.parse(this.dataset.active);m=e,$(this).toggleClass("active",e),$(this).toggleClass("fa-volume-up fa-volume-mute opacity-50")}),$(".js-change-sentence-autoplay").toggleClass("fa-volume-up",f).toggleClass("fa-volume-mute opacity-50",!f).attr("data-active",f).on("click",function(){var e=!JSON.parse(this.dataset.active);f=e,$(this).toggleClass("active",e),$(this).toggleClass("fa-volume-up fa-volume-mute opacity-50")}),$(".js-change-sentence-repeat-open .number").text(h),$(".js-change-sentence-repeat-open").each((e,t)=>{new bootstrap.Tooltip(t,{trigger:"click",placement:"right",html:!0,title:$('<div class="text-center" style="width:6rem"><label class="form-label">문장<br>반복 재생 횟수</label><input type="number" min="1" class="js-change-sentence-repeat form-control pe-0 me-1 d-inline" value="'+h+'" style="width:4rem">회</div>')[0]})}),$(document).on("click",".js-next-slide",k).on("shown.bs.tooltip",".js-change-sentence-repeat-open",function(){$(".js-change-sentence-repeat:visible").val(h)[0].focus()}).on("blur",".js-change-sentence-repeat",function(){$(".js-change-sentence-repeat-open:visible").tooltip("hide")}).on("change",".js-change-sentence-repeat",function(){h=Math.max(1,parseInt(this.value)),$(".js-change-sentence-repeat-open .number").text(h)}),$(".js-save-configs").on("click",function(){localStorage.setItem(o,JSON.stringify({wordAutoplay:m,sentenceAutoplay:f,sentenceRepeat:h})),$(this).prev(".toast").toast("show")})}