function pageinit(n){$(".js-overview-battlebook").on("click",function(){location.assign("/battlebook/overview/"+ntoa(n))});let o=$(".battlebook-info-section .book-cover img");$('[name="coverImage"]').on("change",function(e){let t=e.target.files[0];if(null==t)return!1;let a=new FileReader;a.onload=function(){o.css("background-image","url("+this.result+")").closest(".book-cover").removeClass("default").find(".book-title").hide(),URL.revokeObjectURL(a.result)},new Compressor(t,{success(e){a.readAsDataURL(e)},error(e){a.readAsDataURL(t)}})}),$(document).on("focus click",".edit-hover:not(.active) *",function(e){e.stopImmediatePropagation(),e.stopPropagation();var e=$(this.closest(".edit-hover")),t=e.find(".battlebook-edit-input");e.addClass("active"),t.is(":file")?(t.data("originData",o.css("background-image")),e.find(".mdf-btns").css("display","block")):(t.prop("readonly",!1),t.data("originData",(t.is(":radio")?t.filter(":checked"):t).val()),e.find(".mdf-btns").show(),t.is("textarea")&&(t.data("summernote")?t.siblings(".note-editor").show():openSummernote(t),e.find(".description:not(textarea)").hide())),e.find(".edit-badge").hide()}),$(".js-edit-cancel").click(function(e){e.stopPropagation();var e=$(this.closest(".edit-hover")),t=e.find(".battlebook-edit-input");t.is(":file")?(o.css("background-image",t.data("originData")),"none"==t.data("originData")&&o.closest(".book-cover").addClass("default").find(".book-title").show()):(t.is(":radio")?t.filter('[value="'+t.data("originData")+'"]').prop("checked",!0):t.val(t.data("originData")),t.is("textarea")?(t.siblings(".note-editor").hide(),e.find(".description:not(textarea)").show()):t.prop("readonly",!0)),e.removeClass("active").find(".edit-badge").show().removeAttr("style"),e.find(".mdf-btns").hide().find("button").not(this).prop("disabled",!0)}),$(".edit-hover input, .edit-hover select, .edit-hover textarea").on("input",function(){$(this.closest(".edit-hover")).find(".mdf-btns button").prop("disabled",!1)}),$(".edit-battlebook-form").submit(function(e){e.preventDefault();let a=$(this).find(".battlebook-edit-input"),t=a.closest(".edit-hover"),o=this;if(a.is(":file")){let t=new FormData;t.append("battleBookId",n),new Compressor(a.get(0).files[0],{success(e){t.append(a.attr("name"),e,e.name),$.ajax({url:o.action,type:"POST",data:t,processData:!1,contentType:!1,success:i,error:()=>alertModal("수정에 실패했습니다.")})},error(e){t.append(a.attr("name"),a.get(0).files[0]),$.ajax({url:o.action,type:"POST",data:t,processData:!1,contentType:!1,success:i,error:()=>alertModal("수정에 실패했습니다.")})}})}else{e={battleBookId:n};e[a.attr("name")]=a.is(":radio")?"true"==a.filter(":checked").val():a.is("textarea")?a.summernote("code").trim():"number"==a.attr("type")?parseInt(a.val()):a.val().trim(),$.ajax({url:o.action,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:i,error:()=>alertModal("수정에 실패했습니다.")})}function i(){alertModal("수정되었습니다."),t.removeClass("active").find(".edit-badge").show().removeAttr("style"),t.find(".mdf-btns").hide(),a.is("textarea")&&(a.siblings(".note-editor").hide(),$(o).siblings(".description").html(a.val()).show()),$(".update-date").text((new Date).toLocaleDateString())}})}