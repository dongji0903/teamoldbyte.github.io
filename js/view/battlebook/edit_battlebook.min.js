function pageinit(s){$(".js-overview-battlebook").on("click",function(){location.assign("/battlebook/overview/"+ntoa(s))});let a=$(".battlebook-info-section .book-cover img");$('[name="coverImage"]').on("change",function(e){let t=e.target.files[0];if(null==t)return!1;const o=new FileReader;o.onload=function(){a.css("background-image","url("+this.result+")").closest(".book-cover").removeClass("default").find(".book-title").hide(),URL.revokeObjectURL(o.result)},new Compressor(t,{success(e){o.readAsDataURL(e)},error(e){o.readAsDataURL(t)}})}),$(document).on("focus click",".edit-hover:not(.active) *",function(e){e.stopImmediatePropagation(),e.stopPropagation();var e=$(this.closest(".edit-hover")),t=e.find(".battlebook-edit-input");e.addClass("active"),t.is(":file")?(t.data("originData",a.css("background-image")),e.find(".mdf-btns").css("display","block")):(t.prop("readonly",!1),t.data("originData",(t.is(":radio")?t.filter(":checked"):t).val()),e.find(".mdf-btns").show(),t.is("textarea")&&(t.data("summernote")?t.siblings(".note-editor").show():openSummernote(t),e.find(".description:not(textarea)").hide())),e.find(".edit-badge").hide()}),$(".js-edit-cancel").click(function(e){e.stopPropagation();var e=$(this.closest(".edit-hover")),t=e.find(".battlebook-edit-input");t.is(":file")?(a.css("background-image",t.data("originData")),"none"==t.data("originData")&&a.closest(".book-cover").addClass("default").find(".book-title").show()):(t.is(":radio")?t.filter('[value="'+t.data("originData")+'"]').prop("checked",!0):t.val(t.data("originData")),t.is("textarea")?(t.siblings(".note-editor").hide(),e.find(".description:not(textarea)").show()):t.prop("readonly",!0)),e.removeClass("active").find(".edit-badge").show().removeAttr("style"),e.find(".mdf-btns").hide().find("button").not(this).prop("disabled",!0)}),$(".edit-hover input, .edit-hover select, .edit-hover textarea").on("input",function(){$(this.closest(".edit-hover")).find(".mdf-btns button").prop("disabled",!1)}),$(".edit-battlebook-form").submit(function(e){e.preventDefault();const t=$(this).find(".battlebook-edit-input"),o=t.closest(".edit-hover"),a=this;if(t.is(":file")){const n=new FormData;n.append("battleBookId",s),new Compressor(t.get(0).files[0],{success(e){n.append(t.attr("name"),e,e.name),$.ajax({url:a.action,type:"POST",data:n,processData:!1,contentType:!1,success:i,error:()=>alertModal("수정에 실패했습니다.")})},error(e){n.append(t.attr("name"),t.get(0).files[0]),$.ajax({url:a.action,type:"POST",data:n,processData:!1,contentType:!1,success:i,error:()=>alertModal("수정에 실패했습니다.")})}})}else{e={battleBookId:s};e[t.attr("name")]=t.is(":radio")?"true"==t.filter(":checked").val():"number"==t.attr("type")?parseInt(t.val()):t.val().trim(),$.ajax({url:a.action,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:i,error:()=>alertModal("수정에 실패했습니다.")})}function i(){alertModal("수정되었습니다."),o.removeClass("active").find(".edit-badge").show().removeAttr("style"),o.find(".mdf-btns").hide(),t.is("textarea")&&(t.siblings(".note-editor").hide(),$(a).siblings(".description").html(t.val()).show()),$(".update-date").text((new Date).toLocaleDateString())}})}