async function pageinit(C,e,t,S,I,n,s,o,j){history.length==parseInt(sessionStorage.getItem("historyLength"))?(alert("비정상적 접근입니다."),sessionStorage.removeItem("historyLength"),location.replace("/")):sessionStorage.setItem("historyLength",history.length);const i=parseFloat(getComputedStyle(document.documentElement).fontSize),T=new FicoTTS({initSuccessCallback:()=>{devSize.isPhone()||document.querySelector("#ttsSettings .form-switch").remove()}}),q=await $.get("https://static.findsvoc.com/fragment/workbook/element_templates.min.html",jQuery.noop,"html"),L={"n.":"명사","v.":"동사","vt.":"타동사","vi.":"자동사","a.":"형용사","ad.":"부사","prep.":"전치사","conj.":"접속사","int.":"감탄사","abbr.":"약어","pron.":"대명사","NP.":"명사구","phrasal-v.":"구동사","VP.":"동사구","PP.":"전치사구","ADP.":"부사구","AJP.":"형용사구","IP.":"관용어","CP.":"연어"};$(window).on("unload",()=>$("#loadingModal").modal("hide")),$(".workbook-menu-section").find(".logo-link-section").addClass("glass-effect"),/Mobi/.test(navigator?.userAgent)&&screen.orientation||$(".js-rotate-btn").remove(),$(".sentence-link").one("click",function e(){$(".js-toggle-menu").removeClass("pe-none"),$(".sentence-link").off("click",e).not(this).addClass("pe-none opacity-50");const t=$(this).closest(".full-text,.sentence-list").find(".sentence-link").index(this);var n=j[t],s=($.getJSON("/sermes/count/update/"+n.sentenceId),$(".one-sentence-unit-section:eq(0)")),o=(s.data("sentenceId",n.sentenceId).attr("id","sentence"+(t+1)).data("metaEvaluated",["S","F"].includes(n.metaStatus)).find(".origin-sentence-section"),s.find(".removable-section").collapse("show"),s.find(".collapse-btn").each(function(){this.dataset.bsTarget=`#sentence${t+1} `+this.dataset.collapseSelector}),s.find(".origin-sentence").append($(q).children(".origin-sentence-container").clone(!0).children()).find(".sentence-text").text(n.text),s.find(".numbering-text").remove(),n.text),i=n.svocList;s.find(".result-semantic-section").append($(q).children(".svoc-menu-section").clone(!0)).find(".js-open-dashboard").attr("data-bs-target",`#sentence${t+1} .dashboard-section`);let a=i[0];const l=$(q).children(".svoc-section").clone(!0);l.appendTo(s.find(".result-semantic-section")),tandem.showSemanticAnalysis(o,a.svocBytes,l.find(".svoc-block")).then(e=>{l.find(".writer-section").empty().append($("#hiddenDivs").find(".help-icon,.tip-icon,.js-rotate-btn").clone());var t=l.find(".svoc-mdf-btns");t.find("[data-seq]").attr("data-seq",e.dataset.seq),C!=a.memberId&&t.remove()});var i=function(e){switch(e){case"S":return{icon:"🥳",msg:"평가를 받은 문장이예요."};case"F":return{icon:"🤯",msg:"분석이 틀렸대요."};default:return{icon:"🤔",msg:"아직 평가되지 않은 문장이예요."}}}(n.metaStatus),c=(s.find(".dashboard-section .meta-status").text(i.icon).attr("title",i.msg),n.korList);if(null!=c&&0<c.length){var d=c.length,r=s.find(".ai-translation-section").show().empty();for(let e=0;e<d;e++){var p=M.clone(),g=c[e];p.data("korTid",g.korId),"Translator"!=g.alias?p.addClass("user-trans").find(".translator").text(" "+g.alias):p.addClass("ai-trans"),p.find(".translation-text").text(g.kor),C==g.memberId&&p.append($(q).find(".trans-mdf-btns").clone(!0)),r.append(p)}r.closest(".translation-section").find(".open-kor-btn").addClass("active"),r.find(".ai-translation-block").collapse("show")}var h=n.wordList;if(null!=h&&0<h.length){var f=h.length,u=s.find(".collapse-section .word-section, .sentence-ext-section .word-section .one-block").empty();u.closest(".word-list-section").toggleClass("has-user-vocas",h.some(e=>e.senseList.some(e=>/[A-Z]|phrasal-v/.test(e.partType))));for(let e=0;e<f;e++){const k=h[e],x=P.clone();x.toggleClass("user-vocas-word",k.senseList.some(e=>/[A-Z]|phrasal-v/.test(e.partType))),x.data({wordId:k.wid,sentenceId:n.sentenceId,workbookId:I,sentenceWordId:k.sentenceWordId}),x.find(".one-part-unit-section").remove(),x.find(".title").text(k.title).attr("data-playing","off").click(function(e){e.stopPropagation(),"on"==this.dataset.playing?O():(O(this),this.dataset.playing="on",this.classList.add("tts-playing","blink-2"),T.speakRepeat(k.title,2,500,()=>{this.classList.remove("tts-playing","blink-2"),this.dataset.playing="off"}))});var m=k.senseList;if(null!=m){var v=m.length;for(let e=0;e<v;e++){var b=m[e],w=A.clone();x.append(w),w.find(".part").text(b.partType).attr("title",L[b.partType]),w.find(".meaning").text(b.meaning)}u.append(x)}}devSize.isPhone()||s.find('.nav-link[data-type="word-list"]').tab("show")}let y=s.find(".related-list").addClass("loading position-relative show");y.append('<i class="loading-icon w-auto offset-6 text-center fa-2x fas fa-spin fa-circle-notch text-fc-purple"></i>'),y.find(".empty-list").hide();o=s.data("sentenceId");$.getJSON("/workbook/search/finger/"+ntoa(o),t=>{if(null!=t&&0<t.length){y.empty();var n=t.length;for(let e=0;e<n;e++){var s=t[e],o=$(q).find(".finger-section").clone(!0);["A","S"].includes(S)||o.find(".svoc-mdf-btns").remove(),y.append(o),o.data("sentenceId",s.sentenceId).find(".sentence-text").text(s.eng)}}else y.find(".empty-list").show(),y.find(".loading-icon").remove();y.removeClass("loading").addClass("loaded")}).fail(()=>{alertModal("인덱스 핑거 조회에 실패했습니다."),y.find(".empty-list").show(),y.find(".loading-icon").remove(),y.removeClass("loading").addClass("loaded")}),setTimeout(()=>$(".result-section")[0].scrollIntoView(),500)}),$("#passageNotes, #passageQnas").on("show.bs.collapse",function(e){$(e.target).is(".qna-section,.note-section")&&($(this).siblings(".collapse").collapse("hide"),$(this).closest(".passage-comment-section").addClass("bg-fc-light-purple"))}).on("hide.bs.collapse",function(e){$(e.target).is(".qna-section,.note-section")&&0==$(this).siblings(".collapse.show").length&&$(this).closest(".passage-comment-section").removeClass("bg-fc-light-purple")}),$("#passageNotes,#passageNotes_mobile").one("show.bs.collapse",function(){const t=$(this);t.is(".loading")||(t.addClass("loading"),$.getJSON(`/workbook/passage/note/list/${I}/${o}/`+C,e=>{var n=e,s=t.find(".note-list").empty();0<n.length&&s.siblings(".empty-list").hide();for(let e=0,t=n.length;e<t;e++)v(n[e]).appendTo(s);t.removeClass("loading")}).fail(()=>alertModal("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$("#passageQnas").one("show.bs.collapse",function(){const e=$(this);e.is(".loading")||(e.addClass("loading"),$.getJSON(["/qnastack/question/workbook/passage",I,o].join("/"),function(n){0<n.length&&e.find(".empty-list").hide();var s=e.find(".qna-list").empty();for(let e=0,t=n.length;e<t;e++){var o=n[e],o=createQuestionDOM(o,!1);o.find(".accordion-collapse").attr("data-bs-parent","#passageQnas .qna-list"),s.append(o)}e.removeClass("loading")}).fail(()=>alertModal("질문 가져오기에 실패했습니다.\n다시 접속해 주세요.")))});let a=$(".result-section");var l=$(".one-sentence-unit-section").clone();let M=l.find(".ai-translation-block:eq(0)"),P=l.find(".one-word-unit-section:eq(0)"),A=l.find(".one-part-unit-section:eq(0)"),c=(0==j.length&&$("#loadingModal").modal("hide"),$(document).one("click",".origin-sentence-section",function(e){}),0),d=$(".view-passage-section")[0].scrollTop;const r=$(".workbook-menu-section");$(document).on("scroll",function(){var e=scrollY>d?1:-1;d=scrollY,c==e||$("#js-mobile-menu .passage-sentence-nav").is(".show")||(c=e,anime({targets:"#js-mobile-menu",easing:"linear",duration:200,translateY:0<e?"100%":0}))});let p,g,h;function f(e,t){t=t.match(/swiper[-\w]*/g);return $(this).data("swiperClass",t),t}function u(t){var e=t.closest(".one-sentence-unit-section").data("sentenceId");!t.is(".loading,.loaded")&&e&&(t.addClass("loading").find(".empty-list").show(),$.getJSON(`/workbook/sentence/note/list/${I}/${e}/`+C,e=>{var n=e,s=(0<n.length&&t.find(".empty-list").hide(),t.find(".note-list").empty());for(let e=0,t=n.length;e<t;e++)v(n[e]).appendTo(s);t.toggleClass("loading loaded")}).fail(()=>alertModal("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}function O(t){T.stop(),document.querySelectorAll('[class*="js-tts-play"][data-playing="on"],.tts-playing').forEach(e=>{t!=e&&(e.matches('[class*="js-tts-play"]')?e.textContent="play_circle":e.matches(".tts-playing")&&e.classList.remove("tts-playing","blink-2"),e.dataset.playing="off")})}$(window).on("resize",function(){devSize.isPhone()?($(".one-sentence-unit-section").addClass(function(){return["swiper-slide"].concat($(this).data("swiperClass"))}).parent(".result-section").addClass(function(){return["swiper-wrapper"].concat($(this).data("swiperClass"))}).parent().addClass(function(){return["swiper"].concat($(this).data("swiperClass"))}),h?(h.enable(),h.slides.forEach(e=>g.observe(e))):h=new Swiper(".swiper",{breakpoints:{576:{enabled:!1}},autoHeight:!0,speed:250,navigation:{prevEl:".js-prev-sentence",nextEl:".js-next-sentence"},pagination:{el:".swiper-pagination",clickable:!0},spaceBetween:30,on:{afterInit:function(t){(p=new IntersectionObserver(e=>{anime({targets:r.get(0),duration:150,easing:"linear",translateY:0<e[0].intersectionRatio?0:"-7rem"})},{rootMargin:`-${7*i}px 0px ${0*i}px 0px`})).observe($(".workbook-cover-section").get(0)),g=new ResizeObserver(e=>{e.find(e=>e.target==t.slides[t.activeIndex])&&t.update()}),t.slides.forEach(e=>g.observe(e));var e=t.slides[0],e=$(e).find(".collapse-section .note-section");function n(){setTimeout(()=>{$(".js-tts-play-sentence").trigger("click")},500)}e.collapse("show"),u(e),$(".passage-sentence-nav .sentence").eq(this.activeIndex).addClass("active"),devSize.isPhone()&&T.autoEnabled()&&($("#loadingModal").is(".show")?$("#loadingModal").on("hidden.bs.modal",n):n())},slideChange:function(){$(this.slides[this.activeIndex]).find(".note-section").collapse("show"),$(".passage-sentence-nav .sentence").eq(this.activeIndex).addClass("active").siblings(".sentence").removeClass("active"),O()},slideChangeTransitionEnd:function(e){scrollTo(0,a[0].offsetTop),localStorage.getItem("fico-swipe-happened")||localStorage.setItem("fico-swipe-happened",!0),setTimeout(()=>{$(e.slides[e.activeIndex]).find(".semantics-result:visible").each(function(){tandem.correctMarkLine(this)}),T.autoEnabled()&&$(".js-tts-play-sentence").trigger("click")},500)}}})):(g?.disconnect(),h?.disable(),$(".one-sentence-unit-section").removeClass(f).parent(".result-section").removeClass(f).attr("style","").parent().removeClass(f))}).trigger("resize"),$(document).one("click","#js-mobile-menu .sentence-link",function(){$("#js-mobile-menu .mobile-menu-section,#js-mobile-menu .passage-sentence-nav").collapse("toggle"),h.slideTo($(this).index())}).on("show.bs.collapse hide.bs.collapse","#js-mobile-menu .passage-sentence-nav",function(e){e.target==this&&($("#js-mobile-menu .js-toggle-menu").animate("show"==e.type?{rotate:"180deg"}:{rotate:"0deg"}),$("#js-mobile-menu").css("transform","translateY(0)"),"show"==e.type)&&$(".passage-sentence-nav .sentence.active")[0].scrollIntoView()}).on("show.bs.collapse",".collapse-section .note-section",function(){u($(this))}).on("click",".word-list-section",function(){var e;devSize.isPhone()&&(e=$(this).find(".word-section"),this.matches(".shrink")?(e.animate({height:e.data("orgHeight")+"px"}),this.classList.remove("shrink")):(this.classList.add("shrink"),e.data("orgHeight")||e.data("orgHeight",e.height()),e.animate({height:"1.5rem"},300)))}).on("click",".note-list .note-text",function(){devSize.isPhone()&&(this.matches(".shrink")?($(this).animate({height:$(this).data("orgHeight")+"px"}),this.classList.remove("shrink")):(this.classList.add("shrink"),$(this).data("orgHeight")||$(this).data("orgHeight",$(this).height()),$(this).animate({height:"1.5rem"},300)))}),devSize.isPhone()&&!localStorage.getItem("fico-swipe-happened")&&$("#loadingModal").on("hidden.bs.modal",function(){setTimeout(()=>{$(".swipe-intro").show(),setTimeout(()=>$(".swipe-intro").remove(),2e3)},1e3)}),$(document).on("click","#toggle-all-btn",function(){var e=$(this).find(".fold-icon").is(".expanded")?"hide":"show";$(".one-sentence-unit-section>.collapse").trigger("prv.scroll").collapse(e),$(this).find(".fold-icon").toggleClass("expanded")}).on("prv.scroll",".one-sentence-unit-section>.collapse",function(){this.dataset.scroll="false"}).on("show.bs.collapse hide.bs.collapse",".one-sentence-unit-section>.collapse",function(e){var t;e.target==e.currentTarget&&((t=$(this).closest(".one-sentence-unit-section")).toggleClass("active","show"==e.type).find(".origin-sentence-section").attr("aria-expanded","show"==e.type),"show"==e.type&&"false"!=e.target.dataset.scroll&&t[0].scrollIntoView(),e.target.dataset.scroll="true")}).on("click",".js-tts-play-all, .js-tts-play-sentence",function(e){e.stopPropagation();const n=this;if("on"==n.dataset.playing)O();else if(O(n),n.dataset.playing="on",n.textContent="stop_circle",n.matches(".js-tts-play-all")){const s=$(".full-text .sentence-link").get();let t;!function e(){t&&t.classList.remove("tts-playing","blink-2");if("off"==n.dataset.playing)return;0<s.length?setTimeout(()=>{(t=s.shift()).classList.add("tts-playing","blink-2"),T.speak(t.textContent,e)},0):(n.dataset.playing="off",n.textContent="play_circle")}()}else{let e=$(n).closest(".origin-sentence").find(".sentence-text:visible")[0]||h.slides[h.activeIndex]?.querySelector(".sentence-text");e&&(e.classList.add("tts-playing"),T.speakRepeat(e.textContent,2,500,()=>{e.classList.remove("tts-playing"),n.dataset.playing="off",n.textContent="play_circle"}))}}).on("click",".js-tts-setting",function(e){e.stopPropagation(),O(),T.openSettings()}),$(document).on("shown.bs.collapse",".one-sentence-unit-section>.collapse",function(e){if(e.target.matches(".removable-section")&&e.target==e.currentTarget){var t=$(this).closest(".one-sentence-unit-section"),n=t.data("sentenceId");$(e.target).find(".semantics-result").filter(":visible").each(function(){tandem.correctMarkLine(this)}),t.data("metaEvaluated")||$(e.target).find(".dashboard-section").collapse("show");const o=t.find(".sentence-ext-section .note-section");o.is(".loading,.loaded")||(o.addClass("loading"),o.find(".empty-list").show(),$.getJSON(`/workbook/sentence/note/list/${I}/${n}/`+C,e=>{var n=e,s=(0<n.length&&o.find(".empty-list").hide(),o.find(".note-list").empty());for(let e=0,t=n.length;e<t;e++)v(n[e]).appendTo(s);o.toggleClass("loading loaded")}).fail(()=>alertModal("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}}).on("shown.bs.collapse",".svoc-section",function(){tandem.correctMarkLine(this.querySelector(".semantics-result"))}),$(document).on("show.bs.collapse",".dashboard-section",function(){$(this).prev(".result-semantic-section").addClass("border-bottom-0"),$(this).find(".tip-content-section").hide(0,function(){var e=$(this).closest(".one-sentence-unit-section").find(".origin-sentence .sentence-text").text();$(this).html(tandem?.tip?.showRandomTip(e.match(/['"]/)?5:void 0)).fadeIn()})}).on("shown.bs.collapse",".dashboard-section",function(){devSize.isPhone()&&scrollTo(scrollX,$(this).offset().top-visualViewport.height/2+this.offsetHeight/2)}).on("hidden.bs.collapse",".dashboard-section",function(){$(this).prev(".result-semantic-section").removeClass("border-bottom-0")}),$(document).on("click","div:not(.edit-svoc)>.semantics-result,.js-collapse-svoc",function(){var e=$(this).closest(".one-sentence-unit-section");e.find(".result-semantic-section .collapse").collapse("toggle"),e.find(".js-collapse-svoc").toggleClass("expanded")});const m={S:"<b>평가를 하는 이유</b><br><br>A.I.는 인간의 언어를 이해하면서 분석하지 않습니다.<br>학습자들에게 도움이 될 수 있도록 분석 결과를 평가해주세요.<br>평가도 하고 다양한 fico Egg도 모아보세요.",F:"<b>AI 분석이 정확하지 않은가요?</b><br><br>그건 회원님이 AI보다 실력이 좋다는 증거입니다.<br>직접 수정할 수도 있고 그냥 내버려 둘 수도 있습니다.<br>실력 발휘 기대합니다."};if($("#check-modal").on("show.bs.modal",function(e){var e=e.relatedTarget,t=this.querySelector(".status-submit"),n=e.dataset.metaStatus;t.dataset.metaStatus=n,this.querySelector(".modal-body").innerHTML=m[n],$(t).data("sentenceSection",$(e.closest(".one-sentence-unit-section")))}),$(document).on("click",".js-set-worthless",function(){const e=$(this).closest(".js-finger-detail").data("sentenceId");confirmModal('<div class="text-start row"><span class="col-12 text-center">완전한 문장의 구성으로 충족되지 않습니다.<br>다음과 같은 경우에 해당합니다.</span><div class="mx-auto w-auto d-block"><br>\t• 오타가 포함된 문장<br>\t• 불완전하게 잘린 문장<br>\t• 문장구성이 안되는 문장<br>\t• 불완전한 인용구, 구두점오류가 있는 문장<br>\t• 기타 비문장</div></div>',()=>{$.ajax({url:"/sentence/useful/edit",type:"POST",data:JSON.stringify({sentenceId:e,useful:!1}),contentType:"application/json",success:()=>{this.classList.remove("js-set-worthless","text-danger"),this.classList.add("text-secondary"),this.title="유용하지 않은 문장입니다.",this.style.pointerEvent="none",alertModal("useful값을 false로 수정했습니다.")},error:()=>{alertModal("useful 정보 수정에 실패했습니다.")}})})}).on("click",".js-finger-detail",async function(e){if(!e.target.closest(".edit-svoc,.svoc-mdf-btns")&&e.target.closest(".js-finger-detail")){const n=$(this),s=n.find(".toggle-eye");e=n.data("sentenceId");s.is(".loading")||(s.is(".loaded")?(n.toggleClass("bg-gray-700").find(".fold-icon").toggleClass("expanded",!s.is(".active")),s.toggleClass("active disabled"),n.find(".sentence-text, .trans-block, .svoc-section").toggle(300)):(s.addClass("loading"),await $.getJSON("/workbook/sentence/finger/"+e,e=>async function(e){n.find(".sentence-text").hide();var t=$(await tandem.showSemanticAnalysis(e.eng,e.svocBytes,n.find(".svoc-section").show().find(".svoc-block")));e.svocId&&t.data("svocId",e.svocId);n.removeClass("bg-gray-700").find(".trans-block").text(e.kor).show(),n.find(".fold-icon").addClass("expanded"),s.toggleClass("disabled active loading loaded")}(e)).fail(()=>alertModal("해석·분석 가져오기에 실패했습니다.\n다시 접속해 주세요."))))}}).on("show.bs.collapse",".craft-section",function(){var e=$(this).closest(".one-sentence-unit-section"),t=(e.find(".dashboard-section").collapse("hide"),Array.from(e.find(".ai-translation-section").eq(0).find(".ai-translation-block"),e=>({id:$(e).data("korTid"),text:e.querySelector(".translation-text").textContent})));null==this.querySelector(".battle-section-panel")&&craft.openBattleMakerPanel(this,C,S,e.data("sentenceId"),e.find(".semantics-result")[0],t)}),["A","S"].includes(S)){const b=".one-word-unit-section",w={el:"span",role:"button",class:"js-del-word fas fa-trash-alt",dataset:{bsToggle:"tooltip",bsTitle:"삭제"}};$(document).on("mouseover",b,function(){var e,t;0<$(this).find(".js-del-word").length||(e=createElement(w),t=$(this).find(".title"),$(e).insertAfter(t))}).on("mouseleave",b,function(){$(this).find(".js-del-word").remove()}).on("click",".js-del-word",function(e){e.stopPropagation();const t=$(this).closest(b),n=t.data()["sentenceWordId"];e=t.find(".title").text().trim();confirmModal(`이 문장에서 단어 ${e}을(를) 삭제하시겠습니까?`,()=>{$.ajax({url:"/workbook/sentence/word/del",type:"POST",contentType:"application/json",data:JSON.stringify(n),success:()=>{alertModal("단어가 삭제되었습니다.",()=>{var e=t.closest(".word-list-section");e.toggleClass("has-user-vocas",e.find(".part").get().some(e=>/[A-Z]|phrasal-v/.test(e.textContent))),t.slideUp(()=>t.remove())})},error:e=>{alertModal(e.responseText)}})})})}function v(e){var t,n=$(q).children(`.note-block.${e?.hasOwnProperty("sentenceId")?"sentence":"passage"}-note`).clone(!0)[0];return devSize.isPhone()&&n.querySelector(".note").classList.add("overflow-hidden"),n.dataset.noteId=e.noteId,n.querySelector(".note-text").innerHTML=e.content,n.querySelector(".updatedate").textContent=new Date(e.updateDate||new Date).toLocaleDateString(),C!=e?.memberInfo?.memberId?n.querySelector(".note-mdf-btns").remove():((t=$(n).find(".note-editor .note-open-input")).val((e.noteAccess??e.publicOpen).toString()),t.trigger("input")),n.querySelector(".personacon-section .alias").textContent=e?.memberInfo?.alias,$(n)}}