async function pageinit(r,t,c){const o=document.querySelector("#sentenceListDiv tbody"),l=document.querySelector("#sentencePagination"),d=($.fn.autocomplete||(document.head.append(createElement({el:"link",rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.css"})),await $.ajax({url:"https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.13.1/jquery-ui.min.js",dataType:"script",cache:!0})),await $.get("https://static.findsvoc.com/data/workbook/element_templates.min.html",jQuery.noop,"html"));let s={},i={};$(document).on("show.bs.collapse hide.bs.collapse","#searchSentenceDiv",function(e){$('.searchIcon[data-bs-target="#searchSentenceDiv"]').toggleClass("fa-search-minus fa-search-plus")}).on("change","#searchTypeSelect",function(){const n=$(".search-input-section."+this.value);var e=!/metaStatus/.test(this.value);switch($("#searchBtn").toggle(e),$("#refreshBtn").toggle(!e),this.value){case"eng":n.find("input").autocomplete("instance")||n.find("input").autocomplete({minLength:2,delay:50,source:function(e,t){const a=e.term&&e.term.trim();a in s?t(s[a]):$.getJSON("/sentence/search",{eng:a},function(e){s[a]=Array.from(e,e=>e.eng).sort(),t(s[a])}).fail(()=>{s[a]=[],t([])})},select:function(e,t){e.target.value=t.item.value,$("#searchSentenceForm").submit()}});break;case"writer":n.find("input").autocomplete("instance")||n.find("input").autocomplete({minLength:1,delay:50,source:function(e,t){const a=e.term&&e.term.trim();a in i?t(i[a]):$.getJSON("/sentence/alias/search/"+a,function(e){i[a]=e.sort(),t(e)}).fail(()=>{i[a]=[],t([])})},select:function(e,t){var[,t,a]=t.item.value.match(/(.+) : (\d+)$/);n.find(".selected-writer").attr("data-mid",a).text(t),$(this).val("").next("span").show(),$("#searchSentenceForm").submit()}})}$(".search-input-section."+this.value).show().siblings(".search-input-section").hide()}).on("change",".search-input-section select",function(){$("#searchSentenceForm").submit()}).on("submit","#searchSentenceForm",function(e){var t=Object.fromEntries(new FormData(this).entries()),a=(e?.originalEvent?.submitter?.matches("#refreshBtn")||(t.page=1),e.preventDefault(),$(this).find(".search-input-section."+t.searchType));switch(t.searchType){case"metaStatus":t.keyword=a.find("select").val();break;case"senlength":case"searchCount":case"fscore":t.keyword=Array.from(a.find("input").get(),e=>e.value).join("~");break;case"regDate":t.fromDate=a.find("input:eq(0)").val(),t.toDate=a.find("input:eq(1)").val();break;case"writer":t.keyword=a.find(".selected-writer").attr("data-mid");break;default:t.keyword=a.find("input").val()?.trim()}$.getJSON(this.action,t,e=>n(e,"searchSentenceForm")).fail(()=>alertModal("센텐스 검색 오류 발생"))}),$("#searchTypeSelect").trigger("change"),$(document).on("click",".thlink[data-value]",function(){var e=this.dataset.value,t=o.dataset.searchForm,a=$(`#${t} #sortName`),n=$(`#${t} #asc`);e==a.val()?n.val("true"!=n.val()):a.val(this.dataset.value),$("#"+t).submit()}),$(document).on("click",".page-link",function(){var e=l.dataset.searchForm;$(`#${e} #page`).val(parseInt(this.dataset.pagenum)),$("#"+e).submit()}),$("#pageForm").on("submit",function(e){e.preventDefault(),$.ajax({url:"/adminxyz/sentence/page",data:$(this).serialize(),success:function(e){n(e,"pageForm")},error:function(){aler("센텐스 목록 조회에 실패했습니다.")}})}),$(document).on("click",".js-open-detail",function(){const n=this.dataset.sentenceId,o=this.textContent,c=this.closest("tr");var e=$("#sentenceDetailSection");function t(e){const t=$("#sentenceDetailSection");if(t[0].dataset.sentenceId=n,e.svocList?.length){const a=e.svocList[0];a.memberId!=r&&t.find(".js-del-svoc").hide(),tandem.showSemanticAnalysis(o,a.svocBytes,t.find(".svoc-block").empty()).then(e=>{$(e).data("svocId",a.svocId).data("memberId",a.memberId),t.find(".writer-section .personacon-alias").text(a.writerAlias),a.image?t.find(".writer-section .personacon-profile").removeClass("profile-default")[0].style.background=`url(/resource/profile/images/${a.image}) center/cover no-repeat`:t.find(".writer-section .personacon-profile").addClass("profile-default")[0].style.background="var(--fc-logo-head) center/cover no-repeat"})}t.find(".kor-info").empty().append(createElement(Array.from(e.korList,e=>({el:"div",textContent:e.kor})))),t.find(".gram-info :text").val(e.gramMeta),t.find('.useful-info :radio[name="useful"]').filter(function(){this.value==$(c).find(".data-useful")[0].dataset.useful&&(this.checked=!0)});const s=t.find("#nav-wordlist").empty(),i=$(d).find(".one-word-unit-section");e.wordList?.length||s.append(i.find(".empty-list").clone()),e.wordList?.forEach((e,t)=>{const a=i.clone(!1).empty();var n=i.find(".title").clone(!0).text(e.title);a.append(n),e?.senseList?.forEach(e=>{var t=i.find(".one-part-unit-section").clone(!0);t.find(".part").text(e.partType),t.find(".meaning").text(e.meaning),a.append(t)}),s.append(a)}),bootstrap?.Tab?.getOrCreateInstance(t.find("#nav-wordlist-tab")[0])?.show()}e.is(".show")&&e.is($(c).next())?e.collapse("hide"):($(c).addClass("active").siblings("tr").removeClass("active"),e.is(".show")&&e[0].scrollIntoView({behavior:"instant",block:"nearest"}),$(c).after(e.collapse("show")),$("#editSentence").prop("disabled",!0),e.find(".tab-pane").removeClass("loading loaded"),$(this).data("sentenceInfo")?t($(this).data("sentenceInfo")):$.getJSON("/adminxyz/sentence/svoc/search/"+n,e=>{t(Object.assign(e,{gramMeta:$(c).find(".data-grammeta")[0].dataset.gramMeta})),$(this).data("sentenceInfo",e)}).fail(()=>alert("해설 상세정보를 조회하지 못했습니다.")))}).on("show.bs.tab","#sentenceDetailSection .nav-link",function(e){const o=$(this.dataset.bsTarget);if(!o.is(".loaded,.loading")){o.addClass("loading");var t=$("#sentenceDetailSection")[0].dataset.sentenceId;switch(o[0].id.match(/nav-(\w+)/)[1]){case"wordlist":o.addClass("loaded").removeClass("loading");break;case"indexfinger":o.empty().append($(d).find(".loading-icon").clone(!0)),$.getJSON("/workbook/search/finger/"+ntoa(t),t=>{var a=$(d).find(".related-list");if(null!=t&&0<t.length){var n=t.length;for(let e=0;e<n;e++){var s=t[e],i=a.find(".finger-section").clone(!0);o.append(i),i.data("sentenceId",s.sentenceId).find(".sentence-text").text(s.eng)}}else o.append(a.find(".empty-list").clone(!0));o.removeClass("loading").addClass("loaded").find(".loading-icon").remove()}).fail(()=>{o.removeClass("loading").addClass("loaded").find(".loading-icon").remove(),alertModal("인덱스 핑거 조회에 실패했습니다.")});break;case"sentencenote":workbookId}}}).on("shown.bs.collapse","#sentenceDetailSection",function(){window.scrollTo(0,document.getElementById("sentenceDetailSection").offsetTop)}).on("click",".js-finger-detail",async function(e){if(!e.target.closest(".edit-svoc,.svoc-mdf-btns")&&e.target.closest(".js-finger-detail")){const t=$(this),a=t.find(".toggle-eye");e=t.data("sentenceId");a.is(".loading")||(a.is(".loaded")?(t.toggleClass("bg-gray-700").find(".fold-icon").toggleClass("expanded",!a.is(".active")),a.toggleClass("active disabled"),t.find(".sentence-text, .trans-block, .svoc-section").toggle(300)):(a.addClass("loading"),await $.getJSON("/workbook/sentence/finger/"+e,e=>async function(e){t.find(".sentence-text").hide(),await tandem.showSemanticAnalysis(e.eng,e.svocBytes,t.find(".svoc-section").show().find(".svoc-block")),t.removeClass("bg-gray-700").find(".trans-block").text(e.kor).show(),t.find(".fold-icon").addClass("expanded"),a.toggleClass("disabled active loading loaded")}(e)).fail(()=>alertModal("해석·분석 가져오기에 실패했습니다.\n다시 접속해 주세요."))))}}).on("click",".js-edit-svoc",async function(){const a=this.closest(".js-finger-detail")?"indexFinger":"searchResult",n=parseInt($(this).closest(".js-finger-detail").data("sentenceId")||$(".one-sentence-row.active").find(".js-open-detail")[0].dataset.sentenceId),s=$(this).closest(".svoc-section").find(".semantics-result");function i(e){s.data("svocId",e),r&&s.data("memberId",r),"searchResult"==a&&(t&&$("#sentenceDetailSection .writer-section .alias").text(t),$("#sentenceDetailSection .writer-section .personacon-profile").toggleClass("profile-default",!c).css("backgroundImage",`${c?"url(/resource/profile/images/"+c+")":"var(--fc-logo-head)"} center/cover no-repeat`)),s.closest(".svoc-section").find(".svoc-mdf-btns").show()}function o(){s.closest(".svoc-section").find(".svoc-mdf-btns").show()}$(this).closest(".svoc-mdf-btns").hide(),s.svoceditor(!1,function(e){var t=parseInt(s.data("svocId")||0),e={sentenceId:n,memberId:r,encSvocText:e};r==parseInt(s.data("memberId"))&&0<t&&(e.svocId=t);$.ajax({url:"/adminxyz/sentence/svoc/edit",type:"POST",data:JSON.stringify(e),contentType:"application/json",success:i,error:o});t=window.tandem?.meta?.saveGramMetaFromDOM(n,s[0],!0,"adminxyz");"searchResult"==a&&$("#sentenceDetailSection .gram-info :text").val(t)},o),setTimeout(()=>{tandem.correctMarkLine(s[0])},500)}),$("#editGramMeta").on("click",function(){const e=$(".one-sentence-row.active").find(".data-grammeta")[0],t=$(".one-sentence-row.active").find(".data-metastatus")[0],a=$(this).closest(".gram-info").find("input").val();var n=parseInt($(this).closest("tr")[0].dataset.sentenceId);$.ajax({url:"/adminxyz/sentence/grammeta/edit",type:"POST",data:JSON.stringify({sentenceId:n,gramMeta:a,metaStatus:"S"}),contentType:"application/json",success:()=>{e.dataset.gramMeta=a,t.textContent=m.S,alertModal("GramMeta 정보를 수정했습니다.")},error:()=>alertModal("GramMeta 정보 수정에 실패했습니다.")})}),$("#editUseful").on("click",function(){const e=$(".one-sentence-row.active").find(".data-useful")[0],t="true"==$(':radio[name="useful"]:checked').val();var a=parseInt($(this).closest("tr")[0].dataset.sentenceId);$.ajax({url:"/adminxyz/sentence/useful/edit",type:"POST",data:JSON.stringify({sentenceId:a,useful:t}),contentType:"application/json",success:()=>{e.dataset.useful=t,alertModal("useful 정보를 수정했습니다.")},error:()=>alertModal("useful 정보 수정에 실패했습니다.")})});const m={N:"Not",U:"Upd",S:"Suc",F:"Fail"};function n(d,e){$("#sentenceDetailContainer").append($("#sentenceDetailSection")),$("#sentenceListDiv .sortMark").hide();var t=$(`#${e} #sortName`).val(),t=$(`.thlink[data-value="${t}"]+.sortMark`),t=(0<t.length&&t.html("false"==$(`#${e} #asc`).val()?"▼":"▲").show(),d?.totalPages),a=d?.number+1,n=10*(Math.floor((a-1)/10)+1-1)+1,s=10+n<=t?10+n-1:t,i=(o.dataset.searchForm=e,o.replaceChildren(createElement(Array.from(d.content,({eng:e,senlength:t,sentenceId:a,gramMeta:n,searchCount:s,metaStatus:i,useful:o,fscore:c,regDate:r},l)=>({el:"tr",class:"one-sentence-row",children:[{el:"td",className:"data-rnum",textContent:d?.totalElements-d?.number*d?.size-l},{el:"td",className:"data-sid text-center",textContent:a},{el:"td",className:"data-englength text-center",textContent:t||0},{el:"td",className:"data-eng text-start js-open-detail ps-3 text-truncate",role:"button","data-sentence-id":a,textContent:e},{el:"td",className:"data-grammeta text-center","data-gram-meta":n,style:{display:"none"}},{el:"td",className:"data-useful text-center","data-useful":o,style:{display:"none"}},{el:"td",className:"data-searchcount text-center",textContent:s||0},{el:"td",className:"data-fscore ",textContent:c||0},{el:"td",className:"data-metastatus ",textContent:m[i]},{el:"td",className:"data-regdate text-center",textContent:new Date(r).format("yyyy-MM-dd")}]})))),[]);10<n&&i.push({el:"li",className:"page-item","aria-label":"Previous",children:[{el:"a",className:"page-link","aria-hidden":!0,"data-pagenum":n-1,innerHTML:"&laquo;"}]});for(let e=n;e<=s;e++)i.push({el:"li",className:"page-item"+(e==a?" active":""),children:[{el:"a",className:"page-link","data-pagenum":e,textContent:e}]});s<t&&i.push({el:"li",className:"page-item","aria-label":"Next",children:[{el:"a",className:"page-link","aria-hidden":!0,"data-pagenum":s+1,innerHTML:"&raquo;"}]}),l.dataset.searchForm=e,l.replaceChildren(createElement(i))}}