function pageinit(){$("#workbookListDiv .sortMark").hide();var t,e=$('.thlink[data-value="'+$("#searchFormHidden_list #sortName").val()+'"]+.sortMark');0<e.length&&(t=$("#searchFormHidden_list #asc"),e.html("false"==t.val()?"▼":"▲").show()),$(".thlink[data-value]").click(function(){var t=this.dataset.value,e=$("#searchFormHidden_list #sortName"),a=$("#searchFormHidden_list #asc");t==e.val()?a.val("true"==a.val()?"false":"true"):e.val(this.dataset.value),$("#pageForm").submit()}),$(".page-link").click(function(){$("#searchFormHidden_list #page").val(parseInt(this.dataset.pagenum)),$("#pageForm").submit()}),$(document).on("click",".js-open-detail",function(){let e=this.closest("tr"),n=$("#templateDetailSection"),o=e.dataset;n.is(":visible")&&n.is($(e).next())?n.hide(()=>$("#templateDetailContainer").append(n)):($(e).addClass("active").siblings("tr").removeClass("active"),$.getJSON("/adminxyz/workbook/template/passages/"+o.wid,t=>{t.sort((t,e)=>t.orderNum-e.orderNum),n.is(":visible")&&n[0].scrollIntoView({behavior:"instant",block:"nearest"}),n.show(()=>{$(e).after(n),async function(a){n.find('.template-status-info [name="status"][value="'+$(e).find(".template-status-data")[0].dataset.type+'"]').prop("checked",!0),n.find(".template-title-info").text($(e).find(".template-title-data").text()),n.find(".template-wid-info").text(o.wid);var i=n.find(".list-passage-section").empty();for(let t=0,e=a?.length;t<e;t++){var s=$("#hiddenDivs .passage").clone(),l=a[t];s.attr("data-pid",l.passageId).attr("data-order-num",l.orderNum),s.find(".passage-title").text(l.title||"제목 없음").attr("title",l.title||"제목 없음"),s.find(".passage-title-section .title-input").val(l.title),i.append(s)}Masonry.data(i[0])&&i.masonry("destroy");i.masonry({itemSelector:".passage",columnWidth:".passage",gutter:10,percentPosition:!0,horizontalOrder:!0,transitionDuration:"0.8s"})}(t)})}).fail(()=>alertModal("지문 목록 조회 실패")))}),$("#changeBookType").on("click",function(){let t=$('input[name="status"]:checked').val();var e=parseInt($("#templateDetailSection .template-wid-info").text());$.ajax({url:"/workbook/mybook/edit/type",type:"POST",data:JSON.stringify({workBookId:e,workBookType:t}),contentType:"application/json",success:()=>{alertModal("템플릿 상태가 변경되었습니다."),$("tr.active .template-status-data").attr("data-type",t).text("e"==t?"작성중":"다운로드 가능")},error:()=>{alertModal("템플릿 상태 변경에 실패했습니다."),$('input[name="status"]').filter(t=>t.value==$("tr.active .template-status-data").attr("data-type")).prop("checked",!0)}})}),$("#addPassageTitles").on("click",function(){var t=parseInt($("#templateDetailSection .template-wid-info").text().trim()),e=$("#templateDetailSection .template-title-info").text().trim();location.assign(`/adminxyz/template/passagetitle/batch/${ntoa(t)}?wtitle=`+e)}),$(document).on("click",".passage-title",function(){$(this).hide().siblings(".title-input,.title-edit-btn-section").show().closest(".passage-title-section").addClass("edit")}).on("click",".js-edit-ptitle",function(){let t=this.closest(".passage-title-section"),e=$(t).find(".title-input").val().trim();var a={passageId:this.closest(".passage").dataset.pid};0<e.length&&(a.passageTitle=e),editPassageTitle(a,()=>{alertModal("지문 제목이 수정되었습니다."),$(t).removeClass("edit"),$(t).find(".passage-title").text(e||"제목 없음").attr("title",e||"제목 없음").show(),$(t).find(".title-input,.title-edit-btn-section").hide()},()=>alertModal("지문 제목 수정 중 오류가 발생했습니다."))}).on("click",".js-cancel-ptitle",function(){var t=this.closest(".passage-title-section"),e=$(t).find(".passage-title").show();$(t).removeClass("edit"),$(t).find(".title-input").val(e.text()).hide(),$(t).find(".title-edit-btn-section").hide()}),$(document).on("click",".js-del-passage",function(){let t=$(this.closest(".passage"));var e=t.data("pid");let a=t.closest(".list-passage-section");confirm("이 지문을 삭제하시겠습니까?")&&(e={workbookId:parseInt($("#templateDetailSection .template-wid-info").text()),passageId:e},deletePassage(e,function(){alertModal("지문이 삭제되었습니다."),a.masonry("remove",t).masonry("layout")}))})}