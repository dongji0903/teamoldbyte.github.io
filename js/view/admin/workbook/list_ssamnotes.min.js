function pageinit(q,d,c){const y={el:"div",className:"svoc-section row position-relative",children:[{el:"div",className:"svoc-block col my-auto"},{el:"div",className:"svoc-mdf-btns btn-group px-2",children:[{el:"button","data-seq":"",className:"js-edit-svoc login-required btn text-bluegray-300 p-0 pe-1","data-toggle":"tooltip",title:"분석 수정",children:[{el:"span",className:"fas fa-marker"}]},{el:"button","data-seq":"",className:"js-del-svoc login-required btn text-bluegray-300 p-0 ps-1","data-toggle":"tooltip",title:"분석 삭제",children:[{el:"span",className:"fas fa-trash-alt"}]}]},{el:"div",className:"writer-section col-12 col-md-1 mt-2 mt-xl-0 btn","data-bs-toggle":"collapse",children:[{el:"div",className:"personacon-alias alias text-truncate"}]}]},n={el:"div",className:"note-block one-block row g-0",children:[{el:"div",className:"note text-section",children:[{el:"div",className:"note-text",textContent:"노트 본문"},{el:"div",className:"note-editor",style:"display: none;",children:[{el:"textarea",className:"text-input col-12"},{el:"div",className:"form-check form-switch d-inline-block mx-1",children:[{el:"label",className:"form-check-label text-sm",role:"button",children:[{el:"input",type:"checkbox",className:"open-input form-check-input",checked:!1},"회원들과 노트를 공유합니다."]}]},{el:"button",type:"button",className:"btn p-0","data-bs-toggle":"modal","data-bs-target":"#note-modal",children:[{el:"span",className:"material-icons-outlined fs-6",textContent:"help_outline"}]},{el:"div",className:"note-edit-btns btn-group btn-set float-end mt-0 mt-sm-2",children:[{el:"button",type:"button",className:"js-edit-note-cancel btn btn-sm btn-outline-fico",textContent:"취소"},{el:"button",type:"button",className:"js-edit-note btn btn-sm btn-fico",textContent:"확인"}]}]}]},{el:"div",className:"col-12 personacon-section text-end mt-1 text-secondary fst-italic",children:["written by ",{el:"div",className:"personacon-alias alias d-inline fst-normal"}]},{el:"div",className:"col-auto ms-auto row mh-2rem",children:[{el:"div",className:"col-auto ms-auto me-1 note-mdf-btns btn-group",children:[{el:"button",type:"button",className:"js-edit-note-open login-required btn border-color-bluegray border-2 border-end-0 rounded-start py-0 pe-0 text-bluegray-300","data-toggle":"tooltip",title:"노트 수정",children:[{el:"span",className:"far fa-file-alt"},{el:"span",className:"fas fa-pen fa-xs",style:{left:"-8px",top:"5px",position:"relative"}}]},{el:"button",type:"button",className:"js-delete-note login-required btn border-color-bluegray border-2 rounded-end py-0 fas fa-trash-alt text-bluegray-300","data-toggle":"tooltip",title:"노트 삭제"}]},{el:"div",className:"updatedate col-auto ms-auto p-0 mt-1 text-secondary text-xs"}]}]},I={el:"div",className:"trans-mdf-btns",children:[{el:"button",type:"button",className:"js-edit-trans-open login-required btn btn-sm py-0 pe-0 pt-0","data-toggle":"tooltip",title:"해석 수정",children:[{el:"span",className:"material-icons fs-5",textContent:"edit"}]},{el:"button",type:"button",className:"js-del-trans login-required btn btn-sm py-0","data-toggle":"tooltip",title:"해석 삭제",children:[{el:"span",className:"material-icons fs-5",textContent:"delete"}]}]};const N=$(".ai-translation-block"),S=$(".one-word-unit-section"),C=$(".one-part-unit-section");let l;$(document).on("click",".js-open-detail",function(){var t=this.dataset.sid;l=this.closest("tr"),$(l).addClass("bg-info").siblings("tr").removeClass("bg-info");const s=$(".one-sentence-unit-section");s.find(".s-id").text(t),s.addClass("loading"),$.getJSON("/adminxyz/workbook/sentence/"+t,t=>{!async function(o,i){i.data("sentenceId",o.sentenceId).attr("id","sentence0");const t=new Date(o.regDate),e=(i.find(".s-regdate").text(t.format("yyyy-MM-dd HH:mm")),i.find(".origin-sentence-section").get(0)),a=(e.dataset.bsTarget="#sentence0>.collapse",e.dataset.bsToggle="collapse",i.find(".origin-sentence .sentence-text").text(o.text),i.find(".origin-sentence .sentence-text").text()),d=o.svocList,c=d?.length;i.find(".js-collapse-svoc").toggle(1<c),i.find(".result-semantic-section").empty();for(let s=0;s<c;s++){let n=d[s];const x=$(createElement(y));0<s&&x.addClass("collapse"),x.appendTo(i.find(".result-semantic-section")),tandem.showSemanticAnalysis(a,n.svocBytes,x.find(".svoc-block")).then(t=>{$(t).data("svocId",n.svocId).data("memberId",n.memberId),x.find(".writer-section").attr("data-bs-target",`#${i.attr("id")} .dashboard-section`).find(".personacon-alias").text(n.writerAlias);var e=x.find(".svoc-mdf-btns"),e=(e.find("[data-seq]").attr("data-seq",t.dataset.seq),q!=n.memberId&&e.remove(),$("#hiddenDivs .member-personacon:eq(0)").clone(!0));n.image&&(e.find(".personacon-profile").removeClass("profile-default")[0].style.background="url(/resource/profile/images/"+n.image+") center/cover no-repeat"),x.find(".writer-section").prepend(e),null!=window.tandem&&null!=tandem.meta&&s+1==c&&null!=o.metaStatus&&"N"==o.metaStatus&&tandem.meta.saveGramMetaFromDOM(o.sentenceId,t,!1,"workbook")})}i.find(".dashboard-section .meta-status").text({S:"🥳",F:"🤯"}[o.metaStatus]||"🤔").attr("title",{S:"평가를 받은 문장이예요.",F:"분석이 틀렸대요."}[o.metaStatus]||"아직 평가되지 않은 문장이예요.");var n=o.korList;if(null!=n&&0<n.length){var s=n.length,l=i.find(".ai-translation-section").show().empty();for(let t=0;t<s;t++){var r=N.clone(),u=n[t];l.append(r),r.data("korTid",u.korId),"Translator"!=u.alias&&r.find(".translator").text("by "+u.alias),r.find(".translation-text").text(u.kor),q==u.memberId&&r.append(createElement(I))}l.find(".ai-translation-block").first().collapse("show")}var f=o.wordList;if(null!=f&&0<f.length){var m=f.length,p=i.find(".word-section").empty();p.append('<div class="title-section position-relative"><span class="sub-title">문장에서 등장하는 단어를 fico가 대신 검색하여 제공해 드립니다.</span></div>');for(let t=0;t<m;t++){var b=f[t],h=S.clone(),v=(h.find(".one-part-unit-section").remove(),p.append(h),h.find(".title").text(b.title),b.senseList);if(null!=v){var g=v.length;for(let t=0;t<g;t++){var w=v[t],k=C.clone();h.append(k),k.find(".part").text(w.partType),k.find(".meaning").text(w.meaning)}}}576<window.visualViewport.width&&i.find('.nav-link[data-type="word-list"]').tab("show")}$("#ssamNoteRequestDetailSection").collapse("show").find(".one-sentence-unit-section>.collapse").collapse("show")}(t,s),s.removeClass("loading").addClass("loaded")}),$.getJSON("/adminxyz/workbook/info/"+t,t=>{var e=t,t=s,n=t.find(".workbook-overview-section");t.data("workbookId",e.workbookId),n.find(".wb-id").text(e.workbookId),n.find(".image-section img").on("click",()=>location.assign(`/workbook/passage/${ntoa(e.workbookId)}/`+ntoa(e.passageId))),e.imagePath&&n.find(".image-section img").css("backgroundImage",`url(/resource/workbook/cover/${e.imagePath})`),n.find(".text-section .wb-title").text(e.title),n.find(".text-section .reg-date").text(new Date(e.regDate).format("yyyy-MM-dd")),n.find(".description").text(e.description),n.find(".text-section .p-title").text(e.passageTitle),n.find(".text-section .p-id").text(e.passageId),n.find(".writer-section .personacon-alias").text(e.alias),n.find(".age").text((new Date).getFullYear()+1-new Date(e.birthYear).getFullYear()),e.aliasImage&&n.find(".personacon-profile").css("backgroundImage",`url(/resource/profile/images/${e.aliasImage})`)})}),$(".one-sentence-unit-section").find('[role="tab"]').each(function(){var t=this.dataset.type;this.dataset.bsTarget="#sentence0 ."+t+"-section";const e=new bootstrap.Tab(this),n=$(this),s=$(this.dataset.bsTarget);n.on("click",t=>{t.preventDefault(),n.is(".active")?s.collapse("hide"):e.show()}).one("shown.bs.tab",function(){s.find(".afterload").fadeIn(300)}).on("shown.bs.tab",function(){s.collapse("show")}).on("hidden.bs.tab",function(){s.removeClass("show")}),s.on("hidden.bs.collapse",function(t){t.target==s.get(0)&&(s.removeClass("active"),n.removeClass("active").attr("aria-selected",!1).blur())})}),$(document).on("shown.bs.collapse",".one-sentence-unit-section>.collapse",function(t){t.target.matches(".removable-section")&&t.target==t.currentTarget&&($(t.target).find(".semantics-result").filter(":visible").each(function(){tandem.correctMarkLine(this)}),$(t.target).find(".dashboard-section").show(0).trigger("show.bs.collapse"))}).on("show.bs.collapse",".dashboard-section",function(){$(this).prev(".result-semantic-section").addClass("border-bottom-0")}).on("hidden.bs.collapse",".dashboard-section",function(){$(this).prev(".result-semantic-section").removeClass("border-bottom-0")});const s={S:"<b>평가를 하는 이유</b><br><br>A.I.는 인간의 언어를 이해하면서 분석하지 않습니다.<br>학습자들에게 도움이 될 수 있도록 분석 결과를 평가해주세요.<br>평가도 하고 다양한 fico Egg도 모아보세요.",F:"<b>AI 분석이 정확하지 않은가요?</b><br><br>그건 회원님이 AI보다 실력이 좋다는 증거입니다.<br>직접 수정할 수도 있고 그냥 내버려 둘 수도 있습니다.<br>실력 발휘 기대합니다."},r={S:{icon:"🥳",status:"S",tooltip:"평가를 받은 문장이예요."},F:{icon:"🤯",status:"F",tooltip:"분석이 틀렸대요."}};function u(e,n){let s=!1;e.closest(".dashboard-section").find(".edit-meta-status-btn[data-meta-status]").each(function(){var t;this.disabled||(t=$(this).prop("disabled",!0).wrap('<span data-bs-original-title="이미 평가한 문장입니다."></span>').parent()[0],new bootstrap.Tooltip(t,{trigger:"hover focus"}).enable(),t.querySelector(".material-icons").className="material-icons text-gray-400")});const t=e.next();t.popover("show"),setTimeout(()=>t.popover("dispose"),3e3),anime({targets:e[0],rotateX:360,scale:[{value:3,duration:500,easing:"easeOutBack"},{value:1,duration:2500,easing:"easeInBounce"}],delay:300,duration:3e3,update:function(t){!s&&20<t.progress&&(e.text(n.icon).attr("data-bs-original-title",n.tooltip),s=!0)},complete:function(){e[0].style.transform=""}})}$("#check-modal").on("show.bs.modal",function(t){var t=t.relatedTarget.closest("button"),e=this.querySelector(".status-submit"),n=t.dataset.metaStatus;e.dataset.metaStatus=n,this.querySelector(".modal-body").innerHTML=s[n],$(e).data("sentenceSection",$(t.closest(".one-sentence-unit-section")))}),$("#check-modal .status-submit").on("click",function(){var t=$(this).data("sentenceSection");const e=this.dataset.metaStatus,n=t.find(".dashboard-section .meta-status");tandem?.meta?.submitMetaStatus(t.data("sentenceId"),e,"workbook",()=>{u(n,r[e])}),$("#check-modal").modal("hide")}),$(document).on("click",".open-kor-btn,.ai-translation-section",function(){var t=$(this).closest(".translation-section"),e=t.find(".ai-translation-block:not(:first)"),t=t.find(".open-kor-btn");e.collapse(t.is(".active")?"hide":"show"),t.find(".fold-icon").toggleClass("expanded",!t.is(".active")),t.toggleClass("active")}),$(".js-collapse-svoc").click(function(){$(this).closest(".one-sentence-unit-section").find(".result-semantic-section .collapse").collapse("toggle"),$(this).toggleClass("expanded")}),$(document).on("click",".js-add-svoc, .js-edit-svoc",async function(){let e=$(this).is(".js-add-svoc");$(".js-add-svoc").prop("disabled",!0);const n=$(this).closest(".one-sentence-unit-section");let o=null;var t,s,i;function a(t){e&&null!=t&&(o.closest(".new-svoc-form").removeClass("new-svoc-form"),o.data("svocId",t),n.find(".js-collapse-svoc").addClass("expanded").show(),o.closest(".svoc-section").nextAll(".svoc-section").collapse("show")),o.closest(".svoc-section").find(".svoc-mdf-btns").show()}e?((t=$(createElement(y)).addClass("new-svoc-form")).find(".personacon-alias").text(d),s=$("#hiddenDivs .member-personacon").clone(!0),c&&(s.find(".personacon-profile").removeClass("profile-default")[0].style.background="url(/resource/profile/images/"+c+") center/cover no-repeat"),t.find(".writer-section").prepend(s),s=n.find(".origin-sentence .sentence-text").text(),i=await tandem.getSvocBytes(n.find(".semantics-result").get(0)),n.find(".result-semantic-section").prepend(t),(o=$(await tandem.showSemanticAnalysis(s,i,t.find(".svoc-block")))).data("memberId",q),t.find(".svoc-mdf-btns").hide().find("[data-seq]").attr("data-seq",o.attr("data-seq"))):(o=$('.semantics-result[data-seq="'+this.dataset.seq+'"]'),$(this).closest(".svoc-mdf-btns").hide()),o.svoceditor(e,function(t){var e=parseInt(o.closest(".one-sentence-unit-section").data("sentenceId")),n=parseInt(l.dataset.ownerId),s=parseInt(o.data("svocId")||0),n={sentenceId:e,ownerId:n,memberId:q,encSvocText:t};q==Number(o.data("memberId"))&&0<s&&(n.svocId=s);editSvoc(n,a),window.tandem?.meta?.saveGramMetaFromDOM(e,o[0],!0,"workbook"),u(o.closest(".one-sentence-unit-section").find(".meta-status"),r.S)},function(){$(".js-add-svoc").prop("disabled",!1),e?o.closest(".new-svoc-form").remove():o.closest(".svoc-section").find(".svoc-mdf-btns").show()}),setTimeout(()=>{tandem.correctMarkLine(o[0])},500)}).on("click",".js-del-svoc",function(){const t=$('.semantics-result[data-seq="'+this.dataset.seq+'"]'),e=t.closest(".one-sentence-unit-section");var n=Number(t.data("svocId"));confirm("삭제하시겠습니까?")&&delSvoc(n,function(){t.closest(".svoc-section").fadeOut(()=>{t.closest(".svoc-section").remove(),e.find(".svoc-section").length<2&&e.find(".js-collapse-svoc").hide(),e.find(".svoc-section:first-child").removeClass("collapse show"),e.find(".svoc-section:not(:first-child)").addClass("collapse")})})});const e=$(createElement({el:"div",className:"trans-editor mt-2",children:[{el:"textarea",className:"text-input form-control"},{el:"div",className:"trans-edit-btns btn-group my-2",children:[{el:"button",type:"button",className:"js-edit-trans-cancel btn btn-sm btn-outline-fico",textContent:"취소"},{el:"button",type:"button",className:"js-edit-trans login-required btn btn-sm btn-fico",textContent:"확인"}]}]}));function a(t){var e=$(createElement(n));return e.data("noteId",t.noteId),e.find(".note.text-section").find(".note-text").html(t.content),e.find(".updatedate").text(new Date(t.updateDate||new Date).toLocaleDateString()),q!=t?.memberInfo?.memberId?e.find(".note-mdf-btns").remove():e.find(".note-editor .open-input").prop("checked",t.publicOpen).trigger("input"),e.find(".personacon-section").find(".alias").text(t?.memberInfo?.alias),e}$(document).on("click",".js-edit-trans-open",function(){let t=$(this).closest(".ai-translation-block");0<t.length?(t.find(".trans-mdf-btns, .translation-text").hide(),e.find(".text-input").val(t.find(".translation-text").text())):(t=$(this).closest(".translation-section"),e.find(".text-input").val(null)),t.append(e)}).on("click",".js-edit-trans",function(){const n=$(this).closest(".ai-translation-block"),t=Number($(this).closest(".one-sentence-unit-section").data("sentenceId")),s=$(".trans-editor .text-input").val().trim(),o=$(this).closest(".translation-section");var e={sentenceId:t,memberId:q,kor:s};null!=n.data("korTid")&&(e.korTid=Number(n.data("korTid"))),0!=s.length&&editSentenceTrans(e,function(t){{var e;0<n.length?(n.find(".translation-text").text(s),n.find(".trans-mdf-btns, .translation-text").show()):((e=N.clone()).data("korTid",t).find(".translation-text").text(s),e.find(".translator").text("by "+d),e.append(createElement(I)),o.find(".ai-translation-section").prepend(e),e.addClass("show"),o.find(".open-kor-btn").is(".active")||e.siblings(".ai-translation-block").removeClass("show"))}$(".trans-editor").appendTo("#hiddenDivs")})}).on("click",".js-edit-trans-cancel",function(){var t=$(this).closest(".ai-translation-block");$(".trans-editor").appendTo("#hiddenDivs"),t.find(".trans-mdf-btns, .translation-text").show()}).on("click",".js-del-trans",function(){const t=$(this).closest(".ai-translation-block");confirm("삭제하겠습니까?")&&delSentenceTrans(Number(t.data("korTid")),function(){alert("삭제되었습니다."),t.next(".ai-translation-block")?.collapse("show"),t.remove()})}).on("show.bs.tab",".one-sentence-unit-section .nav-link[data-type=note]",async function(){const e=$(this);var t=$(this).closest(".one-sentence-unit-section"),n=t.data("workbookId"),t=t.data("sentenceId");const o=$(this.dataset.bsTarget);$(this).is(".loading,.loaded")||($(this).addClass("loading"),o.find(".empty-list").show(),await $.getJSON(`/workbook/sentence/note/list/${n}/${t}/`+q,t=>{var n=t,s=(0<n.length&&o.find(".empty-list").hide(),o.find(".note-list").empty());for(let t=0,e=n.length;t<e;t++)a(n[t]).appendTo(s);e.toggleClass("loading loaded")}).fail(()=>alert("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}).on("click",".js-add-sentence-note-btn",function(){const n=$(this).closest(".one-sentence-unit-section");var t=Number(n.data("sentenceId")),e=Number(n.data("workbookId"));const s=$(this).closest(".add-section");var o=s.find(".text-input").val().trim(),i=s.find(":checkbox").is(":checked");0!=o.length&&addSentenceNote({workbookId:e,sentenceId:t,memberId:q,content:o,publicOpen:i},function(t){t.memberInfo={memberId:q,alias:d};var e=n.find(".note-section>.note-list"),t=a(t);t.prependTo(e),s.find(".text-input").val("").summernote("destroy"),s.hide(300,function(){var t=s.closest(".note-section");t.find(".add-icon").prop("disabled",!1),t.find(".empty-list").hide()})})}).one("show.bs.tab",".one-sentence-unit-section .nav-link[data-type=qna]",function(){const e=$(this),o=e.closest(".one-sentence-unit-section");var t=o.data("sentenceId");const i=$(this.dataset.bsTarget),a=i.find(".qna-list");e.is(".loading")||(e.addClass("loading"),i.find(".empty-list").show(),$.getJSON(["/qnastack/question/workbook/sentence",workbookId,t].join("/"),t=>{var n=t;0<n.length&&i.find(".empty-list").hide();for(let t=0,e=n.length;t<e;t++){var s=m(n[t],!1);s.find(".accordion-collapse").attr("data-bs-parent","#"+o.attr("id")+" .qna-list"),a.append(s)}e.removeClass("loading")}).fail(()=>alert("질문 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}).on("submit",".sentence-qna-add-form",function(t){t.preventDefault();const n=$(this).closest(".add-section"),s=$(this).closest(".one-sentence-unit-section");t=n.find(".q-title").val().trim();const o=n.find(".text-input");var e=o.val().trim(),t={targetId:Number(s.data("sentenceId")),qtype:"S",workbookId:workbookId,passageId:passageId,questionerId:q,priorityId:priorityId,title:t,content:e};addQuestion("workbook",t,function(t){var e=s.find(".qna-section>.qna-list"),t=m(t,!0);t.find(".accordion-collapse").attr("data-bs-parent","#"+s.attr("id")+" .qna-list"),e.prepend(t),o.val(""),n.hide(300,function(){var t=n.closest(".qna-section");t.find(".add-icon").prop("disabled",!1),t.find(".empty-list").hide()})})}).on("click",".js-edit-note-open",async function(){var t=$(this).closest(".note-block"),e=t.find(".text-section"),t=(t.find(".note-mdf-btns").hide(),e.find(".note-text").hide()),t=e.find(".note-editor").show().find(".text-input").val(t.html());e.find(".open-input").trigger("input"),0==$(this).closest(".passage-comment-section").length&&openSummernote(t)}).on("click",".js-edit-note-cancel",function(){var t=$(this).closest(".text-section"),e=$(this).closest(".note-block");t.find(".note-editor, .note-text").add(e.find(".note-mdf-btns")).toggle()}).on("click",".js-edit-note",function(){const e=$(this).closest(".text-section"),n=$(this).closest(".note-block");var t=e.closest(".one-sentence-unit-section"),s=Number(n.data("noteId")),o=Number(t.data("workbookId")),i=e.find(".open-input").is(":checked"),a=e.find(".text-input").val().trim(),s={noteId:s,workbookId:o,memberId:q,content:a,publicOpen:i},o=0<t.length?"sentence":"passage";0!=a.length&&(0<t.length?s.sentenceId=Number(t.data("sentenceId")):s.passageId=passageId,editNote(o,s,function(t){e.find(".note-editor").hide(),e.find(".open-input").prop("checked",t.publicOpen),e.find(".note-text").html(t.content).show(),n.find(".updatedate").text((new Date).toLocaleDateString()),n.find(".note-mdf-btns, .updatedate").show()}))}).on("click",".js-delete-note",function(){if(confirm("삭제하시겠습니까?")){const t=$(this).closest(".note-block"),e=t.closest(".note-section"),n=Number(t.data("noteId")),s=t.closest(".one-sentence-unit-section"),o=0<s.length?"sentence":"passage";delNote(o,n,function(){t.fadeOut(function(){$(this).remove(),0==e.find(".note-block").length&&e.find(".empty-list").show()})})}}).on("click",".note-section .add-icon",async function(){const s=this;var t=$(s).closest(".one-sentence-unit-section"),e=t.data("sentenceId"),t=t.data("workbookId");$.ajax({url:`/adminxyz/workbook/sentence/note/status/${t}/`+e,success:t=>{if(t)t.includes("<html")?confirmModal("로그인 시간이 만료되었습니다.\n다시 로그인하시겠습니까?",()=>{location.assign("/auth/login")}):alertModal(t);else{$("#ssamNoteRequestListDiv tr.bg-info .status-text").text("작성중");{$(s).prop("disabled",!0);const e=$(s).closest(".note-section"),n=e.find(".add-section");0==$(s).closest(".passage-comment-section").length&&openSummernote(n.find(".text-input")),n.show(300,function(){e.find(".empty-list").hide()})}}},error:()=>{alertModal("상태를 조회할 수 없습니다.")}})}).on("input",".open-input",function(){this.nextSibling.data=this.checked?"회원들과 노트를 공유합니다.":"노트를 비공개로 보관합니다."}).on("click",".cancel-add-note-btn",function(){const e=$(this).closest(".add-section");var t=e.find(".text-input").val("");"function"==typeof t.summernote&&t.summernote("destroy"),e.hide(300,function(){var t=e.closest(".note-section");t.find(".add-icon").prop("disabled",!1),0==t.find(".note-list .note-block").length&&t.find(".empty-list").show()})}).on("click",".qna-section .add-icon",async function(){$(this).prop("disabled",!0).tooltip("hide");const s=$(this).closest(".qna-section"),o=s.children(".add-section");0<$(this).closest(".passage-comment-section").length?(openSummernote(o.find(".text-input")),o.show(300,function(){s.find(".empty-list").hide()})):o.show(300,async function(){s.find(".empty-list").hide();var t,e=s.closest(".one-sentence-unit-section"),n=o.find(".svoc-block");0<n.children().length||(t=e.find(".origin-sentence .sentence-text").text(),e=await tandem.getSvocBytes(e.find(".semantics-result").get(0)),$semantics=$(await tandem.showSemanticAnalysis(t,e,n)),o.find("textarea").get(0).focus())})}).on("click",".cancel-add-qna-btn",function(){const e=$(this).closest(".add-section");e.find(".svoc-block").empty(),e.find(".text-input").val(""),e.hide(300,function(){var t=e.closest(".qna-section");t.find(".add-icon").prop("disabled",!1),0==t.find(".qna-list .qna-block").length&&t.find(".empty-list").show()}),$(this).closest(".survey-section")?.find(".js-satisfy-cancel")?.trigger("click")}).on("click",".js-edit-question-open",function(){var t=$(this).closest(".question-section"),e=(t.find(".text-section").slideUp(),t.find(".edit-section").slideDown()),t=t.closest(".qna-unit");e.find(".q-title").val(t.find(".title-block .question-text:eq(0)").text()),e.find(".text-input").val(t.data("content")),openSummernote(e.find(".text-input"))}).on("click",".cancel-edit-question",function(){var t=$(this).closest(".edit-section"),e=t.closest(".question-section").find(".text-section");t.find(".text-input").val("").summernote("destroy"),t.slideUp(),e.slideDown()}).on("submit",".question-section .edit-section",function(t){t.preventDefault(),t.stopPropagation();const e=$(this).closest(".edit-section"),n=e.closest(".qna-unit");var t=e.find(".q-title").val().trim(),s=e.find(".text-input").val();if(0==s.length)return alert("내용을 입력해 주세요."),!1;t={questionId:n.data("questionId"),title:t,content:s,targetId:n.data("targetId"),workbookId:workbookId,passageId:passageId,qtype:n.data("qType"),questionerId:q,priorityId:n.data("priorityId"),questionStatus:n.data("qStatus")};editQuestion("workbook",t,function(t){e.find(".text-input").val("").summernote("destroy"),e.slideUp(),n.find(".question-section .text-section").slideDown(),n.find(".title-block .question-text:eq(0)").html(t.title.replace("[추가질문]",'<span class="text-violet">[추가질문]</span>')),n.find(".title-block .question-section .question-text").text($("<div></div>").html(t.content).text()),n.find(".content-block .question-text").html(t.content)})}).on("click",".js-del-question",function(){const e=$(this).closest(".qna-unit");var t;confirm("질문을 정말 삭제하시겠습니까?")&&(t=e.data("questionId"),delQuestion("workbook",t,function(t){alert("삭제되었습니다."),"object"!=typeof t||null==t?e.slideUp(function(){$(this).closest(".qna-block").remove()}):(e.find(".title-block .question-text:eq(0)").text(t.title),e.find(".title-block .question-section .question-text").text($("<div></div>").html(t.content).text()),e.find(".content-block .question-text").html(t.content),p(e.find(".q-status"),"C"))}))}).on("show.bs.collapse",".qna-list .content-block",async function(){const e=$(this),a=$(this).closest(".qna-unit");var t=a.data("questionId"),n=a.data("qType"),s=a.data("targetId");e.is(".loading,.loaded")||(e.is(".loaded")||e.addClass("loading"),$.getJSON(["/qnastack/answers",n,t,s].join("/"),{from:"w"},async function(t){var n=t.answerList,t=e.find(".question-section"),s=e.find(".answer-list"),o=[t];if(t.find(".qna-mdf-btns").show(),0<n?.length)for(let t=0,e=n.length;t<e;t++){var i=b(n[t],a);i.appendTo(s),o.push(i)}for(let t=0,e=o.length;t<e;t++)await sleep(600),o[t].addClass("show");e.toggleClass("loading loaded")}).fail(t=>{alert("질문의 상세내용을 가져오지 못했습니다. 다시 접속해 주세요."),e.removeClass("loading")}))}).on("click",".qna-unit .add-section .text-input",function(){openSummernote($(this)),$(this).closest(".add-section").find(".qna-add-btns").slideDown()}).on("click",".cancel-add-answer-btn",function(){$(this).closest(".add-section").find(".text-input").val("").summernote("destroy"),$(this).closest(".qna-add-btns").slideUp()}).on("click",".js-add-answer-btn",function(){const e=$(this).closest(".add-section"),n=e.closest(".qna-unit"),s=e.find(".text-input");var t=s.summernote("code").trim();if(0==t.length)return alert("내용을 입력해 주세요."),!1;t={questionId:Number(n.data("questionId")),writerId:q,content:t};addAnswer(t,function(t){s.val("").summernote("destroy"),e.find(".qna-add-btns").slideUp();t=b(t,n);t.insertBefore(e),sleep(600),t.addClass("show")})}).on("click",".js-edit-answer-open",function(){$answer=$(this).closest(".answer-section"),$contentSection=$answer.find(".text-section").slideUp(),($editSection=$answer.find(".edit-section").slideDown()).find(".text-input").val($answer.find(".answer-text").html()),openSummernote($editSection.find(".text-input"))}).on("click",".cancel-edit-answer",function(){var t=$(this).closest(".edit-section"),e=t.closest(".answer-section").find(".text-section");t.find(".text-input").val("").summernote("destroy"),t.slideUp(),e.slideDown()}).on("submit",".answer-section .edit-section",function(t){t.preventDefault(),t.stopPropagation();const e=$(this),n=e.closest(".answer-section"),s=n.find(".text-section");var t=n.closest(".qna-unit"),o=e.find(".text-input").val().trim();if(0==o.length)return alert("내용을 입력해 주세요."),!1;t={questionId:Number(t.data("questionId")),answerId:n.data("answerId"),writerId:q,content:o};editAnswer(t,function(t){alert("수정되었습니다."),e.find(".text-input").val("").summernote("destroy"),e.add(s).slideToggle(),n.find(".answer-text").html(t.content)})}).on("click",".js-del-answer",function(){const t=$(this).closest(".answer-section");var e;confirm("답변을 정말 삭제하시겠습니까?")&&(e=t.data("answerId"),delAnswer(e,function(){alert("삭제되었습니다."),t.slideUp(function(){$(this).remove()})}))}).on("click",".js-survey-answer",function(){var t=$(this).closest(".satis-btns").addClass("active"),t=(t.closest(".qna-unit").find(".satis-btns").not(t).addClass("inactive"),$(this).closest(".qna-unit").find(".survey-section").show());t.closest(".content-block").children(".add-section").hide(),t.data("answerId",$(this).closest(".answer-section").data("answerId")).data("memberId",$(this).closest(".answer-section").data("memberId")),t.find("[name=evaluation][value="+$(this).val()+"]").prop("checked",!0).trigger("input"),t[0].scrollIntoView()}).on("click",".js-satisfy-cancel",function(){$(this).closest(".survey-section").slideUp().closest(".content-block").children(".add-section").show(),$(this).closest(".qna-unit").find(".satis-btns").removeClass("active inactive")}).on("input",":radio[name=evaluation]",function(){var t;"B"==this.value?((t=$(".question-add-form").appendTo($(this).closest(".survey-section")).slideDown()).find(".q-title").val("[추가질문] "+t.closest(".qna-unit").find(".question-text:eq(0)").text()),t.find(".text-input").val(""),openSummernote(t.find(".text-input")),t.find(".qna-add-btns").slideDown(),$(this).closest(".survey-section").children(".answer-survey-btns").slideUp()):($(this).closest(".survey-section").find(".question-add-form .q-title")?.val(""),void 0!==$.summernote&&$(this).closest(".survey-section").find(".question-add-form .text-input")?.val("").summernote("destroy"),$(this).closest(".survey-section").find(".question-add-form")?.hide(300),$(this).closest(".survey-section").find(".answer-survey-btns").slideDown())}).on("click",".js-satisfy-btn",function(){const e=$(this).closest(".survey-section"),n=e.data("answerId");var t=e.data("memberId");const s=$(this).closest(".qna-unit");var o=s.data("questionId");const i=e.find("[name=evaluation]:checked").val(),a=-1<"ABD".indexOf(i)?"C":"A";o={questionId:o,answerId:n,writerId:t,evaluation:i,questionStatus:a};evaluateAnswer(o,function(){alert("평가가 완료되었습니다."),e.slideUp(),s.data("qStatus",a),p(s.find(".q-status"),a);var t=s.find(".answer-section").filter(function(){return $(this).data("answerId")==n});t.find(".satis-btns").remove(),-1<"AB".indexOf(i)&&t.find(".answer-text").before('<div class="material-icons text-yellow-400">emoji_events</div>');"C"==a?s.find(".satis-btns").remove():e.closest(".content-block").children(".add-section").show()})}).on("click",".js-add-question-btn",function(){const s=$(this).closest(".add-section");var t=s.closest(".qna-unit");const o=s.find(".text-input");var e=s.find(".q-title").val().trim(),n=o.val().trim();0!=n.length&&(e={targetId:t.data("targetId"),title:e,content:n,workbookId:workbookId,passageId:passageId,priorityId:$(this).closest(".survey-section").data("memberId"),qtype:t.data("qType"),questionerId:q},addQuestion("workbook",e,function(t){var e=$(".qna-list").show(),n=e.closest("[id]").attr("id"),t=m(t,!0);t.find(".accordion-collapse").attr("data-bs-parent","#"+n+" .qna-list"),e.prepend(t),o.val("").summernote("destroy"),s.hide(300,function(){$(this).closest(".qna-add-btns").data("openBtn")?.prop("disabled",!1)}),0<s.closest(".survey-section").length&&s.closest(".survey-section").find(".js-satisfy-btn").trigger("click")}))}).on("show.bs.tab","[role=tab][data-type=craft]",function(t){var e=$(this).closest(".one-sentence-unit-section"),n=(e.find(".dashboard-section").collapse("hide"),Array.from(e.find(".ai-translation-block"),t=>({id:$(t).data("korTid"),text:t.querySelector(".translation-text").textContent})));if(null==document.querySelector(this.dataset.bsTarget).querySelector(".battle-section-panel")){craft.openBattleMakerPanel(document.querySelector(this.dataset.bsTarget),q,e.data("sentenceId"),e.find(".semantics-result")[0],n);const s=e.find(".workbook-overview-section .wb-title").text();"HELLO-BOOK"!=s&&setTimeout(()=>{document.querySelector(this.dataset.bsTarget).querySelector(".battle-source-section .source").value=s},1e3)}});var f=0;function m(t,e){var n=$("#hiddenDivs .qna-unit").clone(),s=$('<div class="qna-block one-block row g-0 p-0"></div>'),o=(n.data("questionId",t.qid).data("qType",t.qtype).data("qStatus",t.qstatus).data("priorityId",t.priorityId).data("targetId",t.targetId).data("content",t.content).data("isMine",t.questioner.mid==q),p(n.find(".q-status"),t.qstatus),e?{alias:d,image:c,memberId:q}:t.questioner),i=n.find(".personacon-section");return i.find(".alias").text(o.alias),o.image&&i.find(".personacon-profile").removeClass("profile-default").css("background","url(/resource/profile/images/"+o.image+") center/cover no-repeat"),n.find(".regdate").text((e?new Date:new Date(t.regDate)).toLocaleDateString()),n.find(".title-block .question-text:eq(0)").html(t.title.replace("[추가질문]",'<span class="text-violet">[추가질문]</span>')),n.find(".title-block .question-section .question-text").text($("<div></div>").html(t.content).text()),n.find(".content-block .question-text").html(t.content),q!=o.mid&&n.find(".qna-mdf-btns, .survey-section").remove(),"C"==t.qstatus&&n.find(".add-section, .survey-section").remove(),"R"==t.qstatus&&t.questioner.mid!=q&&q!=t.priorityId&&n.find(".add-section .text-input").attr("placeholder","답변 우선권자의 답변을 기다리는 중입니다..").prop("disabled",!0),n.attr("id","question"+f).find(".accordion-button").attr("data-bs-target","#question"+f+" .content-block"),f++,n.appendTo(s),0==q&&s.find(".collapse").hide(),s}function p(t,e){switch(t.removeClass("bg-bittersweetshimmer bg-jazzberryjam bg-violet bg-coolblack"),e){case"H":t.addClass("bg-bittersweetshimmer").text("대기중");break;case"A":t.addClass("bg-jazzberryjam").text("다른 답변 요청");break;case"R":t.addClass("bg-violet").text("답변예약");break;case"C":t.addClass("bg-coolblack").text("완료")}}function b(t,e){var n=$("#hiddenDivs .answer-section").clone().addClass("fade");return n.data("answerId",t.aid).data("memberId",t.writer.mid),n.find(".alias").text(t.writer?.alias),0<t.writer?.image?.length&&(n.find(".personacon-section").find(".personacon-profile").removeClass("profile-default")[0].style.background="url(/resource/profile/images/"+t.writer.image+") center/cover no-repeat"),100==t.satisLevel&&n.find(".answer-text").before('<div class="material-icons text-yellow-400">emoji_events</div>'),(t.writer.mid!=q||0<t.satisLevel)&&n.find(".qna-mdf-btns").remove(),(!e.data("isMine")||0<t.satisLevel)&&n.find(".satis-btns").remove(),n.find(".regdate").text(new Date(t.regDate).toLocaleDateString()),n.find(".answer-text").html(t.content),n}}