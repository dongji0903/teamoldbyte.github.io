async function pageinit(e){const c=document.querySelector("#battleListDiv tbody"),s=document.querySelector("#battlePagination"),r=["#1(성분)","#2(수식어)","#3(택일/2)","#4(틀린/n)","#5(영작)","#6(빈칸)","#7(해석)","#8(토익)"];function t(e){$("#battleListDiv .sortMark").hide();var t=$("#searchFormHidden_list #sortName").val(),t=$(`.thlink[data-value="${t}"]+.sortMark`),t=(0<t.length&&t.html("false"==$("#searchFormHidden_list #asc").val()?"▼":"▲").show(),e?.totalPages),a=e?.number+1,l=10*(Math.floor((a-1)/10)+1-1)+1,o=10+l<=t?10+l-1:t,n=(c.replaceChildren(createElement(Array.from(e.content,e=>({el:"tr",children:[{el:"td",className:"data-rnum",textContent:e.rnum},{el:"td",className:"data-bid text-center",textContent:e.bid,"data-battleid":e.bid},{el:"td",className:"data-type text-center",textContent:r[e.battleType-1]},{el:"td",className:"data-englevel text-center",textContent:e.engLevel},{el:"td",className:"data-gramtitle text-center",textContent:e.grammarTitle},{el:"td",className:"data-englength text-center",textContent:e.engLength},{el:"td",className:"data-context text-start js-open-detail",style:"width:300px","data-sentenceid":e.sentenceId,onclick:()=>i(e),children:[{el:"a",style:{display:"inline-block",width:"300px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},textContent:e.eng}]},{el:"td",className:"data-asktag text-center",textContent:e.askTag},{el:"td",className:"data-source text-center",textContent:e.source},{el:"td",className:"data-regdate text-center",textContent:new Date(e.regDate).format("yyyy-MM-dd")}]})))),[]);10<l&&n.push({el:"li",className:"page-item","aria-label":"Previous",children:[{el:"a",className:"page-link","aria-hidden":!0,"data-pagenum":l-1,innerHTML:"&laquo;"}]});for(let e=l;e<=o;e++)n.push({el:"li",className:"page-item"+(e==a?" active":""),children:[{el:"a",className:"page-link","data-pagenum":e,textContent:e}]});o<t&&n.push({el:"li",className:"page-item","aria-label":"Next",children:[{el:"a",className:"page-link","aria-hidden":!0,"data-pagenum":o+1,innerHTML:"&raquo;"}]}),s.replaceChildren(createElement(n))}function i(t){var e=document.querySelector("#battleDetailSection .ask-detail-section");$("#battleDetailSection").data("battleCommand",Object.assign({},t,{battleId:t.bid,diffSpecificLevel:t.engLevel})),e.querySelector(".battle-type").value=t.battleType,e.querySelector(".battle-type").dataset.org=t.battleType,e.querySelector(".battle-ask").dataset.org=t.ask,e.querySelector(".battle-ask").replaceChildren(createElement(Array.from(craft.createAskOptions(t.battleType,craft.getAsks(t.battleType)),e=>(e.value==t.ask&&(e.selected=!0),5<=t.battleType&&(e.value=t.ask),e)))),e.querySelector(".battle-engLevel").dataset.org=t.engLevel,e.querySelector(".battle-engLevel").textContent=t.engLevel,e.querySelector(".battle-source").dataset.org=t.source,e.querySelector(".battle-source").value=t.source,e.querySelector(".battle-context").replaceChildren(createElement(craft?.createBattleContext(t.eng,t))),e.querySelector(".battle-diffLevel").dataset.org=t.diffLevel,e.querySelector(".battle-diffLevel").value=t.diffLevel,e.querySelector(".battle-category").dataset.org=t.categoryId,e.querySelector(".battle-category").value=t.categoryId,e.querySelector(".battle-askTag").dataset.org=t.askTag,e.querySelector(".battle-askTag").value=t.askTag,e.querySelector(".battle-comment").dataset.org=t.comment,e.querySelector(".battle-comment").value=t.comment,$(e.querySelector(".battle-comment")).summernote("reset"),$(e.querySelector(".battle-comment")).summernote("pasteHTML",t.comment),e.querySelector("#deleteBattle").dataset.battleid=t.bid,$("#editBattle").prop("disabled",!0);const a=document.getElementById("viewPrevBattle"),l=document.getElementById("viewNextBattle"),o=document.querySelector(`.data-bid[data-battleid="${t.bid}"]`).closest("tr");o.className="bg-info",$(o).siblings().removeClass("bg-info"),a.disabled=0==$(o).prev().length,l.disabled=0==$(o).next().length,a.onclick=()=>$(o).prev()?.find(".js-open-detail")?.trigger("click"),l.onclick=()=>$(o).next()?.find(".js-open-detail")?.trigger("click")}t(e),$(document).on("click",".thlink[data-value]",function(){var e=this.dataset.value,t=$("#searchFormHidden_list #sortName"),a=$("#searchFormHidden_list #asc");e==t.val()?a.val("true"!=a.val()):t.val(this.dataset.value),$("#pageForm").submit()}),$(document).on("click",".page-link",function(){$("#searchFormHidden_list #page").val(parseInt(this.dataset.pagenum)),$("#pageForm").submit()}),$("#pageForm").on("submit",function(e){e.preventDefault(),$.ajax({url:"/adminxyz/craft/battle/page",data:$(this).serialize(),success:function(e){t(e)},error:function(){aler("배틀 목록 조회에 실패했습니다.")}})}),$(document).on("click",".js-open-detail",function(){var e=this.dataset.sentenceid;const a=this.textContent;function t(e){var t=document.querySelector(".explain-detail-section");tandem.showSemanticAnalysis(a,e.svocTag.svocBytes,$(t).find(".svocInfo").empty()),t.querySelector(".korInfo").replaceChildren(createElement(Array.from(e.korList,e=>({el:"div",textContent:e.kor})))),t.querySelector(".wordInfo").replaceChildren(createElement(Array.from(e.wordList,(e,t)=>({el:"span",class:"one-word-unit-section"+(0<t?" ms-3":""),children:[{el:"span",class:"title fw-bold text-blue-700",textContent:e.title}].concat(Array.from(e.senseList,e=>({el:"span",class:"one-part-unit-section ms-2",children:[{el:"span",class:"part text-palegreen",textContent:e.partType},{el:"span",class:"meaning ms-1",textContent:e.meaning}]})))}))))}bootstrap.Tab.getOrCreateInstance(document.querySelector("#viewAskDetail")).show(),$("#battleDetailSection").is(".show")&&window.scrollTo(0,document.getElementById("battleDetailSection").offsetTop),$("#battleDetailSection").collapse("show"),$("#editBattle").prop("disabled",!0),$(this).data("battleAnswerInfo")?t($(this).data("battleAnswerInfo")):$.getJSON("/adminxyz/craft/battle/"+e,e=>{t(e),$(this).data("battleAnswerInfo",e)}).fail(()=>alert("해설 상세정보를 조회하지 못했습니다."))}).on("shown.bs.collapse","#battleDetailSection",function(){window.scrollTo(0,document.getElementById("battleDetailSection").offsetTop)}).on("shown.bs.tab","#viewDescDetail",function(){tandem.correctMarkLine(document.querySelector("#battleDetailSection .svocInfo .semantics-result"))}),$(document).on("input","#battleDetailSection *",function(e){e.stopPropagation(),this.matches(".battle-diffLevel")&&(document.querySelector(".battle-engLevel").textContent=craft.calcDiffSpecific(this.value,$("#battleDetailSection").data("battleCommand").eng.length)),$("#editBattle").prop("disabled",Array.from(document.getElementById("battleDetailSection").querySelectorAll("input, textarea, select")).every(e=>e.value==e.dataset.org))}).on("click","#editBattle",function(){const a=$("#battleDetailSection").data("battleCommand");t=$("#battleDetailSection").data("battleCommand"),e=document.querySelector("#battleDetailSection .ask-detail-section");let l=Object.assign({},t,{battleType:e.querySelector(".battle-type").value,ask:e.querySelector(".battle-ask").value,engLevel:craft.calcDiffSpecific(e.querySelector(".battle-diffLevel").value,t.engLength),source:e.querySelector(".battle-source").value,diffLevel:e.querySelector(".battle-diffLevel").value,categoryId:parseInt(e.querySelector(".battle-category").value),askTag:e.querySelector(".battle-askTag").value,comment:e.querySelector(".battle-comment").value});var e,t;const o=[];Object.keys(l).forEach(e=>{l[e]!=a[e]&&o.push(e)});let n="";1==o.length&&(n={askTag:"/tag",comment:"/comment",categoryId:"/category"}[o[0]]||"",(t={battleId:l.battleId})[o[0]]=l[o[0]],l=t),$.ajax({url:"/adminxyz/craft/battle/edit"+n,type:"POST",contentType:"application/json",data:JSON.stringify(l),success:function(){alert("배틀이 수정되었습니다.");const e=l.battleId,t=document.querySelector(`.data-bid[data-battleid="${e}"]`).closest("tr");o.forEach(e=>{switch(e){case"battleType":t.querySelector(".data-type").textContent=l[e];break;case"askTag":t.querySelector(".data-asktag").textContent=l[e];break;case"categoryId":t.querySelector(".data-gramtitle").textContent=document.querySelector(`#battleDetailSection .battle-category option[value="${l[e]}"]`).textContent;break;case"source":t.querySelector(".data-source").textContent=l[e];break;case"diffLevel":t.querySelector(".data-englevel").textContent=l.engLevel}}),t.querySelector(".js-open-detail").onclick=()=>i(Object.assign({},a,l,{bid:e})),i(Object.assign({},a,l,{bid:e}))},error:()=>alert("배틀을 수정하지 못 했습니다.")})}),$(document).on("click","#deleteBattle",function(){const t=this.dataset.battleid;$.post("/adminxyz/craft/battle/del/"+t,function(){alert("배틀이 삭제되었습니다."),$("#battleDetailSection").collapse("hide");var e=document.querySelector(`.data-bid[data-battleid="${t}"]`).closest("tr");e.className="pe-none opacity-50 bg-danger",e.querySelector(".js-open-detail").onclick=()=>alert("삭제된 배틀입니다.")}).fail(()=>alert("배틀을 삭제하지 못 했습니다."))}),document.getElementById("battleDetailSection").appendChild(createElement([{el:"nav",children:[{el:"div",class:"nav nav-tabs col-auto",role:"tablist",children:[{el:"button",id:"viewAskDetail",class:"nav-link",type:"button","data-bs-toggle":"pill",role:"tab","aria-controls":"nav-ask","aria-selected":"true","data-bs-target":"#battleDetailSection .ask-detail-section",children:[{el:"span",class:"material-icons-outlined fs-16px align-text-bottom",textContent:"inventory_2"},{el:"span",class:"tab-title",textContent:"문제 상세보기"}]},{el:"button",id:"viewDescDetail",class:"nav-link",type:"button","data-bs-toggle":"pill",role:"tab","aria-controls":"nav-explain","aria-selected":"false","data-bs-target":"#battleDetailSection .explain-detail-section",children:[{el:"span",class:"material-icons-outlined fs-16px align-text-bottom",textContent:"inventory_2"},{el:"span",class:"tab-title",textContent:"해설 상세보기"}]}]}]},{el:"div",class:"contents-section tab-content mt-3",children:[{el:"div",class:"ask-detail-section tab-pane fade",role:"tabpanel","aria-labelledby":"nav-ask-tab",children:[{el:"div",className:"battleTopInfo row",children:[{el:"div",className:"col-2 row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"종류"},{el:"select",className:"form-select col battle-type",children:Array.from(["1","2","3","4","5","6","7","8"],e=>({el:"option",value:e,textContent:r[e-1]}))}]},{el:"div",className:"col-5 row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"질문"},{el:"select",className:"form-select col battle-ask"}]},{el:"div",className:"col-auto row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"난이도"},{el:"select",className:"form-select col battle-diffLevel",children:Array.from([["쉬움","A"],["보통","B"],["어려움","C"]],([e,t])=>({el:"option",value:t,textContent:e}))}]},{el:"div",className:"col-auto row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"계급"},{el:"span",className:"col battle-engLevel my-auto"}]}]},{el:"div",className:"col-12 row",children:[{el:"div",className:"col-auto invisible",textContent:"본문"},{el:"div",className:"col battle-context my-3 p-3 border rounded"}]},{el:"div",className:"battleSubInfo col-12 row",children:[{el:"div",className:"col-4 row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"출처"},{el:"input",type:"text",className:"form-control col battle-source"}]},{el:"div",className:"col-4 row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"문법"},{el:"select",className:"form-select col battle-category"}]},{el:"div",className:"col row",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"태그"},{el:"input",type:"text",className:"form-control col battle-askTag"}]}]},{el:"div",className:"battleComment col-12 row mt-3",children:[{el:"label",className:"col-auto lh-1 my-auto text-fc-purple fw-bold",textContent:"해설"},{el:"textarea",className:"form-control col battle-comment",rows:10}]},{el:"div",className:"battleEditBtns mt-3 position-relative text-center",children:[{el:"button",type:"button",id:"deleteBattle",className:"btn btn-outline-fico col-auto",children:[{el:"i",className:"fas fa-trash-alt me-1"},"삭제"]},{el:"button",type:"button",id:"editBattle",className:"btn btn-outline-fico col-auto",disabled:!0,children:[{el:"i",className:"far fa-file-alt"},{el:"i",className:"fas fa-pen fa-xs",style:"left: -8px; top: 5px; position: relative;"},"수정"]},{el:"button",type:"button",id:"viewNextBattle",className:"btn btn-md btn-outline-fico col-auto fas fa-angle-right fs-3 float-end","data-bs-title":"다음 배틀","data-bs-toggle":"tooltip"},{el:"button",type:"button",id:"viewPrevBattle",className:"btn btn-md btn-outline-fico col-auto fas fa-angle-left fs-3 float-end","data-bs-title":"이전 배틀","data-bs-toggle":"tooltip"}]}]},{el:"div",class:"explain-detail-section tab-pane fade",role:"tabpanel","aria-labelledby":"nav-explain-tab",children:[{el:"div",className:"my-3 py-3 row",children:[{el:"label",className:"col-auto lh-1 mt-3 text-fc-purple fw-bold",textContent:"분석"},{el:"div",className:"svocInfo position-relative col"}]},{el:"div",className:"row",children:[{el:"label",className:"col-auto lh-1 text-fc-purple fw-bold",textContent:"해석"},{el:"div",className:"korInfo text-fc-red col"}]},{el:"div",className:"mt-3 row",children:[{el:"label",className:"col-auto lh-1 text-fc-purple fw-bold",textContent:"단어"},{el:"div",className:"wordInfo word-section col"}]}]}]}])),$.getJSON("/grammar/category/list",e=>{document.querySelector("#battleDetailSection .battle-category").appendChild(createElement(Array.from(e,e=>({el:"option",value:e.cid,textContent:(e.parentCategory?"└─ ":"")+e.title}))))}),await openSummernote($("#battleDetailSection textarea.battle-comment"))}