function pageinit(r,o,l,s,a){const n=new Date($(".workbook-info-section .reg-date").text()),d=$("#workBookType").val();if($(window).on("unload",()=>$("#loadingModal").modal("hide")),document.querySelector(".type-tooltip")&&new bootstrap.Tooltip(document.querySelector(".type-tooltip"),{trigger:"hover focus"}).enable(),document.querySelector(".priority-tooltip")&&new bootstrap.Tooltip(document.querySelector(".priority-tooltip"),{trigger:"hover focus"}).enable(),document.querySelector(".js-add-passage-open")){$(".js-add-passage-open").tooltip("show");const m=$("#addPsgIndicator");new IntersectionObserver(e=>{0==e[0].intersectionRect.height&&0<e[0].boundingClientRect.y?(m.addClass("bottom-0"),m.removeClass("top-0"),m.show()):m.hide()},{rootMargin:"35px 0px"}).observe($(".js-add-passage-open")[0])}Compressor.setDefaults({quality:.8,width:210,height:315,maxWidth:210,maxHeight:315,resize:"cover"});const e={itemSelector:".passage",columnWidth:".passage",gutter:10,percentPosition:!0,horizontalOrder:!0,transitionDuration:"0.8s"};if($(".workbook-overview-section .list-passage-section").masonry(e),!l){let s=$(".workbook-info-section .book-cover img");$('[name="coverImage"]').on("change",function(e){let t=e.target.files[0];if(null==t)return!1;const o=new FileReader;o.onload=function(){s.css("background-image","url("+this.result+")").closest(".book-cover").removeClass("default").find(".book-title").hide(),URL.revokeObjectURL(o.result)},new Compressor(t,{success(e){o.readAsDataURL(e)},error(e){o.readAsDataURL(t)}})}),$(document).on("focus click",".edit-hover:not(.active) *",function(e){e.stopImmediatePropagation(),e.stopPropagation();var e=$(this.closest(".edit-hover")),t=e.find("input,select,#description").eq(0);e.addClass("active"),t.is(":file")?(t.data("originData",s.css("background-image")),e.find(".mdf-btns").css("display","block")):(t.prop("readonly",!1),t.is("#description")&&(t.siblings(".description-preview").hide(0),openSummernote(t)),t.data("originData",(t.is(":radio")?t.filter(":checked"):t).val()),e.find(".mdf-btns").show()),e.find(".edit-badge").hide()}),$(".js-edit-cancel").click(function(e){e.stopPropagation();var e=$(this.closest(".edit-hover")),t=e.find("input,select,#description").eq(0);t.is(":file")?(s.css("background-image",t.data("originData")),"none"==t.data("originData")&&s.closest(".book-cover").addClass("default").find(".book-title").show()):(t.is(":radio")?t.filter('[value="'+t.data("originData")+'"]').prop("checked",!0):(t.is("#description")&&($("#description").summernote("destroy"),t.siblings(".description-preview").show(0)),t.val(t.data("originData"))),t.prop("readonly",!0)),e.removeClass("active").find(".edit-badge").show().removeAttr("style"),e.find(".mdf-btns").hide().find("button").not(this).prop("disabled",!0)}),$(".edit-hover input, .edit-hover select, .edit-hover textarea").on("input summernote.change",function(){$(this.closest(".edit-hover")).find(".mdf-btns button").prop("disabled",!1)}),$(".edit-workbook-form").submit(function(e){e.preventDefault();const t=$(this).find("input,select,#description").eq(0),o=t.closest(".edit-hover"),s=this;if(t.is(":file")){const i=new FormData;i.append("workBookId",r),new Compressor(t.get(0).files[0],{success(e){i.append(t.attr("name"),e,e.name),editWorkbookMultiInfo(s.action,i,a)},error(e){i.append(t.attr("name"),t.get(0).files[0]),editWorkbookMultiInfo(s.action,i,a)}})}else{e={workBookId:r};e[t.attr("name")]=t.is(":radio")?"true"==t.filter(":checked").val():(t.is("#description")?t.summernote("code"):t.val()).trim(),editWorkbookPlainInfo(s.action,e,a)}function a(){alertModal("수정되었습니다."),t.is("#description")&&(t.siblings(".description-preview").html(t.summernote("code")).show(0),t.summernote("destroy")),o.removeClass("active").find(".edit-badge").show().removeAttr("style"),o.find(".mdf-btns").hide().find("button:not(.js-edit-cancel)").prop("disabled",!0),$(".update-date").text((new Date).toLocaleDateString())}})}const t=new IntersectionObserver(e=>{e[0].isIntersecting&&(e=e[0].target.dataset.pagenum,$.getJSON("/workbook/passages/"+r,{pageNum:e},i).fail((e,t,o)=>alertModal("지문 조회에 실패했습니다. 다시 접속해주세요.")))}),c=document.querySelector(".page-scroll");function i(o){var s=$(".list-passage-section");if(null!=o&&0<o.content?.length){for(let e=0,t=o.content?.length;e<t;e++){var a=$("#hiddenDivs .passage").clone(),i=o.content[e],n=(a.attr("data-pid",i.passageId),a.attr("data-order-num",i.orderNum),l?a.find(".passage-title").text(new Date(i.regDate).format("yyyy-MM-dd(e)")).attr("title",new Date(i.regDate).format("yyyy-MM-dd(e)")):a.find(".passage-title").text(i.title||"제목 없음").attr("title",i.title||"제목 없음"),a.find(".passage-title-section .title-input").val(i.title),i.sample&&a.addClass("sample"),a.find(".passage-text")),r=i.sentenceList;0==r.length&&n.addClass("pe-none").append($("#hiddenDivs .guide-add-sentences").clone());for(let e=0,t=r.length;e<t;e++)n.append(r[e].eng);(!"TC".includes(d)||0<r?.length)&&a.find(".js-add-sentences").remove(),s.append(a),s.is(".moving")?s.sortable("refresh"):s.masonry("appended",a)}o.last&&t.disconnect(),c.dataset.pagenum++}else t.disconnect()}function p(t){var e=t.totalPages,o=t.number+1,t=10*(Math.ceil(o/10)-1)+1,s=10+t<=e?10+t-1:e,a=[];for(let e=t;e<=s;e++)a.push({el:"span",className:"page-item swiper-pagination-bullet"+(o==e?" swiper-pagination-bullet-active":""),"data-pagenum":e});return 10<t&&a.unshift({el:"span",className:"page-item",role:"button","data-pagenum":t-1,innerHTML:"&laquo;"}),s<e&&a.push({el:"span",className:"page-item",role:"button","data-pagenum":s+1,innerHTML:"&raquo;"}),a}function g(e){var t=0<e?.image?.length?`url(/resource/profile/images/${e.image})`:"var(--fc-logo-head)",o={el:"span",className:"email col-6 my-auto",textContent:e.email},s={el:"span",className:"alias col-3 my-auto",textContent:e.alias};return{el:"div",className:"coworker row g-0","data-mid":e.memberId,children:[{el:"div",className:"member-personacon",children:[{el:"img",className:"personacon-profile",src:"https://static.findsvoc.com/images/app/member/profile_paper.png",style:{backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundImage:t}}]},o,s,{el:"button",className:"del-coworker my-auto btn del-btn col-1 fas fa-trash-alt",title:"목록에서 제외합니다."}]}}t.observe(c),$(document).on("click",".js-view-passage",function(){var e=this.matches(".note-request-unit")?"?senQuery="+this.querySelector(".sentence-text").textContent:"",t=Number(this.closest(".passage").dataset.pid);sessionStorage.setItem("workbookCover",l?"https://static.findsvoc.com/images/app/workbook/bookcover/hellobook_cover.jpeg":o),sessionStorage.setItem("passageIdList",JSON.stringify(s)),$("#loadingModal").modal("show"),location.assign(`/workbook/passage/${ntoa(r)}/`+ntoa(t)+e)}),$(document).on("click",".feedback-list .page-item, .note-request-list .page-item",function(){const i=this.closest(".pagination-section").dataset.content;var e=this.dataset.pagenum;$.getJSON(`/workbook/${i}/list/`+r,{pageNum:e},e=>{if("feedback"==i){return t=e,o=Array.from(t.content,e=>{var t=new Date(e.regDate);return{el:"div",className:"feedback-unit row g-0",role:"button",title:"펼쳐보기/접기",children:[{el:"div",className:"feedback-text-block col-12 col-lg-10 row g-0 m-auto",children:[{el:"span",className:"feedback-text text-truncate","data-org":e.content,textContent:e.content.replace(/\n.+/g,"")}]},{el:"div",className:"regDate-section col-6 col-lg-2",children:[{el:"span",className:"reg-date",textContent:new Date(Math.max(n,t)).format("yyyy-MM-dd")}]}]}}),$(".feedback-list .feedback-unit").remove(),$(".feedback-list .pagination-section").before(createElement(o)),void $(".feedback-list .pagination-section .swiper-pagination").get(0).replaceChildren(createElement(p(t)));var t}else{var o=e;const s={H:"대기중",W:"작성중",D:"작성&lt;br&gt;완료",C:"취 소",S:"추 천"},a=Array.from(o.content,e=>({el:"div",className:"note-request-unit row g-0 js-view-passage passage status-"+e.progressStatus.toLowerCase(),role:"button","data-pid":e.passageId,"data-bs-toggle":"tooltip",title:"클릭시 노트를 신청한 지문 상세보기로 이동합니다.",children:[{el:"div",className:"col-2 col-xl-1 row g-0 m-auto",children:[{el:"div",className:"badge-block",children:[{el:"span",className:"status-text",innerHTML:s[e.progressStatus]}]}]},{el:"div",className:"col-8 col-xl-9 row g-0 m-auto",children:["S"==e.progressStatus?{el:"span",className:"suggest-text",children:["이 문장에 대해 ",{el:"span",className:"app-name-text",textContent:"fico"},"쌤 노트를 ",{el:"b",textContent:"신청"},"해 보면 어떨까요?"]}:"",{el:"span",className:"sentence-text text-truncate",textContent:e.sentence.eng}]},{el:"div",className:"col-2 m-auto text-center",children:[{el:"span",className:"reg-date",textContent:new Date(e.regDate).format("yyyy-MM-dd")}]}]}));$(".note-request-list .note-request-unit").remove(),$(".note-request-list .pagination-section").before(createElement(a)),$(".note-request-list .pagination-section .swiper-pagination").get(0).replaceChildren(createElement(p(o)))}})}).on("click",".feedback-unit",function(){var e=$(this).find(".feedback-text"),t=e.data("org"),o=t.replace(/[\r\n].+/g,""),s=$(this).toggleClass("open").hasClass("open");e.text(s?t:o),$(this).siblings().toggle(!s)}),l?$(".js-add-passage-open").click(function(){location.assign("/workbook/mystack/add")}):($(".js-add-passage-open").click(function(){30<=s.length?$("#passageLimitModal").modal("show"):(sessionStorage.setItem("workbookCover",this.dataset.cover),sessionStorage.setItem("passageIdList",JSON.stringify(s)),location.assign(`/workbook/passage/add/${ntoa(r)}?wtitle=`+encodeURIComponent($("#title").val())))}),$(".js-add-passage-title").click(function(){30<=s.length?$("#passageLimitModal").modal("show"):location.assign(`/workbook/passagetitle/batch/${ntoa(r)}?wtitle=`+encodeURIComponent($("#title").val()))}),$(document).on("click",".passage-title",function(){0!=$(".js-edit-ptitle").length&&$(this).hide().siblings(".title-input,.title-edit-btn-section").show().closest(".passage-title-section").addClass("edit")}).on("click",".js-edit-ptitle",function(){const e=this.closest(".passage-title-section"),t=$(e).find(".title-input").val().trim();var o={passageId:this.closest(".passage").dataset.pid};0<t.length&&(o.passageTitle=t),editPassageTitle(o,()=>{alertModal("지문 제목이 수정되었습니다."),$(e).removeClass("edit"),$(e).find(".passage-title").text(t||"제목 없음").attr("title",t||"제목 없음").show(),$(e).find(".title-input,.title-edit-btn-section").hide()},()=>alertModal("지문 제목 수정 중 오류가 발생했습니다."))}).on("click",".js-cancel-ptitle",function(){var e=this.closest(".passage-title-section"),t=$(e).find(".passage-title").show();$(e).removeClass("edit"),$(e).find(".title-input").val(t.text()).hide(),$(e).find(".title-edit-btn-section").hide()}).on("show.bs.dropdown",".edit-menu-block .dropdown-toggle",function(){$(".passage .edit-menu-block .dropdown-toggle.show").dropdown("hide").each(function(){$(this).closest(".edit-menu-block").hide()}),$(this).closest(".edit-menu-block").show()}).on("mouseout",".edit-menu-block",function(){$(this).find(".dropdown-toggle").is(".show")||$(this).hide()}).on("click",".js-move-passage",function(){const n=$(this).closest(".list-passage-section");$(this).closest(".dropdown-menu").siblings(".dropdown-toggle").dropdown("hide"),$(".js-add-passage-open").tooltip("hide"),$("#exitEditPassageOrder,.js-add-passage-open,.passage-list-normal-guide,.passage-list-moving-guide").toggle(),n.addClass("moving row").masonry("destroy").sortable({classes:{"ui-sortable-helper":"shadow-lg"},cursor:"move",update:(e,t)=>{if(confirm("문장을 여기로 이동하겠습니까?")){var o=t.item.prev(".passage"),s=t.item.next(".passage");if(0==s.length)t.item[0].dataset.orderNum=Number(o[0].dataset.orderNum)+1e3;else if(0==o.length){var a=Number(s[0].dataset.orderNum),i=Math.round(a/2);if(i==a)return alertModal("더이상 이동할 수 없습니다."),void n.sortable("cancel");t.item[0].dataset.orderNum=i}else{a=Number(o[0].dataset.orderNum),i=Number(s[0].dataset.orderNum),o=Math.round((a+i)/2);if(-1<[a,i].indexOf(o))return alertModal("더이상 이동할 수 없습니다."),void n.sortable("cancel");t.item[0].dataset.orderNum=o}s={workbookId:r,passageId:parseInt(t.item[0].dataset.pid),orderNum:parseInt(t.item[0].dataset.orderNum)};$.ajax({url:"/workbook/passage/order/edit",type:"POST",data:JSON.stringify(s),contentType:"application/json",success:()=>alertModal("지문 순서가 성공적으로 변경되었습니다."),error:()=>alertModal("지문 순서 변경이 실패했습니다.",()=>{n.sortable("cancel")})})}else n.sortable("cancel")}})}).on("click","#exitEditPassageOrder",function(){$(".list-passage-section.moving").removeClass("moving row").masonry(e),$(this).add(".js-add-passage-open").toggle()}).on("click",".js-add-sentences",function(){var e=$(this).closest(".passage"),t=parseInt(e[0].dataset.pid),e=e.find(".passage-title").text().trim();location.assign(`/workbook/passage/sentence/add/${ntoa(r)}/${ntoa(t)}?ptitle=`+encodeURIComponent(e))}).on("click",".js-edit-passage",function(){var e=Number(this.closest(".passage").dataset.pid),t=this.closest(".passage").querySelector(".passage-title").title;sessionStorage.setItem("workbookId",r),sessionStorage.setItem("workbookCover",o),sessionStorage.setItem("passageIdList",JSON.stringify(s)),sessionStorage.setItem("editingPassageId",e),location.assign(`/workbook/mybook/edit/passage/${ntoa(e)}?ptitle=`+encodeURIComponent(t))}),$(document).on("click",".js-del-passage",function(){const e=$(this.closest(".passage"));var t=e.data("pid");const o=e.closest(".list-passage-section"),s=e.is(".sample");confirm("이 지문을 삭제하시겠습니까?")&&deletePassage({workbookId:r,passageId:t},function(){alertModal("지문이 삭제되었습니다."),s&&a--;o.masonry("remove",e).masonry("layout")})}).on("click",".js-toggle-sample",function(){const e=$(this.closest(".passage"));var t=e.data("pid"),o=e.is(".sample")?"이 지문을 샘플에서 제외하시겠습니까?":"이 지문을 샘플로 지정하시겠습니까?";const s=!e.is(".sample");s&&6==a?alertModal("한 워크북에 지정할 샘플 지문의 최대 갯수는 6개입니다."):confirm(o)&&(o={workbookId:r,passageId:t,sample:s},editPassageSample(o,function(){alertModal("지문 샘플정보를 변경했습니다."),a+=s?1:-1,e.toggleClass("sample")}))}),$(".open-add-coworker").on("click",function(){const t=$("#coworker-edit-modal .list-coworker-section");0==t.children().length&&$.getJSON("/workbook/coworker/list/"+ntoa(r),e=>{t.get(0).appendChild(createElement(Array.from(e,e=>g(e))))}).fail(()=>alertModal("공동 작업자 조회에 실패했습니다.")),$("#coworker-edit-modal").modal("show")}),$("#coworker-edit-modal").on("hidden.bs.modal",function(){$(this).find(".list-new-coworker-section").empty(),$(this).find(".add-coworker-btn").prop("disabled",!0)}),$(".check-coworker-btn").on("click",function(){const o=$("#coworker-email").get(0);0<o.value.length&&o.checkValidity()&&$.getJSON("/member/search",{email:btoa(o.value.trim())},e=>{var t;o.value="",e?(t=$("#coworker-edit-modal .list-new-coworker-section"),e=createElement(g(e)),t.append(e).find(".empty-msg").hide(),$(".add-coworker-btn").prop("disabled",!1)):alertModal("존재하지 않은 회원입니다.")})}),$(".add-coworker-btn").on("click",function(){var e=Array.from($(".list-new-coworker-section .coworker").get(),e=>e.dataset.mid);$.ajax({url:"/workbook/coworker/add",type:"POST",data:{workbookId:r,coworkerIdList:e},success:function(){alertModal("공동 작업자가 추가되었습니다."),$("#coworker-email").val(""),$(".add-coworker-btn").prop("disabled",!0),$(".list-coworker-section").append($(".list-new-coworker-section").children(".coworker")),$(".list-new-coworker-section .empty-msg").show()},error:function(){alertModal("작업자 등록에 실패했습니다.")}})}),$(document).on("click",".del-coworker",function(){const e=$(this).closest(".coworker"),t=e.find(".alias").text(),o=parseInt(e.data("mid"));confirmModal(t+"님을 작업자에서 제외하시겠습니까?",()=>{0<$(this).closest(".list-new-coworker-section").length?(e.remove(),0==$(".list-new-coworker-section .coworker").length&&($(".list-new-coworker-section .empty-msg").show(),$(".add-coworker-btn").prop("disabled",!0))):$.ajax({url:"/workbook/coworker/del",type:"POST",data:{workbookId:r,coworkerIdList:[o]},success:()=>{e.remove(),alertModal(t+"님을 작업자에서 제외했습니다.")},error:function(){alertModal("작업자 제외가 실패했습니다.")}})})}))}