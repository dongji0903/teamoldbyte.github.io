function pageinit(n,o,l,a,s){if($("#loadingModal").modal("hide"),document.querySelector(".type-tooltip")&&new bootstrap.Tooltip(document.querySelector(".type-tooltip"),{trigger:"hover focus"}).enable(),document.querySelector(".priority-tooltip")&&new bootstrap.Tooltip(document.querySelector(".priority-tooltip"),{trigger:"hover focus"}).enable(),document.querySelector(".js-add-passage-open")){$(".js-add-passage-open").tooltip("show");const d=$("#addPsgIndicator");new IntersectionObserver(e=>{0==e[0].intersectionRect.height&&0<e[0].boundingClientRect.y?(d.addClass("bottom-0"),d.removeClass("top-0"),d.show()):d.hide()},{rootMargin:"35px 0px"}).observe($(".js-add-passage-open")[0])}if(Compressor.setDefaults({quality:.8,width:210,height:315,maxWidth:210,maxHeight:315,resize:"cover"}),$(".workbook-overview-section .list-passage-section").masonry({itemSelector:".passage",columnWidth:".passage",gutter:10,percentPosition:!0,horizontalOrder:!0,transitionDuration:"0.8s"}),!l){let a=$(".workbook-info-section .book-cover img");$('[name="coverImage"]').on("change",function(e){let t=e.target.files[0];if(null==t)return!1;const o=new FileReader;o.onload=function(){a.css("background-image","url("+this.result+")").closest(".book-cover").removeClass("default").find(".book-title").hide(),URL.revokeObjectURL(o.result)},new Compressor(t,{success(e){o.readAsDataURL(e)},error(e){o.readAsDataURL(t)}})}),$(document).on("focus click",".edit-hover:not(.active) *",function(e){e.stopImmediatePropagation(),e.stopPropagation();var e=$(this.closest(".edit-hover")),t=e.find("input,select,textarea");e.addClass("active"),t.is(":file")?(t.data("originData",a.css("background-image")),e.find(".mdf-btns").css("display","block")):(t.prop("readonly",!1),t.data("originData",(t.is(":radio")?t.filter(":checked"):t).val()),e.find(".mdf-btns").show()),e.find(".edit-badge").hide()}),$(".js-edit-cancel").click(function(e){e.stopPropagation();var e=$(this.closest(".edit-hover")),t=e.find("input,select,textarea");t.is(":file")?(a.css("background-image",t.data("originData")),"none"==t.data("originData")&&a.closest(".book-cover").addClass("default").find(".book-title").show()):(t.is(":radio")?t.filter('[value="'+t.data("originData")+'"]').prop("checked",!0):t.val(t.data("originData")),t.prop("readonly",!0)),e.removeClass("active").find(".edit-badge").show().removeAttr("style"),e.find(".mdf-btns").hide().find("button").not(this).prop("disabled",!0)}),$(".edit-hover input, .edit-hover select, .edit-hover textarea").on("input",function(){$(this.closest(".edit-hover")).find(".mdf-btns button").prop("disabled",!1)}),$(".edit-workbook-form").submit(function(e){e.preventDefault();const t=$(this).find("input,select,textarea"),o=t.closest(".edit-hover"),a=this;if(t.is(":file")){const i=new FormData;i.append("workBookId",n),new Compressor(t.get(0).files[0],{success(e){i.append(t.attr("name"),e,e.name),editWorkbookMultiInfo(a.action,i,s)},error(e){i.append(t.attr("name"),t.get(0).files[0]),editWorkbookMultiInfo(a.action,i,s)}})}else{e={workBookId:n};e[t.attr("name")]=t.is(":radio")?"true"==t.filter(":checked").val():t.val().trim(),editWorkbookPlainInfo(a.action,e,s)}function s(){alertModal("수정되었습니다."),o.removeClass("active").find(".edit-badge").show().removeAttr("style"),o.find(".mdf-btns").hide().find("button:not(.js-edit-cancel)").prop("disabled",!0),$(".update-date").text((new Date).toLocaleDateString())}})}const e=new IntersectionObserver(e=>{e[0].isIntersecting&&(e=e[0].target.dataset.pagenum,$.getJSON("/workbook/passages/"+n,{pageNum:e},i).fail((e,t,o)=>alertModal("지문 조회에 실패했습니다. 다시 접속해주세요.")))}),t=document.querySelector(".page-scroll");function i(o){var a=$(".list-passage-section");if(null!=o&&0<o.content?.length){for(let e=0,t=o.content?.length;e<t;e++){var s=$("#hiddenDivs .passage").clone(),i=o.content[e],n=(s.attr("data-pid",i.passageId),l?s.find(".passage-title").text(new Date(i.regDate).format("yyyy-MM-dd(e)")).attr("title",new Date(i.regDate).format("yyyy-MM-dd(e)")):s.find(".passage-title").text(i.title||"제목 없음").attr("title",i.title||"제목 없음"),s.find(".passage-title-section .title-input").val(i.title),i.sample&&s.addClass("sample"),s.find(".passage-text")),r=i.sentenceList;for(let e=0,t=r.length;e<t;e++)n.append(r[e].eng);a.append(s).masonry("appended",s)}o.last&&e.disconnect(),t.dataset.pagenum=o.number+1}else e.disconnect()}function r(t){return{el:"div",className:"coworker row g-0","data-mid":t.memberId,children:[{el:"div",className:"member-personacon",children:[{el:"img",className:"personacon-profile",src:"https://static.findsvoc.com/images/app/member/profile_paper.png",style:{backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundImage:0<t?.image.length?`url(/resource/profile/images/${t.image})`:"var(--fc-logo-head)"}}]},{el:"span",className:"email col-6 my-auto",textContent:t.email},{el:"span",className:"alias col-3 my-auto",textContent:t.alias},{el:"button",className:"my-auto btn del-btn col-1 fas fa-trash-alt",onclick:function(){const e=this;confirmModal(t.alias+"님을 작업자에서 제외하시겠습니까?",function(){$.ajax({url:"/workbook/coworker/del",type:"POST",data:{workbookId:n,coworkerIdList:[t.memberId]},success:function(){$(e).closest(".coworker").remove(),alertModal(t.alias+"님을 작업자에서 제외했습니다.")},error:function(){alertModal("작업자 제외가 실패했습니다.")}})})}}]}}function c(t){var e=t.totalPages,o=t.number+1,t=10*(Math.ceil(o/10)-1)+1,a=10+t<=e?10+t-1:e,s=[];for(let e=t;e<=a;e++)s.push({el:"span",className:"page-item swiper-pagination-bullet"+(o==e?" swiper-pagination-bullet-active":""),"data-pagenum":e});return 10<t&&s.unshift({el:"span",className:"page-item",role:"button","data-pagenum":t-1,innerHTML:"&laquo;"}),a<e&&s.push({el:"span",className:"page-item",role:"button","data-pagenum":a+1,innerHTML:"&raquo;"}),s}e.observe(t),$(document).on("click",".js-view-passage",function(){var e=this.matches(".note-request-unit")?"?senQuery="+this.querySelector(".sentence-text").textContent:"",t=Number(this.closest(".passage").dataset.pid);sessionStorage.setItem("workbookCover",l?"https://static.findsvoc.com/images/app/workbook/bookcover/hellobook_cover.jpeg":o),sessionStorage.setItem("passageIdList",JSON.stringify(a)),$("#loadingModal").modal("show"),location.assign(`/workbook/passage/${ntoa(n)}/`+ntoa(t)+e)}),l?$(".js-add-passage-open").click(function(){location.assign("/workbook/mystack/add")}):($(".js-add-passage-open").click(function(){30<=a.length?$("#passageLimitModal").modal("show"):(sessionStorage.setItem("workbookCover",this.dataset.cover),sessionStorage.setItem("passageIdList",JSON.stringify(a)),location.assign("/workbook/passage/add/"+ntoa(n)))}),$(".js-add-passage-title").click(function(){30<=a.length?$("#passageLimitModal").modal("show"):location.assign("/workbook/passagetitle/batch/"+ntoa(n))}),$(document).on("click",".passage-title",function(){$(this).hide().siblings(".title-input,.title-edit-btn-section").show().closest(".passage-title-section").addClass("edit")}).on("click",".js-edit-ptitle",function(){const e=this.closest(".passage-title-section"),t=$(e).find(".title-input").val().trim();var o={passageId:this.closest(".passage").dataset.pid};0<t.length&&(o.passageTitle=t),editPassageTitle(o,()=>{alertModal("지문 제목이 수정되었습니다."),$(e).removeClass("edit"),$(e).find(".passage-title").text(t||"제목 없음").attr("title",t||"제목 없음").show(),$(e).find(".title-input,.title-edit-btn-section").hide()},()=>alertModal("지문 제목 수정 중 오류가 발생했습니다."))}).on("click",".js-cancel-ptitle",function(){var e=this.closest(".passage-title-section"),t=$(e).find(".passage-title").show();$(e).removeClass("edit"),$(e).find(".title-input").val(t.text()).hide(),$(e).find(".title-edit-btn-section").hide()}).on("click",".js-edit-passage",function(){var e=Number(this.closest(".passage").dataset.pid);sessionStorage.setItem("workbookId",n),sessionStorage.setItem("workbookCover",o),sessionStorage.setItem("passageIdList",JSON.stringify(a)),sessionStorage.setItem("editingPassageId",e),location.assign("/workbook/mybook/edit/passage/"+ntoa(e))}),$(document).on("click",".js-del-passage",function(){const e=$(this.closest(".passage"));var t=e.data("pid");const o=e.closest(".list-passage-section"),a=e.is(".sample");confirm("이 지문을 삭제하시겠습니까?")&&deletePassage({workbookId:n,passageId:t},function(){alertModal("지문이 삭제되었습니다."),a&&s--;o.masonry("remove",e).masonry("layout")})}).on("click",".js-toggle-sample",function(){const e=$(this.closest(".passage"));var t=e.data("pid"),o=e.is(".sample")?"이 지문을 샘플에서 제외하시겠습니까?":"이 지문을 샘플로 지정하시겠습니까?";const a=!e.is(".sample");a&&6==s?alertModal("한 워크북에 지정할 샘플 지문의 최대 갯수는 6개입니다."):confirm(o)&&(o={workbookId:n,passageId:t,sample:a},editPassageSample(o,function(){alertModal("지문 샘플정보를 변경했습니다."),s+=a?1:-1,e.toggleClass("sample")}))}),$(".open-add-coworker").on("click",function(){const t=$("#coworker-edit-modal .list-coworker-section");0==t.children().length&&$.getJSON("/workbook/coworker/list/"+ntoa(n),e=>{t.get(0).appendChild(createElement(Array.from(e,e=>r(e))))}).fail(()=>alertModal("공동 작업자 조회에 실패했습니다.")),$("#coworker-edit-modal").modal("show")}),$("#coworker-edit-modal").on("hidden.bs.modal",function(){$(this).find(".list-new-coworker-section").empty(),$(this).find(".add-coworker-btn").prop("disabled",!0)}),$(".check-coworker-btn").on("click",function(){const t=$("#coworker-email").get(0);0<t.value.length&&t.checkValidity()&&$.getJSON("/member/search",{email:btoa(t.value.trim())},e=>{t.value="",e?(e=createElement(r(e)),$(e).find(".del-btn").hide().before(createElement({el:"span",className:"col-1 my-auto fas fa-plus new-worker-symbol"})),$("#coworker-edit-modal .list-new-coworker-section").get(0).appendChild(e),$(".add-coworker-btn").prop("disabled",!1)):alertModal("존재하지 않은 회원입니다.")})}),$(".add-coworker-btn").on("click",function(){var e=Array.from($(".list-new-coworker-section").get(0).children,e=>e.dataset.mid);$.ajax({url:"/workbook/coworker/add",type:"POST",data:{workbookId:n,coworkerIdList:e},success:function(){alertModal("공동 작업자가 추가되었습니다."),$("#coworker-email").val(""),$(".add-coworker-btn").prop("disabled",!0),$(".list-new-coworker-section").children().each(function(){$(this).find(".del-btn").show(),$(this).find(".new-worker-symbol").remove()}),$(".list-coworker-section").append($(".list-new-coworker-section").children())},error:function(){alertModal("작업자 등록에 실패했습니다.")}})}),$(document).on("click",".feedback-list .page-item, .note-request-list .page-item",function(){const i=this.closest(".pagination-section").dataset.content;var e=ntoa(n),t=this.dataset.pagenum;$.getJSON(`/workbook/${i}/list/`+e,{pageNum:t},e=>{if("feedback"==i){return t=e,o=Array.from(t.content,e=>({el:"div",className:"feedback-unit row g-0",role:"button",title:"펼쳐보기/접기",children:[{el:"div",className:"col-8 col-xl-10 row g-0 m-auto",children:[{el:"span",className:"feedback-text text-truncate","data-org":e.content,textContent:e.content.replace(/\n.+/g,"")}]},{el:"div",className:"col-2 m-auto text-center",children:[{el:"span",className:"reg-date",textContent:new Date(e.regDate).format("yyyy-MM-dd")}]}]})),$(".feedback-list .feedback-unit").remove(),$(".feedback-list .pagination-section").before(createElement(o)),void $(".feedback-list .pagination-section .swiper-pagination").get(0).replaceChildren(createElement(c(t)));var t}else{var o=e;const a={H:"대기중",W:"작성중",D:"작성&lt;br&gt;완료",C:"취 소",S:"추 천"},s=Array.from(o.content,e=>({el:"div",className:"note-request-unit row g-0 js-view-passage passage status-"+e.progressStatus.toLowerCase(),role:"button","data-pid":e.passageId,"data-bs-toggle":"tooltip",title:"클릭시 노트를 신청한 지문 상세보기로 이동합니다.",children:[{el:"div",className:"col-2 col-xl-1 row g-0 m-auto",children:[{el:"div",className:"badge-block",children:[{el:"span",className:"status-text",innerHTML:a[e.progressStatus]}]}]},{el:"div",className:"col-8 col-xl-9 row g-0 m-auto",children:["S"==e.progressStatus?{el:"span",className:"suggest-text",children:["이 문장에 대해 ",{el:"span",className:"app-name-text",textContent:"fico"},"쌤 노트를 ",{el:"b",textContent:"신청"},"해 보면 어떨까요?"]}:"",{el:"span",className:"sentence-text text-truncate",textContent:e.sentence.eng}]},{el:"div",className:"col-2 m-auto text-center",children:[{el:"span",className:"reg-date",textContent:new Date(e.regDate).format("yyyy-MM-dd")}]}]}));$(".note-request-list .note-request-unit").remove(),$(".note-request-list .pagination-section").before(createElement(s)),$(".note-request-list .pagination-section .swiper-pagination").get(0).replaceChildren(createElement(c(o)))}})}).on("click",".feedback-unit",function(){var e=$(this).find(".feedback-text"),t=e.data("org"),o=t.replace(/[\r\n].+/g,"");e.css("white-space",$(this).is(".open")?"nowrap":"break-spaces"),e.text($(this).is(".open")?o+"...":t),$(this).toggleClass("open")}))}