function pageinit(l,c,d,i,D,r,e){const n=new FicoTTS({autoplay:!1,initSuccessCallback:()=>{document.querySelector("#ttsSettings .form-switch").remove()}}),m={el:"div",className:"svoc-section row position-relative",children:[{el:"div",className:"svoc-block col my-auto"},{el:"div",className:"svoc-mdf-btns btn-group px-2",children:[{el:"button","data-seq":"",className:"js-edit-svoc login-required btn text-bluegray-300 p-0 pe-1","data-toggle":"tooltip",title:"분석 수정",children:[{el:"span",className:"fas fa-marker"}]},{el:"button","data-seq":"",className:"js-del-svoc login-required btn text-bluegray-300 p-0 ps-1","data-toggle":"tooltip",title:"분석 삭제",children:[{el:"span",className:"fas fa-trash-alt"}]}]},{el:"div",className:"writer-section col-12 col-md-1 mt-2 mt-xl-0 btn","data-bs-toggle":"collapse",children:[{el:"div",className:"personacon-alias alias text-truncate"}]}]};var A={el:"div",className:"finger-section one-block js-finger-detail bg-gray-700",role:"button",children:[{el:"div",className:"sentence-text-block d-flex",children:[{el:"div",className:"rounded-icon my-auto me-2",tabIndex:"0","data-toggle":"tooltip",title:"문장을 누르면 해석·분석이 열립니다",children:[{el:"span",className:"btn rounded-pill toggle-eye my-auto disabled",children:[{el:"i",className:"far"}," 해석·분석"]}]},{el:"div",className:"fold-icon-section ms-auto my-auto d-block d-md-none",children:[{el:"span",className:"fold-icon text-3xl"}]},{el:"div",className:"sentence-text my-auto"},{el:"div",className:"fold-icon-section ms-auto my-auto d-none d-md-block",children:[{el:"span",className:"fold-icon text-3xl"}]}]},{el:"div",className:"svoc-block",style:"display: none;"},{el:"div",className:"trans-block mt-2",style:"display: none;"}]};const F={el:"div",className:"note-block one-block row g-0",children:[{el:"div",className:"note text-section",children:[{el:"div",className:"note-text",textContent:"노트 본문"},{el:"div",className:"note-editor",style:"display: none;",children:[{el:"textarea",className:"text-input col-12"},{el:"div",className:"form-check form-switch d-inline-block mx-1",children:[{el:"label",className:"form-check-label text-sm",role:"button",children:[{el:"input",type:"checkbox",className:"open-input form-check-input",checked:!0},"회원들과 노트를 공유합니다."]}]},{el:"button",type:"button",className:"btn p-0","data-bs-toggle":"modal","data-bs-target":"#note-modal",children:[{el:"span",className:"material-icons-outlined fs-6",textContent:"help_outline"}]},{el:"div",className:"note-edit-btns btn-group btn-set float-end mt-0 mt-sm-2",children:[{el:"button",type:"button",className:"js-edit-note-cancel btn btn-sm btn-outline-fico",textContent:"취소"},{el:"button",type:"button",className:"js-edit-note btn btn-sm btn-fico",textContent:"확인"}]}]}]},{el:"div",className:"col-12 personacon-section text-end mt-1 text-secondary fst-italic",children:["written by ",{el:"div",className:"personacon-alias alias d-inline fst-normal"}]},{el:"div",className:"col-auto ms-auto row mh-2rem",children:[{el:"div",className:"col-auto ms-auto me-1 note-mdf-btns btn-group",children:[{el:"button",type:"button",className:"js-edit-note-open login-required btn border-color-bluegray border-2 border-end-0 rounded-start py-0 pe-0 text-bluegray-300","data-toggle":"tooltip",title:"노트 수정",children:[{el:"span",className:"far fa-file-alt"},{el:"span",className:"fas fa-pen fa-xs",style:{left:"-8px",top:"5px",position:"relative"}}]},{el:"button",type:"button",className:"js-delete-note login-required btn border-color-bluegray border-2 rounded-end py-0 fas fa-trash-alt text-bluegray-300","data-toggle":"tooltip",title:"노트 삭제"}]},{el:"div",className:"updatedate col-auto ms-auto p-0 mt-1 text-secondary text-xs"}]}]},a={el:"div",className:"trans-mdf-btns",children:[{el:"button",type:"button",className:"js-edit-trans-open login-required btn btn-sm py-0 pe-0 pt-0","data-toggle":"tooltip",title:"해석 수정",children:[{el:"span",className:"material-icons fs-5",textContent:"edit"}]},{el:"button",type:"button",className:"js-del-trans login-required btn btn-sm py-0","data-toggle":"tooltip",title:"해석 삭제",children:[{el:"span",className:"material-icons fs-5",textContent:"delete"}]}]};const _={el:"div",className:"ailoading-icon position-relative overflow-hidden d-inline-block",style:{width:"50px",height:"50px"},children:[{el:"lottie-player",className:"position-absolute top-50 start-50 translate-middle",src:"https://assets1.lottiefiles.com/packages/lf20_iJX38w.json",background:"transparent",speed:"3",loop:!0,autoplay:!0,style:{width:"150px",height:"150px"}}]};document.querySelector("section").append(createElement([{el:"div",className:"note-modal-section modal",tabIndex:"-1",id:"note-modal",children:[{el:"div",className:"modal-dialog modal-dialog-centered",children:[{el:"div",className:"modal-content",children:[{el:"div",className:"modal-header",children:[{el:"h5",className:"modal-title col-10",textContent:"Note 공개/비공개"},{el:"button",type:"button",className:"btn-close","data-bs-dismiss":"modal",ariaLabel:"Close"}]},{el:"div",className:"modal-body",children:[{el:"p",children:["다른 회원들에게 작성한 노트를 ",{el:"b",textContent:"공개할지 여부"},"를 설정할 수 있습니다.",{el:"br"},{el:"b",textContent:"비공개"}," 노트는 ",{el:"b",textContent:"개인적인 메모"}," 등으로 활용할 수 있으며",{el:"br"},{el:"b",textContent:"공개"}," 노트는 ",{el:"b",textContent:"판매 목적"},"의 워크북에서 활용할 수 있습니다."]},{el:"p",children:["노트를 충분히 작성을 하면 ",{el:"b",textContent:"워크북의 품질"},"이 올라가게 되어 다른 회원들이 ",{el:"b",textContent:"구매할 확률"},"이 높아집니다."]}]}]}]}]},{el:"div",className:"check-modal-section modal fade",tabIndex:"-1",id:"check-modal",children:[{el:"div",className:"modal-dialog modal-dialog-centered",children:[{el:"div",className:"modal-content border-0",children:[{el:"div",className:"modal-header bg-fc-purple",children:[{el:"h5",className:"modal-title text-white col-10",textContent:"평가 감사합니다."},{el:"button",type:"button",className:"btn-close","data-bs-dismiss":"modal",ariaLabel:"Close"}]},{el:"div",className:"modal-body",children:[{el:"p"}]},{el:"div",className:"modal-footer justify-content-center",children:[{el:"button",type:"button",className:"btn btn-outline-fico","data-bs-dismiss":"modal",textContent:"취소"},{el:"button",type:"button",className:"btn btn-fico status-submit",textContent:"제출"}]}]}]}]}])),/Mobi/.test(navigator?.userAgent)&&screen.orientation||$(".js-rotate-btn").remove();var t=JSON.parse(sessionStorage.getItem("passageIdList")),s=sessionStorage.getItem("workbookCover"),o=$(".workbook-cover-section .workbook-cover .book-image");if(0<document.referrer.length)try{var p=new URL(document.referrer).pathname;$("#editPassageBtn").click(()=>{sessionStorage.setItem("workbookId",i),sessionStorage.setItem("editingPassageId",r),location.assign("/workbook/mybook/edit/passage/"+ntoa(r))}),p.includes("/workbook/passage/add")||p.includes("/workbook/passage/new")?($("#addPassageBtn, #editPassageBtn, #editWorkbookBtn").show(),t.includes(r)||(t.push(r),sessionStorage.setItem("passageIdList",JSON.stringify(t)))):p.includes("/workbook/mybook/edit")?($("#addPassageBtn").remove(),$("#editPassageBtn, #editWorkbookBtn").show()):$("#addPassageBtn, #editPassageBtn, #editWorkbookBtn").remove()}catch(e){$("#addPassageBtn, #editPassageBtn, #editWorkbookBtn").remove()}else $("#addPassageBtn, #editPassageBtn, #editWorkbookBtn").remove();if(null!=s&&/.+\.[A-Za-z]+$/.test(s)?o.css("background","url("+(-1<s.indexOf("https://")?s:"/resource/workbook/cover/"+s)+") center/cover no-repeat"):o.css("background","var(--fc-logo-head) center/cover no-repeat #121E34"),null!=t){if(0<t.indexOf(r)){const Z=t[t.indexOf(r)-1];$(".js-prev-passage").on("click",function(){$("#loadingModal").modal("show"),location.assign("/workbook/passage/"+ntoa(i)+"/"+ntoa(Z))})}else $(".js-prev-passage").remove();if(-1<t.indexOf(r)&&t.indexOf(r)<t.length-1){const K=t[t.indexOf(r)+1];$(".js-next-passage").on("click",function(){$("#loadingModal").modal("show"),location.assign("/workbook/passage/"+ntoa(i)+"/"+ntoa(K))})}else $(".js-next-passage").remove()}else $(".js-prev-passage,.js-next-passage").remove();$(".sentence-link").click(function(){$("#sentence"+this.dataset.sno+" .origin-sentence-section").trigger("click")}),$("#passageNotes, #passageQnas").on("show.bs.collapse",function(e){$(e.target).is(".qna-section,.note-section")&&($(this).siblings(".collapse").collapse("hide"),$(this).closest(".passage-comment-section").addClass("bg-fc-light-purple"))}).on("hide.bs.collapse",function(e){$(e.target).is(".qna-section,.note-section")&&0==$(this).siblings(".collapse.show").length&&$(this).closest(".passage-comment-section").removeClass("bg-fc-light-purple")}),$("#passageNotes").one("show.bs.collapse",function(){const t=$(this);t.is(".loading")||(t.addClass("loading"),$.getJSON("/workbook/passage/note/list/"+i+"/"+r+"/"+l,e=>{var n=e,s=t.find(".note-list").empty();0<n.length&&s.siblings(".empty-list").hide();for(let e=0,t=n.length;e<t;e++)O(n[e]).appendTo(s);t.removeClass("loading")}).fail(e=>alert("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$("#js-add-passage-note-btn").click(function(){const n=$(this).closest(".add-section"),s=n.find(".text-input");var e=s.val().trim(),t=n.find(":checkbox").is(":checked");0!=e.length&&addPassageNote({workbookId:i,passageId:r,memberId:l,content:e,publicOpen:t},function(e){e.memberInfo={memberId:l,alias:c};var t=n.closest(".note-section").find(".note-list").show(),e=O(e);e.prependTo(t),s.val(""),n.toggle(300,function(){$(this).siblings(".empty-list").hide(),n.closest(".note-section").find(".add-icon").prop("disabled",!1)})})}),$("#passageQnas").one("show.bs.collapse",function(){const e=$(this);e.is(".loading")||(e.addClass("loading"),$.getJSON(["/qnastack/question/workbook/passage",i,r].join("/"),function(n){0<n.length&&e.find(".empty-list").hide();var s=e.find(".qna-list").empty();for(let e=0,t=n.length;e<t;e++){var o=n[e],o=createQuestionDOM(o,!1);o.find(".accordion-collapse").attr("data-bs-parent","#passageQnas .qna-list"),s.append(o)}e.removeClass("loading")}).fail(e=>alert("질문 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$(".js-add-passage-qna-btn").click(function(){const n=$(this).closest(".add-section"),s=n.find(".text-input");var e=n.find(".q-title").val().trim(),t=s.val().trim();0!=t.length&&addQuestion("workbook",{targetId:r,title:e,content:t,qtype:"P",workbookId:i,passageId:r,questionerId:l,priorityId:D},function(e){var t=n.closest(".qna-section").find(".qna-list").show(),e=createQuestionDOM(e,!0);e.find(".accordion-collapse").attr("data-bs-parent","#passageQnas .qna-list"),t.prepend(e),s.val("").summernote("destroy"),n.hide(300,function(){var e=n.closest(".qna-section");e.find(".add-icon").prop("disabled",!1),e.find(".empty-list").hide()})})});var J=$(".result-section"),u=$(".one-sentence-unit-section").clone();let b=u.find(".ai-translation-block");var Q=u.find(".one-word-unit-section"),W=u.find(".one-part-unit-section"),R=e.length;for(let o=0;o<R;o++){const P=e[o];let t;0<o?(t=u.clone(),J.append(t)):t=$(".one-sentence-unit-section:eq(0)"),t.data("sentenceId",P.sentenceId).attr("id","sentence"+(o+1)).data("metaEvaluated",["S","F"].includes(P.metaStatus));t.find(".origin-sentence-section").get(0);t.on("click",".origin-sentence-section",function(e){e.target.matches(".js-tts-play,.js-tts-setting")||t.children(".collapse").collapse("toggle")}),t.find('[role="tab"]').each(function(){var e=this.dataset.type;this.dataset.bsTarget="#sentence"+(o+1)+" ."+e+"-section";const t=new bootstrap.Tab(this),n=$(this),s=$(this.dataset.bsTarget);n.on("click",e=>{e.preventDefault(),n.is(".active")?s.collapse("hide"):t.show()}).one("shown.bs.tab",function(){s.find(".ailoading").prepend(createElement(_)),setTimeout(()=>{s.find(".ailoading").remove(),s.find(".afterload").fadeIn(300)},1e3)}).on("shown.bs.tab",function(e){s.collapse("show")}).on("hidden.bs.tab",function(){s.removeClass("show")}),s.on("hidden.bs.collapse",function(e){e.target==s.get(0)&&(s.removeClass("active"),n.removeClass("active").attr("aria-selected",!1).blur())})}),t.find(".origin-sentence").append(createElement([{el:"span",className:"numbering-text print-removed",textContent:o+1},{el:"span",className:"sentence-text",textContent:P.text},{el:"div",className:"d-inline-block",children:[{el:"button",type:"button",className:"btn text-fc-purple ms-2 p-0 material-icons-outlined border-0 fs-3 js-tts-play","data-bs-toggle":"tooltip",title:"재생/중지","data-active":"on",textContent:"play_circle"},{el:"button",id:"ttsSetting",class:"btn d-inline w-auto text-fc-purple m-0 p-0 ps-2 material-icons-outlined fs-3 border-0 shadow-none bg-transparent js-tts-setting","data-bs-toggle":"tooltip",title:"음성 설정",textContent:"tune"}]}]));const Y=P.text,E=P.svocList,M=E?.length;t.find(".js-collapse-svoc").toggle(1<M);for(let s=0;s<M;s++){let n=E[s];const L=$(createElement(m));L.appendTo(t.find(".result-semantic-section")),tandem.showSemanticAnalysis(Y,n.svocBytes,L.find(".svoc-block")).then(e=>{$(e).data("svocId",n.svocId).data("memberId",n.memberId),L.find(".writer-section").attr("data-bs-target",`#sentence${o+1} .dashboard-section`).find(".personacon-alias").text(n.writerAlias);var t=L.find(".svoc-mdf-btns"),t=(t.find("[data-seq]").attr("data-seq",e.dataset.seq),l!=n.memberId&&t.remove(),$("#hiddenDivs .member-personacon").clone(!0));n.image&&(t.find(".personacon-profile").removeClass("profile-default")[0].style.background="url(/resource/profile/images/"+n.image+") center/cover no-repeat"),L.find(".writer-section").prepend(t),null!=window.tandem&&null!=tandem.meta&&s+1==M&&null!=P.metaStatus&&"N"==P.metaStatus&&tandem.meta.saveGramMetaFromDOM(P.sentenceId,e,!1,"workbook")})}t.find(".dashboard-section .meta-status").text({S:"🥳",F:"🤯"}[P.metaStatus]||"🤔").attr("title",{S:"평가를 받은 문장이예요.",F:"분석이 틀렸대요."}[P.metaStatus]||"아직 평가되지 않은 문장이예요.");var f=P.korList;if(null!=f&&0<f.length){var G=f.length,h=t.find(".ai-translation-section").show().empty();for(let e=0;e<G;e++){var g=b.clone(),v=f[e];h.append(g),g.data("korTid",v.korId),"Translator"!=v.alias&&g.find(".translator").text("by "+v.alias),g.find(".translation-text").text(v.kor),l==v.memberId&&g.append(createElement(a))}h.find(".ai-translation-block").first().collapse("show")}var k=P.wordList;if(null!=k&&0<k.length){var H=k.length,x=t.find(".word-section").empty();x.parent().prepend('<div class="title-section position-relative"><span class="sub-title">문장에서 등장하는 단어를 fico가 대신 검색하여 제공해 드립니다.</span></div>');for(let e=0;e<H;e++){var y=k[e],w=Q.clone(),N=(w.find(".one-part-unit-section").remove(),x.append(w),w.find(".title").text(y.title),y.senseList);if(null!=N){var X=N.length;for(let e=0;e<X;e++){var I=N[e];$partBlock=W.clone(),w.append($partBlock),$partBlock.find(".part").text(I.partType),$partBlock.find(".meaning").text(I.meaning)}}}}var C=P.fingerList;if(null!=C&&0<C.length){var S=t.find(".related-list").empty(),z=C.length;S.append(createElement({el:"div",className:"title-section position-relative",children:[{el:"span",className:"sub-title",textContent:"현재 문장과 유사한 구조를 가지거나 보충 학습할 수 있는 예문들을 추천합니다."}]}));for(let e=0;e<z;e++){var j=C[e],q=$(createElement(A));S.append(q),q.data("sentenceId",j.sentenceId).find(".sentence-text").text(j.eng)}}}$("#loadingModal").on("hidden.bs.modal",function(){$(".full-text").show(),$(".result-semantic-section .svoc-section:not(:first-child)").addClass("collapse"),$(".one-sentence-unit-section .removable-section").addClass("collapse")}),setTimeout(()=>$("#loadingModal").modal("hide"),2e3),$(document).on("show.bs.collapse hide.bs.collapse",".one-sentence-unit-section>.collapse",function(e){var t;e.target==e.currentTarget&&((t=$(this).closest(".one-sentence-unit-section")).toggleClass("active","show"==e.type).find(".origin-sentence-section").attr("aria-expanded","show"==e.type),"show"==e.type&&t[0].scrollIntoView())}).on("click",".js-tts-play",function(e){var t="on"==this.dataset.active;document.querySelectorAll(".js-tts-play").forEach(e=>{e.dataset.active="on",e.textContent="play_circle"}),this.dataset.active=t?"off":"on",this.textContent=t?"stop_circle":"play_circle",t?n.speakRepeat(this.closest(".origin-sentence").querySelector(".sentence-text").textContent,2,500,()=>{this.dataset.active="on",this.textContent="play_circle"}):n.stop()}).on("click",".js-tts-setting",function(e){n.stop(),document.querySelectorAll(".js-tts-play").forEach(e=>{e.dataset.active="on",e.textContent="play_circle"}),n.openSettings()}).on("shown.bs.collapse",".one-sentence-unit-section>.collapse",function(e){e.target.matches(".removable-section")&&e.target==e.currentTarget&&($(e.target).find(".semantics-result").filter(":visible").each(function(){tandem.correctMarkLine(this)}),$(this).closest(".one-sentence-unit-section").data("metaEvaluated")||$(e.target).find(".dashboard-section").collapse("show"))}),$(document).on("show.bs.collapse",".dashboard-section",function(){$(this).prev(".result-semantic-section").addClass("border-bottom-0"),$(this).find(".tip-content-section").hide(0,function(){var e=$(this).closest(".one-sentence-unit-section").find(".origin-sentence .sentence-text").text();$(this).html(tandem?.tip?.showRandomTip(e.match(/['"]/)?5:void 0)).fadeIn()})}).on("hidden.bs.collapse",".dashboard-section",function(){$(this).prev(".result-semantic-section").removeClass("border-bottom-0")}),$(document).on("click",".open-kor-btn,.ai-translation-block .translation-text",function(){var e=$(this).closest(".translation-section"),t=e.find(".ai-translation-block:not(:first)"),e=e.find(".open-kor-btn");t.collapse(e.is(".active")?"hide":"show"),e.find(".fold-icon").toggleClass("expanded",!e.is(".active")),e.toggleClass("active")}),$(".js-collapse-svoc").click(function(){$(this).closest(".one-sentence-unit-section").find(".result-semantic-section .collapse").collapse("toggle"),$(this).toggleClass("expanded")});const U={S:"<b>평가를 하는 이유</b><br><br>A.I.는 인간의 언어를 이해하면서 분석하지 않습니다.<br>학습자들에게 도움이 될 수 있도록 분석 결과를 평가해주세요.<br>평가도 하고 다양한 fico Egg도 모아보세요.",F:"<b>AI 분석이 정확하지 않은가요?</b><br><br>그건 회원님이 AI보다 실력이 좋다는 증거입니다.<br>직접 수정할 수도 있고 그냥 내버려 둘 수도 있습니다.<br>실력 발휘 기대합니다."},T={S:{icon:"🥳",status:"S",tooltip:"평가를 받은 문장이예요."},F:{icon:"🤯",status:"F",tooltip:"분석이 틀렸대요."}};function V(t,n){let s=!1;t.closest(".dashboard-section").find(".edit-meta-status-btn[data-meta-status]").each(function(){var e;this.disabled||(e=$(this).prop("disabled",!0).wrap('<span data-bs-original-title="이미 평가한 문장입니다."></span>').parent()[0],new bootstrap.Tooltip(e,{trigger:"hover focus"}).enable(),e.querySelector(".material-icons").className="material-icons text-gray-400")});const e=t.next();e.popover("show"),setTimeout(()=>e.popover("dispose"),3e3),anime({targets:t[0],rotateX:360,scale:[{value:3,duration:500,easing:"easeOutBack"},{value:1,duration:2500,easing:"easeInBounce"}],delay:300,duration:3e3,update:function(e){!s&&20<e.progress&&(t.text(n.icon).attr("data-bs-original-title",n.tooltip),s=!0)},complete:function(){t[0].style.transform=""}})}$("#check-modal").on("show.bs.modal",function(){var e=event.target.closest("button"),t=this.querySelector(".status-submit"),n=e.dataset.metaStatus;t.dataset.metaStatus=n,this.querySelector(".modal-body").innerHTML=U[n],$(t).data("sentenceSection",$(e.closest(".one-sentence-unit-section")))}),$("#check-modal .status-submit").on("click",function(){var e=$(this).data("sentenceSection");const t=this.dataset.metaStatus,n=e.find(".dashboard-section .meta-status");tandem?.meta?.submitMetaStatus(e.data("sentenceId"),t,"workbook",()=>{V(n,T[t])}),$("#check-modal").modal("hide")}),$(document).on("click",".js-add-svoc, .js-edit-svoc",async function(){let t=$(this).is(".js-add-svoc");$(".js-add-svoc").prop("disabled",!0);const n=$(this).closest(".one-sentence-unit-section");let s=null;var e,o,a;function i(e){t&&null!=e&&(s.closest(".new-svoc-form").removeClass("new-svoc-form"),s.data("svocId",e),n.find(".js-collapse-svoc").addClass("expanded").show(),s.closest(".svoc-section").nextAll(".svoc-section").collapse("show")),s.closest(".svoc-section").find(".svoc-mdf-btns").show()}t?((e=$(createElement(m)).addClass("new-svoc-form")).find(".personacon-alias").text(c),o=$("#hiddenDivs .member-personacon").clone(!0),d&&(o.find(".personacon-profile").removeClass("profile-default")[0].style.background="url(/resource/profile/images/"+d+") center/cover no-repeat"),e.find(".writer-section").attr("data-bs-target",n.find(".writer-section").get(0).dataset.bsTarget).prepend(o),o=n.find(".origin-sentence .sentence-text").text(),a=await tandem.getSvocBytes(n.find(".semantics-result").get(0)),n.find(".result-semantic-section").prepend(e),(s=$(await tandem.showSemanticAnalysis(o,a,e.find(".svoc-block")))).data("memberId",l),e.find(".svoc-mdf-btns").hide().find("[data-seq]").attr("data-seq",s.attr("data-seq"))):(s=$('.semantics-result[data-seq="'+this.dataset.seq+'"]'),$(this).closest(".svoc-mdf-btns").hide()),s.svoceditor(t,function(e){var t=Number(s.closest(".one-sentence-unit-section").data("sentenceId")),n=Number(s.data("svocId")||0),e={sentenceId:t,memberId:l,encSvocText:e};l==Number(s.data("memberId"))&&0<n&&(e.svocId=n);editSvoc(e,i),window.tandem?.meta?.saveGramMetaFromDOM(t,s[0],!0,"workbook"),V(s.closest(".one-sentence-unit-section").find(".meta-status"),T.S)},function(){$(".js-add-svoc").prop("disabled",!1),t?s.closest(".new-svoc-form").remove():s.closest(".svoc-section").find(".svoc-mdf-btns").show()}),setTimeout(()=>{tandem.correctMarkLine(s[0])},500)}).on("click",".js-del-svoc",function(){const e=$('.semantics-result[data-seq="'+this.dataset.seq+'"]'),t=e.closest(".one-sentence-unit-section");var n=Number(e.data("svocId"));confirm("삭제하시겠습니까?")&&delSvoc(n,function(){e.closest(".svoc-section").fadeOut(()=>{e.closest(".svoc-section").remove(),t.find(".svoc-section").length<2&&t.find(".js-collapse-svoc").hide(),t.find(".svoc-section:first-child").removeClass("collapse show"),t.find(".svoc-section:not(:first-child)").addClass("collapse")})})});const B=$(createElement({el:"div",className:"trans-editor mt-2",children:[{el:"textarea",className:"text-input form-control",placeholder:"나의 해석을 직접 등록할 수 있습니다."},{el:"div",className:"trans-edit-btns btn-group my-2",children:[{el:"button",type:"button",className:"js-edit-trans-cancel btn btn-sm btn-outline-fico",textContent:"취소"},{el:"button",type:"button",className:"js-edit-trans login-required btn btn-sm btn-fico",textContent:"확인"}]}]}));function O(e){var t,n=createElement(F);return n.dataset.noteId=e.noteId,n.querySelector(".note-text").innerHTML=e.content,n.querySelector(".updatedate").textContent=new Date(e.updateDate||new Date).toLocaleDateString(),l!=e?.memberInfo?.memberId?n.querySelector(".note-mdf-btns").remove():((t=n.querySelector(".note-editor .open-input")).checked=e.publicOpen,$(t).trigger("input")),n.querySelector(".personacon-section .alias").textContent=e?.memberInfo?.alias,$(n)}$(document).on("click",".js-edit-trans-open",function(){B.hide();var e=$(this).closest(".ai-translation-block");this.matches(".add-btn")?($(this).hide(),B.data("mode","add").find(".text-input").val(null),$(this).closest(".translation-section").find(".ai-translation-section").prepend(B)):(e.find(".trans-mdf-btns, .translation-text").hide(),B.data("mode","edit").find(".text-input").val(e.find(".translation-text").text()),e.before(B)),B.show(300)}).on("click",".js-edit-trans",function(){const n=B.next(".ai-translation-block"),e=Number($(this).closest(".one-sentence-unit-section").data("sentenceId")),s=B.find(".text-input").val().trim(),o=$(this).closest(".translation-section");var t={sentenceId:e,memberId:l,kor:s};"edit"==B.data("mode")&&null!=n.data("korTid")&&(t.korTid=Number(n.data("korTid"))),0!=s.length&&editSentenceTrans(t,function(e){{var t;B.hide(300,()=>B.appendTo("#hiddenDivs")),"edit"==B.data("mode")?(n.find(".translation-text").text(s).show(300),n.find(".trans-mdf-btns").show(300)):((t=b.clone()).data("korTid",e).find(".translation-text").text(s),t.find(".translator").text("by "+c),t.append(createElement(a)),o.find(".ai-translation-section").prepend(t),o.children(".add-btn").show(300),t.addClass("show"),o.find(".open-kor-btn").is(".active")||t.siblings(".ai-translation-block").removeClass("show"))}})}).on("click",".js-edit-trans-cancel",function(){B.fadeOut(300,()=>B.appendTo("#hiddenDivs")),("edit"==B.data("mode")?B.next(".ai-translation-block").find(".trans-mdf-btns, .translation-text"):B.closest(".translation-section").children(".add-btn")).show(300)}).on("click",".js-del-trans",function(){event.stopPropagation(),event.stopImmediatePropagation();const e=$(this).closest(".ai-translation-block");confirm("삭제하겠습니까?")&&delSentenceTrans(Number(e.data("korTid")),function(){alert("삭제되었습니다."),(e.closest(".translation-section").find(".open-kor-btn").is(".active")?e.nextAll(".ai-translation-block"):e.next(".ai-translation-block"))?.collapse("show");e.fadeOut(300,()=>e.remove())})}).on("click",".js-finger-detail",async function(){const t=$(this),n=t.find(".toggle-eye");var e=t.data("sentenceId");n.is(".loading")||(n.is(".loaded")?(t.toggleClass("bg-gray-700").find(".fold-icon").toggleClass("expanded",!n.is(".active")),n.toggleClass("active disabled"),t.find(".sentence-text, .trans-block, .svoc-block").toggle(300)):(n.addClass("loading"),await $.getJSON("/workbook/sentence/finger/"+e,e=>async function(e){t.find(".sentence-text").hide(),await tandem.showSemanticAnalysis(e.eng,e.svocBytes,t.find(".svoc-block").show()),t.removeClass("bg-gray-700").find(".trans-block").text(e.kor).show(),t.find(".fold-icon").addClass("expanded"),n.toggleClass("disabled active loading loaded")}(e)).fail(e=>alert("해석·분석 가져오기에 실패했습니다.\n다시 접속해 주세요."))))}).on("show.bs.tab",".one-sentence-unit-section .nav-link[data-type=note]",async function(){const t=$(this);var e=$(this).closest(".one-sentence-unit-section").data("sentenceId");const o=$(this.dataset.bsTarget);$(this).is(".loading,.loaded")||($(this).addClass("loading"),o.find(".empty-list").show(),await $.getJSON("/workbook/sentence/note/list/"+i+"/"+e+"/"+l,e=>{var n=e,s=(0<n.length&&o.find(".empty-list").hide(),o.find(".note-list").empty());for(let e=0,t=n.length;e<t;e++)O(n[e]).appendTo(s);t.toggleClass("loading loaded")}).fail(e=>alert("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}).on("click",".js-add-sentence-note-btn",function(){const n=$(this).closest(".one-sentence-unit-section");var e=Number(n.data("sentenceId"));const s=$(this).closest(".add-section");var t=s.find(".text-input").val().trim(),o=s.find(":checkbox").is(":checked");0!=t.length&&addSentenceNote({workbookId:i,sentenceId:e,memberId:l,content:t,publicOpen:o},function(e){e.memberInfo={memberId:l,alias:c};var t=n.find(".note-section>.note-list"),e=O(e);e.prependTo(t),s.find(".text-input").val("").summernote("destroy"),s.hide(300,function(){var e=s.closest(".note-section");e.find(".add-icon").prop("disabled",!1),e.find(".empty-list").hide()})})}).on("click",".js-edit-note-open",async function(){var e=$(this).closest(".note-block"),t=e.find(".text-section"),e=(e.find(".note-mdf-btns").hide(),t.find(".note-text").hide()),e=t.find(".note-editor").show().find(".text-input").val(e.html());t.find(".open-input").trigger("input"),openSummernote(e)}).on("click",".js-edit-note-cancel",function(){var e=$(this).closest(".text-section"),t=$(this).closest(".note-block");e.find(".note-editor, .note-text").add(t.find(".note-mdf-btns")).toggle()}).on("click",".js-edit-note",function(){const t=$(this).closest(".text-section"),n=$(this).closest(".note-block");var e=Number(n.data("noteId")),s=t.find(".open-input").is(":checked"),o=t.find(".text-input").val().trim(),e={noteId:e,workbookId:i,memberId:l,content:o,publicOpen:s},s=t.closest(".one-sentence-unit-section"),a=0<s.length?"sentence":"passage";0!=o.length&&(0<s.length?e.sentenceId=Number(s.data("sentenceId")):e.passageId=r,editNote(a,e,function(e){t.find(".note-editor").hide(),t.find(".open-input").prop("checked",e.publicOpen),t.find(".note-text").html(e.content).show(),n.find(".updatedate").text((new Date).toLocaleDateString()),n.find(".note-mdf-btns, .updatedate").show()}))}).on("click",".js-delete-note",function(){if(confirm("삭제하시겠습니까?")){const e=$(this).closest(".note-block"),t=e.closest(".note-section"),n=Number(e.data("noteId")),s=e.closest(".one-sentence-unit-section"),o=0<s.length?"sentence":"passage";delNote(o,n,function(){e.fadeOut(function(){$(this).remove(),0==t.find(".note-block").length&&t.find(".empty-list").show()})})}}).on("click",".note-section .add-icon",async function(){$(this).prop("disabled",!0);const e=$(this).closest(".note-section");var t=e.find(".add-section");openSummernote(t.find(".text-input")),t.show(300,function(){e.find(".empty-list").hide()})}).on("input",".open-input",function(){this.nextSibling.data=this.checked?"회원들과 노트를 공유합니다.":"노트를 비공개로 보관합니다."}).on("click",".cancel-add-note-btn",function(){const t=$(this).closest(".add-section");var e=t.find(".text-input").val("");"function"==typeof e.summernote&&e.summernote("destroy"),t.hide(300,function(){var e=t.closest(".note-section");e.find(".add-icon").prop("disabled",!1),0==e.find(".note-list .note-block").length&&e.find(".empty-list").show()})}).on("show.bs.tab","[role=tab][data-type=craft]",function(e){var t=$(this).closest(".one-sentence-unit-section"),n=(t.find(".dashboard-section").collapse("hide"),Array.from(t.find(".ai-translation-block"),e=>({id:$(e).data("korTid"),text:e.querySelector(".translation-text").textContent})));null==document.querySelector(this.dataset.bsTarget).querySelector(".battle-section-panel")&&craft.openBattleMakerPanel(document.querySelector(this.dataset.bsTarget),l,t.data("sentenceId"),t.find(".semantics-result")[0],n)})}const sleep=t=>new Promise(e=>setTimeout(e,t));