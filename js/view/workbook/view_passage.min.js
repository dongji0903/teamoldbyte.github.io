async function pageinit(d,r,p,i,u,E,D,f,e){const z=parseFloat(getComputedStyle(document.documentElement).fontSize),v=new FicoTTS({initSuccessCallback:()=>{devSize.isPhone()||document.querySelector("#ttsSettings .form-switch").remove()}}),m=await $.get("https://static.findsvoc.com/fragment/workbook/element_templates.min.html",jQuery.noop,"html"),a={"n.":"명사","v.":"동사","vt.":"타동사","vi.":"자동사","a.":"형용사","ad.":"부사","prep.":"전치사","conj.":"접속사","int.":"감탄사","NP.":"명사구","phrasal-v.":"구동사","VP.":"동사구","PP.":"전치사구","ADP.":"부사구","AJP.":"형용사구"};$(window).on("unload",()=>$("#loadingModal").modal("hide")),$(".workbook-menu-section").find(".logo-link-section").addClass("glass-effect"),/Mobi/.test(navigator?.userAgent)&&screen.orientation||$(".js-rotate-btn").remove();var t=JSON.parse(sessionStorage.getItem("passageIdList"));if(0<document.referrer.length)try{var n=new URL(document.referrer).pathname;n.includes("/workbook/passage/add")||n.includes("/workbook/passage/new")?(t.includes(f)||(t.push(f),sessionStorage.setItem("passageIdList",JSON.stringify(t))),30<=t.length&&$("#addPassageBtn").remove()):(n.includes("/workbook/mybook/edit")||n.includes("/workbook/passage/sentence/add"))&&$("#addPassageBtn").remove()}catch(e){$("#addPassageBtn").remove()}else $("#addPassageBtn").remove();if(null!=t){if(0<t.indexOf(f)){const ne=t[t.indexOf(f)-1];$(".js-prev-passage").on("click",function(){$("#loadingModal").modal("show"),location.assign("/workbook/passage/"+ntoa(u)+"/"+ntoa(ne))})}else $(".js-prev-passage").remove();if(-1<t.indexOf(f)&&t.indexOf(f)<t.length-1){const se=t[t.indexOf(f)+1];$(".js-next-passage").on("click",function(){$("#loadingModal").modal("show"),location.assign("/workbook/passage/"+ntoa(u)+"/"+ntoa(se))})}else $(".js-next-passage").remove()}else $(".js-prev-passage,.js-next-passage").remove();$(".sentence-link").click(function(){$("#sentence"+this.dataset.sno+" .origin-sentence-section").trigger("click")}),$(".passage-title-block").on("click",".display-block",function(){var e;0<$(this).siblings(".edit-block").length&&(e=$(this).is(".show"),$(".passage-title-block .edit-block").collapse(e?"show":"hide"),$(".passage-title-block .display-block").collapse(e?"hide":"show"),e)&&$(".passage-title-block .title-input:visible")[0].focus()}).on("click",".js-edit-ptitle",function(){const e=this.closest(".passage-title-block"),t=$(e).find(".title-input").val().trim();var n={passageId:f};0<t.length&&(n.passageTitle=t),editPassageTitle(n,()=>{alertModal("지문 제목이 수정되었습니다."),$(e).find(".edit-block").collapse("hide"),$(".passage-title-block .display-block").collapse("show").find(".passage-title-text").text(t||"제목 없음"),$(".title-input").val(t||"")},()=>alertModal("지문 제목 수정 중 오류가 발생했습니다."))}).on("click",".js-cancel-ptitle",function(){var e=$(".passage-title-text").text();$(".passage-title-block .edit-block").collapse("hide").find(".title-input").val(e),$(".passage-title-block .display-block").collapse("show")}),$("#passageNotes, #passageQnas").on("show.bs.collapse",function(e){$(e.target).is(".qna-section,.note-section")&&($(this).siblings(".collapse").collapse("hide"),$(this).closest(".passage-comment-section").addClass("bg-fc-light-purple"))}).on("hide.bs.collapse",function(e){$(e.target).is(".qna-section,.note-section")&&0==$(this).siblings(".collapse.show").length&&$(this).closest(".passage-comment-section").removeClass("bg-fc-light-purple")}),$("#passageNotes,#passageNotes_mobile").one("show.bs.collapse",function(){const t=$(this);t.is(".loading")||(t.addClass("loading"),$.getJSON(`/workbook/passage/note/list/${u}/${f}/`+d,e=>{var n=e,s=t.find(".note-list").empty();0<n.length&&s.siblings(".empty-list").hide();for(let e=0,t=n.length;e<t;e++)V(n[e]).appendTo(s);t.removeClass("loading")}).fail(()=>alertModal("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$(".js-add-passage-note-btn").click(function(){const n=$(this).closest(".add-section"),s=n.find(".text-input");var e=s.val().trim(),t=JSON.parse(n.find(".note-open-input").val());0!=e.length&&addPassageNote({workbookId:u,passageId:f,memberId:d,content:e,publicOpen:t},function(e){e.memberInfo={memberId:d,alias:r};var e=V(e),t=n.closest(".note-section").find(".note-list").show();e.prependTo(t),s.val(""),n.toggle(300,function(){$(this).siblings(".empty-list").hide(),n.closest(".note-section").find(".add-icon").prop("disabled",!1)})})}),$("#passageQnas").one("show.bs.collapse",function(){const e=$(this);e.is(".loading")||(e.addClass("loading"),$.getJSON(["/qnastack/question/workbook/passage",u,f].join("/"),function(n){0<n.length&&e.find(".empty-list").hide();var s=e.find(".qna-list").empty();for(let e=0,t=n.length;e<t;e++){var o=n[e],o=createQuestionDOM(o,!1);o.find(".accordion-collapse").attr("data-bs-parent","#passageQnas .qna-list"),s.append(o)}e.removeClass("loading")}).fail(()=>alertModal("질문 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$(".js-add-passage-qna-btn").click(function(){const n=$(this).closest(".add-section"),s=n.find(".text-input");var e=n.find(".q-title").val().trim(),t=s.val().trim();0!=t.length&&addQuestion("workbook",{targetId:f,title:e,content:t,qtype:"P",workbookId:u,passageId:f,questionerId:d,priorityId:D},function(e){var t=n.closest(".qna-section").find(".qna-list").show(),e=createQuestionDOM(e,!0);e.find(".accordion-collapse").attr("data-bs-parent","#passageQnas .qna-list"),t.prepend(e),s.val("").summernote("destroy"),n.hide(300,function(){var e=n.closest(".qna-section");e.find(".add-icon").prop("disabled",!1),e.find(".empty-list").hide()})})});let B=$(".result-section");var s=$(".one-sentence-unit-section").clone();let J=s.find(".ai-translation-block:eq(0)"),F=s.find(".one-word-unit-section:eq(0)"),b=s.find(".one-part-unit-section:eq(0)");const l=e.length;0==l&&$("#loadingModal").modal("hide");for(let o=0;o<l;o++){const q=e[o];let t;0<o?(t=s.clone(),B.append(t)):t=$(".one-sentence-unit-section:eq(0)"),t.data("sentenceId",q.sentenceId).attr("id","sentence"+(o+1)).data("metaEvaluated",["S","F"].includes(q.metaStatus)).find(".origin-sentence-section"),t.on("click",".origin-sentence-section",function(e){e.target.closest('[class*="js-tts"]')||t.children(".collapse").collapse("toggle")}),t.find(".collapse-btn").each(function(){this.dataset.bsTarget=`#sentence${o+1} `+this.dataset.collapseSelector}),t.find(".origin-sentence").append($(m).children(".origin-sentence-container").clone(!0).children()).find(".numbering-text").text(o+1).next(".sentence-text").text(q.text);const oe=q.text,O=q.svocList,N=O?.length;t.find(".js-collapse-svoc").toggle(1<N),t.find(".result-semantic-section").append($(m).children(".svoc-menu-section").clone(!0)).find(".js-open-dashboard").attr("data-bs-target",`#sentence${o+1} .dashboard-section`);for(let s=0;s<N;s++){let n=O[s];const P=$(m).children(".svoc-section").clone(!0);P.appendTo(t.find(".result-semantic-section")),tandem.showSemanticAnalysis(oe,n.svocBytes,P.find(".svoc-block")).then(e=>{$(e).data("svocId",n.svocId).data("memberId",n.memberId),P.find(".writer-section").find(".personacon-alias").text(n.writerAlias),P.find(".writer-section").attr("data-bs-target",`#sentence${o+1} .dashboard-section`);var t=P.find(".svoc-mdf-btns"),t=(t.find("[data-seq]").attr("data-seq",e.dataset.seq),d!=n.memberId&&t.remove(),$("#hiddenDivs .member-personacon").clone(!0));n.image&&(t.find(".personacon-profile").removeClass("profile-default")[0].style.background="url(/resource/profile/images/"+n.image+") center/cover no-repeat"),P.find(".writer-section").prepend(t),null!=d&&0<d&&null!=window.tandem&&null!=tandem.meta&&s+1==N&&null!=q.metaStatus&&"N"==q.metaStatus&&tandem.meta.saveGramMetaFromDOM(q.sentenceId,e,!1,"workbook"),0<s&&$(e).closest(".svoc-section").addClass("collapse"),s+1==N&&o+1==l&&$("#loadingModal").modal("hide")})}t.find(".dashboard-section .meta-status").text({S:"🥳",F:"🤯"}[q.metaStatus]||"🤔").attr("title",{S:"평가를 받은 문장이예요.",F:"분석이 틀렸대요."}[q.metaStatus]||"아직 평가되지 않은 문장이예요.");var c=q.korList;if(null!=c&&0<c.length){var R=c.length,h=t.find(".ai-translation-section").show().empty();for(let e=0;e<R;e++){var g=J.clone(),k=c[e];g.data("korTid",k.korId),"Translator"!=k.alias?g.addClass("user-trans").find(".translator").text(" "+k.alias):g.addClass("ai-trans"),g.find(".translation-text").text(k.kor),d==k.memberId&&g.append($(m).find(".trans-mdf-btns").clone(!0)),h.append(g)}h.closest(".translation-section").find(".open-kor-btn").addClass("active"),h.find(".ai-translation-block").collapse("show")}var w=q.wordList;if(null!=w&&0<w.length){var H=w.length,Q=t.find(".collapse-section .word-section, .sentence-ext-section .word-section .one-block").empty();for(let e=0;e<H;e++){const L=w[e],A=F.clone();A.data({wordId:L.wid,sentenceId:q.sentenceId,workbookId:u}),A.find(".one-part-unit-section").remove(),A.find(".title").text(L.title).attr("data-playing","off").click(function(e){e.stopPropagation(),"on"==this.dataset.playing?M():(M(this),this.dataset.playing="on",this.classList.add("tts-playing","blink-2"),v.speakRepeat(L.title,2,500,()=>{this.classList.remove("tts-playing","blink-2"),this.dataset.playing="off"}))});var y=L.senseList;if(null!=y){var _=y.length;for(let e=0;e<_;e++){var U=y[e],x=b.clone();A.append(x),x.find(".part").text(U.partType),x.find(".meaning").text(U.meaning)}Q.append(A)}}devSize.isPhone()||t.find('.nav-link[data-type="word-list"]').tab("show")}}let Y=0,K=$(".view-passage-section")[0].scrollTop;const G=$(".workbook-menu-section");$(document).on("scroll",function(){var e=scrollY>K?1:-1;K=scrollY,Y==e||$("#js-mobile-menu .passage-sentence-nav").is(".show")||(Y=e,anime({targets:"#js-mobile-menu",easing:"linear",duration:200,translateY:0<e?"100%":0}))});let X,o;const I=new Swiper(".swiper",{breakpoints:{576:{enabled:!1}},autoHeight:!0,speed:250,navigation:{prevEl:".js-prev-sentence",nextEl:".js-next-sentence"},pagination:{el:".swiper-pagination",clickable:!0},spaceBetween:30,on:{afterInit:function(t){(X=new IntersectionObserver(e=>{anime({targets:G.get(0),duration:150,easing:"linear",translateY:0<e[0].intersectionRatio?0:"-7rem"})},{rootMargin:`-${7*z}px 0px ${0*z}px 0px`})).observe($(".workbook-cover-section").get(0)),o=new ResizeObserver(e=>{e.find(e=>e.target==t.slides[t.activeIndex])&&t.update()}),t.slides.forEach(e=>o.observe(e));var e=t.slides[0],e=$(e).find(".collapse-section .note-section");function n(){setTimeout(()=>{$(".js-tts-play-sentence").trigger("click")},500)}e.collapse("show"),W(e),$(".passage-sentence-nav .sentence").eq(this.activeIndex).addClass("active"),devSize.isPhone()&&v.autoEnabled()&&($("#loadingModal").is(".show")?$("#loadingModal").on("hidden.bs.modal",n):n())},slideChange:function(){$(this.slides[this.activeIndex]).find(".note-section").collapse("show"),$(".passage-sentence-nav .sentence").eq(this.activeIndex).addClass("active").siblings(".sentence").removeClass("active"),M()},slideChangeTransitionEnd:function(e){scrollTo(0,B[0].offsetTop),localStorage.getItem("fico-swipe-happened")||localStorage.setItem("fico-swipe-happened",!0),setTimeout(()=>{$(e.slides[e.activeIndex]).find(".semantics-result:visible").each(function(){tandem.correctMarkLine(this)}),v.autoEnabled()&&$(".js-tts-play-sentence").trigger("click")},500)}}});function S(e,t){t=t.match(/swiper[-\w]*/g);return $(this).data("swiperClass",t),t}function W(t){var e=t.closest(".one-sentence-unit-section").data("sentenceId");!t.is(".loading,.loaded")&&e&&(t.addClass("loading").find(".empty-list").show(),$.getJSON(`/workbook/sentence/note/list/${u}/${e}/`+d,e=>{var n=e,s=(0<n.length&&t.find(".empty-list").hide(),t.find(".note-list").empty());for(let e=0,t=n.length;e<t;e++)V(n[e]).appendTo(s);t.toggleClass("loading loaded")}).fail(()=>alertModal("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}function M(t){v.stop(),document.querySelectorAll('[class*="js-tts-play"][data-playing="on"],.tts-playing').forEach(e=>{t!=e&&(e.matches('[class*="js-tts-play"]')?e.textContent="play_circle":e.matches(".tts-playing")&&e.classList.remove("tts-playing","blink-2"),e.dataset.playing="off")})}$(window).on("resize",function(){devSize.isPhone()?($(".one-sentence-unit-section").addClass(function(){return["swiper-slide"].concat($(this).data("swiperClass"))}).parent(".result-section").addClass(function(){return["swiper-wrapper"].concat($(this).data("swiperClass"))}).parent().addClass(function(){return["swiper"].concat($(this).data("swiperClass"))}),I.enable(),I.slides.forEach(e=>o.observe(e))):(o.disconnect(),I.disable(),$(".one-sentence-unit-section").removeClass(S).parent(".result-section").removeClass(S).attr("style","").parent().removeClass(S))}),$(document).on("click","#js-mobile-menu .sentence-link",function(){$("#js-mobile-menu .mobile-menu-section,#js-mobile-menu .passage-sentence-nav").collapse("toggle"),I.slideTo($(this).index())}).on("show.bs.collapse hide.bs.collapse","#js-mobile-menu .passage-sentence-nav",function(e){e.target==this&&($("#js-mobile-menu .js-toggle-menu").animate("show"==e.type?{rotate:"180deg"}:{rotate:"0deg"}),$("#js-mobile-menu").css("transform","translateY(0)"),"show"==e.type)&&$(".passage-sentence-nav .sentence.active")[0].scrollIntoView()}).on("show.bs.collapse",".collapse-section .note-section",function(){W($(this))}).on("click",".word-list-section",function(){var e;devSize.isPhone()&&(e=$(this).find(".word-section"),this.matches(".shrink")?(e.animate({height:e.data("orgHeight")+"px"}),this.classList.remove("shrink")):(this.classList.add("shrink"),e.data("orgHeight")||e.data("orgHeight",e.height()),e.animate({height:"1.5rem"},300)))}).on("click",".note-list .note-text",function(){devSize.isPhone()&&(this.matches(".shrink")?($(this).animate({height:$(this).data("orgHeight")+"px"}),this.classList.remove("shrink")):(this.classList.add("shrink"),$(this).data("orgHeight")||$(this).data("orgHeight",$(this).height()),$(this).animate({height:"1.5rem"},300)))}),devSize.isPhone()&&!localStorage.getItem("fico-swipe-happened")&&$("#loadingModal").on("hidden.bs.modal",function(){setTimeout(()=>{$(".swipe-intro").show(),setTimeout(()=>$(".swipe-intro").remove(),2e3)},1e3)}),$("#loadingModal").on("hidden.bs.modal",function(){$(".full-text").show(()=>{const t=new URLSearchParams(location.search).get("senQuery");var e;t&&(devSize.isPhone()?(e=Array.from(I.slides).find(e=>t==e.querySelector(".sentence-text").textContent),console.log("slide move"),I.slideTo(I.slides.indexOf(e))):$(Array.from(document.querySelectorAll(".origin-sentence-section")).find(e=>t==e.querySelector(".sentence-text").textContent)).trigger("click"))})}),$(document).on("click","#toggle-all-btn",function(e){var t=$(this).find(".fold-icon").is(".expanded")?"hide":"show";$(".one-sentence-unit-section>.collapse").trigger("prv.scroll").collapse(t),$(this).find(".fold-icon").toggleClass("expanded")}).on("prv.scroll",".one-sentence-unit-section>.collapse",function(){this.dataset.scroll="false"}).on("show.bs.collapse hide.bs.collapse",".one-sentence-unit-section>.collapse",function(e){var t;e.target==e.currentTarget&&((t=$(this).closest(".one-sentence-unit-section")).toggleClass("active","show"==e.type).find(".origin-sentence-section").attr("aria-expanded","show"==e.type),"show"==e.type&&"false"!=e.target.dataset.scroll&&t[0].scrollIntoView(),e.target.dataset.scroll="true")}).on("click",".js-tts-play-all, .js-tts-play-sentence",function(e){e.stopPropagation();const n=this;if("on"==n.dataset.playing)M();else if(M(n),n.dataset.playing="on",n.textContent="stop_circle",n.matches(".js-tts-play-all")){const s=$(".full-text .sentence-link").get();let t;!function e(){t&&t.classList.remove("tts-playing","blink-2");if("off"==n.dataset.playing)return;0<s.length?setTimeout(()=>{(t=s.shift()).classList.add("tts-playing","blink-2"),v.speak(t.textContent,e)},0):(n.dataset.playing="off",n.textContent="play_circle")}()}else{let e=$(n).closest(".origin-sentence").find(".sentence-text:visible")[0]||I.slides[I.activeIndex]?.querySelector(".sentence-text");e&&(e.classList.add("tts-playing"),v.speakRepeat(e.textContent,2,500,()=>{e.classList.remove("tts-playing"),n.dataset.playing="off",n.textContent="play_circle"}))}}).on("click",".js-tts-setting",function(e){e.stopPropagation(),M(),v.openSettings()}),$(document).on("shown.bs.collapse",".one-sentence-unit-section>.collapse",function(e){if(e.target.matches(".removable-section")&&e.target==e.currentTarget){var t=$(this).closest(".one-sentence-unit-section"),n=t.data("sentenceId");$(e.target).find(".semantics-result").filter(":visible").each(function(){tandem.correctMarkLine(this)}),t.data("metaEvaluated")||$(e.target).find(".dashboard-section").collapse("show");const o=t.find(".sentence-ext-section .note-section");o.is(".loading,.loaded")||(o.addClass("loading"),o.find(".empty-list").show(),$.getJSON(`/workbook/sentence/note/list/${u}/${n}/`+d,e=>{var n=e,s=(0<n.length&&o.find(".empty-list").hide(),o.find(".note-list").empty());for(let e=0,t=n.length;e<t;e++)V(n[e]).appendTo(s);o.toggleClass("loading loaded")}).fail(()=>alertModal("노트 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}}).on("show.bs.collapse",".related-list",function(){if(!this.matches(".loaded,.loading")){let a=$(this).addClass("loading position-relative");a.append('<i class="loading-icon w-auto offset-6 text-center fa-2x fas fa-spin fa-circle-notch text-fc-purple"></i>'),a.find(".empty-list").hide();var e=$(this).closest(".one-sentence-unit-section").data("sentenceId");$.getJSON("/workbook/search/finger/"+ntoa(e),t=>{if(null!=t&&0<t.length){a.empty();var n=t.length;for(let e=0;e<n;e++){var s=t[e],o=$(m).find(".finger-section").clone(!0);["A","S"].includes(i)||o.find(".svoc-mdf-btns").remove(),a.append(o),o.data("sentenceId",s.sentenceId).find(".sentence-text").text(s.eng)}}else a.find(".empty-list").show(),a.find(".loading-icon").remove();$(this).removeClass("loading").addClass("loaded")}).fail(()=>{alertModal("인덱스 핑거 조회에 실패했습니다."),a.find(".empty-list").show(),a.find(".loading-icon").remove(),$(this).removeClass("loading").addClass("loaded")})}}).on("shown.bs.collapse",".svoc-section",function(){tandem.correctMarkLine(this.querySelector(".semantics-result"))}),$(document).on("show.bs.collapse",".dashboard-section",function(){$(this).prev(".result-semantic-section").addClass("border-bottom-0"),$(this).find(".tip-content-section").hide(0,function(){var e=$(this).closest(".one-sentence-unit-section").find(".origin-sentence .sentence-text").text();$(this).html(tandem?.tip?.showRandomTip(e.match(/['"]/)?5:void 0)).fadeIn()})}).on("shown.bs.collapse",".dashboard-section",function(){devSize.isPhone()&&scrollTo(scrollX,$(this).offset().top-visualViewport.height/2+this.offsetHeight/2)}).on("hidden.bs.collapse",".dashboard-section",function(){$(this).prev(".result-semantic-section").removeClass("border-bottom-0")}),$(document).on("click","div:not(.edit-svoc)>.semantics-result,.js-collapse-svoc",function(){var e=$(this).closest(".one-sentence-unit-section");e.find(".result-semantic-section .collapse").collapse("toggle"),e.find(".js-collapse-svoc").toggleClass("expanded")});const Z={S:"<b>평가를 하는 이유</b><br><br>A.I.는 인간의 언어를 이해하면서 분석하지 않습니다.<br>학습자들에게 도움이 될 수 있도록 분석 결과를 평가해주세요.<br>평가도 하고 다양한 fico Egg도 모아보세요.",F:"<b>AI 분석이 정확하지 않은가요?</b><br><br>그건 회원님이 AI보다 실력이 좋다는 증거입니다.<br>직접 수정할 수도 있고 그냥 내버려 둘 수도 있습니다.<br>실력 발휘 기대합니다."},ee={S:{icon:"🥳",status:"S",tooltip:"평가를 받은 문장이예요."},F:{icon:"🤯",status:"F",tooltip:"분석이 틀렸대요."}};function te(t,n){let s=!1;t.closest(".dashboard-section").find(".edit-meta-status-btn[data-meta-status]").each(function(){var e;this.disabled||(e=$(this).prop("disabled",!0).wrap('<span data-bs-original-title="이미 평가한 문장입니다."></span>').parent()[0],new bootstrap.Tooltip(e,{trigger:"hover focus"}).enable(),e.querySelector(".material-icons").className="material-icons text-gray-400")});const e=t.next();e.popover("show"),setTimeout(()=>e.popover("dispose"),3e3),anime({targets:t[0],rotateX:360,scale:[{value:3,duration:500,easing:"easeOutBack"},{value:1,duration:2500,easing:"easeInBounce"}],delay:300,duration:3e3,update:function(e){!s&&20<e.progress&&(t.text(n.icon).attr("data-bs-original-title",n.tooltip),s=!0)},complete:function(){t[0].style.transform=""}})}$("#check-modal").on("show.bs.modal",function(e){var e=e.relatedTarget,t=this.querySelector(".status-submit"),n=e.dataset.metaStatus;t.dataset.metaStatus=n,this.querySelector(".modal-body").innerHTML=Z[n],$(t).data("sentenceSection",$(e.closest(".one-sentence-unit-section")))}),$("#check-modal .status-submit").on("click",function(){var e=$(this).data("sentenceSection");const t=this.dataset.metaStatus,n=e.find(".dashboard-section .meta-status");tandem?.meta?.submitMetaStatus(e.data("sentenceId"),t,"workbook",()=>{te(n,ee[t])}),$("#check-modal").modal("hide")}),$(document).on("click",".js-add-svoc, .js-edit-svoc",async function(){let t=$(this).is(".js-add-svoc");const n=!!this.closest(".js-finger-detail"),s=parseInt((n?$(this).closest(".js-finger-detail"):$(this).closest(".one-sentence-unit-section")).data("sentenceId")),o=($(".js-add-svoc").prop("disabled",!0),$(this).closest(".one-sentence-unit-section"));let a=null;var e,i,l;function c(e){t&&null!=e&&(a.closest(".new-svoc-form").removeClass("new-svoc-form"),a.data("svocId",e),o.find(".js-collapse-svoc").addClass("expanded").show(),a.closest(".svoc-section").nextAll(".svoc-section").collapse("show")),a.closest(".svoc-section").find(".svoc-mdf-btns").show(),$(".js-add-svoc").prop("disabled",!1)}t&&!n?((e=$(m).children(".svoc-section").clone(!0).addClass("new-svoc-form")).find(".personacon-alias").text(r),i=$("#hiddenDivs .member-personacon").clone(!0),p&&(i.find(".personacon-profile").removeClass("profile-default")[0].style.background="url(/resource/profile/images/"+p+") center/cover no-repeat"),e.find(".writer-section").attr("data-bs-target",o.find(".writer-section").get(0).dataset.bsTarget).prepend(i),i=o.find(".origin-sentence .sentence-text").text(),l=await tandem.getSvocBytes(o.find(".semantics-result").get(0)),devSize.isPhone()?o.find(".svoc-menu-section").after(e):o.find(".result-semantic-section").prepend(e),(a=$(await tandem.showSemanticAnalysis(i,l,e.find(".svoc-block")))).data("memberId",d),e.find(".svoc-mdf-btns").hide().find("[data-seq]").attr("data-seq",a.attr("data-seq"))):(a=$(this).closest(".svoc-section").find(".semantics-result"),$(this).closest(".svoc-mdf-btns").hide()),a.svoceditor(t,function(e){var t=Number(a.data("svocId")||0),e={sentenceId:s,workbookId:u,passageId:f,ownerId:E,memberId:d,encSvocText:e};d==Number(a.data("memberId"))&&0<t&&(e.svocId=t);editSvoc(e,c),window.tandem?.meta?.saveGramMetaFromDOM(s,a[0],!0,"workbook"),n||te(a.closest(".one-sentence-unit-section").find(".meta-status"),ee.S)},function(){$(".js-add-svoc").prop("disabled",!1),t?a.closest(".new-svoc-form").remove():a.closest(".svoc-section").find(".svoc-mdf-btns").show()}),setTimeout(()=>{tandem.correctMarkLine(a[0])},500)}).on("click",".js-del-svoc",function(){const e=$('.semantics-result[data-seq="'+this.dataset.seq+'"]'),t=e.closest(".one-sentence-unit-section");var n=Number(e.data("svocId"));confirm("삭제하시겠습니까?")&&delSvoc(n,function(){e.closest(".svoc-section").fadeOut(()=>{e.closest(".svoc-section").remove(),t.find(".svoc-section").length<2&&t.find(".js-collapse-svoc").hide(),t.find(".svoc-section").first().removeClass("collapse show"),t.find(".svoc-section").slice(1).addClass("collapse")})})}).on("click",".js-set-worthless",function(){const e=$(this).closest(".js-finger-detail").data("sentenceId");confirmModal('<div class="text-start row"><span class="col-12 text-center">완전한 문장의 구성으로 충족되지 않습니다.<br>다음과 같은 경우에 해당합니다.</span><div class="mx-auto w-auto d-block"><br>\t• 오타가 포함된 문장<br>\t• 불완전하게 잘린 문장<br>\t• 문장구성이 안되는 문장<br>\t• 불완전한 인용구, 구두점오류가 있는 문장<br>\t• 기타 비문장</div></div>',()=>{$.ajax({url:"/sentence/useful/edit",type:"POST",data:JSON.stringify({sentenceId:e,useful:!1}),contentType:"application/json",success:()=>{this.classList.remove("js-set-worthless","text-danger"),this.classList.add("text-secondary"),this.title="유용하지 않은 문장입니다.",this.style.pointerEvent="none",alertModal("useful값을 false로 수정했습니다.")},error:()=>{alertModal("useful 정보 수정에 실패했습니다.")}})})});const C=$("#hiddenDivs .trans-editor");function V(e){var t,n=$(m).children(`.note-block.${e?.hasOwnProperty("sentenceId")?"sentence":"passage"}-note`).clone(!0)[0];return devSize.isPhone()&&n.querySelector(".note").classList.add("overflow-hidden"),n.dataset.noteId=e.noteId,n.querySelector(".note-text").innerHTML=e.content,n.querySelector(".updatedate").textContent=new Date(e.updateDate||new Date).toLocaleDateString(),d!=e?.memberInfo?.memberId?n.querySelector(".note-mdf-btns").remove():((t=n.querySelector(".note-editor .note-open-input")).value=e.noteAccess??e.publicOpen,$(t).trigger("input")),n.querySelector(".personacon-section .alias").textContent=e?.memberInfo?.alias,$(n)}function j(){T("addVoca")}function T(t){anime({targets:$("#addVoca,#appendVoca,#requestVoca").get(),rotateX:e=>e.id===t?"0deg":"180deg",duration:400,easing:"linear",update:e=>{50<e.progress&&e.animatables.forEach(e=>{e.target.style.zIndex=e.target.id==t?0:-1})}})}$(document).on("click",".js-edit-trans-open",function(){C.hide();var e=$(this).closest(".ai-translation-block");this.matches(".add-btn")?($(this).hide(),C.data("mode","add").find(".text-input").val(null),$(this).closest(devSize.isPhone()?".translation-section":".kor-list-section").find(".ai-translation-section").prepend(C)):(e.find(".trans-mdf-btns, .translation-text").hide(),C.data("mode","edit").find(".text-input").val(e.find(".translation-text").text()),e.before(C)),C.show(300)}).on("click",".js-edit-trans",function(){const n=C.next(".ai-translation-block"),e=Number($(this).closest(".one-sentence-unit-section").data("sentenceId")),s=C.find(".text-input").val().trim(),o=$(this).closest(devSize.isPhone()?".translation-section":".kor-list-section");var t={sentenceId:e,memberId:d,kor:s};"edit"==C.data("mode")&&null!=n.data("korTid")&&(t.korTid=Number(n.data("korTid"))),0!=s.length&&editSentenceTrans(t,function(e){{var t;C.hide(300,()=>C.appendTo("#hiddenDivs")),"edit"==C.data("mode")?(n.find(".translation-text").text(s).show(300),n.find(".trans-mdf-btns").show(300)):((t=J.clone()).data("korTid",e).find(".translation-text").text(s),t.addClass("user-trans"),t.find(".translator").text(" "+r),t.append($(m).find(".trans-mdf-btns").clone(!0)),o.find(".ai-translation-section").prepend(t),o.find(".add-btn").show(300),t.addClass("show"),devSize.isPhone()&&!o.find(".open-kor-btn").is(".active")&&t.siblings(".ai-translation-block").removeClass("show"))}})}).on("click",".js-edit-trans-cancel",function(){C.fadeOut(300,()=>C.appendTo("#hiddenDivs")),("edit"==C.data("mode")?C.next(".ai-translation-block").find(".trans-mdf-btns, .translation-text"):C.closest(devSize.isPhone()?".translation-section":".kor-list-section").find(".add-btn")).show(300)}).on("click",".js-del-trans",function(e){e.stopPropagation(),e.stopImmediatePropagation();const t=$(this).closest(".ai-translation-block");confirm("삭제하겠습니까?")&&delSentenceTrans(Number(t.data("korTid")),function(){alertModal("삭제되었습니다."),(t.closest(".translation-section").find(".open-kor-btn").is(".active")?t.nextAll(".ai-translation-block"):t.next(".ai-translation-block"))?.collapse("show");t.fadeOut(300,()=>t.remove())})}).on("click",".js-finger-detail",async function(e){if(!e.target.closest(".edit-svoc,.svoc-mdf-btns")&&e.target.closest(".js-finger-detail")){const n=$(this),s=n.find(".toggle-eye");e=n.data("sentenceId");s.is(".loading")||(s.is(".loaded")?(n.toggleClass("bg-gray-700").find(".fold-icon").toggleClass("expanded",!s.is(".active")),s.toggleClass("active disabled"),n.find(".sentence-text, .trans-block, .svoc-section").toggle(300)):(s.addClass("loading"),await $.getJSON("/workbook/sentence/finger/"+e,e=>async function(e){n.find(".sentence-text").hide();var t=$(await tandem.showSemanticAnalysis(e.eng,e.svocBytes,n.find(".svoc-section").show().find(".svoc-block")));e.svocId&&t.data("svocId",e.svocId);n.removeClass("bg-gray-700").find(".trans-block").text(e.kor).show(),n.find(".fold-icon").addClass("expanded"),s.toggleClass("disabled active loading loaded")}(e)).fail(()=>alertModal("해석·분석 가져오기에 실패했습니다.\n다시 접속해 주세요."))))}}).on("click",".js-add-sentence-note-btn",function(){const n=$(this).closest(".one-sentence-unit-section");var e=Number(n.data("sentenceId"));const s=$(this).closest(".add-section");var t=s.find(".text-input").val().trim(),o=s.find(".note-open-input").val();0!=t.length&&addSentenceNote({workbookId:u,sentenceId:e,memberId:d,content:t,noteAccess:o},function(e){e.memberInfo={memberId:d,alias:r};var t=n.find(".note-section>.note-list"),e=V(e);e.prependTo(t),s.find(".text-input").val("").summernote("destroy"),s.hide(300,function(){var e=s.closest(".note-section");e.find(".add-icon").prop("disabled",!1),e.find(".empty-list").hide()})})}).on("click",".js-open-voca-form",function(e){var t=$(this).closest(".one-sentence-unit-section");$("#openVocaModal").find(".original-sentence,.original-sentence-background").text(t.find(".origin-sentence .sentence-text").text()),$("#openVocaModal .voca-reg-phase").hide().eq(0).show().find('input[name="vocaTypeCheck"]').prop("checked",!1),$("#openVocaModal .trans-list").empty().append(createElement({el:"ol",children:Array.from(t.find(".translation-section:eq(0) .ai-translation-block .translation-text"),e=>({el:"li",class:"translation-text",textContent:e.textContent}))})),$("#openVocaModal").find(".text-in-sentence,.lemma").val(""),$("#openVocaModal .meaning").html('<p class="p-2">등록하고자 하는 표제어가 기본형이 맞는지 확인 후 OK를 눌러 검색해 주세요.</p>'),$("#openVocaModal").find(".part-type,.additional-meaning").empty().val("").prop("disabled",!0),$("#openVocaModal").data("sentenceUnit",t).modal("show"),$("#addVoca").prop("disabled",!0),j()}).on("change",'input[name="vocaTypeCheck"]',function(){$("#openVocaModal .original-sentence-background").text($("#openVocaModal .original-sentence").text()),$("#openVocaModal").find(".text-in-sentence,.lemma,.additional-meaning").empty().val("").removeClass("is-valid is-invalid"),$("#openVocaModal .meaning").html('<p class="p-2">등록하고자 하는 표제어가 기본형이 맞는지 확인 후 OK를 눌러 검색해 주세요.</p>'),$("#addVoca,#appendVoca,#requestVoca,.part-type,.additional-meaning").prop("disabled",!0),this.value?$("#openVocaModal .part-type").empty().append(`<option value="${this.value}" selected>${a[this.value]}</option>`):$("#openVocaModal .part-type").empty().append(createElement(Array.from(Object.entries(a).slice(0,9),([e,t])=>({el:"option",value:e,textContent:t})))).prepend(createElement({el:"option",textContent:"문장에서 쓰인 품사를 목록에서 선택합니다.",selected:!0,disabled:!0,value:""})),$(this).closest(".voca-reg-phase").next(".voca-reg-phase").slideDown()}).on("mousedown","#openVocaModal .original-sentence",function(){$(this).siblings(".original-sentence-background").text(this.textContent)}),$("#openVocaModal .original-sentence").on("scroll",function(){$("#openVocaModal .original-sentence-background")[0].scrollTop=this.scrollTop}),$(document).on("mouseup","#openVocaModal .original-sentence",function(){var a=getSelection(),i=this.textContent;if(a.anchorNode.isSameNode(a.focusNode)&&"Range"==a.type&&0<a.toString().trim().length){var l=a.anchorNode.compareDocumentPosition(a.focusNode);let e=!1,{anchorNode:t,anchorOffset:n,focusNode:s,focusOffset:o}=((e=!l&&a.anchorOffset>a.focusOffset||l===Node.DOCUMENT_POSITION_PRECEDING?!0:e)&&a.setBaseAndExtent(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset),a);for(;/^(\s|[.,?!'"])/.test(i.substring(n));)n++;for(;/(\s|'s|[.,?!'"])$/.test(i.substring(0,o));)o--;for(;0<n&&/\w/.test(i[n-1]);)n--;for(;o<i.length&&/\w/.test(i[o]);)o++;a.setBaseAndExtent(s,o,t,n);var l=[a.anchorOffset,a.focusOffset].sort((e,t)=>e-t),c=$(this).closest(".voca-reg-phase").next(".voca-reg-phase").slideDown(),a=(c.find(".word-start").val(l[0]),c.find(".word-end").val(l[1]),c.find(".text-in-sentence,.lemma").val(a.toString().substring(0,50)).removeClass("is-valid is-invalid"),c.find(".additional-meaning").empty().val(""),c.find(".part-type,.additional-meaning").prop("disabled",!0),c.find(".meaning").html('<p class="p-2">등록하고자 하는 표제어가 기본형이 맞는지 확인 후 OK를 눌러 검색해 주세요.</p>'),$("#addVoca,#appendVoca,#requestVoca").prop("disabled",!0),c.find(".lemma").trigger("input").focus(),$("#openVocaModal .original-sentence-background").get(0).firstChild),c=new Range;c.setStart(a,l[0]),c.setEnd(a,l[1]),c.surroundContents($('<span class="ws-breakspaces bg-info"></span>').get(0))}}).on("input","#openVocaModal .lemma",function(){var e=this.value.trim();$(this).toggleClass("is-invalid",0==e.length||50<e.length).toggleClass("is-valid",0<e.length&&e.length<=50).siblings(".uppercase-feedback").toggle(this.value.trim().toLowerCase()!=this.value.trim()),$("#openVocaModal .meaning").html('<p class="p-2">등록하고자 하는 표제어가 기본형이 맞는지 확인 후 OK를 눌러 검색해 주세요.</p>'),$("#openVocaModal .word-id").val(0),$("#addVoca,#appendVoca,#requestVoca").prop("disabled",!0)}).on("click","#searchVoca",function(){var e=$("#openVocaModal .lemma"),t=e.val().trim();const s=$('input[name="vocaTypeCheck"]:checked').val(),o="phrasal-v."==s?"pv":"np";t&&!e.is(".is-invalid")&&($("#openVocaModal .word-id").val(0),$.getJSON("/openvocas/search/word",{text:t,partType:o},t=>{if($("#openVocaModal").find(".part-type,.additional-meaning").prop("disabled",!1),$("#addVoca, #appendVoca,#requestVoca").prop("disabled",!1),"np"==o&&$("#openVocaModal .word-id").val(t[0]?.wordId??0),s){const n=new Set([s]);t?.forEach(e=>{e?.meaningList?.forEach(e=>{e=e.match(/[^\.]+/)[0]+".";n.has(e)||n.add(e)})}),$("#openVocaModal .part-type").empty().append(createElement(Array.from(n,(e,t)=>({el:"option",value:e,selected:t<1,textContent:a[e]}))))}var e;0<t?.length?(e=$("#openVocaModal").data("sentenceUnit"),"np"==o?$("#openVocaModal .meaning").empty().append($('<ul class="list-group list-group-flush"></ul>').append(createElement(Array.from(t[0].meaningList,e=>({el:"li",class:"list-group-item",textContent:e}))))):$("#openVocaModal .meaning").empty().append(createElement([{el:"div",class:"text-center m-2 text-secondary",textContent:"───── 아래 뜻 중 적절한 것이 있으면 선택하세요. ─────",selected:!0}].concat(Array.from(t,(e,t)=>({el:"div",class:"form-check",role:"button",children:[{el:"input",type:"checkbox",class:"form-check-input",id:"openVocaMeaningCheck"+t,value:e.wordId},{el:"label",class:"form-check-label",htmlFor:"openVocaMeaningCheck"+t,children:[{el:"span",class:"pv-title fw-bold me-5",textContent:e.title},e.meaningList.join(" ")]}]}))))),e.find(".one-word-unit-section").get().find(e=>Array.from(t,e=>e.wordId).includes($(e).data("wordId")))?($("#appendVoca").prop("disabled",!1),T("appendVoca")):($("#addVoca").prop("disabled",!1),j())):s?($("#openVocaModal .meaning").html('<p class="p-2">시스템에 등록되지 않은 어휘입니다.</p>'),$("#addVoca").prop("disabled",!1),j()):($("#openVocaModal .meaning").html('<p class="p-2 text-center">시스템에 등록되지 않은 어휘입니다.<br>등록을 요청할 수 있습니다.</p>'),$("#openVocaModal .uppercase-feedback").hide(),$(".part-type,.additional-meaning").prop("disabled",!0),$("#requestVoca").prop("disabled",!1),T("requestVoca"))}))}).on("change","#openVocaModal .meaning .form-check-input",function(){this.checked?($("#openVocaModal .meaning .form-check-input").not(this).prop("checked",!1),$("#openVocaModal .lemma").val($(this.labels[0]).find(".pv-title").text()),$("#openVocaModal .word-id").val(this.value)):$("#openVocaModal .word-id").val(0)}).on("input","#openVocaModal .additional-meaning",function(){$("#addVoca,#appendVoca").prop("disabled",!this.value.trim().length&&!parseInt($("#openVocaModal .word-id").val()))}).on("click","#addVoca,#appendVoca,#requestVoca",function(){const f=$("#openVocaModal").data("sentenceUnit"),e=parseInt($("#openVocaModal .word-id").val()),t=$('input[name="vocaTypeCheck"]:checked').val(),n=$("#openVocaModal .part-type").val(),s=$("#openVocaModal .additional-meaning").val().trim(),m=f.data("sentenceId"),o=$("#openVocaModal .lemma").val().trim(),a=$("#openVocaModal .text-in-sentence").val().trim(),i=parseInt($("#openVocaModal .word-start").val()),l=parseInt($("#openVocaModal .word-end").val()),h=$(this).is("#addVoca,#requestVoca"),g=$(this).is("#requestVoca");var c=h?"/openvocas/new/"+(t?"phrase":"word"):"/openvocas/append/meaning";!n&&0<s?.length?alertModal("품사가 선택되지 않은 추가의미가 있습니다.",()=>$("#openVocaModal .part-type").focus()):t&&!e&&!s||!t&&e&&!n?alertModal("등록된 의미들 중 선택을 하거나 추가의미를 입력해 주세요."):$.ajax({url:c,type:"POST",data:{wordId:e||0,partType:n,appendMeaning:s,sentenceId:m,title:o,token:a,start:i,end:l},success:n=>{if(n&&Object.getOwnPropertyNames(n).includes("senseList")){var e=f.find(".word-section>.one-block");if(h){var t=F.clone();if(t.data({wordId:n.wid,sentenceId:m,workbookId:u}),t.find(".one-part-unit-section").remove(),t.find(".title").text(n.title).attr("data-playing","off").click(function(e){e.stopPropagation(),"on"==this.dataset.playing?M():(M(this),this.dataset.playing="on",this.classList.add("tts-playing","blink-2"),v.speakRepeat(n.title,2,500,()=>{this.classList.remove("tts-playing","blink-2"),this.dataset.playing="off"}))}),g)t.addClass("pe-none"),t.append($('<span class="meaning fst-italic">빠른 시일 내에 등록될 예정입니다.<span>'));else{var s=n.senseList,o=s.length;for(let e=0;e<o;e++){var a=s[e],i=b.clone();t.append(i),i.find(".part").text(a.partType),i.find(".meaning").text(a.meaning)}}e.find(".empty-list").remove(),e.append(t)}else{var l=e.find(".one-word-unit-section").filter((e,t)=>$(t).data("wordId")==n.wid),c=(l.find(".one-part-unit-section").remove(),n.senseList),d=c.length;for(let e=0;e<d;e++){var r=c[e],p=b.clone();l.append(p),p.find(".part").text(r.partType),p.find(".meaning").text(r.meaning)}}alertModal(g?"등록이 요청되었습니다. 빠른 시일 내로 등록해 드리겠습니다.":"등록되었습니다. 단어목록을 확인해 주세요.",()=>$("#openVocaModal").modal("hide"))}else alertModal("등록결과를 조회할 수 없습니다\n등록창을 닫습니다.",()=>$("#openVocaModal").modal("hide"))},error:()=>{alertModal("등록에 실패했습니다.")}})}).on("click",".js-edit-note-open",async function(){var e=$(this).closest(".note-block"),t=e.find(".text-section"),n=(e.find(".note-mdf-btns").hide(),t.find(".note-text").hide());this.closest(".collapse-section")&&e.find(".note").toggleClass("overflow-hidden mb-4");e=t.find(".note-editor").show().find(".text-input").val(n.html());t.find(".open-input").trigger("input"),openSummernote(e)}).on("click",".js-edit-note-cancel",function(){var e=$(this).closest(".text-section"),t=$(this).closest(".note-block");this.closest(".collapse-section")&&$(this).closest(".note").toggleClass("overflow-hidden mb-4"),e.find(".note-editor, .note-text").add(t.find(".note-mdf-btns")).toggle()}).on("click",".js-edit-note",function(){const t=$(this).closest(".text-section"),n=$(this).closest(".note-block");var e=Number(n.data("noteId")),s=t.find(".note-open-input").val(),o=t.find(".text-input").summernote("code").trim(),e={noteId:e,workbookId:u,memberId:d,content:o},a=t.closest(".one-sentence-unit-section"),i=0<a.length?"sentence":"passage";0!=o.length&&("sentence"==i?(e.sentenceId=Number(a.data("sentenceId")),e.noteAccess=s):(e.passageId=f,e.publicOpen=JSON.parse(s)),editNote(i,e,function(e){0<n.closest(".collapse-section").length&&n.find(".note").toggleClass("overflow-hidden mb-4");t.find(".note-editor").hide(),t.find(".note-open-input").val(e.noteAccess),t.find(".note-text").html(e.content).show(),n.find(".updatedate").text((new Date).toLocaleDateString()),n.find(".note-mdf-btns, .updatedate").show()}))}).on("click",".js-delete-note",function(){if(confirm("삭제하시겠습니까?")){const e=$(this).closest(".note-block"),t=e.closest(".note-section"),n=Number(e.data("noteId")),s=e.closest(".one-sentence-unit-section"),o=0<s.length?"sentence":"passage";delNote(o,n,function(){e.fadeOut(function(){$(this).remove(),0==t.find(".note-block").length&&t.find(".empty-list").show()})})}}).on("click",".note-section .add-icon",async function(){$(this).prop("disabled",!0);const e=$(this).closest(".note-section");var t=e.find(".add-section");openSummernote(t.find(".text-input")),t.show(300,function(){e.find(".empty-list").hide()})}).on("click",".cancel-add-note-btn",function(){const t=$(this).closest(".add-section");var e=t.find(".text-input").val("");"function"==typeof e.summernote&&e.summernote("destroy"),t.hide(300,function(){var e=t.closest(".note-section");e.find(".add-icon").prop("disabled",!1),0==e.find(".note-list .note-block").length&&e.find(".empty-list").show()})}).on("click",".js-request-note",function(){var e=$(this).closest(".one-sentence-unit-section");const t=e.find(".origin-sentence .sentence-text").text().trim(),n=e.data("sentenceId");confirmModal('<img class="align-baseline" src="https://static.findsvoc.com/images/icons/ssamnote.png" style="width: 5rem;">를 신청하시겠습니까?',function(){$.ajax({url:"/workbook/ssamnote/request",type:"POST",data:{workbookId:u,passageId:f,sentenceId:n,eng:t},success:function(e){e?alertModal(e):alertModal("정상적으로 신청 완료되었습니다.\n신청하신 노트는 09:00~18:00 사이 처리됩니다.\n(당일 처리되지 못 한 노트는 다음 영업일에 처리됩니다.)")},error:function(){alertModal("신청이 정상적으로 처리되지 못 했습니다.")}})})}).on("show.bs.collapse",".craft-section",function(){var e=$(this).closest(".one-sentence-unit-section"),t=(e.find(".dashboard-section").collapse("hide"),Array.from(e.find(".ai-translation-section").eq(0).find(".ai-translation-block"),e=>({id:$(e).data("korTid"),text:e.querySelector(".translation-text").textContent})));null==this.querySelector(".battle-section-panel")&&craft.openBattleMakerPanel(this,d,i,e.data("sentenceId"),e.find(".semantics-result")[0],t)})}