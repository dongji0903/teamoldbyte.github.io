async function pageinit(e){const n={study:[],open:[],working:[],coworking:[]};if(e.empty)$('.book-section[data-list-type="study"]').prepend(createElement({el:"span",className:"default-message",children:["다른 사람이 만든 워크북을 보고 싶다면?",{el:"br"},"워크북 구독을 하면 여기서 볼 수 있습니다."]})).find(".list-inline").css("height","auto");else{n.study=e.content;let t=!0,i=1;e.numberOfElements>d()&&!e.last&&await $.getJSON("/workbook/library/study/list",{pageNum:2},function(e){n.study=n.study.concat(e.content),t=e.last,i++});e=n.study.splice(0,2*d());l(e,$('.book-section[data-list-type="study"] .list-inline')),a($("#studyWorkbookSection .swiper")[0],e,i,t)}function a(e,t,i,o){t=t.length;const s=[9<t,8<t,10<t,14<t][matchMedia("(max-width: 575.8px)").matches?0:matchMedia("(max-width: 675.8px)").matches?1:matchMedia("(max-width: 991.8px)").matches?2:3];new Swiper(e,{watchSlidesProgress:!0,slidesPerView:"auto",freeMode:s,grid:{fill:"row"},breakpoints:{320:{slidesPerGroup:3,autoHeight:t<=3,grid:{rows:6<t?3:3<t?2:1}},576:{slidesPerGroup:4,autoHeight:t<=4,grid:{rows:4<t?2:1}},676:{slidesPerGroup:5,autoHeight:t<=5,grid:{rows:5<t?2:1}},768:{slidesPerGroup:4,spaceBetween:28,autoHeight:t<=4,grid:{rows:4<t?2:1}},992:{slidesPerGroup:7,slidesPerView:7<t?7:"auto",spaceBetween:28,autoHeight:t<=7,grid:{rows:7<t?2:1}}},navigation:{prevEl:$(e).siblings(".swiper-button-section").find(".swiper-button-prev")[0],nextEl:$(e).siblings(".swiper-button-section").find(".swiper-button-next")[0]},lazy:{enabled:!0,loadPrevNext:!0},on:{beforeInit:function(e){(e.isLast=o)||(e.pageNum=i+1)},afterInit:function(e){s||e.lazy.load()},click:function(e){var t;e.clickedSlide&&(t=$(e.clickedSlide).closest(".workbook-block"),e=ntoa(e.clickedSlide.dataset.workBookId),location.assign(`/workbook/${t.is("#studyWorkbookSection")?"study/overview":"mybook/edit"}/`+e))},slideNextTransitionStart:function(t){if(!(t.isLast||t.isLoading||t.slides.length-t.visibleSlidesIndexes.slice(-1)[0]-1>=d())){const i=t.el.dataset.listType,o=(t.isLoading=!0,d()-(t.slides.length-t.visibleSlidesIndexes.slice(-1)[0]-1)%d()),s=n[i].splice(0,o);t.loadOver?(t.appendSlide(Array.from(s,e=>r(e))),t.isLast=0==n[i].length):s.length<o?(t.appendSlide(Array.from(s,e=>r(e))),$.getJSON(`/workbook/library/${i}/list`,{pageNum:t.pageNum++},function(e){delete t.isLoading,e.first&&e.empty?(t.el.classList.add("h-auto"),t.wrapperEl.remove(),t.destroy()):($(t.el).find(".default-message").remove(),n[i]=n[i].concat(e.content),t.appendSlide(Array.from(n[i].splice(0,o-s.length),e=>r(e))),t.update(),e.first&&t.lazy.load(),e.last&&(t.loadOver=!0))}).fail(()=>alert("워크북목록 가져오기에 실패했습니다.\n다시 접속해 주세요."))):(delete t.isLoading,t.appendSlide(Array.from(s,e=>r(e))),t.update())}}}})}function l(i,e){var o=[];for(let e=0,t=i.length;e<t;e++){var s=i[e];o.push(r(s))}e.append(o)}function r(e){var t=$("#hiddenDivs .book-unit").clone(),i=t.attr("data-work-book-id",e.workBookId).find(".book-cover");return t.find(".book-title").text(e.title),i.find("img").attr("alt",e.title),"HELLO-BOOK"==e.title?(i.addClass("hello-book").find(".swiper-lazy-preloader").remove(),t.find(".book-title").hide()):null==e.imagePath||0==e.imagePath.length?i.addClass("default").find(".swiper-lazy-preloader").remove():(i.find("img").addClass("swiper-lazy").attr("data-background","/resource/workbook/cover/"+e.imagePath),t.find(".book-title").hide()),t.find(".book-price").html(0<e.price?e.price.toLocaleString()+" fico":"멤버십 무료"),null!=e.numOfSubscribers&&t.append('<span class="subs-num">'+e.numOfSubscribers+"</span>"),t[0]}function d(){return matchMedia("(min-width: 992px)").matches?14:matchMedia("(min-width: 768px)").matches?8:matchMedia("(min-width: 676px)").matches?10:matchMedia("(min-width: 576px)").matches?8:9}$(".swiper").each(function(){const o=this,s=this.dataset.listType;"study"!==s&&$.getJSON(`/workbook/library/${s}/list`,{pageNum:1},function(e){if(e.empty)$(o).on("click",".book-unit",function(){var e=$(this).closest(".workbook-block"),t=ntoa(this.dataset.workBookId);location.assign(`/workbook/${e.is("#studyWorkbookSection")?"study/overview":"mybook/edit"}/`+t)}),$(o).siblings(".swiper-button-section").find(".swiper-button-prev,.swiper-button-next").remove();else{$(o).find(".default-message").remove(),n[s]=e.content;let t=e.last,i=1;!t&&e.numberOfElements<2*d()?$.getJSON(`/workbook/library/${s}/list`,{pageNum:2},function(e){t=e.last,i=2,n[s]=n[s].concat(e.content);e=n[s].splice(0,2*d());l(e,$(o).find(".swiper-wrapper")),a(o,e,i,t)}):(l(e=n[s].splice(0,2*d()),$(o).find(".swiper-wrapper")),a(o,e,i,t))}}).fail(()=>alert("워크북목록 가져오기에 실패했습니다.\n다시 접속해 주세요."))}),$(document).on("show.bs.collapse hide.bs.collapse",".bookshelf-section",function(e){$(this).closest(".workbook-block").find(".title-section .fold-icon").toggleClass("expanded","show"==e.type)}),$(".bookshelf-section:not(.show)").collapse("show")}