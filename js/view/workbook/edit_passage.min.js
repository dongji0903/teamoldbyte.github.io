function pageinit(e){const r=Number(sessionStorage.getItem("editingPassageId")),t=Number(sessionStorage.getItem("workbookId")),n=576<=window.innerWidth?"#f6f6f6":"#fff",c=".list-sentence-section",u=".one-sentence-unit-section",i={el:"div",class:"one-sentence-unit-section rounded-gray-border p-2 p-lg-4 mb-2 border-0","data-ordernum":"0","data-sid":"0","data-psid":"0",children:[{el:"div",class:"origin-sentence-section my-auto",children:[{el:"div",class:"d-none d-md-block border border-2 border-white rounded-3 float-end",children:[{el:"span",role:"button",class:"js-move-sentence btn float-end border border-2 border-white rounded-0 ui-sortable-handle","data-toggle":"tooltip",title:"위치 이동",children:[{el:"span",class:"fas fa-arrows-alt"}]},{el:"button",type:"button",class:"js-del-sentence btn float-end border border-2 border-white rounded-0","data-toggle":"tooltip",title:"문장 삭제",children:[{el:"span",class:"fas fa-trash-alt"}]},{el:"button",type:"button",class:"edit-icon-section btn float-end border border-2 border-white rounded-0","data-toggle":"collapse",children:[{el:"span",class:"edit-icon fas fa-pen"}]}]},{el:"div",class:"d-block d-md-none float-end border rounded-3 px-1",children:[{el:"span",role:"button",class:"js-move-sentence d-block btn p-1 ui-sortable-handle","data-toggle":"tooltip",title:"위치 이동",children:[{el:"span",class:"fas fa-arrows-alt"}]},{el:"button",type:"button",class:"js-del-sentence d-block btn p-1 mx-auto","data-toggle":"tooltip",title:"문장 삭제",children:[{el:"span",class:"fas fa-trash-alt"}]},{el:"button",type:"button",class:"edit-icon-section d-block btn p-1","data-toggle":"collapse",children:[{el:"span",class:"edit-icon fas fa-pen"}]}]},{el:"div",class:"origin-sentence",role:"button","data-toggle":"collapse",children:[{el:"span",class:"numbering-text",textContent:"3"},{el:"span",class:"sentence-text",textContent:""}]},{el:"div",class:"edit-section collapse mt-2",children:[{el:"textarea",class:"form-control mb-2",textContent:""},{el:"button",type:"button",class:"btn btn-outline-fico","data-toggle":"collapse",textContent:"취소"},{el:"button",type:"button",class:"js-edit btn btn-fico",disabled:!0,textContent:"수정"},{el:"span",class:"invalid-text text-danger",style:"display: none;",textContent:"영문이 아니거나 글자수가 너무 많습니다."}]}]}]};e.sort((e,t)=>e.orderNum-t.orderNum).forEach((e,t)=>{const n=createElement(i);n.dataset.ordernum=e.orderNum,n.dataset.sid=e.sentenceId,n.dataset.psid=e.passageSentenceId,n.querySelector(".numbering-text").textContent=t+1,n.querySelector(".sentence-text").textContent=e.eng,n.querySelector(".edit-section textarea").textContent=e.eng,document.querySelector(c).appendChild(n)}),p(),$("#addPassageBtn").click(()=>location.assign("/workbook/passage/add/"+ntoa(t))),$("#viewPassageBtn").click(()=>location.assign(`/workbook/passage/${ntoa(t)}/`+ntoa(r))),$("#editWorkbookBtn").click(()=>location.assign("/workbook/mybook/edit/"+ntoa(t))),$(c).sortable({axis:"y",items:">"+u,handle:".js-move-sentence",classes:{"ui-sortable-helper":"shadow-lg"},cursor:"move",update:(e,t)=>{if(confirm("문장을 여기로 이동하겠습니까?")){var n=t.item.prev(u),a=t.item.next(u);if(0==a.length)t.item[0].dataset.ordernum=Number(n[0].dataset.ordernum)+1e3;else if(0==n.length){var o=Number(a[0].dataset.ordernum),s=Math.round(o/2);if(s==o)return alert("더이상 이동할 수 없습니다."),void $(c).sortable("cancel");t.item[0].dataset.ordernum=s}else{const d=Number(n[0].dataset.ordernum),l=Number(a[0].dataset.ordernum),i=Math.round((d+l)/2);if(-1<[d,l].indexOf(i))return alert("더이상 이동할 수 없습니다."),void $(c).sortable("cancel");t.item[0].dataset.ordernum=i}o={sentenceId:Number(t.item.data("sid")),sameText:!0,passageId:r,eng:t.item.find(".sentence-text").text(),orderNum:Number(t.item[0].dataset.ordernum)};editPassageSentece(o,m)}else $(c).sortable("cancel")}}),$(".js-open-add-sentence").click(function(){$(this).add($(".add-section")).slideToggle(100,()=>$(".add-section textarea").focus())}),$(".js-cancel-add").click(function(){$(".add-section textarea").val("").trigger("input"),$(".add-section,.js-open-add-sentence").slideToggle(100)}),$(document).on("click",u+' [data-toggle="collapse"]',function(){$(this.closest(u)).find(".collapse").collapse("toggle")});function g(e){anime({targets:e,duration:1e3,easing:"linear",backgroundColor:["#ffc107",n]})}function m(){$(c).html($(u).sort((e,t)=>e.dataset.ordernum-t.dataset.ordernum).each((e,t)=>$(t).find(".numbering-text").text(e+1)))}function p(){var e=1500<=Array.from($(u+" .sentence-text").get(),e=>e.textContent).join("").length;$(".exceed-max-notice")[e?"slideDown":"slideUp"](100),$(".js-open-add-sentence")[e?"slideUp":"slideDown"](100)}$(document).on("input",".edit-section textarea,.add-section textarea",function(){const e=$(this.closest(".edit-section,.add-section")),t=e.find(".js-edit,.js-add"),n=e.find(".invalid-text");let a=$(this).val().parseToSentences().join(" ").capitalize1st();0==a.length?(n.hide(),t.prop("disabled",!0)):0==a.length||500<a.length||a.match(/[^\u0020-\u007F\u0085\u00A0\u2028\u2029\u2018-\u201A\u201C-\u201D]/gi)?(n.show(),t.prop("disabled",!0)):(n.hide(),t.prop("disabled",!1))}),$(".js-add").click(function(){var e=$(".add-section textarea").val().parseToSentences().join(" ").capitalize1st(),t=Number($(u+":last")[0]?.dataset?.ordernum||0)+1e3,e={sentenceId:0,passageId:r,eng:e,orderNum:t};$("#loadingModal").modal("show"),editPassageSentece(e,function(a){if($("#loadingModal").modal("hide"),0<a.length){let n=`아래와 같은 ${a.length}개의 문장이 추가되었습니다.`;$(".js-cancel-add").trigger("click");const s=document.querySelector(c),d=[];for(let e=0,t=a.length;e<t;e++){var o=a[e];const l=createElement(i);l.querySelector(".sentence-text").textContent=o.eng,l.querySelector(".edit-section textarea").textContent=o.eng,l.dataset.sid=o.sentenceId,l.dataset.ordernum=o.orderNum,s.appendChild(l),n+=`
[${e+1}] `+o.eng,d.push(l)}m(),p(),alert(n),g(d)}},function(){alert("등록에 실패했습니다."),$("#loadingModal").modal("hide")})}),$(document).on("click",".js-edit",function(){const l=$(this.closest(u));let e=l.find(".sentence-text").text(),t=l.find(".edit-section textarea").val().parseToSentences().join(" ").capitalize1st();if(!(0==t.length||500<t.length||t.match(/[^\u0020-\u007F\u0085\u00A0\u2028\u2029\u2018-\u201A\u201C-\u201D]/gi)))if(t==e)l.find(".collapse").collapse("toggle");else{const n={sentenceId:Number(l[0].dataset.sid),passageId:r,eng:t,sameText:!1,orderNum:Number(l[0].dataset.ordernum)};e.toLowerCase().replace(/\s/g,"")==t.toLowerCase().replace(/\s/g,"")?n.sameTextSeq=!0:n.sameTextSeq=!1,$("#loadingModal").modal("show"),editPassageSentece(n,function(d){if($("#loadingModal").modal("hide"),1<d.length){let s=`문장이 아래와 같이 ${d.length}개로 나뉘었습니다.`;l.find(".edit-section").one("hidden.bs.collapse",function(){l.hide(function(){const n=[];for(let e=0,t=d.length;e<t;e++){var a=d[e];const o=l.clone();o.find(".sentence-text, textarea").text(a.eng),o[0].dataset.sid=a.sentenceId,o[0].dataset.ordernum=a.orderNum,l.before(o),s+=`
[${e+1}] `+a.eng,n.push(o[0])}l.remove(),$(u).slideDown(),m(),p(),alert(s),g(n)})}),l.find(".edit-section").collapse("hide")}else 1==d.length&&(alert("수정되었습니다."),l.find(".sentence-text").text(d[0].eng),l[0].dataset.sid=d[0].sentenceId,l.find(".edit-section textarea").val(d[0].eng),l.find(".edit-section").collapse("hide"),g(l[0]))},function(){alert("수정에 실패했습니다."),$("#loadingModal").modal("hide")})}}).on("click",".js-del-sentence",function(){if(confirm("문장을 삭제하시겠습니까?")){const e=$(this.closest(u));delPassageSentence({passageId:r,sentenceId:Number(e[0].dataset.sid)},function(){alert("문장이 삭제되었습니다."),e.slideUp(function(){$(this).remove(),m(),p()})})}})}