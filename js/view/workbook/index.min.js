function pageinit(o,n,r,t){$(window).on("unload",()=>$("#loadingModal").modal("hide"));const f={itemSelector:".passage",columnWidth:".passage",gutter:10,percentPosition:!0,horizontalOrder:!0,transitionDuration:"0.8s"},l={public:[],protected:[],classnote:[]};function c(t,e){var a=[];for(let e=0,o=t?.length;e<o;e++){var i=t[e];a.push(d(i))}e.append(a)}function d(e){var o=$("#hiddenDivs .book-unit").clone(),t=(o.attr("href",location.origin+"/workbook/intro/"+ntoa(e.workBookId)),o.attr("data-work-book-id",e.workBookId).find(".book.cover"));return 0<e.imagePath?.length?(t.find(".default").hide(),t.find(".book-title").hide(),t.find(".book-cover-normal").addClass("swiper-lazy").attr("data-background","/resource/workbook/cover/"+e.imagePath)):(t.find(".swiper-lazy-preloader").remove(),"HELLO-BOOK"==e.title&&t.find(".book-title").hide(),t.find(".book-cover-normal").hide()),o.find(".workbook-type").text(e.workBookType),o.find(".workbook-type").addClass("type-"+e.workBookType),o.find(".book-title").text(e.title),o.find(".book-price").html(0<e.price?e.price.toLocaleString()+" gold eggs":"멤버십 무료"),o[0]}function g(e,{workbookId:t,title:o,description:a,price:i,sub:s,copy:n,imagePath:r,alias:l,aliasImage:c,passageDtoList:d,regDate:g,ssamClassDto:p}){var m=0<e.closest(".classnote-workbook-section").length,l=(e.find(".writer-cover .alias").text(l),e.find(".writer-cover .personacon img").css("background-image",0<c?.length?`url(/resource/profile/images/${c})`:"var(--fc-logo-head)"),e.find(".title").text(o),m&&p&&e.find(".class-name").text(p.className||"이름없음"),e.find(".description").html(a),e.find(".price").text(0<i?i.toLocaleString()+" gold eggs":"무료"),e.find(".sub-btn").data("workBookId",t).toggleClass("bg-secondary",s).prop("disabled",s).text(s?"구독중":"구독"),e.find(".reg-date").text(new Date(g).toLocaleDateString()),e.find(".book-cover").toggleClass("default",null==r||0==r.length).find("img").attr("alt",o),e.find(".book-cover img").css("background-image",0<r?.length?`url(/resource/workbook/cover/${r})`:""),e.find(".book-title").text(o).toggle(null==r||0==r.length),e.find(".background-image").css("background-image","url(https://static.findsvoc.com/images/app/workbook/background/bg-"+(1+Math.floor(4*Math.random()))+".jpg)"),e.find(".catch-phrase-section .message").html(n.message),e.find(".catch-phrase-section .alias").text(n.alias),m&&p&&(p.emblemImagePath&&e.find(".emblem-image-section").css("background-image",`url(/resource/ssam/class/${p.emblemImagePath})`),p.classUri)&&e.find(".emblem-image-section").on("click",()=>{location.assign(location.origin+"/ssamclass/"+p.classUri)}),e.find(".list-passage-section")),c=(l.empty(),null!=l.data("masonry")&&l.masonry("destroy"),d);const h=c.map(e=>e.passageId);l.get(0).appendChild(createElement(Array.from(c,o=>({el:"a",className:"passage sample",href:`${location.origin}/workbook/passage/${ntoa(t)}/`+ntoa(o.passageId),textContent:Array.from(o.sentenceList,e=>e.eng).join(" "),onclick:function(e){e.preventDefault(),sessionStorage.setItem("workbookCover",r),sessionStorage.setItem("passageIdList",JSON.stringify(h)),$("#loadingModal").modal("show"),location.assign(`/workbook/passage/${ntoa(t)}/`+ntoa(o.passageId))}})))),e.is(".collapse.show")?(e[0].scrollIntoView(),l.masonry(f)):e.collapse("show")}Object.keys(l).forEach(async i=>{const t={public:o,protected:n,classnote:r}[i],a=$(`.${i}-workbook-section`);if(t&&0<a.length){let o=1;l[i]=t.content,t.numberOfElements>p()&&!t.last?await $.getJSON(`/workbook/${i.replace("note","")}/list/`+ ++o,function(e){l[i]=l[i].concat(e?.content),c(l[i].splice(0,2*p()),a.find(".swiper-wrapper"))}):c(l[i].splice(0,2*p()),a.find(".swiper-wrapper"));var e=a.find(".book").length,s=[9<e,8<e,10<e,14<e][matchMedia("(max-width: 575.8px)").matches?0:matchMedia("(max-width: 675.8px)").matches?1:matchMedia("(max-width: 991.8px)").matches?2:3];new Swiper(a.find(".swiper")[0],{watchSlidesProgress:!0,resistance:!1,freeMode:s,slidesPerView:"auto",grid:{fill:"row"},breakpoints:{320:{slidesPerGroup:3,autoHeight:e<=3,grid:{rows:6<e?3:3<e?2:1}},576:{slidesPerGroup:4,autoHeight:e<=4,grid:{rows:4<e?2:1}},676:{slidesPerGroup:5,autoHeight:e<=5,grid:{rows:5<e?2:1}},768:{slidesPerGroup:4,spaceBetween:30,autoHeight:e<=4,grid:{rows:4<e?2:1}},992:{slidesPerGroup:7,slidesPerView:7<e?7:"auto",spaceBetween:30,autoHeight:e<=7,grid:{rows:7<e?2:1}}},navigation:{prevEl:a.find(".swiper-button-prev")[0],nextEl:a.find(".swiper-button-next")[0]},lazy:!0,on:{beforeInit:function(e){e.isLast=t.last,t.last||(e.pageNum=o+1)},afterInit:function(e){e.lazy.load()},click:function(e,o){if(e.clickedSlide){const t=$(e.el).closest(".workbook-section").siblings(".workbook-overview-section"),a=e.clickedSlide||o.path.find(e=>e.matches(".book-unit"));e=0<t.closest(".protected-workbook-section").length;$(".book-section .book-unit").not(a).removeClass("active"),$(a).toggleClass("active"),t.find(".description-section").addClass("shrink").css("max-height","13.5rem"),$(a).is(".active")?$(a).data("overview")?g(t,$(a).data("overview")):$.getJSON("/workbook/overview/"+ntoa(a.dataset.workBookId),{classType:e},e=>{$(a).data("overview",e),g(t,e)}).fail(()=>alertModal("워크북정보 가져오기에 실패했습니다.\n다시 접속해 주세요.")):t.collapse("hide")}},slideNextTransitionStart:function(o){if(!(o.isLast||o.isLoading||o.slides.length-o.visibleSlidesIndexes.slice(-1)[0]-1>=p())){var e="classnote"==i?"class":i;o.isLoading=!0;const t=p()-(o.slides.length-o.visibleSlidesIndexes.slice(-1)[0]-1)%p(),a=l[i].splice(0,t);o.loadOver?(o.appendSlide(Array.from(a,e=>d(e))),o.isLast=0==l[i].length):a.length<t?(o.appendSlide(Array.from(a,e=>d(e))),$.getJSON(`/workbook/${e}/list/`+o.pageNum++,function(e){delete o.isLoading,$(o.el).find(".default-message").remove(),l[i]=l[i].concat(e.content),o.appendSlide(Array.from(l[i].splice(0,t-a.length),e=>d(e))),o.update(),e.first&&o.lazy.load(),e.last&&(o.loadOver=!0)}).fail(()=>alert("워크북목록 가져오기에 실패했습니다.\n다시 접속해 주세요."))):(delete o.isLoading,o.appendSlide(Array.from(a,e=>d(e))),o.update())}}}})}}),$(".workbook-overview-section").on("shown.bs.collapse",function(){this.scrollIntoView(),$(this).find(".list-passage-section").masonry(f)}),$(document).on("click",".text-roll-end .fold-icon",function(){const e=$(this).closest(".description-section"),o=e.is(".shrink");var t=o?"100em":"13.5em";o&&e.removeClass("shrink"),anime({targets:e[0],duration:500,delay:0,maxHeight:t,easing:"linear",complete:()=>{$(this).toggleClass("expanded"),o||e.addClass("shrink")}})}),$("#js-play-tutorial").click(function(){$.ajax({dataType:"script",cache:!0,url:"https://static.findsvoc.com/js/app/tutorials.min.js"})}),$(".sub-btn").click(function(){if(0==t)confirmModal("fico 멤버십이 필요합니다.\n로그인 화면으로 이동하시겠습니까?",()=>location.assign("/auth/login"));else{const o=this;var e=$(this).data("workBookId");o.disabled=!0,$.post("/workbook/subscription/"+e,function(e){switch(e){case"success":$(o).addClass("bg-secondary").prop("disabled",!0).text("구독중"),confirmModal('나의 서재에 "구독 워크북"이 추가되었습니다.\n나의 서재로 이동하시겠습니까?',()=>location.assign("/workbook/mylibrary"));break;case"duplicated":$(o).addClass("bg-secondary").text("구독중").prop("disabled",!0),alertModal("이미 구독한 워크북입니다.");break;case"insufficient":$(o).removeClass("bg-secondary").text("구독").prop("disabled",!1),alertModal("잔여 gold egg가 부족합니다.");break;case"unauthorized":$(o).addClass("bg-secondary").text("구독").prop("disabled",!0),alertModal("골드 멤버십 워크북입니다.\n자신의 학습자료를 워크북으로 만들어 보세요.")}}).fail(e=>{403==e.status?location.assign("/membership/expired"):alertModal("워크북 구독에 실패했습니다. 화면 새로고침 후 다시 시도해 주세요.")})}}),$(".workbook-overview-section").on("shown.bs.collapse",function(){this.scrollIntoView({block:"center"}),$(this).find(".list-passage-section").masonry(f)}).on("hidden.bs.collapse",function(){$(this).find(".list-passage-section").find(".passage").remove()});let a;function p(){return matchMedia("(min-width: 992px)").matches?14:matchMedia("(min-width: 768px)").matches?8:matchMedia("(min-width: 676px)").matches?10:matchMedia("(min-width: 576px)").matches?8:9}$(".tab-section").on("show.bs.tab click","[role=tab].active",function(e){a=e.currentTarget!=a?e.currentTarget:($(e.currentTarget).add(e.currentTarget.dataset.bsTarget).removeClass("active show"),null)})}