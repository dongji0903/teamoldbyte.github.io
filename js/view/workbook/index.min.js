function pageinit(o,e,t,i){$(window).on("unload",()=>$("#loadingModal").modal("hide"));const b={itemSelector:".passage",columnWidth:".passage",gutter:10,percentPosition:!0,horizontalOrder:!0,transitionDuration:"0.8s"};function a(t,i){var a=[];for(let o=0,e=t.content?.length;o<e;o++){var s=t.content[o],n=$("#hiddenDivs .book-unit").clone(),r=(n.attr("href",location.origin+"/workbook/intro/"+ntoa(s.workBookId)),n.attr("data-work-book-id",s.workBookId).find(".book.cover"));0<s.imagePath?.length?(r.find(".default").hide(),r.find(".book-title").hide(),r.find(".book-cover-normal").addClass("swiper-lazy").attr("data-background","/resource/workbook/cover/"+s.imagePath)):(r.find(".swiper-lazy-preloader").remove(),"HELLO-BOOK"==s.title&&r.find(".book-title").hide(),r.find(".book-cover-normal").hide()),n.find(".workbook-type").text(s.workBookType),n.find(".workbook-type").addClass("type-"+s.workBookType),n.find(".book-title").text(s.title),n.find(".book-price").html(0<s.price?s.price.toLocaleString()+" fico":"멤버십 무료"),a.push(n[0]),i.appendChild(n[0])}}o&&0<$(".public-workbook-section").length&&a(o,$(".public-workbook-section .list-inline").get(0)),e&&0<$(".protected-workbook-section").length&&a(e,$(".protected-workbook-section .list-inline").get(0)),t&&0<$(".classnote-workbook-section").length&&a(t,$(".classnote-workbook-section .list-inline").get(0)),$(".public-workbook-section,.protected-workbook-section,.classnote-workbook-section").each(function(){const e=$(this).find(".book").length;var o=matchMedia("(max-width: 575.8px)").matches?0:matchMedia("(max-width: 675.8px)").matches?1:matchMedia("(max-width: 991.8px)").matches?2:3,o=[9<e,8<e,10<e,14<e][o];new Swiper($(this).find(".swiper")[0],{watchSlidesProgress:!0,resistance:!1,freeMode:o,slidesPerView:"auto",grid:{fill:"row"},breakpoints:{320:{slidesPerGroup:3,autoHeight:e<=3,grid:{rows:6<e?3:3<e?2:1}},576:{slidesPerGroup:4,autoHeight:e<=4,grid:{rows:4<e?2:1}},676:{slidesPerGroup:5,autoHeight:e<=5,grid:{rows:5<e?2:1}},768:{slidesPerGroup:4,spaceBetween:30,autoHeight:e<=4,grid:{rows:4<e?2:1}},992:{slidesPerGroup:7,slidesPerView:7<e?7:"auto",spaceBetween:30,autoHeight:e<=7,grid:{rows:7<e?2:1}}},navigation:{prevEl:$(this).find(".swiper-button-prev")[0],nextEl:$(this).find(".swiper-button-next")[0]},lazy:!0,on:{beforeInit:function(o){o.isLast=e<24},afterInit:function(o){o.lazy.load()},click:function(o,e){if(o.clickedSlide){const g=$(o.el).closest(".workbook-section").siblings(".workbook-overview-section"),i=o.clickedSlide||e.path.find(o=>o.matches(".book-unit")),k=i.dataset.workBookId,p=ntoa(k);function t({title:o,description:e,price:t,sub:i,copy:a,imagePath:s,alias:n,aliasImage:r,passageDtoList:l,regDate:c}){g.find(".writer-cover .alias").text(n),g.find(".writer-cover .personacon img").css("background-image",0<r?.length?`url(/resource/profile/images/${r})`:"var(--fc-logo-head)"),g.find(".title").text(o),g.find(".description").html(e),g.find(".price").text(0<t?t.toLocaleString()+" fico":"무료"),g.find(".sub-btn").data("workBookId",k).toggleClass("bg-secondary",i).prop("disabled",i).text(i?"구독중":"구독"),g.find(".reg-date").text(new Date(c).toLocaleDateString()),g.find(".book-cover").toggleClass("default",null==s||0==s.length).find("img").attr("alt",o),g.find(".book-cover img").css("background-image",0<s?.length?`url(/resource/workbook/cover/${s})`:""),g.find(".book-title").text(o).toggle(null==s||0==s.length),g.find(".background-image").css("background-image","url(https://static.findsvoc.com/images/app/workbook/background/bg-"+(1+Math.floor(4*Math.random()))+".jpg)"),g.find(".catch-phrase-section .message").html(a.message),g.find(".catch-phrase-section .alias").text(a.alias);n=g.find(".list-passage-section"),n.empty(),null!=n.data("masonry")&&n.masonry("destroy"),r=l;const d=r.map(o=>o.passageId);n.get(0).appendChild(createElement(Array.from(r,e=>({el:"a",className:"passage sample",href:`${location.origin}/workbook/passage/${p}/`+ntoa(e.passageId),textContent:Array.from(e.sentenceList,o=>o.eng).join(" "),onclick:function(o){o.preventDefault(),sessionStorage.setItem("workbookCover",s),sessionStorage.setItem("passageIdList",JSON.stringify(d)),$("#loadingModal").modal("show"),location.assign(`/workbook/passage/${p}/`+ntoa(e.passageId))}})))),g.is(".collapse.show")?(g[0].scrollIntoView(),n.masonry(b)):g.collapse("show")}$(".book-section .book-unit").not(i).removeClass("active"),$(i).toggleClass("active"),$(i).is(".active")?$(i).data("overview")?t($(i).data("overview")):$.getJSON("/workbook/overview/"+ntoa(i.dataset.workBookId),o=>{$(i).data("overview",o),t(o)}).fail(()=>alertModal("워크북정보 가져오기에 실패했습니다.\n다시 접속해 주세요.")):g.collapse("hide")}},reachEnd:function(e){if(!e.isLast&&!e.isLoading){e.isLoading=!0,e.pageNum||(e.pageNum=2);let o="public";0<$(e.el).closest(".protected-workbook-section").length?o="protected":0<$(e.el).closest(".classnote-workbook-section").length&&(o="class"),$.getJSON(`/workbook/${o}/list/`+e.pageNum++,function(o){a(o,e.wrapperEl),e.update(),e.slideNext(),delete e.isLoading,o.last&&(e.isLast=!0)}).fail(()=>alertModal("워크북목록 가져오기에 실패했습니다.\n다시 접속해 주세요."))}}}})}),$(".workbook-overview-section").on("shown.bs.collapse",function(){this.scrollIntoView(),$(this).find(".list-passage-section").masonry(b)}),$("#js-play-tutorial").click(function(){$.ajax({dataType:"script",cache:!0,url:"https://static.findsvoc.com/js/app/tutorials.min.js"})}),$(".sub-btn").click(function(){if(0==i)confirm("fico 멤버십이 필요합니다.\n로그인 화면으로 이동하시겠습니까?")&&location.assign("/auth/login");else{const e=$(this);var o=$(this).data("workBookId");subscribeWorkbook(o,function(o){switch(o){case"success":e.addClass("bg-secondary").prop("disabled",!0).text("구독중"),confirm('나의 서재에 "구독 워크북"이 추가되었습니다.\n나의 서재로 이동하시겠습니까?')&&location.assign("/workbook/mylibrary");break;case"duplicated":alertModal("이미 구독한 워크북입니다.");break;case"insufficient":alertModal("잔여 gold egg가 부족합니다.")}})}}),$(".workbook-overview-section").on("shown.bs.collapse",function(){this.scrollIntoView({block:"center"}),$(this).find(".list-passage-section").masonry(b)}).on("hidden.bs.collapse",function(){$(this).find(".list-passage-section").find(".passage").remove()});let s;$(".tab-section").on("show.bs.tab click","[role=tab].active",function(o){s=o.currentTarget!=s?o.currentTarget:($(o.currentTarget).add(o.currentTarget.dataset.bsTarget).removeClass("active show"),null)})}