function pageinit(o,s,l,d,i,a){$(window).on("unload",()=>$("#loadingModal").modal("hide")),$(document).on("click",".text-roll-end .fold-icon",function(){let e=$(this).closest(".description-section"),t=e.is(".shrink");var s=t?"100em":"13.5em";t&&e.removeClass("shrink"),anime({targets:e[0],duration:500,delay:0,maxHeight:s,easing:"linear",complete:()=>{$(this).toggleClass("expanded"),t||e.addClass("shrink")}})});let r=$(".list-passage-section"),p=$(".page-scroll"),c=(r.masonry({itemSelector:".passage",columnWidth:".passage",gutter:10,percentPosition:!0,horizontalOrder:!0,transitionDuration:"0.8s"}),new IntersectionObserver(e=>{e[0].isIntersecting&&(e=p.data("pagenum"),$.getJSON(`/workbook/passages/${o}?pageNum=`+(e+1),t).fail(()=>{alert("지문 조회에 실패했습니다. 다시 접속해주세요.")}))}));function t(e){if(null!=e&&0<e.content?.length){for(var t of e.content){var s,a,o=$("#hiddenDivs .passage").clone(),i=(o.attr("data-pid",t.passageId),t.title||"제목 없음"),n=(o.find(".passage-title").text(i).attr("title",i),l&&(s=new Date(t.regDate),o.find(".passage-title").text(s.format("yyyy-MM-dd(e)")).attr("title",s.format("yyyy-MM-dd(e)"))),o.find(".passage-title-section .title-input").val(i),d&&t.sample&&o.addClass("sample"),o.find(".passage-text"));for(a of t.sentenceList)n.append(a.eng);r.append(o).masonry("appended",o)}e.last?c.disconnect():p.data("pagenum",e.number+1)}else c.disconnect()}c.observe(p[0]),$(document).on("click",".js-view-passage",function(){var e=Number(this.closest(".passage").dataset.pid);sessionStorage.setItem("workbookCover",s),sessionStorage.setItem("passageIdList",JSON.stringify(a)),$("#loadingModal").modal("show"),location.assign("/workbook/passage/"+ntoa(o)+"/"+ntoa(e))}),l?$(".js-add-passage-open").click(function(){location.assign("/workbook/mystack/add")}):($(".js-add-passage-open").click(function(){33<=a.length?$("#passageLimitModal").modal("show"):(sessionStorage.setItem("workbookCover",this.dataset.cover),sessionStorage.setItem("passageIdList",JSON.stringify(a)),location.assign(`/workbook/passage/add/${ntoa(o)}?wtitle=`+encodeURIComponent($("#title").text())))}),$(document).on("click",".passage-title",function(e){e.stopPropagation(),d&&$(this).hide().siblings(".title-input,.title-edit-btn-section").show().closest(".passage-title-section").addClass("edit")}).on("click",".js-edit-ptitle",function(){let e=this.closest(".passage-title-section"),t=$(e).find(".title-input").val().trim();var s={passageId:this.closest(".passage").dataset.pid};0<t.length&&(s.passageTitle=t),editPassageTitle(s,()=>{alert("지문 제목이 수정되었습니다."),$(e).removeClass("edit"),$(e).find(".passage-title").text(t||"제목 없음").attr("title",t||"제목 없음").show(),$(e).find(".title-input,.title-edit-btn-section").hide()},()=>alert("지문 제목 수정 중 오류가 발생했습니다."))}).on("click",".js-cancel-ptitle",function(){var e=this.closest(".passage-title-section"),t=$(e).find(".passage-title").show();$(e).removeClass("edit"),$(e).find(".title-input").val(t.text()).hide(),$(e).find(".title-edit-btn-section").hide()}).on("click",".js-edit-passage",function(e){e.stopPropagation();var e=Number(this.closest(".passage").dataset.pid),t=this.closest(".passage").querySelector(".passage-title").title;sessionStorage.setItem("workbookId",o),sessionStorage.setItem("workbookCover",s),sessionStorage.setItem("passageIdList",JSON.stringify(a)),sessionStorage.setItem("editingPassageId",e),location.assign(`/workbook/mybook/edit/passage/${ntoa(e)}?ptitle=`+encodeURIComponent(t))}),$(document).on("click",".js-del-passage",function(e){e.stopPropagation();let t=$(this.closest(".passage"));e=t.data("pid");let s=t.closest(".list-passage-section"),a=t.is(".sample");confirm("이 지문을 삭제하시겠습니까?")&&deletePassage({workbookId:o,passageId:e},function(){alert("지문이 삭제되었습니다."),a&&i--;s.masonry("remove",t).masonry("layout")})}).on("click",".js-toggle-sample",function(e){e.stopPropagation();let t=$(this.closest(".passage"));var e=t.data("pid"),s=t.is(".sample")?"이 지문을 샘플에서 제외하시겠습니까?":"이 지문을 샘플로 지정하시겠습니까?";let a=!t.is(".sample");a&&6==i?alert("한 워크북에 지정할 샘플 지문의 최대 갯수는 6개입니다."):confirm(s)&&(s={workbookId:o,passageId:e,sample:a},editPassageSample(s,function(){alert("지문 샘플정보를 변경했습니다."),i+=a?1:-1,t.toggleClass("sample")}))}))}