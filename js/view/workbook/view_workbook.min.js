function pageinit(o,s,l,d,i,a){$("#loadingModal").modal("hide").hide();const c=$(".list-passage-section"),p=$(".page-scroll"),g=(c.masonry({itemSelector:".passage",columnWidth:".passage",gutter:10,percentPosition:!0,horizontalOrder:!0,transitionDuration:"0.8s"}),new IntersectionObserver(t=>{t[0].isIntersecting&&(t=p.data("pagenum"),$.getJSON(`/workbook/passages/${o}?pageNum=`+t,e).fail(()=>{alert("지문 조회에 실패했습니다. 다시 접속해주세요.")}))}));function e(t){if(null!=t&&0<t.content?.length){for(const i of t.content){var e,s=$("#hiddenDivs .passage").clone(),a=(s.attr("data-pid",i.passageId),i.title||"제목 없음"),o=(s.find(".passage-title").text(a).attr("title",a),l&&(e=new Date(i.regDate),s.find(".passage-title").text(e).attr("title",e.format("yyyy-MM-dd(e)"))),s.find(".passage-title-section .title-input").val(a),d&&i.sample&&s.addClass("sample"),s.find(".passage-text"));for(const n of i.sentenceList)o.append(n.eng);c.append(s).masonry("appended",s)}t.last?g.disconnect():p.data("pagenum",t.number+1)}else g.disconnect()}g.observe(p[0]),$(document).on("click",".js-view-passage",function(){var t=Number(this.closest(".passage").dataset.pid);sessionStorage.setItem("workbookCover",s),sessionStorage.setItem("passageIdList",JSON.stringify(a)),$("#loadingModal").modal("show"),location.assign("/workbook/passage/"+ntoa(o)+"/"+ntoa(t))}),l?$(".js-add-passage-open").click(function(){location.assign("/workbook/mystack/add")}):($(".js-add-passage-open").click(function(){30<=a.length?$("#passageLimitModal").modal("show"):(sessionStorage.setItem("workbookCover",this.dataset.cover),sessionStorage.setItem("passageIdList",JSON.stringify(a)),location.assign(`/workbook/passage/add/${ntoa(0)}?wtitle=`+encodeURIComponent($("#title").text())))}),$(document).on("click",".passage-title",function(t){t.stopPropagation(),d&&$(this).hide().siblings(".title-input,.title-edit-btn-section").show().closest(".passage-title-section").addClass("edit")}).on("click",".js-edit-ptitle",function(){const t=this.closest(".passage-title-section"),e=$(t).find(".title-input").val().trim();var s={passageId:this.closest(".passage").dataset.pid};0<e.length&&(s.passageTitle=e),editPassageTitle(s,()=>{alert("지문 제목이 수정되었습니다."),$(t).removeClass("edit"),$(t).find(".passage-title").text(e||"제목 없음").attr("title",e||"제목 없음").show(),$(t).find(".title-input,.title-edit-btn-section").hide()},()=>alert("지문 제목 수정 중 오류가 발생했습니다."))}).on("click",".js-cancel-ptitle",function(){var t=this.closest(".passage-title-section"),e=$(t).find(".passage-title").show();$(t).removeClass("edit"),$(t).find(".title-input").val(e.text()).hide(),$(t).find(".title-edit-btn-section").hide()}).on("click",".js-edit-passage",function(t){t.stopPropagation();var t=Number(this.closest(".passage").dataset.pid),e=this.closest(".passage").querySelector(".passage-title").title;sessionStorage.setItem("workbookId",o),sessionStorage.setItem("workbookCover",s),sessionStorage.setItem("passageIdList",JSON.stringify(a)),sessionStorage.setItem("editingPassageId",t),location.assign(`/workbook/mybook/edit/passage/${ntoa(t)}?ptitle=`+encodeURIComponent(e))}),$(document).on("click",".js-del-passage",function(t){t.stopPropagation();const e=$(this.closest(".passage"));t=e.data("pid");const s=e.closest(".list-passage-section"),a=e.is(".sample");confirm("이 지문을 삭제하시겠습니까?")&&deletePassage({workbookId:o,passageId:t},function(){alert("지문이 삭제되었습니다."),a&&i--;s.masonry("remove",e).masonry("layout")})}).on("click",".js-toggle-sample",function(t){t.stopPropagation();const e=$(this.closest(".passage"));var t=e.data("pid"),s=e.is(".sample")?"이 지문을 샘플에서 제외하시겠습니까?":"이 지문을 샘플로 지정하시겠습니까?";const a=!e.is(".sample");a&&6==i?alert("한 워크북에 지정할 샘플 지문의 최대 갯수는 6개입니다."):confirm(s)&&(s={workbookId:o,passageId:t,sample:a},editPassageSample(s,function(){alert("지문 샘플정보를 변경했습니다."),i+=a?1:-1,e.toggleClass("sample")}))}))}