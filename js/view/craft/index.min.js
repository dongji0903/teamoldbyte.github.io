async function pageinit(c,d){"back_forward"==performance.getEntriesByType("navigation")[0].type&&location.reload();const n=!Cookies?.get("EID")&&!Cookies?.get("FMID"),i="/craft/battle/";let o=[],a=2;const s={"Ѐ":'"bid":',"Ё":'"rnum":',"Ђ":'"categoryId":',"Ѓ":'"sentenceId":',"Є":'"memberId":',"Ѕ":'"diffLevel":',"І":'"engLength":',"Ї":'"engLevel":',"Ј":'"battleType":',"Љ":'"eng":',"Њ":'"grammarTitle":',"Ћ":'"askTag":',"Ќ":'"ask":',"Ѝ":'"source":',"Ў":'"comment":',"Џ":'"example":',"А":'"answer":',"Б":'"regDate":',"В":'"updateDate":',"Г":'"[[',"Д":']]"',"Е":"],["};function l(e){return pako.deflateRaw(function(e){let t=new Map(Object.entries(s).map(([e,t])=>[t,e]));var a=new RegExp(Array.from(t.keys()).join("|").replace(/\[/g,"\\["),"g");return e.replace(a,e=>t.get(e))}(JSON.stringify(e)))}$.cachedScript=$.cachedScript||function(e,t){return $.ajax($.extend(t||{},{dataType:"script",cache:!0,url:e}))};const r='<span style="color: #ffc107;font-weight: bold;">골드 멤버십 서비스</span>입니다.\n문장 구조와 표현을 확인할 수 있는 \n<b>다양한 테스트</b>를 통해 문장을 완전히 파악해 보세요.';if(0==c&&Cookies.get("FMID")){$(".record-stat .alias").text(localStorage.getItem("FM_NAME"));const y="StepBattle"+ntoa(10000001);await $.cachedScript("https://cdn.jsdelivr.net/npm/idb@7/build/umd-with-async-ittr.js"),await $.cachedScript("https://cdn.jsdelivr.net/npm/pako/dist/pako.min.js"),(await indexedDB.databases()).forEach(({name:e,version:t})=>{"findsvoc-idb"==e&&t>=a&&(a=t)}),idb.openDB("findsvoc-idb",a,{async upgrade(e,t,a,o){var s=e.createObjectStore(y,{autoIncrement:!0});if(s.createIndex("bid","bid"),s.createIndex("data","data"),s.createIndex("solve","solve"),1==t){t=await o.objectStore("StepBattle").getAll();t.sort((e,t)=>e.data.rnum-t.data.rnum);for(const n of t)await s.add({...n,bid:ntoa(n.bid),data:l(n.data)});e.deleteObjectStore("StepBattle")}}}).then(a=>{const o={O:0,X:0};a.transaction(y).store.openCursor().then(function e(t){t?(o[t.value.solve]++,t.continue().then(e)):($("#correctRecord").text(o.O),$("#incorrectRecord").text(o.X),$("#totalRecord").text(o.O+o.X),k(),a.close(),$.getJSON("https://static.findsvoc.com/data/craft/rank-list.json",e=>{e=e.reverse().find(e=>e.startValue<o.O).rankTitle;document.querySelector(".rank-icon").replaceChildren(createElement({el:"object",type:"image/svg+xml",data:`https://static.findsvoc.com/images/app/craft/${e}.svg`}))}))})})}else 0==c&&(o=JSON.parse(localStorage.getItem("wanderingBooks"))||[]),k();var e="TCBSC_"+ntoa(c);let t=0;var p=localStorage.getItem(e);null!=p&&JSON.parse(p).date==(new Date).toLocaleDateString()&&(t=JSON.parse(p).count),0<$("#overCount").length&&(t=parseInt($("#overCount").val()),localStorage.setItem(e,JSON.stringify({date:(new Date).toLocaleDateString(),count:t}))),50<=t&&$(".js-play-step").addClass("disabled").removeAttr("onclick").attr("data-bs-toggle","tooltip").attr("data-bs-html","true").attr("title","일일 최대 플레이 횟수에 도달하였습니다.<br>내일 다시 찾아와 주세요.").tooltip();const u={T:"theme",S:"subscription",G:"grammar"},g=[{classname:"rewind",mtype:"r",fas:"history",title:"리뷰 플레이"},{classname:"wrong",mtype:"w",fas:"times",title:"오답 플레이"},{classname:"save",mtype:"s",fas:"save",title:"보관 플레이"}];function b(e,m){return createElement(Array.from(e?.content,({battleBookId:e,bbid:t,title:a,bookType:o,description:s,imagePath:n,completed:i,price:l,openType:r},c)=>{var d={el:"span",className:"title-text",textContent:a},p="book-cover"+(n?"":" default")+(i?" pe-none":""),b=n?{backgroundImage:`url(/resource/battlebook/cover/${n})`}:{};return"subscription"==m?{el:"div",className:"book col-6 row g-0",dataset:{bid:e||t,bookType:u[o],title:a,completed:i},children:[{el:"div",className:"col-auto",children:[{el:"div",className:p,children:[{el:"img",src:"https://static.findsvoc.com/images/app/workbook/bookcover/book_paper.png",style:b},i?{el:"span",className:"completed"}:{el:"span",className:"play-btn-cover js-play-book","data-mtype":"b",title:"배틀북 플레이"}]}]},{el:"div",className:"col position-relative book-info-section",children:[{el:"div",className:"my-1",children:[d]},{el:"div",className:"button-section col-12 row row-cols-3 g-0 text-center btn-group",children:Array.from(g,({classname:e,mtype:t,fas:a,title:o})=>"r"!==t||i?{el:"button",className:`js-play-book ${e}-book-btn btn`,"data-mtype":t,title:o,children:[{el:"i",className:"icon fas fa-"+a}]}:{el:"div",title:"배틀을 끝까지 완료 후 리뷰 플레이가 가능합니다.",children:[{el:"button",className:"rewind-book-btn btn w-100",disabled:!0,children:[{el:"i",className:"icon fas fa-"+a}]}]})}]}]}:{el:"div",className:"book js-open-overview col text-center",dataset:{bid:e||t,title:a,bookType:u[o],description:s,imagePath:n||"",completed:i,price:l,openType:r},style:"order: "+c,children:[{el:"div",className:p,children:[{el:"img",src:"https://static.findsvoc.com/images/app/workbook/bookcover/book_paper.png",style:b}]},{el:"div",className:"title-text-section",children:[d]}]}}))}function m(t){var e=t.totalPages,a=t.number+1,t=10*(Math.ceil(a/10)-1)+1,o=10+t<=e?10+t-1:e,s=[];for(let e=t;e<=o;e++)s.push({el:"span",className:"page-item swiper-pagination-bullet"+(a==e?" swiper-pagination-bullet-active":""),"data-pagenum":e});return 10<t&&s.unshift({el:"span",className:"page-item",role:"button","data-pagenum":t-1,innerHTML:"&laquo;"}),o<e&&s.push({el:"span",className:"page-item",role:"button","data-pagenum":o+1,innerHTML:"&raquo;"}),s}$(".battle-book-list").one("show.bs.collapse",function(){let t=this.className.match(/subscription|theme|grammar/);if(t){t=t[0];const a=this.querySelector(".book-list-container");if(null!=a){const o=a.nextElementSibling?.querySelector(".swiper-pagination");$.ajax({url:`/craft/battlebook/${t}/list`,success:e=>{e?.pageable?(this.setAttribute("initialized",!0),e&&0!=e?.content?.length&&(a.querySelectorAll(".book")?.forEach(e=>e.remove()),a.appendChild(b(e,t)),o?.querySelectorAll(".page-item")?.forEach(e=>e.remove()),o?.appendChild(createElement(m(e))))):alertModal("올바른 데이터를 받지 못했습니다.\n화면을 새로고침 해주세요.")},error:e=>{401==e.status?alertModal("접속시간이 초과되었습니다.\n로그인 화면으로 이동합니다.",()=>location.assign("/auth/login?destPage=/craft/main")):403==e.status?alertModal(r):alertModal("배틀북 조회에 실패했습니다.\n화면 새로고침 후 다시 시도해 주세요.")}})}}}).on("click",".page-item",function(){if(!this.classList.contains("swiper-pagination-bullet-active")){var e=this.closest(".pagination-section");const a=e.dataset.content;var t=this.dataset.pagenum;const o=e.previousElementSibling;if(null!=o){const s=o.nextElementSibling?.querySelector(".swiper-pagination");$.ajax({url:`/craft/battlebook/${a}/list`,data:{pageNum:t},success:e=>{e?.pageable?(o.querySelectorAll(".book")?.forEach(e=>e.remove()),o.appendChild(b(e,a)),s?.querySelectorAll(".page-item")?.forEach(e=>e.remove()),s?.appendChild(createElement(m(e)))):alertModal("올바른 데이터를 받지 못했습니다.\n화면을 새로고침 해주세요.")},error:e=>{401==e.status?alertModal("접속시간이 초과되었습니다.\n로그인 화면으로 이동합니다.",()=>location.assign("/auth/login?destPage=/craft/main")):403==e.status?alertModal(r):alertModal("배틀북 조회에 실패했습니다.\n화면 새로고침 후 다시 시도해 주세요.")}})}}}),c&&["A","S","M"].includes(d)&&"true"==sessionStorage.getItem("subscriptionBattleOpened")&&$(".battle-book-list.subscription").collapse("show");let h=devSize.isPhone()?3:devSize.isTablet()?4:5;$(window).on("resize",function(){h=devSize.isPhone()?3:devSize.isTablet()?4:5,$(".battlebook-overview-section").each(function(){var e=$(this).data("targetBook");e&&(this.style.order=(Math.floor(e.style.order/h)+1)*h)})});const f={T:"클래스용",P:"회원/비회원",M:"회원용"};function v(e){const t=e.match(/(?:craft\/battle\/\w+\/\w\/)(\w+)/)[1];var a;o.includes(t)?location.assign(e):(a=document.getElementById("askMembershipModal")||document.body.appendChild(createElement({el:"div",id:"askMembershipModal","data-bs-backdrop":"static","data-bs-return":"0",class:"modal fade",tabIndex:0,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-header bg-fc-purple py-1 px-3",children:[{el:"h5",class:"modal-title",textContent:"이용 안내"},{el:"button",class:"btn fas fa-times text-light p-0","data-bs-dismiss":"modal","aria-label":"Close"}]},{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section mb-3 text-center text-dark",innerHTML:"<span class='app-name-text'>fico</span> 이용자 <b class='text-fc-red'>가입</b>시 테스트 <b>진행기록</b>과 <b>전적 정보</b>가 <b>저장</b>되어 다음에도 로그인없이 배틀을 <b>이어서 이용</b>할 수 있습니다."},{el:"div",className:"col text-center",children:[{el:"button",class:"btn btn-fico w-100",innerHTML:"<b>예</b><br><span class='fs-7'>(이용자 간편가입)</span>",onclick:()=>{location.assign("/membership/free?destPage="+e)}}]},{el:"div",className:"col text-center",children:[{el:"button",class:"btn btn-outline-fico w-100",innerHTML:"<b>아니오</b><br><span class='fs-7'>(가입없이 진행)</span>",onclick:()=>{o.push(t),localStorage.setItem("wanderingBooks",JSON.stringify(o)),location.assign(e)}}]}]}]}]}]})),$(a).modal("show"))}function k(){const t=(parseInt($("#correctRecord").text())/parseInt($("#totalRecord").text())*100||0).toFixed(1),a=$(".winning-rate-cover .bar"),o=$(".winning-rate-cover .needle"),s=$(".winning-rate-cover .rate-text"),n=$(".personal-info-block .rate-text-section"),i={now:0};anime({targets:i,now:100,easing:"easeOutQuad",delay:500,update:e=>{a.css("transform",`rotate(${45+1.8*i.now*t/100}deg)`),o.add(n).css("transform",`rotate(${1.8*i.now*t/100-90}deg)`),s.text((i.now*t/100).toFixed(1))}})}$(document).on("click",".js-open-overview",function(){const a=$(this).siblings(".battlebook-overview-section"),{bid:e,title:o,description:s,imagePath:n,price:i,openType:l,completed:r}=this.dataset;a.data("targetBook")==this?(a.collapse("hide"),a.data("targetBook",null)):(a.data("targetBook",this),$.getJSON("/craft/battlebook/overview/"+ntoa(e),e=>{(t=this.closest(".battle-book-list").className.match(/subscription|theme|grammar/))&&t[0];var t=(Math.floor(this.style.order/h)+1)*h,t=(a.css("order",t),a.is(".show")?a[0].scrollIntoView({behavior:"smooth",block:"nearest"}):a.collapse("show"),a.find(".book-title").text(o),a.find(".book-cover"));0<n?.length?t.removeClass("default").find("img").css("background-image",`url(/resource/battlebook/cover/${n})`):t.addClass("default").find("img").css("background-image",""),a.find(".description").html(s),a.find(".book-open-type").text(f[l]).attr("data-open",l),a.find(".book-price").text(i.toLocaleString()),a.find(".sub-btn").toggleClass("bg-secondary",0==c&&"P"!=l||0==c&&"true"==r||0!=c&&!!e||!e&&"U"==d).prop("disabled",0==c&&"P"!=l||0==c&&"true"==r||0!=c&&!!e||!e&&"U"==d).html(0==c?"P"==l?"true"==r?"플레이 완료":'<i class="fas fa-play me-3"></i>바로 플레이':"회원 전용":e?"구독중":"U"==d?"구독 불가 (멤버십 만료)":"구독")}).fail(()=>alertModal("배틀북 정보 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$(".battlebook-overview-section, .battle-book-list").on("shown.bs.collapse",function(e){"subscription"==this.className.match(/subscription|theme|grammar/)&&sessionStorage.setItem("subscriptionBattleOpened","true"),e.stopPropagation(),this.scrollIntoView({behavior:"smooth",block:"nearest"})}).on("hide.bs.collapse",function(){"subscription"==this.className.match(/subscription|theme|grammar/)&&sessionStorage.setItem("subscriptionBattleOpened","false")}),$(".battlebook-overview-section").on("click",".sub-btn",function(){const{bid:e,title:t,openType:a,bookType:o,completed:s}=$(this).closest(".battlebook-overview-section").data("targetBook").dataset;if(!c)return"P"==a?Cookies.get("FMID")?void location.assign(i+o+`/b/${ntoa(parseInt(e))}?title=${encodeURIComponent(t)}&bookType=${o}&completed=${s}&wanderer=`+n):void v(i+o+`/b/${ntoa(parseInt(e))}?title=${encodeURIComponent(t)}&bookType=${o}&completed=${s}&wanderer=`+n):void(confirmModal("fico 멤버십이 필요합니다.\n로그인 화면으로 이동하시겠습니까?")&&location.assign("/auth/login"));$.post("/craft/battlebook/subscription/"+e,e=>{switch(e){case"success":alertModal(`"${t}"을(를) 구독하였습니다.
개인별 학습에서 구독한 배틀북을 확인할 수 있습니다.
녹색 플레이 버튼을 눌러 배틀을 풀어보세요`,()=>{$(this).prop("disabled",!0).text("구독중"),$(".battle-book-list.subscription").attr("initialized")?$.getJSON("/craft/battlebook/subscription/list",e=>{$(".my-book-type.subscription .book-list-container").empty().append(b(e,"subscription")).collapse("show")}):$(".battle-book-list.subscription").collapse("show")});break;case"duplicated":alertModal("이미 구독한 배틀북입니다.\n'개인별 학습'을 참고해 주세요.");break;case"insufficient":alertModal("잔여 fico 코인이 부족합니다.")}}).fail(e=>{403===e.status?alertModal(r):alertModal("배틀북 구독에 실패했습니다. 화면 새로고침 후 다시 시도해 주세요.")})}),$(document).on("click",".js-play-step",function(){n?location.assign("/membership/free"):!c&&Cookies?.get("EID")?location.assign("/auth/login?destPage=/craft/main"):location.assign(i+"step/b?title=단계별 학습&bookType=step&wanderer="+n)}).on("click",".js-play-book",function(){var{bid:e,title:t,bookType:a,completed:o}=this.closest(".book").dataset,s=this.dataset.mtype,e="step"===a?"":"/"+ntoa(e),o=void 0===o?"":"&completed="+o;n?v(i+a+`/${s}${e}?title=${encodeURIComponent(t)}&bookType=${a}${o}&wanderer=`+n):location.assign(i+a+`/${s}${e}?title=${encodeURIComponent(t)}&bookType=${a}${o}&wanderer=`+n)})}