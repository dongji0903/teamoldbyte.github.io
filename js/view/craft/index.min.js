async function pageinit(c,d){"back_forward"==performance.getEntriesByType("navigation")[0].type&&location.reload();let o=2;const a={"Ѐ":'"bid":',"Ё":'"rnum":',"Ђ":'"categoryId":',"Ѓ":'"sentenceId":',"Є":'"memberId":',"Ѕ":'"diffLevel":',"І":'"engLength":',"Ї":'"engLevel":',"Ј":'"battleType":',"Љ":'"eng":',"Њ":'"grammarTitle":',"Ћ":'"askTag":',"Ќ":'"ask":',"Ѝ":'"source":',"Ў":'"comment":',"Џ":'"example":',"А":'"answer":',"Б":'"regDate":',"В":'"updateDate":',"Г":'"[[',"Д":']]"',"Е":"],["};function n(e){return pako.deflateRaw(function(e){let t=new Map(Object.entries(a).map(([e,t])=>[t,e]));var o=new RegExp(Array.from(t.keys()).join("|").replace(/\[/g,"\\["),"g");return e.replace(o,e=>t.get(e))}(JSON.stringify(e)))}if($.cachedScript=$.cachedScript||function(e,t){return $.ajax($.extend(t||{},{dataType:"script",cache:!0,url:e}))},0==c&&localStorage.getItem("FM_NAME")){$(".record-stat .alias").text(localStorage.getItem("FM_NAME"));const l="StepBattle"+ntoa(10000001);await $.cachedScript("https://cdn.jsdelivr.net/npm/idb@7/build/umd-with-async-ittr.js"),await $.cachedScript("https://cdn.jsdelivr.net/npm/pako/dist/pako.min.js"),(await indexedDB.databases()).forEach(({name:e,version:t})=>{"findsvoc-idb"==e&&t>=o&&(o=t)}),idb.openDB("findsvoc-idb",o,{async upgrade(e,t,o,a){var i=e.createObjectStore(l,{autoIncrement:!0});if(i.createIndex("bid","bid"),i.createIndex("data","data"),i.createIndex("solve","solve"),1==t){t=await a.objectStore("StepBattle").getAll();t.sort((e,t)=>e.data.rnum-t.data.rnum);for(const s of t)await i.add({...s,bid:ntoa(s.bid),data:n(s.data)});e.deleteObjectStore("StepBattle")}}}).then(o=>{const a={O:0,X:0};o.transaction(l).store.openCursor().then(function e(t){t?(a[t.value.solve]++,t.continue().then(e)):($("#correctRecord").text(a.O),$("#incorrectRecord").text(a.X),$("#totalRecord").text(a.O+a.X),r(),o.close(),$.getJSON("https://static.findsvoc.com/data/craft/rank-list.json",e=>{e=e.reverse().find(e=>e.startValue<a.O).rankTitle;document.querySelector(".rank-icon").replaceChildren(createElement({el:"object",type:"image/svg+xml",data:`https://static.findsvoc.com/images/app/craft/${e}.svg`}))}))})})}else r();var e="TCBSC_"+ntoa(c);let t=0;var i=localStorage.getItem(e);null!=i&&JSON.parse(i).date==(new Date).toLocaleDateString()&&(t=JSON.parse(i).count),0<$("#overCount").length&&(t=parseInt($("#overCount").val()),localStorage.setItem(e,JSON.stringify({date:(new Date).toLocaleDateString(),count:t}))),50<=t&&$(".js-play-step").addClass("disabled").removeAttr("onclick").attr("data-bs-toggle","tooltip").attr("data-bs-html","true").attr("title","일일 최대 플레이 횟수에 도달하였습니다.<br>내일 다시 찾아와 주세요.").tooltip();const g={T:"theme",S:"subscription",G:"grammar"},u=[{classname:"rewind",mtype:"r",fas:"history",title:"리뷰 플레이"},{classname:"wrong",mtype:"w",fas:"times",title:"오답 플레이"},{classname:"save",mtype:"s",fas:"save",title:"보관 플레이"}];function s(e,m){return createElement(Array.from(e,({battleBookId:e,bbid:t,title:o,bookType:a,description:i,imagePath:s,completed:n,price:r,openType:l},c)=>{var d={el:"span",className:"title-text",textContent:o},p="book-cover"+(s?"":" default"),b=s?{backgroundImage:`url(/resource/battlebook/cover/${s})`}:{};return"subscription"==m?{el:"div",className:"book col-6 row g-0",dataset:{bid:e||t,bookType:g[a],title:o},children:[{el:"div",className:"col-auto",children:[{el:"div",className:p,children:[{el:"img",src:"https://static.findsvoc.com/images/app/workbook/bookcover/book_paper.png",style:b},n?{el:"span",className:"completed"}:{el:"span",className:"play-btn-cover js-play-book","data-mtype":"b",title:"배틀북 플레이"}]}]},{el:"div",className:"col position-relative book-info-section",children:[{el:"div",className:"my-1",children:[d]},{el:"div",className:"button-section col-12 row row-cols-3 g-0 text-center btn-group",children:Array.from(u,({classname:e,mtype:t,fas:o,title:a})=>"r"!==t||n?{el:"button",className:`js-play-book ${e}-book-btn btn`,"data-mtype":t,title:a,children:[{el:"i",className:"icon fas fa-"+o}]}:{el:"div",title:"배틀을 끝까지 완료 후 리뷰 플레이가 가능합니다.",children:[{el:"button",className:"rewind-book-btn btn w-100",disabled:!0,children:[{el:"i",className:"icon fas fa-"+o}]}]})}]}]}:{el:"div",className:"book js-open-overview col text-center",dataset:{bid:e||t,title:o,bookType:g[a],description:i,imagePath:s||"",completed:n,price:r,openType:l},style:"order: "+c,children:[{el:"div",className:p,children:[{el:"img",src:"https://static.findsvoc.com/images/app/workbook/bookcover/book_paper.png",style:b}]},{el:"div",className:"title-text-section",children:[d]}]}}))}$(".battle-book-list").one("show.bs.collapse",function(){let t=this.className.match(/subscription|theme|grammar/);if(t){t=t[0];const o=this.querySelector(".book-list-container");null!=o&&$.getJSON(`/craft/battlebook/${t}/list`,e=>{this.setAttribute("initialized",!0),e&&0!=e.length&&o.appendChild(s(e,t))})}});let p=devSize.isPhone()?3:5;$(window).on("resize",function(){p=devSize.isPhone()?3:5});const b={T:"특정 클래스 멤버십 결제 회원",P:"모든 사용자",M:"멤버십 결제 회원"};function r(){const t=(parseInt($("#correctRecord").text())/parseInt($("#totalRecord").text())*100||0).toFixed(1),o=$(".winning-rate-cover .bar"),a=$(".winning-rate-cover .needle"),i=$(".winning-rate-cover .rate-text"),s=$(".personal-info-block .rate-text-section"),n={now:0};anime({targets:n,now:100,easing:"easeOutQuad",delay:500,update:e=>{o.css("transform",`rotate(${45+1.8*n.now*t/100}deg)`),a.add(s).css("transform",`rotate(${1.8*n.now*t/100-90}deg)`),i.text((n.now*t/100).toFixed(1))}})}$(document).on("click",".js-open-overview",function(){const a=$(this).siblings(".battlebook-overview-section"),{bid:e,title:i,description:s,imagePath:n,price:r,openType:l}=this.dataset;a.data("targetBook")==this?(a.collapse("hide"),a.data("targetBook",null)):(a.data("targetBook",this),$.getJSON("/craft/battlebook/overview/"+ntoa(e),({sub:e})=>{let t=this.closest(".battle-book-list").className.match(/subscription|theme|grammar/);t=t&&t[0];var o=(Math.floor($(this).index(`.${t} .book`)/p)+1)*p,o=(a.css("order",o),a.is(".show")?a[0].scrollIntoView({behavior:"smooth",block:"nearest"}):a.collapse("show"),a.find(".book-title").text(i),a.find(".book-cover"));0<n?.length?o.removeClass("default").find("img").css("background-image",`url(/resource/battlebook/cover/${n})`):o.addClass("default").find("img").css("background-image",""),a.find(".description").html(s),a.find(".book-open-type").text(b[l]).attr("data-open",l),a.find(".book-price").text(r.toLocaleString()),a.find(".sub-btn").toggleClass("bg-secondary",0==c&&"P"!=l||0!=c&&!!e||!e&&"U"==d).prop("disabled",0==c&&"P"!=l||0!=c&&!!e||!e&&"U"==d).html(0==c?"P"==l?'<i class="fas fa-play"></i> 바로 플레이':"멤버십 전용":e?"구독중":"U"==d?"구독 불가 (멤버십 만료)":"구독")}).fail(()=>alertModal("배틀북 정보 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$(".battlebook-overview-section, .battle-book-list").on("shown.bs.collapse",function(e){e.stopPropagation(),this.scrollIntoView({behavior:"smooth",block:"nearest"})}),$(".battlebook-overview-section").on("click",".sub-btn",function(){const{bid:e,title:t,openType:o,bookType:a}=$(this).closest(".battlebook-overview-section").data("targetBook").dataset;if(0==c)return"P"==o?void location.assign(`/craft/battle/${a}/b/${ntoa(parseInt(e))}?title=${encodeURIComponent(t)}&bookType=`+a):void(confirmModal("fico 멤버십이 필요합니다.\n로그인 화면으로 이동하시겠습니까?")&&location.assign("/auth/login"));$.post("/craft/battlebook/subscription/"+e,e=>{switch(e){case"success":alertModal(`"${t}"을(를) 구독하였습니다.
개인별 학습에서 구독한 배틀북을 확인할 수 있습니다.
녹색 플레이 버튼을 눌러 배틀을 풀어보세요`,()=>{$(this).prop("disabled",!0).text("구독중"),$(".battle-book-list.subscription").attr("initialized")?$.getJSON("/craft/battlebook/subscription/list",e=>{$(".my-book-type.subscription .book-list-container").empty().append(s(e,"subscription")).collapse("show")}):$(".battle-book-list.subscription").collapse("show")});break;case"duplicated":alertModal("이미 구독한 배틀북입니다.\n'개인별 학습'을 참고해 주세요.");break;case"insufficient":alertModal("잔여 fico 코인이 부족합니다.")}}).fail(()=>alertModal("배틀북 구독에 실패했습니다. 화면 새로고침 후 다시 시도해 주세요."))}),$(document).on("click",".js-play-book",function(){var{bid:e,title:t,bookType:o}=this.closest(".book").dataset,a=this.dataset.mtype,e="step"===o?"":"/"+ntoa(e);location.assign(`/craft/battle/${o}/${a}${e}?title=${encodeURIComponent(t)}&bookType=`+o)})}