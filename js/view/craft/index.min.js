async function pageinit(c,d){"back_forward"==performance.getEntriesByType("navigation")[0].type&&location.reload();const i=!Cookies?.get("EID")&&!Cookies?.get("FMID"),n="/craft/battle/";let a=[],o=2;const s={"Ѐ":'"bid":',"Ё":'"rnum":',"Ђ":'"categoryId":',"Ѓ":'"sentenceId":',"Є":'"memberId":',"Ѕ":'"diffLevel":',"І":'"engLength":',"Ї":'"engLevel":',"Ј":'"battleType":',"Љ":'"eng":',"Њ":'"grammarTitle":',"Ћ":'"askTag":',"Ќ":'"ask":',"Ѝ":'"source":',"Ў":'"comment":',"Џ":'"example":',"А":'"answer":',"Б":'"regDate":',"В":'"updateDate":',"Г":'"[[',"Д":']]"',"Е":"],["};function l(e){return pako.deflateRaw(function(e){let t=new Map(Object.entries(s).map(([e,t])=>[t,e]));var o=new RegExp(Array.from(t.keys()).join("|").replace(/\[/g,"\\["),"g");return e.replace(o,e=>t.get(e))}(JSON.stringify(e)))}if($.cachedScript=$.cachedScript||function(e,t){return $.ajax($.extend(t||{},{dataType:"script",cache:!0,url:e}))},0==c&&Cookies.get("FMID")){$(".record-stat .alias").text(localStorage.getItem("FM_NAME"));const k="StepBattle"+ntoa(10000001);await $.cachedScript("https://cdn.jsdelivr.net/npm/idb@7/build/umd-with-async-ittr.js"),await $.cachedScript("https://cdn.jsdelivr.net/npm/pako/dist/pako.min.js"),(await indexedDB.databases()).forEach(({name:e,version:t})=>{"findsvoc-idb"==e&&t>=o&&(o=t)}),idb.openDB("findsvoc-idb",o,{async upgrade(e,t,o,a){var s=e.createObjectStore(k,{autoIncrement:!0});if(s.createIndex("bid","bid"),s.createIndex("data","data"),s.createIndex("solve","solve"),1==t){t=await a.objectStore("StepBattle").getAll();t.sort((e,t)=>e.data.rnum-t.data.rnum);for(const i of t)await s.add({...i,bid:ntoa(i.bid),data:l(i.data)});e.deleteObjectStore("StepBattle")}}}).then(o=>{const a={O:0,X:0};o.transaction(k).store.openCursor().then(function e(t){t?(a[t.value.solve]++,t.continue().then(e)):($("#correctRecord").text(a.O),$("#incorrectRecord").text(a.X),$("#totalRecord").text(a.O+a.X),f(),o.close(),$.getJSON("https://static.findsvoc.com/data/craft/rank-list.json",e=>{e=e.reverse().find(e=>e.startValue<a.O).rankTitle;document.querySelector(".rank-icon").replaceChildren(createElement({el:"object",type:"image/svg+xml",data:`https://static.findsvoc.com/images/app/craft/${e}.svg`}))}))})})}else 0==c&&(a=JSON.parse(localStorage.getItem("wanderingBooks"))||[]),f();var e="TCBSC_"+ntoa(c);let t=0;var r=localStorage.getItem(e);null!=r&&JSON.parse(r).date==(new Date).toLocaleDateString()&&(t=JSON.parse(r).count),0<$("#overCount").length&&(t=parseInt($("#overCount").val()),localStorage.setItem(e,JSON.stringify({date:(new Date).toLocaleDateString(),count:t}))),50<=t&&$(".js-play-step").addClass("disabled").removeAttr("onclick").attr("data-bs-toggle","tooltip").attr("data-bs-html","true").attr("title","일일 최대 플레이 횟수에 도달하였습니다.<br>내일 다시 찾아와 주세요.").tooltip();const g={T:"theme",S:"subscription",G:"grammar"},u=[{classname:"rewind",mtype:"r",fas:"history",title:"리뷰 플레이"},{classname:"wrong",mtype:"w",fas:"times",title:"오답 플레이"},{classname:"save",mtype:"s",fas:"save",title:"보관 플레이"}];function p(e,m){return createElement(Array.from(e,({battleBookId:e,bbid:t,title:o,bookType:a,description:s,imagePath:i,completed:n,price:l,openType:r},c)=>{var d={el:"span",className:"title-text",textContent:o},p="book-cover"+(i?"":" default"),b=i?{backgroundImage:`url(/resource/battlebook/cover/${i})`}:{};return"subscription"==m?{el:"div",className:"book col-6 row g-0",dataset:{bid:e||t,bookType:g[a],title:o,completed:n},children:[{el:"div",className:"col-auto",children:[{el:"div",className:p,children:[{el:"img",src:"https://static.findsvoc.com/images/app/workbook/bookcover/book_paper.png",style:b},n?{el:"span",className:"completed"}:{el:"span",className:"play-btn-cover js-play-book","data-mtype":"b",title:"배틀북 플레이"}]}]},{el:"div",className:"col position-relative book-info-section",children:[{el:"div",className:"my-1",children:[d]},{el:"div",className:"button-section col-12 row row-cols-3 g-0 text-center btn-group",children:Array.from(u,({classname:e,mtype:t,fas:o,title:a})=>"r"!==t||n?{el:"button",className:`js-play-book ${e}-book-btn btn`,"data-mtype":t,title:a,children:[{el:"i",className:"icon fas fa-"+o}]}:{el:"div",title:"배틀을 끝까지 완료 후 리뷰 플레이가 가능합니다.",children:[{el:"button",className:"rewind-book-btn btn w-100",disabled:!0,children:[{el:"i",className:"icon fas fa-"+o}]}]})}]}]}:{el:"div",className:"book js-open-overview col text-center",dataset:{bid:e||t,title:o,bookType:g[a],description:s,imagePath:i||"",completed:n,price:l,openType:r},style:"order: "+c,children:[{el:"div",className:p,children:[{el:"img",src:"https://static.findsvoc.com/images/app/workbook/bookcover/book_paper.png",style:b}]},{el:"div",className:"title-text-section",children:[d]}]}}))}$(".battle-book-list").one("show.bs.collapse",function(){let t=this.className.match(/subscription|theme|grammar/);if(t){t=t[0];const o=this.querySelector(".book-list-container");null!=o&&$.ajax({url:`/craft/battlebook/${t}/list`,success:e=>{Array.prototype.isPrototypeOf(e)?(this.setAttribute("initialized",!0),e&&0!=e.length&&o.appendChild(p(e,t))):alertModal("올바른 데이터를 받지 못했습니다.\n로그인 화면으로 이동합니다.",()=>location.assign("/auth/login?destPage=/craft/main"))},error:e=>{401==e.status?alertModal("접속시간이 초과되었습니다.\n로그인 화면으로 이동합니다.",()=>location.assign("/auth/login?destPage=/craft/main")):alertModal("배틀북 조회에 실패했습니다.\n화면 새로고침 후 다시 시도해 주세요.")}})}}),c&&["A","S","M"].includes(d)&&"true"==sessionStorage.getItem("subscriptionBattleOpened")&&$(".battle-book-list.subscription").collapse("show");let b=devSize.isPhone()?3:devSize.isTablet()?4:5;$(window).on("resize",function(){b=devSize.isPhone()?3:devSize.isTablet()?4:5,$(".battlebook-overview-section").each(function(){var e=$(this).data("targetBook");e&&(this.style.order=(Math.floor(e.style.order/b)+1)*b)})});const m={T:"클래스용",P:"회원/비회원",M:"회원용"};function h(e){const t=e.match(/(?:craft\/battle\/\w+\/\w\/)(\w+)/)[1];var o;a.includes(t)?location.assign(e):(o=document.getElementById("askMembershipModal")||document.body.appendChild(createElement({el:"div",id:"askMembershipModal","data-bs-backdrop":"static","data-bs-return":"0",class:"modal fade",tabIndex:0,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-header bg-fc-purple py-1 px-3",children:[{el:"h5",class:"modal-title",textContent:"이용 안내"},{el:"button",class:"btn fas fa-times text-light p-0","data-bs-dismiss":"modal","aria-label":"Close"}]},{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section mb-3 text-center text-dark",innerHTML:"<span class='app-name-text'>fico</span> 이용자 <b class='text-fc-red'>가입</b>시 테스트 <b>진행기록</b>과 <b>전적 정보</b>가 <b>저장</b>되어 다음에도 로그인없이 배틀을 <b>이어서 이용</b>할 수 있습니다."},{el:"div",className:"col text-center",children:[{el:"button",class:"btn btn-fico w-100",innerHTML:"<b>예</b><br><span class='fs-7'>(이용자 간편가입)</span>",onclick:()=>{location.assign("/membership/free?destPage="+e)}}]},{el:"div",className:"col text-center",children:[{el:"button",class:"btn btn-outline-fico w-100",innerHTML:"<b>아니오</b><br><span class='fs-7'>(가입없이 진행)</span>",onclick:()=>{a.push(t),localStorage.setItem("wanderingBooks",JSON.stringify(a)),location.assign(e)}}]}]}]}]}]})),$(o).modal("show"))}function f(){const t=(parseInt($("#correctRecord").text())/parseInt($("#totalRecord").text())*100||0).toFixed(1),o=$(".winning-rate-cover .bar"),a=$(".winning-rate-cover .needle"),s=$(".winning-rate-cover .rate-text"),i=$(".personal-info-block .rate-text-section"),n={now:0};anime({targets:n,now:100,easing:"easeOutQuad",delay:500,update:e=>{o.css("transform",`rotate(${45+1.8*n.now*t/100}deg)`),a.add(i).css("transform",`rotate(${1.8*n.now*t/100-90}deg)`),s.text((n.now*t/100).toFixed(1))}})}$(document).on("click",".js-open-overview",function(){const o=$(this).siblings(".battlebook-overview-section"),{bid:e,title:a,description:s,imagePath:i,price:n,openType:l,completed:r}=this.dataset;o.data("targetBook")==this?(o.collapse("hide"),o.data("targetBook",null)):(o.data("targetBook",this),$.getJSON("/craft/battlebook/overview/"+ntoa(e),e=>{(t=this.closest(".battle-book-list").className.match(/subscription|theme|grammar/))&&t[0];var t=(Math.floor(this.style.order/b)+1)*b,t=(o.css("order",t),o.is(".show")?o[0].scrollIntoView({behavior:"smooth",block:"nearest"}):o.collapse("show"),o.find(".book-title").text(a),o.find(".book-cover"));0<i?.length?t.removeClass("default").find("img").css("background-image",`url(/resource/battlebook/cover/${i})`):t.addClass("default").find("img").css("background-image",""),o.find(".description").html(s),o.find(".book-open-type").text(m[l]).attr("data-open",l),o.find(".book-price").text(n.toLocaleString()),o.find(".sub-btn").toggleClass("bg-secondary",0==c&&"P"!=l||0==c&&"true"==r||0!=c&&!!e||!e&&"U"==d).prop("disabled",0==c&&"P"!=l||0==c&&"true"==r||0!=c&&!!e||!e&&"U"==d).html(0==c?"P"==l?"true"==r?"플레이 완료":'<i class="fas fa-play me-3"></i>바로 플레이':"회원 전용":e?"구독중":"U"==d?"구독 불가 (멤버십 만료)":"구독")}).fail(()=>alertModal("배틀북 정보 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$(".battlebook-overview-section, .battle-book-list").on("shown.bs.collapse",function(e){"subscription"==this.className.match(/subscription|theme|grammar/)&&sessionStorage.setItem("subscriptionBattleOpened","true"),e.stopPropagation(),this.scrollIntoView({behavior:"smooth",block:"nearest"})}).on("hide.bs.collapse",function(){"subscription"==this.className.match(/subscription|theme|grammar/)&&sessionStorage.setItem("subscriptionBattleOpened","false")}),$(".battlebook-overview-section").on("click",".sub-btn",function(){const{bid:e,title:t,openType:o,bookType:a,completed:s}=$(this).closest(".battlebook-overview-section").data("targetBook").dataset;if(!c)return"P"==o?Cookies.get("FMID")?void location.assign(n+a+`/b/${ntoa(parseInt(e))}?title=${encodeURIComponent(t)}&bookType=${a}&completed=${s}&wanderer=`+i):void h(n+a+`/b/${ntoa(parseInt(e))}?title=${encodeURIComponent(t)}&bookType=${a}&completed=${s}&wanderer=`+i):void(confirmModal("fico 멤버십이 필요합니다.\n로그인 화면으로 이동하시겠습니까?")&&location.assign("/auth/login"));$.post("/craft/battlebook/subscription/"+e,e=>{switch(e){case"success":alertModal(`"${t}"을(를) 구독하였습니다.
개인별 학습에서 구독한 배틀북을 확인할 수 있습니다.
녹색 플레이 버튼을 눌러 배틀을 풀어보세요`,()=>{$(this).prop("disabled",!0).text("구독중"),$(".battle-book-list.subscription").attr("initialized")?$.getJSON("/craft/battlebook/subscription/list",e=>{$(".my-book-type.subscription .book-list-container").empty().append(p(e,"subscription")).collapse("show")}):$(".battle-book-list.subscription").collapse("show")});break;case"duplicated":alertModal("이미 구독한 배틀북입니다.\n'개인별 학습'을 참고해 주세요.");break;case"insufficient":alertModal("잔여 fico 코인이 부족합니다.")}}).fail(()=>alertModal("배틀북 구독에 실패했습니다. 화면 새로고침 후 다시 시도해 주세요."))}),$(document).on("click",".js-play-step",function(){i?location.assign("/membership/free"):!c&&Cookies?.get("EID")?location.assign("/auth/login?destPage=/craft/main"):location.assign(n+"step/b?title=단계별 학습&bookType=step&wanderer="+i)}).on("click",".js-play-book",function(){var{bid:e,title:t,bookType:o,completed:a}=this.closest(".book").dataset,s=this.dataset.mtype,e="step"===o?"":"/"+ntoa(e),a=void 0===a?"":"&completed="+a;i?h(n+o+`/${s}${e}?title=${encodeURIComponent(t)}&bookType=${o}${a}&wanderer=`+i):location.assign(n+o+`/${s}${e}?title=${encodeURIComponent(t)}&bookType=${o}${a}&wanderer=`+i)})}